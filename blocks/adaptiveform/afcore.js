import{_ as e,a as t,b as n,c as r,d as i}from"./lite.js";var o,u;console.time("script json-formula");var s=0,a=2,l=3,c=5,h=7,f=8,d=9,p=((o={})[s]="number",o[1]="any",o[a]="string",o[l]="array",o[4]="object",o[c]="boolean",o[6]="expression",o[h]="null",o[f]="Array<number>",o[d]="Array<string>",o[10]="class",o[11]="Array<array>",o);function v(e,t){if(void 0===t&&(t=!0),null===e)return h;var n=e;if(t){if("function"!=typeof e.valueOf)return 4;n=e.valueOf.call(e)}switch(Object.prototype.toString.call(n)){case"[object String]":return a;case"[object Number]":return s;case"[object Array]":return l;case"[object Boolean]":return c;case"[object Null]":return h;case"[object Object]":return"Expref"===n.jmespathType?6:4;default:return 4}}function _(e){return[v(e),v(e,!1)]}function y(e,t,n,r,i,o){var u=e[0];if(-1!==t.findIndex(function(e){return 1===e||u===e}))return n;var v=!1;if((4===u||1===t.length&&10===t[0])&&(v=!0),u===l&&1===t.length&&4===t[0]&&(v=!0),t.includes(11)){if(u===l&&(n.forEach(function(e){e instanceof Array||(v=!0)}),!v))return n;v=!0}if(v)throw new Error("TypeError: "+r+" expected argument to be type "+p[t[0]]+" but received type "+p[u]+" instead.");var g=-1;if(u===l&&t.includes(d)&&t.includes(f)&&(g=n.length>0&&"string"==typeof n[0]?d:f),-1===g&&[d,f,l].includes(u)&&(g=t.find(function(e){return[d,f,l].includes(e)})),-1===g&&(g=t[0]),1===g)return n;if(g===d||g===f||g===l){if(g===l)return u===f||u===d?n:null===n?[]:[n];var m=g===f?s:a;if(u===l){for(var b=n.slice(),j=0;j<b.length;j+=1){var x=_(b[j]);b[j]=y(x,[m],b[j],r,i,o)}return b}if([s,a,h,c].includes(m))return[y(e,[m],n,r,i,o)]}else{if(g===s)return[a,c,h].includes(u)?i(n):0;if(g===a)return u===h||4===u?"":o(n);if(g===c)return!!n;if(4===g&&4===e[1])return n}throw new Error("unhandled argument")}function g(e){return null!==e&&"[object Array]"===Object.prototype.toString.call(e)}function m(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function b(e){return null==e?e:g(e)?e.map(function(e){return b(e)}):"function"!=typeof e.valueOf?e:e.valueOf()}function j(e,t){var n=b(e),r=b(t);if(n===r)return!0;if(Object.prototype.toString.call(n)!==Object.prototype.toString.call(r))return!1;if(!0===g(n)){if(n.length!==r.length)return!1;for(var i=0;i<n.length;i+=1)if(!1===j(n[i],r[i]))return!1;return!0}if(!0===m(n)){var o={};for(var u in n)if(hasOwnProperty.call(n,u)){if(!1===j(n[u],r[u]))return!1;o[u]=!0}for(var s in r)if(hasOwnProperty.call(r,s)&&!0!==o[s])return!1;return!0}return!1}function x(e){if(null===e)return!0;var t=b(e);if(""===t||!1===t||null===t)return!0;if(g(t)&&0===t.length)return!0;if(m(t)){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))return!1;return!0}return!t}var E=/*#__PURE__*/function(){function e(e,t,n,r,i,o){this.runtime=e,this.globals=t,this.toNumber=n,this.toString=r,this.debug=i,this.language=o}var t=e.prototype;return t.search=function(e,t){return this.visit(e,t)},t.visit=function(e,t){var n,r=this,i=e&&(n={Field:function(e,t){if(null!==t&&(m(t)||g(t))){var n=t[e.name];if("function"==typeof n&&(n=void 0),void 0===n){try{r.debug.push("Failed to find: '"+e.name+"'");var i=Object.keys(t).map(function(e){return"'"+e+"'"}).toString();i.length&&r.debug.push("Available fields: "+i)}catch(e){}return null}return n}return null},Subexpression:function(e,t){for(var n=r.visit(e.children[0],t),i=1;i<e.children.length;i+=1)if(null===(n=r.visit(e.children[1],n)))return null;return n},IndexExpression:function(e,t){var n=r.visit(e.children[0],t);return r.visit(e.children[1],n)},Index:function(e,t){if(g(t)){var n=r.toNumber(r.visit(e.value,t));n<0&&(n=t.length+n);var i=t[n];return void 0===i?(r.debug.push("Index "+n+" out of range"),null):i}if(m(t)){var o=r.toString(r.visit(e.value,t)),u=t[o];return void 0===u?(r.debug.push("Key "+o+" does not exist"),null):u}return r.debug.push("left side of index expression "+t+" is not an array or object."),null},Slice:function(e,t){if(!g(t))return null;var n=e.children.slice(0).map(function(e){return null!=e?r.toNumber(r.visit(e,t)):null}),i=r.computeSliceParams(t.length,n),o=i[0],u=i[1],s=i[2],a=[];if(s>0)for(var l=o;l<u;l+=s)a.push(t[l]);else for(var c=o;c>u;c+=s)a.push(t[c]);return a},Projection:function(e,t){var n=r.visit(e.children[0],t);if(!g(n))return null;var i=[];return n.forEach(function(t){var n=r.visit(e.children[1],t);null!==n&&i.push(n)}),i},ValueProjection:function(e,t){var n=r.visit(e.children[0],t);if(!m(b(n)))return null;var i=[];return Object.values(n).forEach(function(t){var n=r.visit(e.children[1],t);null!==n&&i.push(n)}),i},FilterProjection:function(e,t){var n=r.visit(e.children[0],t);if(!g(n))return null;var i=n.filter(function(t){return!x(r.visit(e.children[2],t))}),o=[];return i.forEach(function(t){var n=r.visit(e.children[1],t);null!==n&&o.push(n)}),o},Comparator:function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);if("EQ"===e.name)return j(n,i);if("NE"===e.name)return!j(n,i);if("GT"===e.name)return n>i;if("GTE"===e.name)return n>=i;if("LT"===e.name)return n<i;if("LTE"===e.name)return n<=i;throw new Error("Unknown comparator: "+e.name)}},n.Flatten=function(e,t){var n=r.visit(e.children[0],t);if(!g(n))return null;var i=[];return n.forEach(function(e){g(e)?i.push.apply(i,e):i.push(e)}),i},n.Identity=function(e,t){return t},n.MultiSelectList=function(e,t){return null===t?null:e.children.map(function(e){return r.visit(e,t)})},n.MultiSelectHash=function(e,t){if(null===t)return null;var n={};return e.children.forEach(function(e){n[e.name]=r.visit(e.value,t)}),n},n.OrExpression=function(e,t){var n=r.visit(e.children[0],t);return x(n)&&(n=r.visit(e.children[1],t)),n},n.AndExpression=function(e,t){var n=r.visit(e.children[0],t);return!0===x(n)?n:r.visit(e.children[1],t)},n.AddExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"+")},n.ConcatenateExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return n=y(_(n),[2,9],n,"concatenate",r.toNumber,r.toString),i=y(_(i),[2,9],i,"concatenate",r.toNumber,r.toString),r.applyOperator(n,i,"&")},n.UnionExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return n=y(_(n),[3],n,"union",r.toNumber,r.toString),i=y(_(i),[3],i,"union",r.toNumber,r.toString),n.concat(i)},n.SubtractExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"-")},n.MultiplyExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"*")},n.DivideExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"/")},n.PowerExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"^")},n.NotExpression=function(e,t){return x(r.visit(e.children[0],t))},n.Literal=function(e){return e.value},n.Number=function(e){return e.value},n.Pipe=function(e,t){var n=r.visit(e.children[0],t);return r.visit(e.children[1],n)},n.Current=function(e,t){return t},n.Global=function(e){var t=r.globals[e.name];return void 0===t?null:t},n.Function=function(e,t){if("if"===e.name)return r.runtime.callFunction(e.name,e.children,t,r,!1);var n=e.children.map(function(e){return r.visit(e,t)});return r.runtime.callFunction(e.name,n,t,r)},n.ExpressionReference=function(e){var t=e.children[0];return t.jmespathType="Expref",t},n)[e.type];if(!i)throw new Error("Unknown/missing node type "+(e&&e.type||""));return i(e,t)},t.computeSliceParams=function(e,t){function n(e,t,n){var r=t;return r<0?(r+=e)<0&&(r=n<0?-1:0):r>=e&&(r=n<0?e-1:e),r}var r=t[0],i=t[1],o=t[2];if(null===o)o=1;else if(0===o){var u=new Error("Invalid slice, step cannot be 0");throw u.name="RuntimeError",u}var s=o<0;return[r=null===r?s?e-1:0:n(e,r,o),i=null===i?s?-1:e:n(e,i,o),o]},t.applyOperator=function(e,t,n){var r=this;if(g(e)&&g(t)){var i=e.length<t.length?e:t,o=Math.abs(e.length-t.length);i.length+=o,i.fill(null,i.length-o);for(var u=[],s=0;s<e.length;s+=1)u.push(this.applyOperator(e[s],t[s],n));return u}if(g(e))return e.map(function(e){return r.applyOperator(e,t,n)});if(g(t))return t.map(function(t){return r.applyOperator(e,t,n)});if("*"===n)return this.toNumber(e)*this.toNumber(t);if("&"===n)return e+t;if("+"===n)return this.toNumber(e)+this.toNumber(t);if("-"===n)return this.toNumber(e)-this.toNumber(t);if("/"===n){var a=e/t;return Number.isFinite(a)?a:null}if("^"===n)return Math.pow(e,t);throw new Error("Unknown operator: "+n)},e}(),M="UnquotedIdentifier",k="QuotedIdentifier",w="Rbracket",D="Rparen",N="Comma",O="Colon",S="Number",T="Current",I="Pipe",C="Or",P="And",R="Dot",$="Lbracket",F="Literal",A={".":R,",":N,":":O,"{":"Lbrace","}":"Rbrace","]":w,"(":"Lparen",")":D,"@":T},q={"<":!0,">":!0,"=":!0,"!":!0},L={" ":!0,"\t":!0,"\n":!0};function U(e,t){return e>="0"&&e<="9"||t&&"-"===e||"."===e}function z(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e}function V(e,t){var n=e[t];return"$"===n?e.length>t&&z(e[t+1]):n>="a"&&n<="z"||n>="A"&&n<="Z"||"_"===n}var G=/*#__PURE__*/function(){function e(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this._allowedGlobalNames=e,this.debug=t}var t=e.prototype;return t.tokenize=function(e){var t,n,r,i=[];for(this._current=0;this._current<e.length;){var o=i.length?i.slice(-1)[0].type:null;if(this._isGlobal(o,e,this._current))i.push(this._consumeGlobal(e));else if(V(e,this._current))t=this._current,n=this._consumeUnquotedIdentifier(e),i.push({type:M,value:n,start:t});else if(void 0!==A[e[this._current]])i.push({type:A[e[this._current]],value:e[this._current],start:this._current}),this._current+=1;else if("-"===e[this._current]&&![T,S,D,M,k,w].includes(o)||U(e[this._current],!1))r=this._consumeNumber(e),i.push(r);else if("["===e[this._current])r=this._consumeLBracket(e),i.push(r);else if('"'===e[this._current])t=this._current,n=this._consumeQuotedIdentifier(e),i.push({type:k,value:n,start:t});else if("'"===e[this._current])t=this._current,n=this._consumeRawStringLiteral(e),i.push({type:F,value:n,start:t});else if("`"===e[this._current]){t=this._current;var u=this._consumeLiteral(e);i.push({type:F,value:u,start:t})}else if(void 0!==q[e[this._current]])i.push(this._consumeOperator(e));else if(void 0!==L[e[this._current]])this._current+=1;else if("&"===e[this._current])t=this._current,this._current+=1,"&"===e[this._current]?(this._current+=1,i.push({type:P,value:"&&",start:t})):i.push(o===N||"Lparen"===o?{type:"Expref",value:"&",start:t}:{type:"Concatenate",value:"&",start:t});else if("~"===e[this._current])t=this._current,this._current+=1,i.push({type:"Union",value:"~",start:t});else if("+"===e[this._current])t=this._current,this._current+=1,i.push({type:"Add",value:"+",start:t});else if("-"===e[this._current])t=this._current,this._current+=1,i.push({type:"Subtract",value:"-",start:t});else if("*"===e[this._current]){t=this._current,this._current+=1;var s=i.length&&i.slice(-1)[0].type;0===i.length||[$,R,I,P,C,N,O].includes(s)?i.push({type:"Star",value:"*",start:t}):i.push({type:"Multiply",value:"*",start:t})}else if("/"===e[this._current])t=this._current,this._current+=1,i.push({type:"Divide",value:"/",start:t});else if("^"===e[this._current])t=this._current,this._current+=1,i.push({type:"Power",value:"^",start:t});else{if("|"!==e[this._current]){var a=new Error("Unknown character:"+e[this._current]);throw a.name="LexerError",a}t=this._current,this._current+=1,"|"===e[this._current]?(this._current+=1,i.push({type:C,value:"||",start:t})):i.push({type:I,value:"|",start:t})}}return i},t._consumeUnquotedIdentifier=function(e){var t=this._current;for(this._current+=1;this._current<e.length&&z(e[this._current]);)this._current+=1;return e.slice(t,this._current)},t._consumeQuotedIdentifier=function(e){var t=this._current;this._current+=1;for(var n=e.length,r=!V(e,t+1);'"'!==e[this._current]&&this._current<n;){var i=this._current;z(e[i])||(r=!0),this._current=i+="\\"!==e[i]||"\\"!==e[i+1]&&'"'!==e[i+1]?1:2}this._current+=1;var o=e.slice(t,this._current);try{r&&!o.includes(" ")||(this.debug.push("Suspicious quotes: "+o),this.debug.push("Did you intend a literal? '"+o.replace(/"/g,"")+"'?"))}catch(e){}return JSON.parse(o)},t._consumeRawStringLiteral=function(e){var t=this._current;this._current+=1;for(var n=e.length;"'"!==e[this._current]&&this._current<n;){var r=this._current;this._current=r+="\\"!==e[r]||"\\"!==e[r+1]&&"'"!==e[r+1]?1:2}return this._current+=1,e.slice(t+1,this._current-1).replaceAll("\\'","'")},t._consumeNumber=function(e){var t=this._current;this._current+=1;for(var n=e.length;U(e[this._current],!1)&&this._current<n;)this._current+=1;var r,i=e.slice(t,this._current);return r=i.includes(".")?parseFloat(i):parseInt(i,10),{type:S,value:r,start:t}},t._consumeLBracket=function(e){var t=this._current;return this._current+=1,"?"===e[this._current]?(this._current+=1,{type:"Filter",value:"[?",start:t}):"]"===e[this._current]?(this._current+=1,{type:"Flatten",value:"[]",start:t}):{type:$,value:"[",start:t}},t._isGlobal=function(e,t,n){if(null!==e&&e===R)return!1;if("$"!==t[n])return!1;for(var r=n+1;r<t.length&&z(t[r]);)r+=1;var i=t.slice(n,r);return this._allowedGlobalNames.includes(i)},t._consumeGlobal=function(e){var t=this._current;for(this._current+=1;this._current<e.length&&z(e[this._current]);)this._current+=1;return{type:"Global",name:e.slice(t,this._current),start:t}},t._consumeOperator=function(e){var t=this._current,n=e[t];return this._current+=1,"!"===n?"="===e[this._current]?(this._current+=1,{type:"NE",value:"!=",start:t}):{type:"Not",value:"!",start:t}:"<"===n?"="===e[this._current]?(this._current+=1,{type:"LTE",value:"<=",start:t}):{type:"LT",value:"<",start:t}:">"===n?"="===e[this._current]?(this._current+=1,{type:"GTE",value:">=",start:t}):{type:"GT",value:">",start:t}:"="===e[this._current]?(this._current+=1,{type:"EQ",value:"==",start:t}):{type:"EQ",value:"=",start:t}},t._consumeLiteral=function(e){this._current+=1;for(var t,n=this._current,r=e.length,i=!1;(i||"`"!==e[this._current])&&this._current<r;){var o=this._current;i&&"\\"===e[o]&&'"'===e[o+1]?o+=2:('"'===e[o]&&(i=!i),o+=i&&"`"===e[o+1]?2:"\\"!==e[o]||"\\"!==e[o+1]&&"`"!==e[o+1]?1:2),this._current=o}var u=e.slice(n,this._current).trimStart();return t=function(e){if(""===e)return!1;if('[{"'.includes(e[0]))return!0;if(["true","false","null"].includes(e))return!0;if(!"-0123456789".includes(e[0]))return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(u=u.replaceAll("\\`","`"))?JSON.parse(u):JSON.parse('"'+u+'"'),this._current+=1,t},e}(),Q="Colon",J="UnquotedIdentifier",H="QuotedIdentifier",B="Rbracket",W="Rparen",Y="Comma",K="Concatenate",Z="Rbrace",X="Number",ee="Current",te="Global",ne="Field",re="Pipe",ie="Subtract",oe="Multiply",ue="Flatten",se="Star",ae="Filter",le="Lbrace",ce="Lbracket",he="Lparen",fe=((u={}).EOF=0,u[J]=0,u[H]=0,u[B]=0,u[W]=0,u[Y]=0,u[Z]=0,u[X]=0,u[ee]=0,u[te]=0,u[ne]=0,u.Expref=0,u[re]=1,u.Or=2,u.And=3,u.Add=6,u[ie]=6,u[K]=7,u[oe]=7,u.Divide=7,u.Power=7,u.Union=7,u.EQ=5,u.GT=5,u.LT=5,u.GTE=5,u.LTE=5,u.NE=5,u[ue]=9,u[se]=20,u[ae]=21,u.Dot=40,u.Not=45,u[le]=50,u[ce]=55,u[he]=60,u),de=/*#__PURE__*/function(){function e(e){void 0===e&&(e=[]),this._allowedGlobalNames=e}var t=e.prototype;return t.parse=function(e,t){this._loadTokens(e,t),this.index=0;var n=this.expression(0);if("EOF"!==this._lookahead(0)){var r=this._lookaheadToken(0),i=new Error("Unexpected token type: "+r.type+", value: "+r.value);throw i.name="ParserError",i}return n},t._loadTokens=function(e,t){var n=new G(this._allowedGlobalNames,t).tokenize(e);n.push({type:"EOF",value:"",start:e.length}),this.tokens=n},t.expression=function(e){var t=this._lookaheadToken(0);this._advance();for(var n=this.nud(t),r=this._lookahead(0);e<fe[r];)this._advance(),n=this.led(r,n),r=this._lookahead(0);return n},t._lookahead=function(e){return this.tokens[this.index+e].type},t._lookaheadToken=function(e){return this.tokens[this.index+e]},t._advance=function(){this.index+=1},t._getIndex=function(){return this.index},t._setIndex=function(e){this.index=e},t.nud=function(e){var t,n,r;switch(e.type){case"Literal":return{type:"Literal",value:e.value};case X:return{type:"Number",value:e.value};case J:return{type:"Field",name:e.value};case H:if(n={type:"Field",name:e.value},this._lookahead(0)===he)throw new Error("Quoted identifier not allowed for function names.");return n;case"Not":return{type:"NotExpression",children:[this.expression(fe.Not)]};case se:return{type:"ValueProjection",children:[{type:"Identity"},this._lookahead(0)===B?{type:"Identity"}:this._parseProjectionRHS(fe.Star)]};case ae:return this.led(e.type,{type:"Identity"});case le:return this._parseMultiselectHash();case ue:return{type:"Projection",children:[{type:ue,children:[{type:"Identity"}]},this._parseProjectionRHS(fe.Flatten)]};case ce:return this._lookahead(0)===se&&this._lookahead(1)===B?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},this._parseProjectionRHS(fe.Star)]}):this._parseUnchainedIndexExpression();case ee:return{type:ee};case te:return{type:te,name:e.name};case ne:return{type:ne};case"Expref":return{type:"ExpressionReference",children:[t=this.expression(fe.Expref)]};case he:for(r=[];this._lookahead(0)!==W;)t=this.expression(0),r.push(t);return this._match(W),r[0];default:this._errorToken(e)}},t.led=function(e,t){var n,r,i,o,u,s;switch(e){case K:return{type:"ConcatenateExpression",children:[t,r=this.expression(fe.Concatenate)]};case"Dot":return s=fe.Dot,this._lookahead(0)!==se?{type:"Subexpression",children:[t,r=this._parseDotRHS(s)]}:(this._advance(),{type:"ValueProjection",children:[t,r=this._parseProjectionRHS(s)]});case re:return r=this.expression(fe.Pipe),{type:re,children:[t,r]};case"Or":return{type:"OrExpression",children:[t,r=this.expression(fe.Or)]};case"And":return{type:"AndExpression",children:[t,r=this.expression(fe.And)]};case"Add":return{type:"AddExpression",children:[t,r=this.expression(fe.Add)]};case ie:return{type:"SubtractExpression",children:[t,r=this.expression(fe.Subtract)]};case oe:return{type:"MultiplyExpression",children:[t,r=this.expression(fe.Multiply)]};case"Divide":return{type:"DivideExpression",children:[t,r=this.expression(fe.Divide)]};case"Power":return{type:"PowerExpression",children:[t,r=this.expression(fe.Power)]};case"Union":return{type:"UnionExpression",children:[t,r=this.expression(fe.Power)]};case he:for(i=t.name,o=[];this._lookahead(0)!==W;)u=this.expression(0),this._lookahead(0)===Y&&this._match(Y),o.push(u);return this._match(W),{type:"Function",name:i,children:o};case ae:return n=this.expression(0),this._match(B),{type:"FilterProjection",children:[t,r=this._lookahead(0)===ue?{type:"Identity"}:this._parseProjectionRHS(fe.Filter),n]};case ue:return{type:"Projection",children:[{type:ue,children:[t]},this._parseProjectionRHS(fe.Flatten)]};case"EQ":case"NE":case"GT":case"GTE":case"LT":case"LTE":return this._parseComparator(t,e);case ce:return this._lookahead(0)===se&&this._lookahead(1)===B?(this._advance(),this._advance(),{type:"Projection",children:[t,r=this._parseProjectionRHS(fe.Star)]}):(r=this._parseChainedIndexExpression(),this._projectIfSlice(t,r));default:this._errorToken(this._lookaheadToken(0))}},t._match=function(e){if(this._lookahead(0)!==e){var t=this._lookaheadToken(0),n=new Error("Expected "+e+", got: "+t.type);throw n.name="ParserError",n}this._advance()},t._errorToken=function(e){var t=new Error("Invalid token ("+e.type+'): "'+e.value+'"');throw t.name="ParserError",t},t._parseChainedIndexExpression=function(){var e=this._getIndex();if(this._lookahead(0)===Q)return this._parseSliceExpression();var t=this.expression(0);return this._lookahead(0)===Q?(this._setIndex(e),this._parseSliceExpression()):(this._match(B),{type:"Index",value:t})},t._parseUnchainedIndexExpression=function(){var e=this._getIndex(),t=this._lookahead(0);if(t===Q){var n=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},n)}var r=this.expression(0),i=this._lookahead(0);if(i===Y)return this._setIndex(e),this._parseMultiselectList();if(i===Q){this._setIndex(e);var o=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},o)}return t===X?(this._match(B),{type:"Index",value:r}):(this._setIndex(e),this._parseMultiselectList())},t._projectIfSlice=function(e,t){var n={type:"IndexExpression",children:[e,t]};return"Slice"===t.type?{type:"Projection",children:[n,this._parseProjectionRHS(fe.Star)]}:n},t._parseSliceExpression=function(){for(var e=[null,null,null],t=0,n=this._lookahead(0);n!==B&&t<3;){if(n===Q&&t<2)t+=1,this._advance();else{e[t]=this.expression(0);var r=this._lookahead(0);if(r!==Q&&r!==B){var i=new Error("Syntax error, unexpected token: "+r.value+"("+r.type+")");throw i.name="Parsererror",i}}n=this._lookahead(0)}return this._match(B),{type:"Slice",children:e}},t._parseComparator=function(e,t){return{type:"Comparator",name:t,children:[e,this.expression(fe[t])]}},t._parseDotRHS=function(e){var t=this._lookahead(0);return[J,H,se].indexOf(t)>=0?this.expression(e):t===ce?(this._match(ce),this._parseMultiselectList()):t===le?(this._match(le),this._parseMultiselectHash()):void 0},t._parseProjectionRHS=function(e){var t;if(fe[this._lookahead(0)]<10)t={type:"Identity"};else if(this._lookahead(0)===ce)t=this.expression(e);else if(this._lookahead(0)===ae)t=this.expression(e);else{if("Dot"!==this._lookahead(0)){var n=this._lookaheadToken(0),r=new Error("Sytanx error, unexpected token: "+n.value+"("+n.type+")");throw r.name="ParserError",r}this._match("Dot"),t=this._parseDotRHS(e)}return t},t._parseMultiselectList=function(){for(var e=[];this._lookahead(0)!==B;){var t=this.expression(0);if(e.push(t),this._lookahead(0)===Y&&(this._match(Y),this._lookahead(0)===B))throw new Error("Unexpected token Rbracket")}return this._match(B),{type:"MultiSelectList",children:e}},t._parseMultiselectHash=function(){var e,t,n,r=[],i=[J,H];if(this._lookahead(0)===Z)return this._advance(),{type:"MultiSelectHash",children:[]};for(;;){if(e=this._lookaheadToken(0),i.indexOf(e.type)<0)throw new Error("Expecting an identifier token, got: "+e.type);if(t=e.value,this._advance(),this._match(Q),n=this.expression(0),r.push({type:"KeyValuePair",name:t,value:n}),this._lookahead(0)===Y)this._match(Y);else if(this._lookahead(0)===Z){this._match(Z);break}}return{type:"MultiSelectHash",children:r}},e}();function pe(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var ve=new function(){var t;function n(e){return null==e?"":e.toString()}var r=/*#__PURE__*/function(){function r(){}var i=r.prototype;return i.addFunctions=function(r,i){void 0===i&&(i={}),this.functionTable=e({},function(e,t,n,r,i,o,u){var s=0,a=2;function l(t,n){return function(r){var o=e.visit(t,r);if(n.indexOf(i(o))<0){var u="TypeError: expected one of "+n+", received "+i(o);throw new Error(u)}return o}}return{abs:{_func:function(e){return Math.abs(e[0])},_signature:[{types:[s]}]},avg:{_func:function(e){var t=0,n=e[0];return n.forEach(function(e){t+=e}),t/n.length},_signature:[{types:[8]}]},ceil:{_func:function(e){return Math.ceil(e[0])},_signature:[{types:[s]}]},contains:{_func:function(e){return o(e[0]).indexOf(o(e[1]))>=0},_signature:[{types:[a,3]},{types:[1]}]},endsWith:{_func:function(e){var t=o(e[0]),n=o(e[1]);return-1!==t.indexOf(n,t.length-n.length)},_signature:[{types:[a]},{types:[a]}]},floor:{_func:function(e){return Math.floor(e[0])},_signature:[{types:[s]}]},length:{_func:function(e){var r=o(e[0]);return t(r)?Object.keys(r).length:n(r)?r.length:u(r).length},_signature:[{types:[a,3,4]}]},map:{_func:function(t){var n=t[0];return t[1].map(function(t){return e.visit(n,t)})},_signature:[{types:[6]},{types:[3]}]},reduce:{_func:function(t){var n=t[0];return t[1].reduce(function(t,r,i,o){return e.visit(n,{accumulated:t,current:r,index:i,array:o})},3===t.length?t[2]:null)},_signature:[{types:[6]},{types:[3]},{types:[1],optional:!0}]},max:{_func:function(e){if(e[0].length>0){var t=i(e[0][0]);return e[0].reduce(t===s?function(e,t){return r(e)>=r(t)?e:t}:function(e,t){return u(t).localeCompare(u(e))<0?e:t},e[0][0])}return null},_signature:[{types:[3,8,9]}]},merge:{_func:function(e){var t={};return e.forEach(function(e){Object.entries(e).forEach(function(e){t[e[0]]=e[1]})}),t},_signature:[{types:[4],variadic:!0}]},maxBy:{_func:function(e){var t,n,r=e[0],i=l(e[1],[s,a]),o=-Infinity;return r.forEach(function(e){(n=i(e))>o&&(o=n,t=e)}),t},_signature:[{types:[3]},{types:[6]}]},sum:{_func:function(e){var t=0;return e[0].forEach(function(e){t+=1*e}),t},_signature:[{types:[8]}]},startsWith:{_func:function(e){return o(e[0]).startsWith(o(e[1]))},_signature:[{types:[a]},{types:[a]}]},min:{_func:function(e){if(e[0].length>0){if(i(e[0][0])===s)return e[0].reduce(function(e,t){return r(e)<=r(t)?e:t},e[0][0]);for(var t=e[0],n=t[0],o=1;o<t.length;o+=1)u(t[o]).localeCompare(u(n))<0&&(n=t[o]);return n}return null},_signature:[{types:[3,8,9]}]},minBy:{_func:function(e){var t,n,r=e[0],i=l(e[1],[s,a]),o=Infinity;return r.forEach(function(e){(n=i(e))<o&&(o=n,t=e)}),t},_signature:[{types:[3]},{types:[6]}]},type:{_func:function(e){var t;return(t={},t[s]="number",t[a]="string",t[3]="array",t[4]="object",t[5]="boolean",t[6]="expref",t[7]="null",t)[i(e[0])]},_signature:[{types:[1]}]},keys:{_func:function(e){return null===e[0]?[]:Object.keys(e[0])},_signature:[{types:[1]}]},values:{_func:function(e){var t=o(e[0]);return null===t?[]:Object.values(t)},_signature:[{types:[1]}]},sort:{_func:function(e){var t=e[0].slice(0);if(t.length>0){var n=i(e[0][0])===s?r:u;t.sort(function(e,t){var r=n(e),i=n(t);return r<i?-1:r>i?1:0})}return t},_signature:[{types:[3,9,8]}]},sortBy:{_func:function(t){var n=t[0].slice(0);if(0===n.length)return n;var r=t[1],o=i(e.visit(r,n[0]));if([s,a].indexOf(o)<0)throw new Error("TypeError");for(var u=[],l=0;l<n.length;l+=1)u.push([l,n[l]]);u.sort(function(t,n){var u=e.visit(r,t[1]),s=e.visit(r,n[1]);if(i(u)!==o)throw new Error("TypeError: expected "+o+", received "+i(u));if(i(s)!==o)throw new Error("TypeError: expected "+o+", received "+i(s));return u>s?1:u<s?-1:t[0]-n[0]});for(var c=0;c<u.length;c+=1)n[c]=u[c][1];return n},_signature:[{types:[3]},{types:[6]}]},join:{_func:function(e){return e[1].join(e[0])},_signature:[{types:[a]},{types:[9]}]},reverse:{_func:function(e){var t=o(e[0]);if(i(t)===a){for(var n="",r=t.length-1;r>=0;r-=1)n+=t[r];return n}var u=e[0].slice(0);return u.reverse(),u},_signature:[{types:[a,3]}]},toArray:{_func:function(e){return 3===i(e[0])?e[0]:[e[0]]},_signature:[{types:[1]}]},toString:{_func:function(e){return i(e[0])===a?e[0]:JSON.stringify(e[0])},_signature:[{types:[1]}]},toNumber:{_func:function(e){var t=i(e[0]);return t===s?e[0]:t===a?r(e[0]):null},_signature:[{types:[1]}]},notNull:{_func:function(e){return e.find(function(e){return 7!==i(e)})||null},_signature:[{types:[1],variadic:!0}]},zip:{_func:function(e){for(var t=e.reduce(function(e,t){return Math.min(e,t.length)},e[0].length),n=new Array(t),r=function(t){n[t]=[],e.forEach(function(e){n[t].push(e[t])})},i=0;i<t;i+=1)r(i);return n},_signature:[{types:[3],variadic:!0}]}}}(this._interpreter,m,g,t,v,b,n),function(e,t,n,r){return void 0===r&&(r=[]),{casefold:{_func:function(e,n,r){return t(e[0]).toLocaleUpperCase(r.language).toLocaleLowerCase(r.language)},_signature:[{types:[2]}]},and:{_func:function(t){var n=!!e(t[0]);return t.slice(1).forEach(function(t){n=n&&!!e(t)}),n},_signature:[{types:[1],variadic:!0}]},deepScan:{_func:function(e){var t=e[0],n=e[1].toString(),r=[];return null===t||function e(t){Object.entries(t).forEach(function(t){var i=t[1];t[0]===n&&r.push(i),"object"==typeof i&&e(i)})}(t),r},_signature:[{types:[4,3,7]},{types:[2,0]}]},or:{_func:function(t){var n=!!e(t[0]);return t.slice(1).forEach(function(t){n=n||!!e(t)}),n},_signature:[{types:[1],variadic:!0}]},not:{_func:function(t){return!e(t[0])},_signature:[{types:[1]}]},null:{_func:function(){return null},_signature:[]},true:{_func:function(){return!0},_signature:[]},false:{_func:function(){return!1},_signature:[]},if:{_func:function(t,n,r){var i=t[1],o=t[2],u=r.visit(t[0],n);return e(u)?r.visit(i,n):r.visit(o,n)},_signature:[{types:[1]},{types:[1]},{types:[1]}]},substitute:{_func:function(e){var r=t(e[0]),i=t(e[1]),o=t(e[2]);if(e.length<=3)return r.replaceAll(i,o);var u=n(e[3]);if(u<1)return r;for(var s=-1,a=0;a<u;a+=1){var l=r.slice(s+=1).indexOf(i);if(-1===l)return r;s+=l}return r.slice(0,s)+r.slice(s).replace(i,o)},_signature:[{types:[2]},{types:[2]},{types:[2]},{types:[0],optional:!0}]},value:{_func:function(e){var t=e[0]||{},n=e[1],i=t[n];if(void 0===i){r.push("Failed to find: '"+n+"'");var o=Object.keys(t).map(function(e){return"'"+e+"'"}).toString();return o.length&&r.push("Available fields: "+o),null}return i},_signature:[{types:[4,3,7]},{types:[2,0]}]},lower:{_func:function(e){return t(e[0]).toLowerCase()},_signature:[{types:[2]}]},upper:{_func:function(e){return t(e[0]).toUpperCase()},_signature:[{types:[2]}]},exp:{_func:function(e){var t=n(e[0]);return Math.exp(t)},_signature:[{types:[0]}]},power:{_func:function(e){return Math.pow(n(e[0]),n(e[1]))},_signature:[{types:[0]},{types:[0]}]},find:{_func:function(e){var r=t(e[0]),i=t(e[1]),o=e.length>2?n(e[2]):0,u=i.indexOf(r,o);return-1===u?null:u},_signature:[{types:[2]},{types:[2]},{types:[0],optional:!0}]},left:{_func:function(e){var r=e.length>1?n(e[1]):1;return r<0?null:e[0]instanceof Array?e[0].slice(0,r):t(e[0]).substr(0,r)},_signature:[{types:[2,3]},{types:[0],optional:!0}]},right:{_func:function(e){var r=e.length>1?n(e[1]):1;if(r<0)return null;if(e[0]instanceof Array)return 0===r?[]:e[0].slice(-1*r);var i=t(e[0]);return i.substr(i.length-r,r)},_signature:[{types:[2,3]},{types:[0],optional:!0}]},mid:{_func:function(e){var r=n(e[1]),i=n(e[2]);return r<0?null:e[0]instanceof Array?e[0].slice(r,r+i):t(e[0]).substr(r,i)},_signature:[{types:[2,3]},{types:[0]},{types:[0]}]},mod:{_func:function(e){return n(e[0])%n(e[1])},_signature:[{types:[0]},{types:[0]}]},proper:{_func:function(e){return t(e[0]).split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}).join(" ")},_signature:[{types:[2]}]},rept:{_func:function(e){var r=t(e[0]),i=n(e[1]);return i<0?null:r.repeat(i)},_signature:[{types:[2]},{types:[0]}]},replace:{_func:function(e){var r=t(e[0]),i=n(e[1]),o=n(e[2]),u=t(e[3]);return i<0?null:r.substr(0,i)+u+r.substr(i+o)},_signature:[{types:[2]},{types:[0]},{types:[0]},{types:[2]}]},round:{_func:function(e){return pe(n(e[0]),n(e[1]))},_signature:[{types:[0]},{types:[0]}]},sqrt:{_func:function(e){var t=Math.sqrt(n(e[0]));return Number.isNaN(t)?null:t},_signature:[{types:[0]}]},stdevp:{_func:function(e){var t=e[0]||[];if(0===t.length)return null;var r=t.map(function(e){return n(e)}),i=r.reduce(function(e,t){return e+t},0)/t.length,o=r.reduce(function(e,t){return e+t*t},0)/t.length,u=Math.sqrt(o-i*i);return Number.isNaN(u)?null:u},_signature:[{types:[8]}]},stdev:{_func:function(e){var t=e[0]||[];if(t.length<=1)return null;var r=t.map(function(e){return n(e)}),i=r.reduce(function(e,t){return e+t},0)/t.length,o=r.reduce(function(e,t){return e+t*t},0),u=Math.sqrt((o-t.length*i*i)/(t.length-1));return Number.isNaN(u)?null:u},_signature:[{types:[8]}]},trim:{_func:function(e){return t(e[0]).split(" ").filter(function(e){return e}).join(" ")},_signature:[{types:[2]}]},trunc:{_func:function(e){var t=n(e[0]),r=e.length>1?n(e[1]):0;return(t>=0?Math.floor:Math.ceil)(t*Math.pow(10,r))/Math.pow(10,r)},_signature:[{types:[0]},{types:[0],optional:!0}]},charCode:{_func:function(e){var t=n(e[0]);return Number.isInteger(t)?String.fromCharCode(t):null},_signature:[{types:[0]}]},codePoint:{_func:function(e){var n=t(e[0]);return 0===n.length?null:n.codePointAt(0)},_signature:[{types:[2]}]},datetime:{_func:function(e){var r=n(e[0]),i=n(e[1]),o=n(e[2]),u=e.length>3?n(e[3]):0,s=e.length>4?n(e[4]):0,a=e.length>5?n(e[5]):0,l=e.length>6?n(e[6]):0,c=e.length>7?t(e[7]):null,h=new Date(r,i-1,o,u,s,a,l);return c&&(h=function(e,t){if(null===e)return null;var n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds());return n+=function(e,t){var n=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format(e),r=/GMT([+\-−])?(\d{1,2}):?(\d{0,2})?/.exec(n);if(!r)return 0;var i=r.slice(1),o=60*(60*(i[1]||0)+1*(i[2]||0))*1e3;return"-"===i[0]?-1*o:o}(e,t),new Date(n)}(h,c)),h.getTime()/864e5},_signature:[{types:[0]},{types:[0]},{types:[0]},{types:[0],optional:!0},{types:[0],optional:!0},{types:[0],optional:!0},{types:[0],optional:!0},{types:[2],optional:!0}]},datedif:{_func:function(e){var r=n(e[0]),i=n(e[1]),o=t(e[2]).toLowerCase();if(i===r)return 0;if(i<r)return null;if("d"===o)return Math.floor(i-r);var u=new Date(864e5*r),s=new Date(864e5*i),a=s.getFullYear()-u.getFullYear(),l=s.getMonth()-u.getMonth(),c=s.getDate()-u.getDate();if("y"===o){var h=a;return l<0&&(h-=1),0===l&&c<0&&(h-=1),h}if("m"===o)return 12*a+l+(c<0?-1:0);if("ym"===o)return c<0&&(l-=1),l<=0&&a>0?12+l:l;if("yd"===o)return c<0&&(l-=1),s.setFullYear(l<0?u.getFullYear()+1:u.getFullYear()),Math.floor((s.getTime()-u.getTime())/864e5);throw new TypeError('Unrecognized unit parameter "'+o+'" for datedif()')},_signature:[{types:[0]},{types:[0]},{types:[2]}]},eomonth:{_func:function(e){var t=n(e[0]),r=n(e[1]),i=new Date(864e5*t);return new Date(i.getFullYear(),i.getMonth()+r+1,0).getTime()/864e5},_signature:[{types:[0]},{types:[0]}]},day:{_func:function(e){var t=n(e[0]);return new Date(864e5*t).getDate()},_signature:[{types:[0]}]},month:{_func:function(e){var t=n(e[0]);return new Date(864e5*t).getMonth()+1},_signature:[{types:[0]}]},year:{_func:function(e){var t=n(e[0]);return new Date(864e5*t).getFullYear()},_signature:[{types:[0]}]},time:{_func:function(e){var t=(3600*n(e[0])+60*n(e[1])+n(e[2]))/86400;return t<0?null:t-Math.floor(t)},_signature:[{types:[0]},{types:[0]},{types:[0]}]},hour:{_func:function(e){var t=n(e[0])%1;if(t<0)return null;var r=pe(24*t,14);return Math.floor(r%24)},_signature:[{types:[0]}]},minute:{_func:function(e){var t=n(e[0])%1;if(t<0)return null;var r=Math.round(1440*t,10);return Math.floor(r%60)},_signature:[{types:[0]}]},second:{_func:function(e){var t=n(e[0])%1;if(t<0)return null;var r=pe(86400*t,10);return Math.floor(r%60)},_signature:[{types:[0]}]},now:{_func:function(){return Date.now()/864e5},_signature:[]},today:{_func:function(){return Math.floor(Date.now()/864e5)},_signature:[]},weekday:{_func:function(e){var t=n(e[0]),r=e.length>1?n(e[1]):1,i=new Date(864e5*t).getDay();switch(r){case 1:return i+1;case 2:return(i+6)%7+1;case 3:return(i+6)%7;default:return null}},_signature:[{types:[0]},{types:[0],optional:!0}]},entries:{_func:function(t){var n=e(t[0]);return Object.entries(n)},_signature:[{types:[0,2,3,4,5]}]},fromEntries:{_func:function(e){return Object.fromEntries(e[0])},_signature:[{types:[11]}]},split:{_func:function(e){var n=t(e[0]),r=t(e[1]);return n.split(r)},_signature:[{types:[2]},{types:[2]}]},unique:{_func:function(t){var n=t[0].map(function(t){return e(t)});return t[0].filter(function(t,r){return n.indexOf(e(t))===r})},_signature:[{types:[3]}]},encodeUrlComponent:{_func:function(e){return encodeURIComponent(e[0])},_signature:[{types:[2]}]},encodeUrl:{_func:function(e){return encodeURI(e[0])},_signature:[{types:[2]}]},decodeUrlComponent:{_func:function(e){return decodeURIComponent(e[0])},_signature:[{types:[2]}]},decodeUrl:{_func:function(e){return decodeURI(e[0])},_signature:[{types:[2]}]}}}(b,n,t,r),i)},i._validateArgs=function(e,r,i,o){if(0!==i.length){var u,s=i.filter(function(e){return!e.optional}).length;if(i[i.length-1].variadic){if(r.length<i.length)throw u=1===i.length?" argument":" arguments",new Error("ArgumentError: "+e+"() takes at least"+i.length+u+" but received "+r.length)}else if(r.length<s||r.length>i.length)throw u=1===i.length?" argument":" arguments",new Error("ArgumentError: "+e+"() takes "+i.length+u+" but received "+r.length);if(o)for(var a,l,c,h,f=Math.min(i.length,r.length),d=0;d<f;d+=1)c=r[d],h=void 0,(a=i[d].types).includes(10)&&null!==(h=c)&&!Array.isArray(h)&&"Object"!==h.constructor.name||a.includes(1)||(l=_(r[d]),r[d]=y(l,a,r[d],e,t,n))}},i.callFunction=function(e,t,n,r,i){if(void 0===i&&(i=!0),!Object.prototype.hasOwnProperty.call(this.functionTable,e))throw new Error("Unknown function: "+e+"()");var o=this.functionTable[e];return this._validateArgs(e,t,o._signature,i),o._func.call(this,t,n,r)},r}();this.compile=function(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=[]);try{r=new de(t).parse(e,n)}catch(e){throw n.push(e.toString()),e}return r},this.search=function(e,i,o,u,s,a,l){void 0===a&&(a=[]),void 0===l&&(l="en-US");var c=new r(u);c.debug=a,t=function(e,t){return void 0===t&&(t=[]),function(n){var r=b(n);if(null===r)return null;if(r instanceof Array)return t.push("Converted array to zero"),0;var i=typeof r;return"number"===i?r:"string"===i?e(r,t):"boolean"===i?r?1:0:(t.push("Converted object to zero"),0)}}(s||function(e){var t=+e;return Number.isNaN(t)?0:t},a);var h=new E(c,o,t,n,a,l);c._interpreter=h,c.addFunctions(a,u);try{return h.search(e,i)}catch(e){throw a.push(e.message||e.toString()),e}},this.strictDeepEqual=j},_e=/*#__PURE__*/function(){function t(e,t,n,r,i,o){void 0===t&&(t={}),void 0===n&&(n=null),void 0===r&&(r=[]),void 0===i&&(i=[]),void 0===o&&(o="en-US"),this.expression=e,this.customFunctions=t,this.stringToNumber=n,this.node=ve.compile(e,r,i),this.debug=i,this.language=o}return t.prototype.search=function(t,n){return ve.search(this.node,t,n,e({},this.customFunctions),this.stringToNumber,this.debug,this.language)},t}();console.timeEnd("script json-formula");var ye=function(e){try{var t=e.name,n=e.size,r=e.type;return Promise.resolve(new Promise(function(i,o){var u=new FileReader;u.onload=function(e){i(new kt({data:Bt(e.target.result,t),type:r,name:t,size:n}))},u.readAsDataURL(e.data)}))}catch(e){return Promise.reject(e)}};function ge(){return ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ge.apply(this,arguments)}console.time("script af-core");var me=["description","placeholder","enum","enumNames","label.value","constraintMessages.accept","constraintMessages.enum","constraintMessages.exclusiveMinimum","constraintMessages.exclusiveMaximum","constraintMessages.format","constraintMessages.maxFileSize","constraintMessages.maxLength","constraintMessages.maximum","constraintMessages.maxItems","constraintMessages.minLength","constraintMessages.minimum","constraintMessages.minItems","constraintMessages.pattern","constraintMessages.required","constraintMessages.step","constraintMessages.type","constraintMessages.validationExpression"],be=["accept","enum","exclusiveMinimum","exclusiveMaximum","format","maxFileSize","maxLength","maximum","maxItems","minLength","minimum","minItems","pattern","required","step","validationExpression","enumNames"],je=function(e,t){void 0===e&&(e=""),void 0===t&&(t=[]),this.errorMessages=t,this.fieldName=e},xe=function(e){return new Map(Object.entries(e))},Ee=xe({date:"date-input","data-url":"file-input",binary:"file-input"}),Me=xe({number:"number-input",boolean:"checkbox",object:"panel",array:"panel",file:"file-input","file[]":"file-input"}),ke=["string[]","boolean[]","number[]","array"],we=function(e){var t=e.type||"string";return"enum"in e?e.enum.length>2||ke.indexOf(t)>-1?"drop-down":"checkbox":"string"===t||"string[]"===t?Ee.get(e.format)||"text-input":Me.get(t)||"text-input"},De=function e(t){if("items"in t){var n=t,r=n.items;if("array"===n.type)return{type:"array",items:e(r[0]),minItems:null==n?void 0:n.minItems,maxItems:null==n?void 0:n.maxItems};var i=r.filter(function(e){return null!=e.name});return{type:"object",properties:Object.fromEntries(i.map(function(t){return[t.name,e(t)]})),required:i.filter(function(e){return e.required}).map(function(e){return e.name})}}var o,u=t,s=["type","maxLength","minLength","minimum","maximum","format","pattern","step","enum"].reduce(function(e,t){return t in u&&null!=u[t]&&(e[t]=u[t]),e},{});if("none"!==u.dataRef&&0!=Object.keys(s).length)return ge({title:null==(o=u.label)?void 0:o.value,description:u.description},s)},Ne=function(e){return De(e)},Oe=function(e,t,n){if(t in e)return e[t];if(!t.startsWith(":")){var r=":"+t;if(r in e)return e[r]}return n},Se=function(e){return"file"===(null==e?void 0:e.type)||"file[]"===(null==e?void 0:e.type)||("string"===(null==e?void 0:e.type)||"string[]"===(null==e?void 0:e.type))&&("binary"===(null==e?void 0:e.format)||"data-url"===(null==e?void 0:e.format))},Te=function(e){return be.some(function(t){return void 0!==e[t]})},Ie=function(e){return"checkbox"===((null==e?void 0:e.fieldType)||we(e))},Ce=function(e){return"checkbox-group"===((null==e?void 0:e.fieldType)||we(e))},Pe=function(e){var t=(null==e?void 0:e.fieldType)||we(e);return"text-input"===t&&"date"===(null==e?void 0:e.format)||"date-input"===t};function Re(e,t){var n;return e instanceof Array?(n=[],n=e.map(function(e){return Re(e,t)})):"object"==typeof e&&null!==e?(n={},Object.entries(e).forEach(function(e){n[e[0]]=Re(e[1],t)})):n=e,t&&n&&n.id&&(n.id=t()),n}function $e(e,t,n){if(null!=e&&null!=t){var r=ge({},t);return r[n]=e[n],""===Fe(e).replace(Fe(r),"")}return!1}var Fe=function(e){return JSON.stringify(e,null,2)},Ae=/*#__PURE__*/function(){function e(e,t,n){this._metadata=n,this._payload=e,this._type=t}var n=e.prototype;return n.payloadToJson=function(){return this.payload},n.toJson=function(){return{payload:this.payloadToJson(),type:this.type,isCustomEvent:this.isCustomEvent}},n.toString=function(){return JSON.stringify(this.toJson())},t(e,[{key:"type",get:function(){return this._type}},{key:"payload",get:function(){return this._payload}},{key:"metadata",get:function(){return this._metadata}},{key:"target",get:function(){return this._target}},{key:"isCustomEvent",get:function(){return!1}}]),e}(),qe=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"change",{dispatch:n})||this}return n(t,e),t.prototype.withAdditionalChange=function(e){return new t(this.payload.changes.concat(e.payload.changes),this.metadata)},t}(Ae),Le=/*#__PURE__*/function(e){function t(t){return void 0===t&&(t={}),e.call(this,t,"invalid",{})||this}return n(t,e),t}(Ae),Ue=/*#__PURE__*/function(e){function t(t){return void 0===t&&(t={}),e.call(this,t,"valid",{})||this}return n(t,e),t}(Ae),ze=/*#__PURE__*/function(e){function t(t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),e.call(this,t,"executeRule",{dispatch:n})||this}return n(t,e),t}(Ae),Ve=function(e,t,n){return new qe({changes:[{propertyName:e,currentValue:t,prevValue:n}]})},Ge=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"initialize",{dispatch:n})||this}return n(t,e),t}(Ae),Qe=/*#__PURE__*/function(e){function t(){return e.call(this,{},"load",{dispatch:!1})||this}return n(t,e),t}(Ae),Je=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"click",{dispatch:n})||this}return n(t,e),t}(Ae),He=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"blur",{dispatch:n})||this}return n(t,e),t}(Ae),Be=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"validationComplete",{dispatch:n})||this}return n(t,e),t}(Ae),We=/*#__PURE__*/function(e){function t(){return e.call(this,{},"focus",{dispatch:!1})||this}return n(t,e),t}(Ae),Ye=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"submit",{dispatch:n})||this}return n(t,e),t}(Ae),Ke=/*#__PURE__*/function(e){function t(t,n){return e.call(this,{field:n,changes:t},"fieldChanged")||this}return n(t,e),t}(Ae),Ze=/*#__PURE__*/function(e){function r(t,n,r){return void 0===n&&(n={}),void 0===r&&(r=!1),e.call(this,n,t,{dispatch:r})||this}return n(r,e),t(r,[{key:"isCustomEvent",get:function(){return!0}}]),r}(Ae),Xe=/*#__PURE__*/function(e){function t(t){return e.call(this,t,"addItem")||this}return n(t,e),t}(Ae),et=/*#__PURE__*/function(e){function t(t){return e.call(this,t,"removeItem")||this}return n(t,e),t}(Ae),tt=/*#__PURE__*/function(){function e(e,t,n){void 0===n&&(n=typeof t),this.$_fields=[],this.$_name=e,this.$_value=t,this.$_type=n}var n=e.prototype;return n.valueOf=function(){return this.$_value},n.setValue=function(e,t,n){this.$_value=e,this.$_fields.forEach(function(e){n!==e&&(e.value=t)})},n.$bindToField=function(e){-1===this.$_fields.indexOf(e)&&this.$_fields.push(e)},n.$convertToDataValue=function(){return this},t(e,[{key:"$name",get:function(){return this.$_name}},{key:"$value",get:function(){return this.$_value}},{key:"$type",get:function(){return this.$_type}},{key:"$isDataGroup",get:function(){return!1}}]),e}(),nt=Symbol("NullValue"),rt=new(/*#__PURE__*/function(e){function t(){return e.call(this,"",nt,"null")||this}n(t,e);var r=t.prototype;return r.setValue=function(){},r.$bindToField=function(){},r.$length=function(){return 0},r.$convertToDataValue=function(){return this},r.$addDataNode=function(){},r.$removeDataNode=function(){},r.$getDataNode=function(){return this},r.$containsDataNode=function(){return!1},t}(tt)),it=/*#__PURE__*/function(e){n(i,e);var r=i.prototype;function i(t,n,r){var i;return void 0===r&&(r=typeof n),(i=e.call(this,t,n,r)||this).$_items=n instanceof Array?n.map(function(e,t){return i.createEntry(t,e)}):Object.fromEntries(Object.entries(n).map(function(e){var t=e[0];return[t,i.createEntry(t,e[1])]})),i}return r.createEntry=function(e,t){var n=t instanceof Array?"array":typeof t;return"object"==typeof t&&null!=t?new i(e,t,n):new tt(e,t,n)},r.$convertToDataValue=function(){return new tt(this.$name,this.$value,this.$type)},r.$addDataNode=function(e,t,n){if(void 0===n&&(n=!1),t!==rt)if("array"===this.$type){var r=e;n?this.$_items[e]=t:this.$_items.splice(r,0,t)}else this.$_items[e]=t},r.$removeDataNode=function(e){this.$_items[e]=void 0},r.$getDataNode=function(e){if(this.$_items.hasOwnProperty(e))return this.$_items[e]},r.$containsDataNode=function(e){return this.$_items.hasOwnProperty(e)&&void 0!==this.$_items[e]},t(i,[{key:"$value",get:function(){return"array"===this.$type?Object.values(this.$_items).filter(function(e){return void 0!==e}).map(function(e){return e.$value}):Object.fromEntries(Object.values(this.$_items).filter(function(e){return void 0!==e}).map(function(e){return[e.$name,e.$value]}))}},{key:"$length",get:function(){return Object.entries(this.$_items).length}},{key:"$isDataGroup",get:function(){return!0}}]),i}(tt),ot=function(e,t){return{type:"Identifier",value:e,start:t}},ut=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e},st=function(e,t,n){return null===e&&"$"===t[n]},at=function(e,t){var n=e[t];return"$"===n?e.length>t&&ut(e[t+1]):n>="a"&&n<="z"||n>="A"&&n<="Z"||"_"===n},lt=function(e){return e>="0"&&e<="9"},ct=/*#__PURE__*/function(){function e(e){this._tokens=[],this._result_tokens=[],this.stream=e,this._current=0}var t=e.prototype;return t._consumeGlobal=function(){return this._current+=1,{type:"Global",start:0,value:"$"}},t._consumeUnquotedIdentifier=function(e){var t=this._current;for(this._current+=1;this._current<e.length&&ut(e[this._current]);)this._current+=1;return ot(e.slice(t,this._current),t)},t._consumeQuotedIdentifier=function(e){var t=this._current;this._current+=1;for(var n=e.length;'"'!==e[this._current]&&this._current<n;){var r=this._current;this._current=r+="\\"!==e[r]||"\\"!==e[r+1]&&'"'!==e[r+1]?1:2}return this._current+=1,ot(JSON.parse(e.slice(t,this._current)),t)},t._consumeNumber=function(e){var t=this._current;this._current+=1;for(var n=e.length;lt(e[this._current])&&this._current<n;)this._current+=1;var r=e.slice(t,this._current);return{type:"Number",value:parseInt(r,10),start:t}},t._consumeBracket=function(e){var t,n=this._current;if(this._current+=1,!lt(e[this._current]))throw new Error("unexpected exception at position "+this._current+". Must be a character");if(t=this._consumeNumber(e).value,this._current<this.stream.length&&"]"!==e[this._current])throw new Error("unexpected exception at position "+this._current+". Must be a character");return this._current++,function(e,t){return{type:"bracket",value:e,start:t}}(t,n)},t.tokenize=function(){for(var e=this.stream;this._current<e.length;){var t=this._tokens.length?this._tokens.slice(-1)[0]:null;if(st(t,e,this._current)){var n=this._consumeGlobal();this._tokens.push(n),this._result_tokens.push(n)}else if(at(e,this._current)){var r=this._consumeUnquotedIdentifier(e);this._tokens.push(r),this._result_tokens.push(r)}else if("."===e[this._current]&&null!=t&&"DOT"!==t.type)this._tokens.push({type:"DOT",value:".",start:this._current}),this._current+=1;else if("["===e[this._current]){var i=this._consumeBracket(e);this._tokens.push(i),this._result_tokens.push(i)}else{if('"'!==e[this._current]){var o=Math.max(0,this._current-2),u=Math.min(this.stream.length,this._current+2);throw new Error("Exception at parsing stream "+this.stream.slice(o,u))}var s=this._consumeQuotedIdentifier(e);this._tokens.push(s),this._result_tokens.push(s)}}return this._result_tokens},e}(),ht=function(e){return new ct(e).tokenize()},ft=function(e,t,n){var r;r="string"==typeof t?ht(t):t;for(var i=e,o=0,u=function(e,t,n){return null===t?n:"bracket"===t.type?new it(e.value,[],"array"):new it(e.value,{})};o<r.length&&null!=i;){var s=r[o];if("Global"===s.type)i=e;else if("Identifier"===s.type){if(!(i instanceof it&&"object"===i.$type))throw new Error("Looking for "+s.value+" in "+i.$value);if(i.$containsDataNode(s.value)&&null!==i.$getDataNode(s.value).$value)i=i.$getDataNode(s.value);else if(n){var a=u(s,o<r.length-1?r[o+1]:null,n);i.$addDataNode(s.value,a),i=a}else i=void 0}else if("bracket"===s.type){if(!(i instanceof it&&"array"===i.$type))throw new Error("Looking for index "+s.value+" in non array"+i.$value);var l=s.value;if(l<i.$length)i=i.$getDataNode(l);else if(n){var c=u(s,o<r.length-1?r[o+1]:null,n);i.$addDataNode(l,c),i=c}else i=void 0}o+=1}return i},dt=function(e,t,n,r){var i,o=arguments.length,u=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(u=(o<3?i(u):o>3?i(t,n,u):i(t,n))||u);return o>3&&u&&Object.defineProperty(t,n,u),u},pt=["value","label","description","visible","enabled","readOnly","enum","enumNames","required","properties","exclusiveMinimum","exclusiveMaximum","maxLength","maximum","maxItems","minLength","minimum","minItems","step"],vt=[].concat(pt,["valid","index","activeChild"]),_t=/*#__PURE__*/function(){function e(e,t){this._action=e,this._target=t}return e.prototype.toString=function(){return this._action.toString()},t(e,[{key:"type",get:function(){return this._action.type}},{key:"payload",get:function(){return this._action.payload}},{key:"metadata",get:function(){return this._action.metadata}},{key:"target",get:function(){return this._target}},{key:"isCustomEvent",get:function(){return this._action.isCustomEvent}},{key:"originalAction",get:function(){return this._action.originalAction}}]),e}(),yt=Symbol("target"),gt=Symbol("qualifiedName"),mt=/*#__PURE__*/function(){function e(e,t){this._callbacks={},this._dependents=[],this._tokens=[],this._options=t,this[gt]=null,this._jsonModel=ge({},e,{id:"id"in e?e.id:this.form.getUniqueId()})}var n=e.prototype;return n.setupRuleNode=function(){var e=this;this._ruleNode=new Proxy(this.ruleNodeReference(),{get:function(t,n){return e.getFromRule(t,n)}})},n.ruleNodeReference=function(){return this},n.getRuleNode=function(){return this._ruleNode},n.getFromRule=function(t,n){if(n===Symbol.toPrimitive||"valueOf"===n&&!t.hasOwnProperty("valueOf"))return this.valueOf;if(n===yt)return this;if("string"==typeof n)if(n.startsWith("$")){if("function"!=typeof this[n=n.substr(1)]){var r=this[n];return r instanceof e?r.getRuleNode():r instanceof Array?r.map(function(t){return t instanceof e?t.getRuleNode():t}):r}}else{if(t.hasOwnProperty(n))return t[n];if("function"==typeof t[n])return t[n]}},n.isTransparent=function(){var e,t="array"===(null==(e=this.parent)?void 0:e._jsonModel.type);return!this._jsonModel.name&&!t},n.getState=function(){return ge({},this._jsonModel,{":type":this[":type"]})},n.subscribe=function(e,t){var n=this;return void 0===t&&(t="change"),this._callbacks[t]=this._callbacks[t]||[],this._callbacks[t].push(e),{unsubscribe:function(){n._callbacks[t]=n._callbacks[t].filter(function(t){return t!==e})}}},n._addDependent=function(e){if(void 0===this._dependents.find(function(t){return t.node===e})){var t=this.subscribe(function(t){var n=t.payload.changes,r=[].concat(vt,["items"]);n.findIndex(function(e){return r.indexOf(e.propertyName)>-1})>-1&&e.dispatch(new ze)});this._dependents.push({node:e,subscription:t})}},n.removeDependent=function(e){var t=this._dependents.findIndex(function(t){return t.node===e});t>-1&&(this._dependents[t].subscription.unsubscribe(),this._dependents.splice(t,1))},n.queueEvent=function(e){var t=new _t(e,this);this.form.getEventQueue().queue(this,t,["valid","invalid"].indexOf(t.type)>-1)},n.dispatch=function(e){this.queueEvent(e),this.form.getEventQueue().runPendingQueue()},n.notifyDependents=function(e){var t=this;(this._callbacks[e.type]||[]).forEach(function(n){n(new _t(e,t))})},n._setProperty=function(e,t,n){void 0===n&&(n=!0);var r=this._jsonModel[e];if(!(null!==t&&null!==r&&"object"==typeof t&&"object"==typeof r?JSON.stringify(t)===JSON.stringify(r):r===t)){this._jsonModel[e]=t;var i=Ve(e,t,r);return n&&this.notifyDependents(i),i.payload.changes}return[]},n._bindToDataModel=function(e){if("$form"!==this.id){var t,n,r,i=this._jsonModel.dataRef,o=e,u="";if(null===i)t=rt;else if(void 0!==i){0===this._tokens.length&&(this._tokens=ht(i));var s=e;if("Global"===this._tokens[0].type&&(s=this.form.getDataNode()),void 0!==s){var a=this._tokens[this._tokens.length-1].value,l=this.defaultDataModel(a);t=ft(s,this._tokens,l),o=ft(s,this._tokens.slice(0,-1)),u=a}}else if(e!==rt){o=e;var c="array"===e.$type?this.index:this._jsonModel.name||"";if(u=c,""!==c){var h=this.defaultDataModel(c);void 0!==h&&void 0===(t=e.$getDataNode(c))&&e.$addDataNode(c,t=h)}else t=void 0}t&&(this.isContainer||o===rt||t===rt||(t=null==(r=t)?void 0:r.$convertToDataValue(),o.$addDataNode(u,t,!0)),null==(n=t)||n.$bindToField(this),this._data=t)}else this._data=e},n.getDataNode=function(){return this._data},n.getNonTransparentParent=function(){for(var e=this.parent;null!=e&&e.isTransparent();)e=e.parent;return e},n._initialize=function(){if(void 0===this._data){var e,t=this.parent;do{e=t.getDataNode(),t=t.parent}while(void 0===e);this._bindToDataModel(e)}},n._applyUpdates=function(e,t){var n=this;return e.reduce(function(e,r){var i=n._setProperty(r,t[r],!1);return i.length>0&&(e[r]=i[0]),e},{})},n.focus=function(){this.parent&&(this.parent.activeChild=this)},t(e,[{key:"isContainer",get:function(){return!1}},{key:"id",get:function(){return this._jsonModel.id}},{key:"index",get:function(){return this.parent.indexOf(this)}},{key:"parent",get:function(){return this._options.parent}},{key:"type",get:function(){return this._jsonModel.type}},{key:"fieldType",get:function(){return this._jsonModel.fieldType||"text-input"}},{key:":type",get:function(){return this._jsonModel[":type"]||this.fieldType}},{key:"name",get:function(){return this._jsonModel.name}},{key:"description",get:function(){return this._jsonModel.description},set:function(e){this._setProperty("description",e)}},{key:"dataRef",get:function(){return this._jsonModel.dataRef}},{key:"visible",get:function(){return this._jsonModel.visible},set:function(e){if(e!==this._jsonModel.visible){var t=Ve("visible",e,this._jsonModel.visible);this._jsonModel.visible=e,this.notifyDependents(t)}}},{key:"form",get:function(){return this._options.form}},{key:"ruleEngine",get:function(){return this.form.ruleEngine}},{key:"label",get:function(){return this._jsonModel.label},set:function(e){if(e!==this._jsonModel.label){var t=Ve("label",e,this._jsonModel.label);this._jsonModel=ge({},this._jsonModel,{label:e}),this.notifyDependents(t)}}},{key:"uniqueItems",get:function(){return this._jsonModel.uniqueItems}},{key:"properties",get:function(){return this._jsonModel.properties||{}},set:function(e){this._setProperty("properties",ge({},e))}},{key:"qualifiedName",get:function(){if(this.isTransparent())return null;if(null!==this[gt])return this[gt];var e=this.getNonTransparentParent();return this[gt]=e&&"array"===e.type?e.qualifiedName+"["+this.index+"]":e.qualifiedName+"."+this.name,this[gt]}}]),e}();dt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],mt.prototype,"index",null),dt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],mt.prototype,"description",null),dt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],mt.prototype,"visible",null),dt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],mt.prototype,"label",null),dt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],mt.prototype,"properties",null);var bt=/*#__PURE__*/function(e){function r(){var t;return(t=e.call.apply(e,[this].concat([].slice.call(arguments)))||this)._events={},t._rules={},t}n(r,e);var i=r.prototype;return i.getCompiledRule=function(e,t){if(!(e in this._rules)){var n=t||this.rules[e];if(!("string"==typeof n&&n.length>0))throw new Error("only expression strings are supported. "+typeof n+" types are not supported");try{this._rules[e]=this.ruleEngine.compileRule(n)}catch(t){this.form.logger.error('Unable to compile rule `"'+e+'" : "'+n+'"` Exception : '+t)}}return this._rules[e]},i.getCompiledEvent=function(e){var t=this;if(!(e in this._events)){var n,r=null==(n=this._jsonModel.events)?void 0:n[e];"string"==typeof r&&r.length>0&&(r=[r]),void 0!==r&&r.length>0&&(this._events[e]=r.map(function(n){try{return t.ruleEngine.compileRule(n)}catch(n){t.form.logger.error('Unable to compile expression `"'+e+'" : "'+r+'"` Exception : '+n)}return null}).filter(function(e){return null!==e}))}return this._events[e]||[]},i.applyUpdates=function(e){var t=this;Object.entries(e).forEach(function(e){var n=e[0],r=e[1];if(n in pt||n in t&&"function"!=typeof t[n])try{t[n]=r}catch(e){console.error(e)}})},i.executeAllRules=function(e){var t=this,n=Object.entries(this.rules);if(n.length>0){var r=this.getExpressionScope();n.forEach(function(n){var i=n[0],o=t.getCompiledRule(i,n[1]);if(o){var u=t.ruleEngine.execute(o,r,e,!0);pt.indexOf(i)>-1?t[i]=u:t.form.logger.warn(i+" is not a valid editable property.")}})}},i.getExpressionScope=function(){var e=this.getNonTransparentParent(),t={self:this.getRuleNode(),siblings:(null==e?void 0:e.ruleNodeReference())||{}},n=new Proxy(t,{get:function(e,t){if(t===Symbol.toStringTag)return"Object";if(t.startsWith("$")){var n=e.self[t];return n instanceof mt?n.getRuleNode():n instanceof Array?n.map(function(e){return e instanceof mt?e.getRuleNode():e}):n}return t in e.siblings?e.siblings[t]:e.self[t]},has:function(e,t){return void 0!==e.self[t]||void 0!==e.siblings[t]}});return n},i.executeEvent=function(e,t){var n;t&&(n=this.ruleEngine.execute(t,this.getExpressionScope(),e)),void 0!==n&&null!=n&&this.applyUpdates(n)},i.executeRule=function(e,t){void 0===e.payload.ruleName&&this.executeAllRules(t)},i.executeExpression=function(e){var t={form:this.form,$form:this.form.getRuleNode(),$field:this.getRuleNode(),field:this},n=this.ruleEngine.compileRule(e);return this.ruleEngine.execute(n,this.getExpressionScope(),t)},i.executeAction=function(e){var t=this,n={form:this.form,$form:this.form.getRuleNode(),$field:this.getRuleNode(),field:this,$event:{type:e.type,payload:e.payload,target:this.getRuleNode()}},r=e.isCustomEvent?"custom_"+e.type:e.type;this.getCompiledEvent(e.isCustomEvent?"custom:"+e.type:e.type).forEach(function(e){return t.executeEvent(n,e)}),r in this&&"function"==typeof this[r]&&this[r](e,n),this.notifyDependents(e)},t(r,[{key:"rules",get:function(){return this._jsonModel.rules||{}}}]),r}(mt),jt=function(e,t,n,r){var i,o=arguments.length,u=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(u=(o<3?i(u):o>3?i(t,n,u):i(t,n))||u);return o>3&&u&&Object.defineProperty(t,n,u),u},xt=/*#__PURE__*/function(e){function r(){var t;return(t=e.call.apply(e,[this].concat([].slice.call(arguments)))||this)._children=[],t._itemTemplate=null,t._activeChild=null,t}n(r,e);var i=r.prototype;return i.ruleNodeReference=function(){return this._childrenReference},i.hasDynamicItems=function(){return null!=this._itemTemplate},i.getState=function(){return ge({},this._jsonModel,{":type":this[":type"],items:this._children.map(function(e){return ge({},e.getState())})})},i._addChildToRuleNode=function(e,t){var n=this,r=this,i=t.parent,o=void 0===i?this:i,u="array"==o.type?o._children.length+"":e.name||"";u.length>0&&Object.defineProperty(o._childrenReference,u,{get:function(){return e.isContainer&&e.hasDynamicItems()&&r.ruleEngine.trackDependency(e),r.hasDynamicItems()?(r.ruleEngine.trackDependency(r),void 0!==n._children[u]?n._children[u].getRuleNode():void 0):e.getRuleNode()},configurable:!0,enumerable:!0})},i._addChild=function(e,t,n){void 0===n&&(n=!1);for(var r=this;null!=r&&r.isTransparent();)r=r.parent;("number"!=typeof t||t>r._children.length)&&(t=this._children.length);var i=this.form,o=ge({index:t},Re(e,n?function(){return i.getUniqueId()}:void 0)),u=this._createChild(o,{parent:this,index:t});return this._addChildToRuleNode(u,{parent:r}),t===this._children.length?this._children.push(u):this._children.splice(t,0,u),u},i.indexOf=function(e){return this._children.indexOf(e)},i.defaultDataModel=function(e){var t=this._jsonModel.type||void 0;if(void 0!==t)return new it(e,"array"===t?[]:{},t)},i._initialize=function(){var t=this;e.prototype._initialize.call(this);var n=this._jsonModel.items;if(this._jsonModel.items=[],this._childrenReference="array"==this._jsonModel.type?[]:{},"array"==this._jsonModel.type&&1===n.length&&null!=this.getDataNode()){this._itemTemplate=Re(n[0]),"number"!=typeof this._jsonModel.minItems&&(this._jsonModel.minItems=0),"number"!=typeof this._jsonModel.maxItems&&(this._jsonModel.maxItems=-1),"number"!=typeof this._jsonModel.initialItems&&(this._jsonModel.initialItems=Math.max(1,this._jsonModel.minItems));for(var r=0;r<this._jsonModel.initialItems;r++)this._addChild(this._itemTemplate)._initialize()}else n.length>0&&(n.forEach(function(e){t._addChild(e)._initialize()}),this._jsonModel.minItems=this._children.length,this._jsonModel.maxItems=this._children.length,this._jsonModel.initialItems=this._children.length);this.setupRuleNode()},i.addItem=function(e){if("addItem"===e.type&&null!=this._itemTemplate&&(-1===this._jsonModel.maxItems||this._children.length<this._jsonModel.maxItems)){var t=this.getDataNode(),n=e.payload;("number"!=typeof n||n>this._children.length)&&(n=this._children.length);var r=this._addChild(this._itemTemplate,e.payload,!0),i=r.defaultDataModel(n);i&&t.$addDataNode(n,i),r._initialize(),this.notifyDependents(Ve("items",r.getState,null)),r.dispatch(new Ge),r.dispatch(new ze);for(var o=n+1;o<this._children.length;o++)this._children[o].dispatch(new ze)}},i.removeItem=function(e){if("removeItem"===e.type&&null!=this._itemTemplate){if(0==this._children.length)return;var t="number"==typeof e.payload?e.payload:this._children.length-1,n=this._children[t].getState();if(this._children.length>this._jsonModel.minItems){this._childrenReference.pop(),this._children.splice(t,1),this.getDataNode().$removeDataNode(t);for(var r=t;r<this._children.length;r++)this._children[r].dispatch(new ze);this.notifyDependents(Ve("items",null,n))}}},i.queueEvent=function(t){var n;e.prototype.queueEvent.call(this,t),null!=(n=t.metadata)&&n.dispatch&&this.items.forEach(function(e){e.queueEvent(t)})},i.validate=function(){return this.items.flatMap(function(e){return e.validate()}).filter(function(e){return""!==e.fieldName})},i.dispatch=function(t){e.prototype.dispatch.call(this,t)},i.importData=function(e){this._bindToDataModel(e);var t=this.getDataNode()||e;this.syncDataAndFormModel(t)},i.syncDataAndFormModel=function(e){if("array"===(null==e?void 0:e.$type)&&null!=this._itemTemplate){for(var t=null==e?void 0:e.$value.length,n=this._children.length,r=this._jsonModel.minItems,i=Math.min(t-n,(-1===this._jsonModel.maxItems?t:this._jsonModel.maxItems)-n),o=Math.min(n-t,n-r);i>0;)i--,this._addChild(this._itemTemplate)._initialize();if(o>0){this._children.splice(t,o);for(var u=0;u<o;u++)this._childrenReference.pop()}}this._children.forEach(function(t){t.importData(e)})},t(r,[{key:"items",get:function(){return this._children}},{key:"maxItems",get:function(){return this._jsonModel.maxItems},set:function(e){this._jsonModel.maxItems=e;var t=this._children.length,n=Math.min(t-e,t-(this._jsonModel.minItems||1));if(n>0){for(var r=0;r<n;r++)this.getDataNode().$removeDataNode(e+r),this._childrenReference.pop();var i=this._children.splice(e,n);this.notifyDependents(Ve("items",i,null))}}},{key:"minItems",get:function(){return this._jsonModel.minItems}},{key:"isContainer",get:function(){return!0}},{key:"activeChild",get:function(){return this._activeChild},set:function(e){if(e!==this._activeChild){for(var t=this._activeChild;t instanceof r;){var n=t.activeChild;t.activeChild=null,t=n}var i=Ve("activeChild",e,this._activeChild);this._activeChild=e,this.parent&&null!==e&&(this.parent.activeChild=this),this._jsonModel.activeChild=null==e?void 0:e.id,this.notifyDependents(i)}}}]),r}(bt);jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],xt.prototype,"maxItems",null),jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],xt.prototype,"minItems",null),jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],xt.prototype,"activeChild",null);var Et=/*#__PURE__*/function(){function e(e){this._jsonModel=ge({},e)}return e.prototype.getP=function(e,t){return Oe(this._jsonModel,e,t)},t(e,[{key:"isContainer",get:function(){return!1}}]),e}(),Mt=/*#__PURE__*/function(e){function r(){return e.apply(this,arguments)||this}return n(r,e),t(r,[{key:"version",get:function(){return this.getP("version","")}},{key:"locale",get:function(){return this.getP("locale","")}},{key:"grammar",get:function(){return this.getP("grammar","")}}]),r}(Et),kt=/*#__PURE__*/function(){function e(e){this.type="application/octet-stream",this.name="unknown",this.size=0,Object.assign(this,e)}var t=e.prototype;return t.toJSON=function(){return{name:this.name,size:this.size,type:this.type,data:this.data.toString()}},t.equals=function(e){return this.data===e.data&&this.type===e.type&&this.name===e.name&&this.size===e.size},e}(),wt="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_".split(""),Dt=/^(\d*\.?\d+)(\\?(?=[KMGT])([KMGT])(?:i?B)?|B?)$/i,Nt=function(e){for(var t=[],n=0;n<=e;n++){var r=Math.floor(Math.random()*wt.length);t.push(wt[r])}return t.join("")},Ot=function e(t){var n=t.items||[];return null==n?void 0:n.reduce(function(t,n){var r=null;if(n.isContainer)r=e(n);else if(Se(n.getState())){r={};var i=null!=n.dataRef?n.dataRef:(n.name||"").length>0?n.name:void 0;n.value instanceof Array?r[n.id]=n.value.map(function(e){return ge({},e,{dataRef:i})}):null!=n.value&&(r[n.id]=ge({},n.value,{dataRef:i}))}return Object.assign(t,r)},{})},St=function(e){var t=0;if("string"==typeof e){var n=Dt.exec(e.trim());null!=n&&(t=Tt(parseFloat(n[1]),(n[2]||"kb").toUpperCase()))}return t},Tt=function(e,t){var n=Math.pow(1024,{KB:1,MB:2,GB:3,TB:4}[t]);return Math.round(e*n)},It=function(e){if(null!==e){var t=null;if(e instanceof kt)t=e;else if("undefined"!=typeof File&&e instanceof File)t={name:e.name,type:e.type,size:e.size,data:e};else if("string"==typeof e&&Ft(e)){var n=Ct(e);if(null!==n){var r=n.blob;t={name:n.name,type:r.type,size:r.size,data:r}}}else{var i,o,u=e;try{t=u=JSON.parse(e)}catch(e){}if("string"==typeof(null==(i=u)?void 0:i.data)&&Ft(null==(o=u)?void 0:o.data)){var s,a=Ct(null==(s=u)?void 0:s.data);if(null!==a){var l,c,h=a.blob;t={name:null==(l=u)?void 0:l.name,type:null==(c=u)?void 0:c.type,size:h.size,data:h}}}else if("string"==typeof u)t={name:u.split("/").pop(),type:"application/octet-stream",size:0,data:u};else if("object"==typeof u){var f,d,p,v;t={name:null==(f=u)?void 0:f.name,type:null==(d=u)?void 0:d.type,size:null==(p=u)?void 0:p.size,data:null==(v=u)?void 0:v.data}}}return null!==t&&null!=t.data?new kt(t):null}return null},Ct=function(e){var t=/^data:([a-z]+\/[a-z0-9-+.]+)?(?:;name=([^;]+))?(;base64)?,(.+)$/.exec(e);if(null!==t){var n=t[1]||"",r=t[2]||"unknown";if("string"==typeof t[3]){for(var i=atob(t[4]),o=[],u=0;u<i.length;u++)o.push(i.charCodeAt(u));return{name:r,blob:new window.Blob([new Uint8Array(o)],{type:n})}}return{name:r,blob:new window.Blob([t[4]],{type:n})}}return null},Pt=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,Rt=/^data:([a-z]+\/[a-z0-9-+.]+)?;(?:name=(.*);)?base64,(.*)$/,$t=[31,28,31,30,31,30,31,31,30,31,30,31],Ft=function(e){return null!=Rt.exec(e.trim())},At=function(e){var t=parseFloat(e),n=!isNaN(t);return n||(t=e),{value:t,valid:n}},qt=function(e){var t=parseFloat(e),n=!isNaN(t)&&Math.round(t)===t;return n||(t=e),{value:t,valid:n}},Lt=function(e){return null==e||e instanceof Array?e:[e]},Ut=function(e){var t="boolean"==typeof e||"true"===e||"false"===e;return{valid:t,value:"boolean"==typeof e?e:t?"true"===e:e}},zt=function(e){var t=It(e),n=null!==t;return{value:n?t:e,valid:n}},Vt=function(e,t){var n=Lt(e);return null==n?[[],[n]]:n.reduce(function(e,n){if(0==e[1].length){var r=t(n);e[r.valid?0:1].push(r.value)}return e},[[],[]])},Gt={date:["minimum","maximum","exclusiveMinimum","exclusiveMaximum","format"],string:["minLength","maxLength","pattern"],number:["minimum","maximum","exclusiveMinimum","exclusiveMaximum"],array:["minItems","maxItems","uniqueItems"],file:["accept","maxFileSize"]},Qt={type:function(e,t){var n=t;if(null==t)return{valid:!0,value:t};var r,i=!0;switch(e){case"string":i=!0,n=t.toString();break;case"string[]":n=Lt(t);break;case"number":n=(r=At(t)).value,i=r.valid;break;case"boolean":i=(r=Ut(t)).valid,n=r.value;break;case"integer":i=(r=qt(t)).valid,n=r.value;break;case"integer[]":n=(i=0===(r=Vt(t,qt))[1].length)?r[0]:t;break;case"file":i=(r=zt(t instanceof Array?t[0]:t)).valid,n=r.value;break;case"file[]":n=(i=0===(r=Vt(t,zt))[1].length)?r[0]:t;break;case"number[]":n=(i=0===(r=Vt(t,At))[1].length)?r[0]:t;break;case"boolean[]":n=(i=0===(r=Vt(t,Ut))[1].length)?r[0]:t}return{valid:i,value:n}},format:function(e,t){var n,r,i=!0,o=t;if(null===t)return{value:o,valid:i};switch(e){case"date":if(null!=(n=Pt.exec((t||"").trim()))){var u=+n[2],s=+n[3],a=(r=+n[1])%400==0||r%4==0&&r%100!=0;i=u>=1&&u<=12&&s>=1&&s<=function(e,t){return e&&2==t?29:$t[t-1]}(a,u)}else i=!1;break;case"data-url":i=!0}return{valid:i,value:o}},minimum:function(e,t){return{valid:t>=e,value:t}},maximum:function(e,t){return{valid:t<=e,value:t}},exclusiveMinimum:function(e,t){return{valid:t>e,value:t}},exclusiveMaximum:function(e,t){return{valid:t<e,value:t}},minItems:function(e,t){return{valid:t instanceof Array&&t.length>=e,value:t}},maxItems:function(e,t){return{valid:t instanceof Array&&t.length<=e,value:t}},uniqueItems:function(e,t){return{valid:!e||t instanceof Array&&t.length===new Set(t).size,value:t}},minLength:function(e,t){return ge({},Qt.minimum(e,"string"==typeof t?t.length:0),{value:t})},maxLength:function(e,t){return ge({},Qt.maximum(e,"string"==typeof t?t.length:0),{value:t})},pattern:function(e,t){return{valid:("string"==typeof e?new RegExp(e):e).test(t),value:t}},required:function(e,t){return{valid:!e||null!=t&&""!==t,value:t}},enum:function(e,t){return{valid:e.indexOf(t)>-1,value:t}},accept:function(e,t){return e&&0!==e.length&&null!=t?{valid:!(t instanceof Array?t:[t]).some(function(t){return!(!(n=t.type)||e.some(function(e){var t=e.trim(),r=t.split("/")[0],i=t.split(".")[1];return t.includes("*")&&n.startsWith(r)||t.includes(".")&&n.endsWith(i)||t===n}));var n}),value:t}:{valid:!0,value:t}},maxFileSize:function(e,t){var n="string"==typeof e?St(e):e;return{valid:!(t instanceof kt)||t.size<=n,value:t}}},Jt=function(e,t,n,r){var i,o=arguments.length,u=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(u=(o<3?i(u):o>3?i(t,n,u):i(t,n))||u);return o>3&&u&&Object.defineProperty(t,n,u),u},Ht=/*#__PURE__*/function(e){function r(t,n){var r;return(r=e.call(this,t,n)||this)._ruleNodeReference=[],r._applyDefaults(),r.queueEvent(new Ge),r.queueEvent(new ze),r}n(r,e);var i=r.prototype;return i._initialize=function(){e.prototype._initialize.call(this),this.setupRuleNode()},i.ruleNodeReference=function(){var e;return this._ruleNodeReference=null!=(e=this.type)&&e.endsWith("[]")?[]:this,this._ruleNodeReference},i._getDefaults=function(){return{readOnly:!1,enabled:!0,visible:!0,type:this._getFallbackType()}},i._getFallbackType=function(){if("string"!=typeof this._jsonModel.type){var e=this.enum;return e&&e.length>0?typeof e[0]:"string"}},i._applyDefaults=function(){var e=this;if(Object.entries(this._getDefaults()).map(function(t){var n=t[0],r=t[1];void 0===e._jsonModel[n]&&void 0!==r&&(e._jsonModel[n]=r)}),void 0===this._jsonModel.value){var t=Qt.type(this.getInternalType()||"string",this._jsonModel.default);this._jsonModel.value=t.value}void 0===this._jsonModel.fieldType&&(this._jsonModel.viewType?(this._jsonModel.viewType.startsWith("custom:")?this.form.logger.error("viewType property has been removed. For custom types, use :type property"):this.form.logger.error("viewType property has been removed. Use fieldType property"),this._jsonModel.fieldType=this._jsonModel.viewType):this._jsonModel.fieldType=we(this._jsonModel)),void 0===this._jsonModel.enum&&"boolean"===this._jsonModel.type&&(this._jsonModel.enum=[!0,!1]),"number"==typeof this._jsonModel.step&&"number"===this._jsonModel.type||(this._jsonModel.step=void 0)},i.isEmpty=function(){return null==this._jsonModel.value||""===this._jsonModel.value},i.getDataNodeValue=function(e){return this.isEmpty()?this.emptyValue:e},i._updateRuleNodeReference=function(e){var t,n=this;if(null!=(t=this.type)&&t.endsWith("[]"))if(null!=e)for(e.forEach(function(e,t){n._ruleNodeReference[t]=e});e.length!==this._ruleNodeReference.length;)this._ruleNodeReference.pop();else for(;0!==this._ruleNodeReference.length;)this._ruleNodeReference.pop()},i.getInternalType=function(){return this.type},i.valueOf=function(){var e=this[yt],t=void 0===e?this:e;return t.ruleEngine.trackDependency(t),t._jsonModel.value||null},i.toString=function(){var e,t=this[yt];return(null==(e=(void 0===t?this:t)._jsonModel.value)?void 0:e.toString())||""},i.getErrorMessage=function(e){var t;return(null==(t=this._jsonModel.constraintMessages)?void 0:t[e])||""},i._getConstraintObject=function(){return Qt},i.isArrayType=function(){return!!this.type&&this.type.indexOf("[]")>-1},i.checkEnum=function(e,t){var n=this;if(!0===this._jsonModel.enforceEnum&&null!=e){var r=t.enum;return e instanceof Array&&this.isArrayType()?e.every(function(e){return r(n.enum||[],e).valid}):r(this.enum||[],e).valid}return!0},i.checkStep=function(){return"number"!=typeof this._jsonModel.step||(this._jsonModel.value-(this._jsonModel.minimum||this._jsonModel.default||0))%this._jsonModel.step==0},i.checkValidationExpression=function(){return"string"!=typeof this._jsonModel.validationExpression||this.executeExpression(this._jsonModel.validationExpression)},i.getConstraints=function(){switch(this.type){case"string":switch(this.format){case"date":return Gt.date;case"binary":case"data-url":return Gt.file;default:return Gt.string}case"file":return Gt.file;case"number":case"integer":return Gt.number}return this.isArrayType()?Gt.array:[]},i.evaluateConstraints=function(){var e=this,t="type",n=this._jsonModel,r=this._jsonModel.value,i=this._getConstraintObject(),o=this.getConstraints(),u=!0;if(u&&(u=i.required(this.required,r).valid&&(!this.isArrayType()||!this.required||r.length>0),t="required"),u&&r!=this.emptyValue){var s=o.find(function(t){if(t in n){var o=n[t],u=i[t];return r instanceof Array&&e.isArrayType()?-1!==Gt.array.indexOf(t)?!u(o,r).valid:r.some(function(e){return!u(o,e).valid}):"function"==typeof u&&!u(o,r).valid}return!1});null!=s?(u=!1,t=s):(t="enum",(u=this.checkEnum(r,i))&&"number"===this.type&&(u=this.checkStep(),t="step"),u&&(u=this.checkValidationExpression(),t="validationExpression"))}u||this.form.logger.log(t+" constraint evaluation failed "+this[t]+". Received "+this._jsonModel.value);var a={valid:u,errorMessage:u?"":this.getErrorMessage(t)};return this._applyUpdates(["valid","errorMessage"],a)},i.triggerValidationEvent=function(e){e.valid&&this.dispatch(this.valid?new Ue:new Le)},i.validate=function(){var e=this.evaluateConstraints();return e.valid&&(this.triggerValidationEvent(e),this.notifyDependents(new qe({changes:Object.values(e)}))),this.valid?[]:[new je(this.id,[this._jsonModel.errorMessage])]},i.importData=function(e){this._bindToDataModel(e);var t=this.getDataNode();if(void 0!==t&&t!==rt&&t.$value!==this._jsonModel.value){var n=Ve("value",t.$value,this._jsonModel.value);this._jsonModel.value=t.$value,this.queueEvent(n)}},i.defaultDataModel=function(e){return new tt(e,this.getDataNodeValue(this._jsonModel.value),this.type||"string")},i.getState=function(){return ge({},e.prototype.getState.call(this),{editValue:this.editValue,displayValue:this.displayValue})},t(r,[{key:"editFormat",get:function(){return this._jsonModel.editFormat}},{key:"displayFormat",get:function(){return this._jsonModel.displayFormat}},{key:"placeholder",get:function(){return this._jsonModel.placeholder}},{key:"readOnly",get:function(){return this._jsonModel.readOnly},set:function(e){this._setProperty("readOnly",e)}},{key:"language",get:function(){return Intl.DateTimeFormat().resolvedOptions().locale}},{key:"enabled",get:function(){return this._jsonModel.enabled},set:function(e){this._setProperty("enabled",e)}},{key:"valid",get:function(){return this._jsonModel.valid}},{key:"emptyValue",get:function(){return"null"===this._jsonModel.emptyValue?null:""===this._jsonModel.emptyValue&&"string"===this.type?"":void 0}},{key:"enum",get:function(){return this._jsonModel.enum},set:function(e){this._setProperty("enum",e)}},{key:"enumNames",get:function(){return this._jsonModel.enumNames},set:function(e){this._setProperty("enumNames",e)}},{key:"required",get:function(){return this._jsonModel.required||!1},set:function(e){this._setProperty("required",e)}},{key:"maximum",get:function(){return this._jsonModel.maximum},set:function(e){this._setProperty("maximum",e)}},{key:"minimum",get:function(){return this._jsonModel.minimum},set:function(e){this._setProperty("minimum",e)}},{key:"editValue",get:function(){var e=this.editFormat;return"date"==this.format&&null!=this.value&&!1!==this.valid?formatDate(new Date(this.value),this.language,e):this.value}},{key:"displayValue",get:function(){var e=this.displayFormat;return"date"==this.format&&null!=this.value&&!1!==this.valid?formatDate(new Date(this.value),this.language,e):this.value}},{key:"value",get:function(){return void 0===this._jsonModel.value?null:this._jsonModel.value},set:function(e){var t=this._getConstraintObject(),n=t.type(this.getInternalType()||"string",e),r=this._setProperty("value",n.value,!1),i={valid:!0};if(r.length>0){this._updateRuleNodeReference(n.value);var o,u=this.getDataNode();if(void 0!==u&&u.setValue(this.getDataNodeValue(this._jsonModel.value),this._jsonModel.value,this),this.parent.uniqueItems&&"array"===this.parent.type&&(i=t.uniqueItems(this.parent.uniqueItems,this.parent.getDataNode().$value)),n.valid&&i.valid)o=this.evaluateConstraints();else{var s={valid:n.valid&&i.valid,errorMessage:n.valid&&i.valid?"":this.getErrorMessage("type")};o=this._applyUpdates(["valid","errorMessage"],s)}o.valid&&this.triggerValidationEvent(o);var a=new qe({changes:r.concat(Object.values(o))});this.dispatch(a)}}},{key:"format",get:function(){return this._jsonModel.format||""}}]),r}(bt);function Bt(e,t){return e.replace(";base64",";name="+encodeURIComponent(t)+";base64")}Jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Ht.prototype,"readOnly",null),Jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Ht.prototype,"enabled",null),Jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Ht.prototype,"valid",null),Jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Ht.prototype,"enum",null),Jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Ht.prototype,"enumNames",null),Jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Ht.prototype,"required",null),Jt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Ht.prototype,"value",null);var Wt=/*#__PURE__*/function(e){function r(){return e.apply(this,arguments)||this}n(r,e);var i=r.prototype;return i._getDefaults=function(){return ge({},e.prototype._getDefaults.call(this),{accept:["audio/*","video/*","image/*","text/*","application/pdf"],maxFileSize:"2MB",type:"file"})},i._applyUpdates=function(e,t){var n=this;return e.reduce(function(e,r){var i=n._jsonModel[r],o=t[r];return o!==i&&(e[r]={propertyName:r,currentValue:o,prevValue:i},n._jsonModel[r]=i instanceof kt&&"object"==typeof o&&"value"===r?new kt(ge({},i,{data:o.data})):o),e},{})},i.getInternalType=function(){var e;return null!=(e=this.type)&&e.endsWith("[]")?"file[]":"file"},i.getDataNodeValue=function(e){var t,n=e;return null!=n&&("string"===this.type?n=null==(t=n.data)?void 0:t.toString():"string[]"===this.type&&(n=(n=n instanceof Array?n:[n]).map(function(e){var t;return null==e||null==(t=e.data)?void 0:t.toString()}))),n},i._serialize=function(){try{var e=this._jsonModel.value;return Promise.resolve(void 0===e?null:Promise.all([].map.call(e instanceof Array?e:[e],ye)))}catch(e){return Promise.reject(e)}},i.importData=function(e){this._bindToDataModel(e);var t=this.getDataNode();if(void 0!==t){var n=null==t?void 0:t.$value;if(null!=n){var r=Qt.type(this.getInternalType(),n);r.valid||this.form.logger.error("unable to bind "+this.name+" to data"),this.form.getEventQueue().queue(this,Ve("value",r.value,this._jsonModel.value)),this._jsonModel.value=r.value}else this._jsonModel.value=null}},t(r,[{key:"maxFileSize",get:function(){return St(this._jsonModel.maxFileSize)}},{key:"accept",get:function(){return this._jsonModel.accept}}]),r}(Ht),Yt=/*#__PURE__*/function(e){function r(){return e.apply(this,arguments)||this}n(r,e);var i=r.prototype;return i.offValue=function(){var e=this.enum;return e.length>1?e[1]:null},i._getConstraintObject=function(){var t,n=ge({},e.prototype._getConstraintObject.call(this));return n.required=(t=this.offValue(),function(e,n){return{valid:Qt.required(e,n).valid&&(!e||n!=t),value:n}}),n},i._getDefaults=function(){return ge({},e.prototype._getDefaults.call(this),{enforceEnum:!0})},t(r,[{key:"enum",get:function(){return this._jsonModel.enum||[]}}]),r}(Ht),Kt=/*#__PURE__*/function(e){function t(t,n){return e.call(this,t,n)||this}n(t,e);var r=t.prototype;return r._getFallbackType=function(){var t=e.prototype._getFallbackType.call(this);if("string"==typeof t)return t+"[]"},r._getDefaults=function(){return ge({},e.prototype._getDefaults.call(this),{enforceEnum:!0,enum:[]})},t}(Ht),Zt=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t.prototype._applyDefaults=function(){e.prototype._applyDefaults.call(this);var t=(new Intl.DateTimeFormat).resolvedOptions().locale;this._jsonModel.editFormat||(this._jsonModel.editFormat="short"),this._jsonModel.displayFormat||(this._jsonModel.displayFormat=this._jsonModel.editFormat),this._jsonModel.placeholder||(this._jsonModel.placeholder=getSkeleton(this._jsonModel.editFormat,t)),this._jsonModel.description||(this._jsonModel.description="To enter today's date use "+formatDate(new Date,t,this._jsonModel.editFormat))},t}(Ht),Xt=function(e,t){var n;return n="items"in e?new tn(e,t):Se(e)||"file-input"===e.fieldType?new Wt(e,t):Ie(e)?new Yt(e,t):Ce(e)?new Kt(e,t):Pe(e)?new Zt(e,t):new Ht(e,t),t.form.fieldAdded(n),n},en={visible:!0},tn=/*#__PURE__*/function(e){function r(t,n){var r;return(r=e.call(this,t,n)||this)._applyDefaults(),r.queueEvent(new Ge),r.queueEvent(new ze),r}n(r,e);var i=r.prototype;return i._applyDefaults=function(){var e=this;Object.entries(en).map(function(t){var n=t[0];void 0===e._jsonModel[n]&&(e._jsonModel[n]=t[1])}),this._jsonModel.dataRef&&void 0===this._jsonModel.type&&(this._jsonModel.type="object")},i._createChild=function(e,t){var n=t.parent;return Xt(e,{form:this.form,parent:void 0===n?this:n})},t(r,[{key:"type",get:function(){var t=e.prototype.type;if("array"===t||"object"===t)return t}},{key:"items",get:function(){return e.prototype.items}},{key:"value",get:function(){return null}},{key:"fieldType",get:function(){return"panel"}},{key:"enabled",get:function(){return this._jsonModel.enabled},set:function(e){this._setProperty("enabled",e)}}]),r}(xt),nn={off:0,debug:1,info:2,warn:3,error:4},rn=/*#__PURE__*/function(){var e=t.prototype;function t(e){void 0===e&&(e="off"),this.logLevel=nn[e]}return e.debug=function(e){this.log(e,"debug")},e.info=function(e){this.log(e,"info")},e.warn=function(e){this.log(e,"warn")},e.error=function(e){this.log(e,"error")},e.log=function(e,t){0!==this.logLevel&&this.logLevel<=nn[t]&&console[t](e)},t}(),on=/*#__PURE__*/function(){function e(e,t){this._node=e,this._event=t}var n=e.prototype;return n.isEqual=function(e){return null!=e&&this._node==e._node&&this._event.type==e._event.type},n.toString=function(){return this._node.id+"__"+this.event.type},n.valueOf=function(){return this.toString()},t(e,[{key:"node",get:function(){return this._node}},{key:"event",get:function(){return this._event}}]),e}(),un=/*#__PURE__*/function(){function e(e){void 0===e&&(e=new rn("off")),this._isProcessing=!1,this._pendingEvents=[],this.logger=e,this._runningEventCount={}}var n=e.prototype;return n.isQueued=function(e,t){var n=new on(e,t);return void 0!==this._pendingEvents.find(function(e){return n.isEqual(e)})},n.queue=function(t,n,r){var i=this;void 0===r&&(r=!1),t&&n&&(n instanceof Array||(n=[n]),n.forEach(function(n){var o=new on(t,n),u=i._runningEventCount[o.valueOf()]||0;u<e.MAX_EVENT_CYCLE_COUNT?(i.logger.info("Queued event : "+n.type+" node: "+t.id+" - "+t.name),r?i._pendingEvents.splice(i._isProcessing?1:0,0,o):i._pendingEvents.push(o),i._runningEventCount[o.valueOf()]=u+1):i.logger.info("Skipped queueing event : "+n.type+" node: "+t.id+" - "+t.name+" with count="+u)}))},n.runPendingQueue=function(){if(!this._isProcessing){for(this._isProcessing=!0;this._pendingEvents.length>0;){var e=this._pendingEvents[0];this.logger.info("Dequeued event : "+e.event.type+" node: "+e.node.id+" - "+e.node.name),e.node.executeAction(e.event),this._pendingEvents.shift()}this._runningEventCount={},this._isProcessing=!1}},t(e,[{key:"length",get:function(){return this._pendingEvents.length}},{key:"isProcessing",get:function(){return this._isProcessing}}]),e}();un.MAX_EVENT_CYCLE_COUNT=10;var sn=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n={});var r=ge({},an,n);return fetch(e,ge({},r,{body:t})).then(function(e){var t;if(!e.ok)throw new Error(e.statusText);return null!=e&&null!=(t=e.headers.get("Content-Type"))&&t.includes("application/json")?e.json():e.text()})},an={method:"GET"},ln=function(e){var t=e;return t.length>0&&t.startsWith("custom:")?t.substring("custom:".length):t},cn=function(e,t,n,r,i,o,u){try{var s,a,l,c=function(t){if(s)return t;var n=ln(i);e.form.dispatch(new Ze(n,a,!0))},h=t,f={method:n},d=function(e,t){try{var n=e()}catch(e){return t()}return n&&n.then?n.then(void 0,t):n}(function(){if(r&&r instanceof kt&&r.data instanceof File){var e=new FormData;e.append(r.name,r.data),l=e}else if(r instanceof FormData)l=r;else if(r&&"object"==typeof r&&Object.keys(r).length>0){var t,n=Object.keys(u);f.headers=n.length>0?ge({},u,-1===n.indexOf("Content-Type")?{"Content-Type":"application/json"}:{}):{"Content-Type":"application/json"};var i=(null==f||null==(t=f.headers)?void 0:t["Content-Type"])||"application/json";"application/json"===i?l=JSON.stringify(r):i.indexOf("multipart/form-data")>-1?l=fn(r):i.indexOf("application/x-www-form-urlencoded")>-1&&(l=hn(r))}return Promise.resolve(sn(h,l,f)).then(function(e){a=e})},function(){e.form.logger.error("Error invoking a rest API");var t=ln(o);e.form.dispatch(new Ze(t,{},!0)),s=1});return Promise.resolve(d&&d.then?d.then(c):c(d))}catch(e){return Promise.reject(e)}},hn=function(e){var t=new URLSearchParams;return Object.entries(e).forEach(function(e){var n=e[1];t.append(e[0],null!=n&&"object"==typeof n?Fe(n):n)}),t},fn=function(e,t){var n=new FormData;Object.entries(e).forEach(function(e){var t=e[1];n.append(e[0],null!=t&&"object"==typeof t?Fe(t):t)});var r=function(e,t){if((null==e?void 0:e.data)instanceof File){var n=(null==e?void 0:e.dataRef)+"/"+(null==e?void 0:e.name);n.startsWith("/")||(n="/"+n),t.append(n,e.data)}};return t&&Object.keys(t).reduce(function(e,i){var o=t[i];return[].concat(e,o&&o instanceof Array?o.map(function(e){return r(e,n)}):[r(o,n)])},[]),n},dn=/*#__PURE__*/function(){function e(){this.customFunctions={}}var t=e.prototype;return t.registerFunctions=function(e){var t=this;Object.entries(e).forEach(function(e){var n=e[0],r=e[1],i=r;"function"==typeof r&&(i={_func:function(e){return r.apply(void 0,e)},_signature:[]}),i.hasOwnProperty("_func")?t.customFunctions[n]=i:console.warn("Unable to register function with name "+n+".")})},t.unregisterFunctions=function(){var e=this;[].slice.call(arguments).forEach(function(t){t in e.customFunctions&&delete e.customFunctions[t]})},t.getFunctions=function(){function e(t){return null==t?t:null!==(n=t)&&"[object Array]"===Object.prototype.toString.call(n)?t.map(function(t){return e(t)}):t.valueOf();var n}function t(e){return null==e?"":e.toString()}return ge({},{validate:{_func:function(e,t,n){var r,i=e[0];return r="string"==typeof i||void 0===i?n.globals.form.validate():n.globals.form.getElement(i.$id).validate(),Array.isArray(r)&&r.length&&n.globals.form.logger.error("Form Validation Error"),r},_signature:[]},setFocus:{_func:function(e,t,n){var r=e[0];try{var i=n.globals.form.getElement(r.$id);n.globals.form.setFocus(i)}catch(e){n.globals.form.logger.error("Invalid argument passed in setFocus. An element is expected")}},_signature:[]},getData:{_func:function(e,t,n){return n.globals.form.logger.warn("The `getData` function is depricated. Use `exportData` instead."),n.globals.form.exportData()},_signature:[]},exportData:{_func:function(e,t,n){return n.globals.form.exportData()},_signature:[]},importData:{_func:function(e,t,n){var r=e[0];return"object"==typeof r&&null!==r&&n.globals.form.importData(r),{}},_signature:[]},submitForm:{_func:function(n,r,i){var o=t(n[0]),u=t(n[1]),s=n.length>2?t(n[2]):"multipart/form-data",a=n.length>3?e(n[3]):null;return i.globals.form.dispatch(new Ye({success:o,error:u,submit_as:s,data:a})),{}},_signature:[]},request:{_func:function(n,r,i){var o,u,s=t(n[0]),a=t(n[1]),l=e(n[2]),c={};return"string"==typeof n[3]?(i.globals.form.logger.warn("This usage of request is deprecated. Please see the documentation and update"),o=e(n[3]),u=e(n[4])):(c=e(n[3]),o=e(n[4]),u=e(n[5])),cn(i.globals,s,a,l,o,u,c),{}},_signature:[]},dispatchEvent:{_func:function(t,n,r){var i,o=t[0],u=e(t[1]),s=t.length>2?e(t[2]):void 0,a=!1;return"string"==typeof o&&(s=u,u=o,a=!0),i=u.startsWith("custom:")?new Ze(u.substring("custom:".length),s,a):function(e,t){switch(void 0===t&&(t={}),e){case"change":return new qe(t);case"submit":return new Ye(t);case"click":return new Je(t);case"addItem":return new Xe(t);case"removeItem":return new et(t);default:console.error("invalid action")}}(u,s),null!=i&&("string"==typeof o?r.globals.form.dispatch(i):r.globals.form.getElement(o.$id).dispatch(i)),{}},_signature:[]}},this.customFunctions)},e}(),pn=new dn,vn=/*#__PURE__*/function(e){function r(t,n,r,o){var u,s;return void 0===r&&(r=new un),void 0===o&&(o="off"),(u=e.call(this,t,{})||this)._fields={},u._invalidFields=[],u.dataRefRegex=/("[^"]+?"|[^.]+?)(?:\.|$)/g,u._ruleEngine=n,u._eventQueue=r,u._logger=new rn(o),u.queueEvent(new Ge),u.queueEvent(new ze),u._ids=(void 0===s&&(s=50),/*#__PURE__*/i().mark(function e(){var t,n,r,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=function(){for(var e=[],t=0;t<s;t++)e.push(Nt(10));return e},n={},r=t();case 3:for(o=r.pop();o in n;)0===r.length&&(r=t()),o=r.pop();return n[o]=!0,e.next=8,r.pop();case 8:0===r.length&&(r=t());case 9:if(r.length>0){e.next=3;break}case 10:case"end":return e.stop()}},e)})()),u._bindToDataModel(new it("$form",{})),u._initialize(),u.queueEvent(new Qe),u}n(r,e);var o=r.prototype;return o._createChild=function(e){return Xt(e,{form:this,parent:this})},o.importData=function(e){this._bindToDataModel(new it("$form",e)),this.syncDataAndFormModel(this.getDataNode()),this._eventQueue.runPendingQueue()},o.exportData=function(){var e;return null==(e=this.getDataNode())?void 0:e.$value},o.setFocus=function(e){for(var t=e.parent,n=e;null!=t&&t.activeChild!=n;)t.activeChild=n},o.getState=function(){var t=this,n=e.prototype.getState.call(this);return n.id="$form",Object.defineProperty(n,"data",{get:function(){return t.exportData()}}),Object.defineProperty(n,"attachments",{get:function(){return Ot(t)}}),n},o.isTransparent=function(){return!1},o.getUniqueId=function(){return null==this._ids?"":this._ids.next().value},o.fieldAdded=function(e){var t=this;this._fields[e.id]=e,e.subscribe(function(e){-1===t._invalidFields.indexOf(e.target.id)&&t._invalidFields.push(e.target.id)},"invalid"),e.subscribe(function(e){var n=t._invalidFields.indexOf(e.target.id);n>-1&&t._invalidFields.splice(n,1)},"valid"),e.subscribe(function(e){var n=e.target.getState();if(n){var r=new Ke(e.payload.changes,n);t.dispatch(r)}})},o.validate=function(){var t=e.prototype.validate.call(this);return this.dispatch(new Be(t)),t},o.isValid=function(){return 0===this._invalidFields.length},o.dispatch=function(t){"submit"===t.type?(e.prototype.queueEvent.call(this,t),this._eventQueue.runPendingQueue()):e.prototype.dispatch.call(this,t)},o.executeAction=function(t){"submit"===t.type&&0!==this._invalidFields.length||e.prototype.executeAction.call(this,t)},o.submit=function(e,t){if(0===this.validate().length){var n=(null==e?void 0:e.payload)||{};!function(e,t,n,r,i){void 0===r&&(r="multipart/form-data"),void 0===i&&(i=null);try{var o=e.form.action,u=i;"object"==typeof u&&null!=u||(u=e.form.exportData());var s,a=Ot(e.form),l=r;Object.keys(a).length>0||"multipart/form-data"===r?(s=fn({data:u},a),l="multipart/form-data"):s={data:u},Promise.resolve(cn(e,o,"POST",s,t,n,{"Content-Type":l})).then(function(){})}catch(e){return Promise.reject(e)}}(t,null==n?void 0:n.success,null==n?void 0:n.error,null==n?void 0:n.submit_as,null==n?void 0:n.data)}},o.getElement=function(e){return e==this.id?this:this._fields[e]},o.getEventQueue=function(){return this._eventQueue},t(r,[{key:"logger",get:function(){return this._logger}},{key:"metaData",get:function(){return new Mt(this._jsonModel.metadata||{})}},{key:"action",get:function(){return this._jsonModel.action}},{key:"type",get:function(){return"object"}},{key:"form",get:function(){return this}},{key:"ruleEngine",get:function(){return this._ruleEngine}},{key:"qualifiedName",get:function(){return"$form"}},{key:"name",get:function(){return"$form"}},{key:"value",get:function(){return null}},{key:"id",get:function(){return"$form"}},{key:"title",get:function(){return this._jsonModel.title||""}}]),r}(xt),_n=/*#__PURE__*/function(){function e(){this._globalNames=["$form","$field","$event"]}var t=e.prototype;return t.compileRule=function(e){var t=pn.getFunctions();return new _e(e,t,void 0,this._globalNames)},t.execute=function(e,t,n,i){void 0===i&&(i=!1);var o=this._context;this._context=n;var u=void 0;try{e.debug=[],u=e.search(t,n)}catch(e){var s,a,l;null==(s=this._context)||null==(a=s.form)||null==(l=a.logger)||l.error(e)}for(var c,h=r(e.debug);!(c=h()).done;){var f,d,p;null==(f=this._context)||null==(d=f.form)||null==(p=d.logger)||p.debug(c.value)}var v=u;return i&&"object"==typeof u&&null!==u&&(v=Object.getPrototypeOf(u).valueOf.call(u)),this._context=o,v},t.trackDependency=function(e){this._context&&void 0!==this._context.field&&this._context.field!==e&&e._addDependent(this._context.field)},e}(),yn=function(e,t,n,r){void 0===n&&(n="error"),void 0===r&&(r=void 0);try{var i=r;null==i&&(i=new vn(ge({},e),new _n,new un(new rn(n)),n));var o=null==e?void 0:e.data;return o&&i.importData(o),"function"==typeof t&&t(i),i.getEventQueue().runPendingQueue(),i}catch(e){throw console.error("Unable to create an instance of the Form "+e),new Error(e)}},gn=function(e,t){try{var n=new vn(ge({},e),new _n);return t&&n.importData(t),0===n.validate().length}catch(e){throw new Error(e)}},mn=function(e,t){try{var n=new vn(ge({},e),new _n);t&&n.importData(t);var r=n.validate();return{messages:r,valid:0===r.length}}catch(e){throw new Error(e)}},bn=function(e,t){void 0===t&&(t={});var n=new Headers;return Object.entries(t).forEach(function(e){n.append(e[0],e[1])}),sn(e+".model.json",null,{headers:t}).then(function(e){return"model"in e&&(e=e.model),Fe(e)})},jn="##",xn="afs:translationIds",En="properties",Mn=["de-DE","en-US","es-ES","fr-FR","it-IT","ja-JP","ko-KR","pt-BR","zh-CN","zh-TW"],kn=function(e,t){me.forEach(function(n){var r,i,o,u;n in t&&null!=e&&null!=(r=e.properties)&&null!=(i=r[xn])&&i[n]&&(null==e||null==(o=e.properties)||null==(u=o[xn])||delete u[n])})},wn=function(e,t){void 0===t&&(t=[]);var n=e,r=[].concat(me,t);return Dn(n,"",r),n},Dn=function e(t,n,i){Object.entries(t).forEach(function(o){var u=o[0],s=o[1];if("object"==typeof s)t instanceof Array?s&&"name"in s&&e(s,""+(""===n?n:n+"##")+s.name,i):e(s,"items"===u?n:""+(""===n?n:n+"##")+u,i);else if(":type"in t||"type"in t||"fieldType"in t)for(var a,l=r(i);!(a=l()).done;){var c=a.value;null!=On(t,c)&&("properties"in t||(t.properties={}),xn in t.properties||(t.properties[xn]={}),c in t.properties[xn]||(t.properties[xn][c]=n+"##"+c+"##"+(Math.floor(1e4*Math.random())+1)))}})},Nn=function e(t,n,i){Object.values(t).forEach(function(o){if("object"==typeof o)e(o,n,i);else for(var u,s=function(){var e=u.value,r=On(t,e);r&&null!=t&&null!=(l=t.properties)&&null!=(c=l[xn])&&c[e]&&(r instanceof Array?r.forEach(function(r,i){"string"==typeof r&&(n[t.properties[xn][e]+"##"+i]=r)}):n[""+t.properties[xn][e]]=r)},a=r(i);!(u=a()).done;){var l,c;s()}})},On=function(e,t,n){if(void 0===n&&(n=null),!t)return n;for(var r=Array.isArray(t)?t:t.split("."),i=e,o=0;o<r.length&&i.hasOwnProperty(r[o]);)i=i[r[o]],o++;return o==r.length?i:n},Sn=function(e,t){void 0===t&&(t=[]);var n={},r=[].concat(me,t);return Nn(e,n,r),n},Tn=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=[]);for(var i,o=[].concat(me,t),u=JSON.parse(JSON.stringify(e)),s=Sn(wn(u,t),o),a=[].concat(Mn,n),l={},c=r(a);!(i=c()).done;)l[i.value]=JSON.parse(JSON.stringify(s));return[u,l]};console.timeEnd("script af-core");export{Ae as ActionImpl,Xe as AddItem,mt as BaseNode,He as Blur,En as CUSTOM_PROPS_KEY,qe as Change,Yt as Checkbox,Kt as CheckboxGroup,Je as Click,xt as Container,Ze as CustomEvent,ze as ExecuteRule,Ht as Field,Ke as FieldChanged,tn as Fieldset,kt as FileObject,Wt as FileUpload,We as Focus,vn as Form,Qe as FormLoad,Mt as FormMetaData,pn as FunctionRuntime,Ge as Initialize,Le as Invalid,Et as Node,et as RemoveItem,bt as Scriptable,Ye as Submit,xn as TRANSLATION_ID,jn as TRANSLATION_TOKEN,Ue as Valid,Be as ValidationComplete,je as ValidationError,wn as addTranslationId,Te as checkIfConstraintsArePresent,$e as checkIfKeyAdded,be as constraintProps,yn as createFormInstance,Sn as createTranslationObj,Tn as createTranslationObject,Re as deepClone,we as defaultFieldTypes,Ne as exportDataSchema,It as extractFileInfo,bn as fetchForm,St as getFileSizeInBytes,On as getOrElse,Oe as getProperty,kn as invalidateTranslation,Ie as isCheckbox,Ce as isCheckboxGroup,Pe as isDateField,Se as isFile,Fe as jsonString,Ve as propertyChange,cn as request,me as translationProps,mn as validateFormData,gn as validateFormInstance};
//# sourceMappingURL=afcore-a4ce11e9.js.map
