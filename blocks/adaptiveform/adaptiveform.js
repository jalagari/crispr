function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},e.apply(this,arguments)}var t=0;function n(e){return"__private_"+t+++"_"+e}function i(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}class r{constructor(e,t){this.formContainer=void 0,this.element=void 0,this.active=void 0,this.id=void 0,this.parentView=void 0,this._model=void 0,this.options=void 0,this.formContainer=e.formContainer,this.id=e.id,this.element=e.element,this.active=!1,this.setModel(t)}setId(e){this.id=e}setParent(e){this.parentView=e,this.parentView.addChild&&this.parentView.addChild(this)}setActive(){this.isActive()||this.element.setAttribute("data-cmp-active","true"),this.parentView&&this.parentView.setActive&&this.parentView.setActive()}setInactive(){this.isActive()&&this.element.setAttribute("data-cmp-active","false"),this.parentView&&this.parentView.setInactive&&this.parentView.setInactive()}isActive(){return this.active}getFormContainerPath(){var e;return null==(e=this.options)?void 0:e.adaptiveformcontainerPath}getId(){return this.id}setModel(e){if(null!=this._model)throw"Re-initializing model is not permitted";this._model=e}toggle(e,t,n){this.toggleAttribute(this.element,e,t,n)}toggleAttribute(e,t,n,i){e&&(!1===t?e.setAttribute(n,i):e.removeAttribute(n))}getLayoutProperties(){let e={};const t=this.getModel().getState();return t&&t.properties&&t.properties["afs:layout"]&&(e=t.properties["afs:layout"]),e}getModel(){return this._model}subscribe(){throw"the field does not subscribe to the model"}getState(){var e;return null==(e=this._model)?void 0:e.getState()}isVisible(){return(null==this?void 0:this.getState().visible)||!0}isEnabled(){return(null==this?void 0:this.getState().enabled)||!0}isLabelVisible(){var e,t;return(null==this||null==(e=this.getState())||null==(t=e.label)?void 0:t.visible)||!0}getLabelValue(){var e,t;return(null==this||null==(e=this.getState())||null==(t=e.label)?void 0:t.value)||""}getName(){var e;return(null==this||null==(e=this.getState())?void 0:e.name)||""}isTooltipVisible(){return!1}getTooltipValue(){return""}isShortDescVisible(){return!1}getShortDescValue(){return""}getDescriptionValue(){var e;return(null==this||null==(e=this.getState())?void 0:e.description)||""}getDefault(){var e;return(null==this||null==(e=this.getState())?void 0:e.default)||""}isReadOnly(){var e;return(null==this||null==(e=this.getState())?void 0:e.readOnly)||!1}isRequired(){var e;return(null==this||null==(e=this.getState())?void 0:e.required)||!1}getPlaceHolder(){var e;return(null==this||null==(e=this.getState())?void 0:e.placeholder)||""}getMinLength(){var e;return null==this||null==(e=this.getState())?void 0:e.minLength}getMaxLength(){var e;return null==this||null==(e=this.getState())?void 0:e.maxLength}getMinimum(){var e;return null==this||null==(e=this.getState())?void 0:e.minimum}getMaximum(){var e;return null==this||null==(e=this.getState())?void 0:e.maximum}}r.IS="FormField";class s extends r{constructor(e,t){super(e,t),this.qm=void 0,this.widget=void 0,this.label=void 0,this.errorDiv=void 0,this.tooltip=void 0,this.description=void 0,this.element.className=this.getbemBlock(),this.widget=this.getWidget(),this.description=this.getDescription(),this.label=this.getLabel(),this.errorDiv=this.getErrorDiv(),this.qm=this.getQuestionMarkDiv(),this.tooltip=this.getTooltipDiv()}getWidget(){throw"method not implemented"}getDescription(){throw"method not implemented"}getLabel(){throw"method not implemented"}getErrorDiv(){throw"method not implemented"}getTooltipDiv(){throw"method not implemented"}getQuestionMarkDiv(){throw"method not implemented"}setModel(e){super.setModel(e);const t=this._model.getState();this._applyState(t)}setFocus(){var e;null==(e=this.getWidget())||e.focus()}_applyState(e){e.value&&this._updateValue(e.value),this._updateVisible(e.visible),this._updateEnabled(e.enabled),this._initializeHelpContent(e)}_initializeHelpContent(e){this._showHideLongDescriptionDiv(!1),this.getDescription()&&this._addHelpIconHandler(e)}_showHideTooltipDiv(e){this.tooltip&&this.toggleAttribute(this.getTooltipDiv(),e,"data-cmp-visible",!1)}_showHideLongDescriptionDiv(e){this.description&&this.toggleAttribute(this.description,e,"data-cmp-visible",!1)}_isTooltipAlwaysVisible(){return!!this.getLayoutProperties().tooltipVisible}_updateVisible(e){this.toggle(e,"aria-hidden",!0),this.element.setAttribute("data-cmp-visible",e+"")}_updateEnabled(e){var t,n,i,r;this.getWidget()&&(this.toggle(e,"aria-disabled",!0),this.element.setAttribute("data-cmp-enabled",e+""),!1===e?(null==(t=this.getWidget())||t.setAttribute("disabled","true"),null==(n=this.getWidget())||n.setAttribute("aria-disabled","true")):(null==(i=this.getWidget())||i.removeAttribute("disabled"),null==(r=this.getWidget())||r.removeAttribute("aria-disabled")))}_updateValid(e,t){this.errorDiv&&(this.toggle(e,"aria-invalid",!0),this.element.setAttribute("data-cmp-valid",e+""),"string"!=typeof t.errorMessage||""===t.errorMessage)&&(this.errorDiv.innerHTML=!0===e?"":"There is an error in the field")}_updateErrorMessage(e,t){this.errorDiv&&(this.errorDiv.innerHTML=t.errorMessage)}_updateValue(e){let t=this.getWidget();t&&(t.value=e)}_addHelpIconHandler(e){const t=this.qm,n=this.description,i=this._isTooltipAlwaysVisible(),r=this;t&&n&&t.addEventListener("click",e=>{e.preventDefault(),"false"===n.getAttribute("data-cmp-visible")?(r._showHideLongDescriptionDiv(!0),i&&r._showHideTooltipDiv(!1)):(r._showHideLongDescriptionDiv(!1),i&&r._showHideTooltipDiv(!0))})}getClass(){return this.constructor.IS}subscribe(){this._model.subscribe(e=>{let t=e.target.getState();e.payload.changes.forEach(e=>{const n=`_update${(i=e.propertyName)[0].toUpperCase()+i.slice(1)}`;var i;"function"==typeof this[n]?"items"===e.propertyName?this[n](e.prevValue,e.currentValue,t):this[n](e.currentValue,t):console.error(`changes to ${e.propertyName} are not supported. Please raise an issue`)})})}getbemBlock(){throw"bemBlock not implemented"}getIS(){throw"IS is not implemented"}getId(){return this.getIS()+"-"+this.id}addListener(){}render(){this.element.innerHTML=this.getHTML(),this.addListener(),this.subscribe()}getHTML(){return`\n            <div class="${this.getbemBlock()}"\n                data-cmp-is="${this.getIS()}"\n                id="${this.getId()}"\n                data-cmp-visible="${this.isVisible()}"\n                data-cmp-enabled="${this.isEnabled()}"\n                data-cmp-adaptiveformcontainer-path="${this.getFormContainerPath()}">\n\n                ${this.renderLabel()}\n                ${this.getInputHTML()}\n                ${this.getQuestionMarkHTML()}\n                ${this.getShortDescHTML()}\n                ${this.getLongDescHTML()}\n                ${this.getErrorHTML()}\n            </div>`}getInputHTML(){throw"getInputHTML is not implemented"}renderLabel(){return this.isLabelVisible()?`<label id="${this.getId()}-label" for="${this.getId()}" class="${this.getbemBlock()}__label" >${this.getLabelValue()}</label>`:""}getQuestionMarkHTML(){return this.getDescriptionValue()?`<button class="${this.getbemBlock()}__questionmark" data-sly-test="${this.getDescriptionValue()}">\n        </button>`:""}getShortDescHTML(){return this.isShortDescVisible()?`<div id="${this.getId()}-shortDescription" class="${this.getbemBlock()}__shortdescription">\n                {this.getShortDescValue()}\n            </div>`:""}getLongDescHTML(){return`<div aria-live="polite">\n                ${this.getDescriptionValue()?`<div id="${this.getId()}-longDescription" class="${this.getbemBlock()}__longdescription"></div>`:""}\n            </div>`}getErrorHTML(){return`<div id="${this.getId()}-errorMessage" class="${this.getbemBlock()}__errormessage"></div>`}getDisabledHTML(){return this.isEnabled()?"":' disabled="true" '}getReadonlyHTML(){return this.isReadOnly()?' readonly="true" ':""}}class o extends s{getWidget(){return this.element.querySelector(o.selectors.widget)}getDescription(){return this.element.querySelector(o.selectors.description)}getLabel(){return this.element.querySelector(o.selectors.label)}getErrorDiv(){return this.element.querySelector(o.selectors.errorDiv)}getTooltipDiv(){return this.element.querySelector(o.selectors.tooltipDiv)}getQuestionMarkDiv(){return this.element.querySelector(o.selectors.qm)}addListener(){var e,t;null==(e=this.getWidget())||e.addEventListener("blur",e=>{this._model.value=e.target.value,this.setInactive()}),null==(t=this.getWidget())||t.addEventListener("focus",e=>{this.setActive()})}getbemBlock(){return o.bemBlock}getIS(){return o.IS}getInputHTML(){return`<input\n            class="cmp-adaptiveform-textinput__widget"\n            title="${this.isTooltipVisible()?this.getTooltipValue():""}"\n            aria-label="${this.isLabelVisible()?this.getLabelValue():""}"\n            type="text"\n            name="${this.getName()}"\n            value="${this.getDefault()}"\n            ${this.getDisabledHTML()}\n            ${this.getReadonlyHTML()}\n            required="${this.isRequired()}"\n            placeholder="${this.getPlaceHolder()}"\n            minlength="${this.getMinLength()}"\n            maxlength="${this.getMaxLength()}"/>`}}function l(e){var t={exports:{}};return e(t,t.exports),t.exports}o.NS="cmp",o.IS="adaptiveFormTextInput",o.bemBlock="cmp-adaptiveform-textinput",o.selectors={self:"[data-"+o.NS+'-is="'+o.IS+'"]',widget:`.${o.bemBlock}__widget`,label:`.${o.bemBlock}__label`,description:`.${o.bemBlock}__longdescription`,qm:`.${o.bemBlock}__questionmark`,errorDiv:`.${o.bemBlock}__errormessage`,tooltipDiv:`.${o.bemBlock}__shortdescription`};var a=d;const u=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvV]{1,5}|[zZOvVxX]{1,3}|S{1,3}|'(?:[^']|'')*')|[^a-zA-Z']+/g;function c(e,t){const n={},i=e.split(/\s/).filter(e=>e.length);n.dateStyle=i[0],i.length>1&&(n.timeStyle=i[1]);const r=new Date(2e3,2,1,2,3,4),s=new Intl.DateTimeFormat(t,n).formatToParts(r),o=s.find(e=>"month"===e.type).value,l=new Intl.DateTimeFormat(t,{month:"long"}).formatToParts(r)[0].value,a=new Intl.DateTimeFormat(t,{month:"short"}).formatToParts(r)[0].value,u=[];return s.forEach(t=>{let n,{type:i,value:r}=t;"month"===i&&(n={[o]:"medium"===e?"short":"long",[l]:"long",[a]:"short","03":"2-digit",3:"numeric"}[r]),"year"===i&&(n={2e3:"numeric","00":"2-digit"}[r]),["day","hour","minute","second"].includes(i)&&(n=2===r.length?"2-digit":"numeric"),"literal"===i&&(n=r),"dayPeriod"===i&&(n="short"),u.push([i,n,r.length])}),u}var h=/*#__PURE__*/Object.defineProperty({getSkeleton:function(e,t){if(a.ShorthandStyles.find(t=>e.includes(t))){const n=c(e,t),i=[],r={month:"M",year:"Y",day:"d"};return n.forEach(e=>{let[t,n,s]=e;t in r?i.push(Array(s).fill(r[t]).join("")):"literal"===t&&i.push(n)}),i.join("")}return e},parseDateTimeSkeleton:function(e,t){if(a.ShorthandStyles.find(t=>e.includes(t)))return c(e,t);const n=[];return e.replace(u,e=>{const t=e.length;switch(e[0]){case"G":n.push(["era",4===t?"long":5===t?"narrow":"short",t]);break;case"y":n.push(["year",2===t?"2-digit":"numeric",t]);break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":n.push(["month",["numeric","2-digit","short","long","narrow"][t-1],t]);break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":n.push(["day",["numeric","2-digit"][t-1],t]);break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":n.push(["weekday",["short","short","short","long","narrow","narrow"][t-1],t]);break;case"e":if(t<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");n.push(["weekday",["short","long","narrow","short"][t-4],t]);break;case"c":if(t<3||t>5)throw new RangeError("`c, cc, cccccc` (weekday) patterns are not supported");n.push(["weekday",["short","long","narrow","short"][t-3],t]);break;case"a":n.push(["hour12",!0,1]);break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":n.push(["hourCycle","h12"]),n.push(["hour",["numeric","2-digit"][t-1],t]);break;case"H":n.push(["hourCycle","h23",1]),n.push(["hour",["numeric","2-digit"][t-1],t]);break;case"K":n.push(["hourCycle","h11",1]),n.push(["hour",["numeric","2-digit"][t-1],t]);break;case"k":n.push(["hourCycle","h24",1]),n.push(["hour",["numeric","2-digit"][t-1],t]);break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":n.push(["minute",["numeric","2-digit"][t-1],t]);break;case"s":n.push(["second",["numeric","2-digit"][t-1],t]);break;case"S":n.push(["fractionalSecondDigits",t,t]);break;case"A":throw new RangeError("`S/A` (millisecond) patterns are not supported, use `s` instead");case"O":n.push(["timeZoneName",t<4?"shortOffset":"longOffset",t]),n.push(["x-timeZoneName",t<4?"O":"OOOO",t]);break;case"X":case"x":case"Z":n.push(["timeZoneName","longOffset",1]),n.push(["x-timeZoneName",e,1]);break;case"z":case"v":case"V":throw new RangeError("z/v/V` (timeZone) patterns are not supported, use `X/x/Z/O` instead");case"'":n.push(["literal",e.slice(1,-1).replace(/''/g,"'"),-1]);break;default:n.push(["literal",e,-1])}return""}),n}},"__esModule",{value:!0}),d=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ShorthandStyles=void 0,t.adjustTimeZone=u,t.datetimeToNumber=function(e){return null===e?0:e.getTime()/864e5},t.formatDate=function(e,t,n,i){if(c.find(e=>n.includes(e))){const r={timeZone:i},s=n.split(/\s/).filter(e=>e.length);return c.indexOf(s[0])>-1&&(r.dateStyle=s[0]),s.length>1&&c.indexOf(s[1])>-1&&(r.timeStyle=s[1]),new Intl.DateTimeFormat(t,r).format(e)}return function(e,t,n,i){const r=(0,h.parseDateTimeSkeleton)(n,t);r.push(["timeZone",i]);const s=r.filter(e=>!e[0].startsWith("x-")),o=r.filter(e=>e[0].startsWith("x-")),l=Object.fromEntries(s);delete l.literal;const a=new Intl.DateTimeFormat(t,l).formatToParts(e);return function(e,t){["hour","minute","second"].forEach(n=>{const i=e.find(e=>e.type===n);if(!i)return;const r=t.find(e=>e[0]===n)[1];"2-digit"===r&&1===i.value.length&&(i.value=`0${i.value}`),"numeric"===r&&2===i.value.length&&"0"===i.value.charAt(0)&&(i.value=i.value.slice(1))})}(a,r),function(e,t){const n=e.find(e=>"year"===e.type);if(!n)return;const i=t.find(e=>"year"===e[0])[2];for(;n.value.length<i;)n.value=`0${n.value}`}(a,s),s.reduce((e,t)=>{if("literal"===t[0])e.push(t);else{const n=a.find(e=>{return e.type===({hour12:"dayPeriod",fractionalSecondDigits:"fractionalSecond"}[n=t[0]]||n);var n});if(n&&"timeZoneName"===n.type){const e=o.find(e=>"x-timeZoneName"===e[0])[1],t=e[0];"Z"===t&&(e.length<4?(n.value=n.value.replace(/(GMT|:)/g,""),""===n.value&&(n.value="+0000")):5===e.length&&(n.value="GMT"===n.value?"Z":n.value.replace(/GMT/,""))),"X"===t||"x"===t?(1===e.length&&(n.value=n.value.replace(/(GMT|:(00)?)/g,"")),2===e.length&&(n.value=n.value.replace(/(GMT|:)/g,"")),3===e.length&&(n.value=n.value.replace(/GMT/g,"")),"X"===t&&""===n.value&&(n.value="Z")):"O"===e&&(n.value=n.value.replace(/GMT/g,"").replace(/0(\d+):/,"$1:").replace(/:00/,""),""===n.value&&(n.value="+0"))}n&&e.push([n.type,n.value])}return e},[])}(e,t,n,i).map(e=>e[1]).join("")},t.numberToDatetime=function(e){return new Date(Math.round(1e3*e*60*60*24))},t.offsetMS=l,t.offsetMSFallback=a,t.parseDate=d,t.parseDefaultDate=function(e,t,n){return d(e,t,"short",null,!1)};const n=[0,1,2,3,4,5,6,7,8,9,10,11].map(e=>new Date(2e3,e,1));function i(e,t){return n.map(n=>{const i=new Intl.DateTimeFormat(e,t).formatToParts(n).find(e=>"month"===e.type);return i&&i.value})}function r(e){return new Intl.NumberFormat(e,{style:"decimal",useGrouping:!1}).format(9876543210).split("").reverse()}function s(e){var t;const n=null===(t=new Intl.DateTimeFormat(e,{era:"short"}).formatToParts(new Date).find(e=>"era"===e.type))||void 0===t?void 0:t.value;return"هـ"===n?"islamic":"gregory"}function o(e){const t=new Date(2e3,1,1,1,1,1),n=new Date(2e3,1,1,16,1,1),i=new Intl.DateTimeFormat(e,{dateStyle:"full",timeStyle:"full"}),r=i.formatToParts(t).find(e=>"dayPeriod"===e.type),s=i.formatToParts(n).find(e=>"dayPeriod"===e.type);return r&&s?{regex:`(${r.value}|${s.value})`,fn:(e,t)=>t.hour+=e===s.value?12:0}:null}function l(e,t){let n;try{n=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format(e)}catch(e){return a(0,t)}const i=/GMT([+\-−])?(\d{1,2}):?(\d{0,2})?/.exec(n);if(!i)return 0;const[r,s,o]=i.slice(1),l=60*(60*(isNaN(parseInt(s))?0:parseInt(s))+(isNaN(parseInt(o))?0:parseInt(o)))*1e3;return"-"===r?-l:l}function a(e,t){const n=function(e){var t=new Date;function n(e){var t=e.replace(":"," ").split(" ");return{day:parseInt(t[0]),hour:parseInt(t[1]),minute:parseInt(t[2])}}var i=t.toLocaleString("en-US",{timeZone:e,day:"numeric",hour:"numeric",minute:"numeric",hour12:!1}),r=n(i),s=n(i=t.toLocaleString("en-US",{day:"numeric",hour:"numeric",minute:"numeric",hour12:!1}));return 24*r.day*60+60*r.hour+r.minute-(24*s.day*60+60*s.hour+s.minute)-t.getTimezoneOffset()}(t);return 60*n*1e3}function u(e,t){if(null===e)return null;let n=e.getTime()-60*e.getTimezoneOffset()*1e3;const i=l(e,t);return a(0,t),n+=-i,new Date(n)}const c=["full","long","medium","short"];function d(e,t,n,l){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const c=[],d=[],p=s(t),g=r(t),m=`([${g[0]}-${g[9]}]{1,2})`,_=`([${g[0]}-${g[9]}]{1,3})`,f=`([${g[0]}-${g[9]}]{1,4})`;let v="h12",y=a,b=!1;const E=e=>1===e.length&&":-/.".includes(e),T=e=>w(e)-1,w=e=>e.split("").reduce((e,t)=>10*e+g.indexOf(t),0),M=e=>t=>{let n=w(t);return n=n<100&&2===e?n+2e3:n,"islamic"===p&&(n=Math.ceil(.97*n+622)),e>2&&n<100&&(b=!0),n},O=e=>t=>e.indexOf(t),x=(0,h.parseDateTimeSkeleton)(n,t),D=i(t,Object.fromEntries(x));x.forEach(e=>{let[n,i,r]=e;if("literal"===n)E(i)?d.push(`[^${g[0]}-${g[9]}]`):d.push(i);else if("month"===n&&["numeric","2-digit"].includes(i))d.push(m),c.push(["month",T]);else if("month"===n&&["formatted","long","short","narrow"].includes(i))d.push(`(${D.join("|")})`),c.push(["month",O(D)]);else if(["day","minute","second"].includes(n))"minute"!==n&&"second"!==n||(y=!1),d.push(m),c.push([n,w]);else if("fractionalSecondDigits"===n)y=!1,d.push(_),c.push([n,(e,t)=>t.fractionalSecondDigits+w(e)]);else if("hour"===n)y=!1,d.push(m),c.push([n,(e,t)=>t.hour+w(e)]);else if("year"===n)d.push("numeric"===i?f:m),c.push(["year",M(r)]);else if("dayPeriod"===n){y=!1;const e=o(t);e&&(d.push(e.regex),c.push(["hour",e.fn]))}else"hourCycle"===n?(y=!1,v=i):"x-timeZoneName"===n?(y=!1,d.push("(?:GMT|UTC|Z)?([+\\-−0-9]{0,3}:?[0-9]{0,2})"),c.push([n,(e,t)=>{if(y=!0,!e)return;const n=e.replace(/−/,"-").match(/([+\-\d]{2,3}):?(\d{0,2})/),i=1*n[1];t.hour-=i;const r=n.length>2?1*n[2]:0;t.minute-=i<0?-r:r}])):"timeZoneName"!==n&&(y=!1,d.push(".+?"));return d},[]);const $=new RegExp(d.join("")),N=e.match($);if(null===N)return e;const S={year:1972,month:0,day:1,hour:0,minute:0,second:0,fractionalSecondDigits:0};if(N.slice(1).forEach((e,t)=>{const[n,i]=c[t];S[n]=i(e,S)}),"h24"===v&&24===S.hour&&(S.hour=0),"h12"===v&&12===S.hour&&(S.hour=0),y){const e=new Date(Date.UTC(S.year,S.month,S.day,S.hour,S.minute,S.second,S.fractionalSecondDigits));return b&&e.setUTCFullYear(S.year),e}const j=new Date(S.year,S.month,S.day,S.hour,S.minute,S.second,S.fractionalSecondDigits);return b&&j.setFullYear(S.year),null==l?j:u(j,l)}t.ShorthandStyles=c}),p=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"formatDate",{enumerable:!0,get:function(){return a.formatDate}}),Object.defineProperty(t,"getSkeleton",{enumerable:!0,get:function(){return h.getSkeleton}}),Object.defineProperty(t,"parseDate",{enumerable:!0,get:function(){return a.parseDate}})}),g=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"formatDate",{enumerable:!0,get:function(){return p.formatDate}}),Object.defineProperty(t,"getSkeleton",{enumerable:!0,get:function(){return p.getSkeleton}}),Object.defineProperty(t,"parseDate",{enumerable:!0,get:function(){return p.parseDate}})}),m={TYPE_NUMBER:0,TYPE_ANY:1,TYPE_STRING:2,TYPE_ARRAY:3,TYPE_OBJECT:4,TYPE_BOOLEAN:5,TYPE_EXPREF:6,TYPE_NULL:7,TYPE_ARRAY_NUMBER:8,TYPE_ARRAY_STRING:9,TYPE_CLASS:10,TYPE_ARRAY_ARRAY:11},_={TOK_EOF:"EOF",TOK_UNQUOTEDIDENTIFIER:"UnquotedIdentifier",TOK_QUOTEDIDENTIFIER:"QuotedIdentifier",TOK_RBRACKET:"Rbracket",TOK_RPAREN:"Rparen",TOK_COMMA:"Comma",TOK_COLON:"Colon",TOK_CONCATENATE:"Concatenate",TOK_RBRACE:"Rbrace",TOK_NUMBER:"Number",TOK_CURRENT:"Current",TOK_GLOBAL:"Global",TOK_FIELD:"Field",TOK_EXPREF:"Expref",TOK_PIPE:"Pipe",TOK_OR:"Or",TOK_AND:"And",TOK_ADD:"Add",TOK_SUBTRACT:"Subtract",TOK_MULTIPLY:"Multiply",TOK_POWER:"Power",TOK_UNION:"Union",TOK_DIVIDE:"Divide",TOK_EQ:"EQ",TOK_GT:"GT",TOK_LT:"LT",TOK_GTE:"GTE",TOK_LTE:"LTE",TOK_NE:"NE",TOK_FLATTEN:"Flatten",TOK_STAR:"Star",TOK_FILTER:"Filter",TOK_DOT:"Dot",TOK_NOT:"Not",TOK_LBRACE:"Lbrace",TOK_LBRACKET:"Lbracket",TOK_LPAREN:"Lparen",TOK_LITERAL:"Literal"};const{TYPE_NUMBER:f,TYPE_ANY:v,TYPE_STRING:y,TYPE_ARRAY:b,TYPE_OBJECT:E,TYPE_BOOLEAN:T,TYPE_EXPREF:w,TYPE_NULL:M,TYPE_ARRAY_NUMBER:O,TYPE_ARRAY_STRING:x,TYPE_CLASS:D,TYPE_ARRAY_ARRAY:$}=m,{TOK_EXPREF:N}=_,S={[f]:"number",[v]:"any",[y]:"string",[b]:"array",[E]:"object",[T]:"boolean",[w]:"expression",[M]:"null",[O]:"Array<number>",[x]:"Array<string>",[D]:"class",[$]:"Array<array>"};function j(e,t=!0){if(null===e)return M;let n=e;if(t){if("function"!=typeof e.valueOf)return E;n=e.valueOf.call(e)}switch(Object.prototype.toString.call(n)){case"[object String]":return y;case"[object Number]":return f;case"[object Array]":return b;case"[object Boolean]":return T;case"[object Null]":return M;case"[object Object]":return n.jmespathType===N?w:E;default:return E}}function k(e){return[j(e),j(e,!1)]}function P(e,t,n,i,r,s){const o=e[0];if(-1!==t.findIndex(e=>e===v||o===e))return n;let l=!1;if((o===E||1===t.length&&t[0]===D)&&(l=!0),o===b&&1===t.length&&t[0]===E&&(l=!0),t.includes($)){if(o===b&&(n.forEach(e=>{e instanceof Array||(l=!0)}),!l))return n;l=!0}if(l)throw new Error(`TypeError: ${i} expected argument to be type ${S[t[0]]} but received type ${S[o]} instead.`);let a=-1;if(o===b&&t.includes(x)&&t.includes(O)&&(a=n.length>0&&"string"==typeof n[0]?x:O),-1===a&&[x,O,b].includes(o)&&(a=t.find(e=>[x,O,b].includes(e))),-1===a&&([a]=t),a===v)return n;if(a===x||a===O||a===b){if(a===b)return o===O||o===x?n:null===n?[]:[n];const t=a===O?f:y;if(o===b){const e=n.slice();for(let n=0;n<e.length;n+=1){const o=k(e[n]);e[n]=P(o,[t],e[n],i,r,s)}return e}if([f,y,M,T].includes(t))return[P(e,[t],n,i,r,s)]}else{if(a===f)return[y,T,M].includes(o)?r(n):0;if(a===y)return o===M||o===E?"":s(n);if(a===T)return!!n;if(a===E&&e[1]===E)return n}throw new Error("unhandled argument")}function R(e){return null!==e&&"[object Array]"===Object.prototype.toString.call(e)}function I(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function A(e){return null==e?e:R(e)?e.map(e=>A(e)):"function"!=typeof e.valueOf?e:e.valueOf()}function L(e,t){const n=A(e),i=A(t);if(n===i)return!0;if(Object.prototype.toString.call(n)!==Object.prototype.toString.call(i))return!1;if(!0===R(n)){if(n.length!==i.length)return!1;for(let e=0;e<n.length;e+=1)if(!1===L(n[e],i[e]))return!1;return!0}if(!0===I(n)){const e={};for(const t in n)if(hasOwnProperty.call(n,t)){if(!1===L(n[t],i[t]))return!1;e[t]=!0}for(const t in i)if(hasOwnProperty.call(i,t)&&!0!==e[t])return!1;return!0}return!1}const{TOK_CURRENT:C,TOK_GLOBAL:Y,TOK_EXPREF:B,TOK_PIPE:F,TOK_EQ:q,TOK_GT:U,TOK_LT:K,TOK_GTE:V,TOK_LTE:H,TOK_NE:G,TOK_FLATTEN:z}=_,{TYPE_STRING:W,TYPE_ARRAY_STRING:Q,TYPE_ARRAY:Z}=m;function J(e){if(null===e)return!0;const t=A(e);if(""===t||!1===t||null===t)return!0;if(R(t)&&0===t.length)return!0;if(I(t)){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}return!t}class X{constructor(e,t,n,i,r,s){this.runtime=e,this.globals=t,this.toNumber=n,this.toString=i,this.debug=r,this.language=s}search(e,t){return this.visit(e,t)}visit(e,t){const n=e&&{Field:(e,t)=>{if(null!==t&&(I(t)||R(t))){let n=t[e.name];if("function"==typeof n&&(n=void 0),void 0===n){try{this.debug.push(`Failed to find: '${e.name}'`);const n=Object.keys(t).map(e=>`'${e}'`).toString();n.length&&this.debug.push(`Available fields: ${n}`)}catch(e){}return null}return n}return null},Subexpression:(e,t)=>{let n=this.visit(e.children[0],t);for(let t=1;t<e.children.length;t+=1)if(n=this.visit(e.children[1],n),null===n)return null;return n},IndexExpression:(e,t)=>{const n=this.visit(e.children[0],t);return this.visit(e.children[1],n)},Index:(e,t)=>{if(R(t)){let n=this.toNumber(this.visit(e.value,t));n<0&&(n=t.length+n);const i=t[n];return void 0===i?(this.debug.push(`Index ${n} out of range`),null):i}if(I(t)){const n=this.toString(this.visit(e.value,t)),i=t[n];return void 0===i?(this.debug.push(`Key ${n} does not exist`),null):i}return this.debug.push(`left side of index expression ${t} is not an array or object.`),null},Slice:(e,t)=>{if(!R(t))return null;const n=e.children.slice(0).map(e=>null!=e?this.toNumber(this.visit(e,t)):null),i=this.computeSliceParams(t.length,n),[r,s,o]=i,l=[];if(o>0)for(let e=r;e<s;e+=o)l.push(t[e]);else for(let e=r;e>s;e+=o)l.push(t[e]);return l},Projection:(e,t)=>{const n=this.visit(e.children[0],t);if(!R(n))return null;const i=[];return n.forEach(t=>{const n=this.visit(e.children[1],t);null!==n&&i.push(n)}),i},ValueProjection:(e,t)=>{const n=this.visit(e.children[0],t);if(!I(A(n)))return null;const i=[];return Object.values(n).forEach(t=>{const n=this.visit(e.children[1],t);null!==n&&i.push(n)}),i},FilterProjection:(e,t)=>{const n=this.visit(e.children[0],t);if(!R(n))return null;const i=n.filter(t=>!J(this.visit(e.children[2],t))),r=[];return i.forEach(t=>{const n=this.visit(e.children[1],t);null!==n&&r.push(n)}),r},Comparator:(e,t)=>{const n=this.visit(e.children[0],t),i=this.visit(e.children[1],t);if(e.name===q)return L(n,i);if(e.name===G)return!L(n,i);if(e.name===U)return n>i;if(e.name===V)return n>=i;if(e.name===K)return n<i;if(e.name===H)return n<=i;throw new Error(`Unknown comparator: ${e.name}`)},[z]:(e,t)=>{const n=this.visit(e.children[0],t);if(!R(n))return null;const i=[];return n.forEach(e=>{R(e)?i.push(...e):i.push(e)}),i},Identity:(e,t)=>t,MultiSelectList:(e,t)=>null===t?null:e.children.map(e=>this.visit(e,t)),MultiSelectHash:(e,t)=>{if(null===t)return null;const n={};return e.children.forEach(e=>{n[e.name]=this.visit(e.value,t)}),n},OrExpression:(e,t)=>{let n=this.visit(e.children[0],t);return J(n)&&(n=this.visit(e.children[1],t)),n},AndExpression:(e,t)=>{const n=this.visit(e.children[0],t);return!0===J(n)?n:this.visit(e.children[1],t)},AddExpression:(e,t)=>{const n=this.visit(e.children[0],t),i=this.visit(e.children[1],t);return this.applyOperator(n,i,"+")},ConcatenateExpression:(e,t)=>{let n=this.visit(e.children[0],t),i=this.visit(e.children[1],t);return n=P(k(n),[W,Q],n,"concatenate",this.toNumber,this.toString),i=P(k(i),[W,Q],i,"concatenate",this.toNumber,this.toString),this.applyOperator(n,i,"&")},UnionExpression:(e,t)=>{let n=this.visit(e.children[0],t),i=this.visit(e.children[1],t);return n=P(k(n),[Z],n,"union",this.toNumber,this.toString),i=P(k(i),[Z],i,"union",this.toNumber,this.toString),n.concat(i)},SubtractExpression:(e,t)=>{const n=this.visit(e.children[0],t),i=this.visit(e.children[1],t);return this.applyOperator(n,i,"-")},MultiplyExpression:(e,t)=>{const n=this.visit(e.children[0],t),i=this.visit(e.children[1],t);return this.applyOperator(n,i,"*")},DivideExpression:(e,t)=>{const n=this.visit(e.children[0],t),i=this.visit(e.children[1],t);return this.applyOperator(n,i,"/")},PowerExpression:(e,t)=>{const n=this.visit(e.children[0],t),i=this.visit(e.children[1],t);return this.applyOperator(n,i,"^")},NotExpression:(e,t)=>J(this.visit(e.children[0],t)),Literal:e=>e.value,Number:e=>e.value,[F]:(e,t)=>{const n=this.visit(e.children[0],t);return this.visit(e.children[1],n)},[C]:(e,t)=>t,[Y]:e=>{const t=this.globals[e.name];return void 0===t?null:t},Function:(e,t)=>{if("if"===e.name)return this.runtime.callFunction(e.name,e.children,t,this,!1);const n=e.children.map(e=>this.visit(e,t));return this.runtime.callFunction(e.name,n,t,this)},ExpressionReference:e=>{const[t]=e.children;return t.jmespathType=B,t}}[e.type];if(!n)throw new Error(`Unknown/missing node type ${e&&e.type||""}`);return n(e,t)}computeSliceParams(e,t){function n(e,t,n){let i=t;return i<0?(i+=e,i<0&&(i=n<0?-1:0)):i>=e&&(i=n<0?e-1:e),i}let[i,r,s]=t;if(null===s)s=1;else if(0===s){const e=new Error("Invalid slice, step cannot be 0");throw e.name="RuntimeError",e}const o=s<0;return i=null===i?o?e-1:0:n(e,i,s),r=null===r?o?-1:e:n(e,r,s),[i,r,s]}applyOperator(e,t,n){if(R(e)&&R(t)){const i=e.length<t.length?e:t,r=Math.abs(e.length-t.length);i.length+=r,i.fill(null,i.length-r);const s=[];for(let i=0;i<e.length;i+=1)s.push(this.applyOperator(e[i],t[i],n));return s}if(R(e))return e.map(e=>this.applyOperator(e,t,n));if(R(t))return t.map(t=>this.applyOperator(e,t,n));if("*"===n)return this.toNumber(e)*this.toNumber(t);if("&"===n)return e+t;if("+"===n)return this.toNumber(e)+this.toNumber(t);if("-"===n)return this.toNumber(e)-this.toNumber(t);if("/"===n){const n=e/t;return Number.isFinite(n)?n:null}if("^"===n)return e**t;throw new Error(`Unknown operator: ${n}`)}}const{TOK_UNQUOTEDIDENTIFIER:ee,TOK_QUOTEDIDENTIFIER:te,TOK_RBRACKET:ne,TOK_RPAREN:ie,TOK_COMMA:re,TOK_COLON:se,TOK_CONCATENATE:oe,TOK_RBRACE:le,TOK_NUMBER:ae,TOK_CURRENT:ue,TOK_GLOBAL:ce,TOK_EXPREF:he,TOK_PIPE:de,TOK_OR:pe,TOK_AND:ge,TOK_ADD:me,TOK_SUBTRACT:_e,TOK_MULTIPLY:fe,TOK_POWER:ve,TOK_DIVIDE:ye,TOK_UNION:be,TOK_EQ:Ee,TOK_GT:Te,TOK_LT:we,TOK_GTE:Me,TOK_LTE:Oe,TOK_NE:xe,TOK_FLATTEN:De,TOK_STAR:$e,TOK_FILTER:Ne,TOK_DOT:Se,TOK_NOT:je,TOK_LBRACE:ke,TOK_LBRACKET:Pe,TOK_LPAREN:Re,TOK_LITERAL:Ie}=_,Ae={".":Se,",":re,":":se,"{":ke,"}":le,"]":ne,"(":Re,")":ie,"@":ue},Le={"<":!0,">":!0,"=":!0,"!":!0},Ce={" ":!0,"\t":!0,"\n":!0};function Ye(e,t){return e>="0"&&e<="9"||t&&"-"===e||"."===e}function Be(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e}function Fe(e,t){const n=e[t];return"$"===n?e.length>t&&Be(e[t+1]):n>="a"&&n<="z"||n>="A"&&n<="Z"||"_"===n}class qe{constructor(e=[],t=[]){this._allowedGlobalNames=e,this.debug=t}tokenize(e){const t=[];let n,i,r;for(this._current=0;this._current<e.length;){const s=t.length?t.slice(-1)[0].type:null;if(this._isGlobal(s,e,this._current))t.push(this._consumeGlobal(e));else if(Fe(e,this._current))n=this._current,i=this._consumeUnquotedIdentifier(e),t.push({type:ee,value:i,start:n});else if(void 0!==Ae[e[this._current]])t.push({type:Ae[e[this._current]],value:e[this._current],start:this._current}),this._current+=1;else if("-"===e[this._current]&&![ue,ae,ie,ee,te,ne].includes(s)||Ye(e[this._current],!1))r=this._consumeNumber(e),t.push(r);else if("["===e[this._current])r=this._consumeLBracket(e),t.push(r);else if('"'===e[this._current])n=this._current,i=this._consumeQuotedIdentifier(e),t.push({type:te,value:i,start:n});else if("'"===e[this._current])n=this._current,i=this._consumeRawStringLiteral(e),t.push({type:Ie,value:i,start:n});else if("`"===e[this._current]){n=this._current;const i=this._consumeLiteral(e);t.push({type:Ie,value:i,start:n})}else if(void 0!==Le[e[this._current]])t.push(this._consumeOperator(e));else if(void 0!==Ce[e[this._current]])this._current+=1;else if("&"===e[this._current])n=this._current,this._current+=1,"&"===e[this._current]?(this._current+=1,t.push({type:ge,value:"&&",start:n})):t.push(s===re||s===Re?{type:he,value:"&",start:n}:{type:oe,value:"&",start:n});else if("~"===e[this._current])n=this._current,this._current+=1,t.push({type:be,value:"~",start:n});else if("+"===e[this._current])n=this._current,this._current+=1,t.push({type:me,value:"+",start:n});else if("-"===e[this._current])n=this._current,this._current+=1,t.push({type:_e,value:"-",start:n});else if("*"===e[this._current]){n=this._current,this._current+=1;const e=t.length&&t.slice(-1)[0].type;0===t.length||[Pe,Se,de,ge,pe,re,se].includes(e)?t.push({type:$e,value:"*",start:n}):t.push({type:fe,value:"*",start:n})}else if("/"===e[this._current])n=this._current,this._current+=1,t.push({type:ye,value:"/",start:n});else if("^"===e[this._current])n=this._current,this._current+=1,t.push({type:ve,value:"^",start:n});else{if("|"!==e[this._current]){const t=new Error(`Unknown character:${e[this._current]}`);throw t.name="LexerError",t}n=this._current,this._current+=1,"|"===e[this._current]?(this._current+=1,t.push({type:pe,value:"||",start:n})):t.push({type:de,value:"|",start:n})}}return t}_consumeUnquotedIdentifier(e){const t=this._current;for(this._current+=1;this._current<e.length&&Be(e[this._current]);)this._current+=1;return e.slice(t,this._current)}_consumeQuotedIdentifier(e){const t=this._current;this._current+=1;const n=e.length;let i=!Fe(e,t+1);for(;'"'!==e[this._current]&&this._current<n;){let t=this._current;Be(e[t])||(i=!0),t+="\\"!==e[t]||"\\"!==e[t+1]&&'"'!==e[t+1]?1:2,this._current=t}this._current+=1;const r=e.slice(t,this._current);try{i&&!r.includes(" ")||(this.debug.push(`Suspicious quotes: ${r}`),this.debug.push(`Did you intend a literal? '${r.replace(/"/g,"")}'?`))}catch(e){}return JSON.parse(r)}_consumeRawStringLiteral(e){const t=this._current;this._current+=1;const n=e.length;for(;"'"!==e[this._current]&&this._current<n;){let t=this._current;t+="\\"!==e[t]||"\\"!==e[t+1]&&"'"!==e[t+1]?1:2,this._current=t}return this._current+=1,e.slice(t+1,this._current-1).replaceAll("\\'","'")}_consumeNumber(e){const t=this._current;this._current+=1;const n=e.length;for(;Ye(e[this._current],!1)&&this._current<n;)this._current+=1;const i=e.slice(t,this._current);let r;return r=i.includes(".")?parseFloat(i):parseInt(i,10),{type:ae,value:r,start:t}}_consumeLBracket(e){const t=this._current;return this._current+=1,"?"===e[this._current]?(this._current+=1,{type:Ne,value:"[?",start:t}):"]"===e[this._current]?(this._current+=1,{type:De,value:"[]",start:t}):{type:Pe,value:"[",start:t}}_isGlobal(e,t,n){if(null!==e&&e===Se)return!1;if("$"!==t[n])return!1;let i=n+1;for(;i<t.length&&Be(t[i]);)i+=1;const r=t.slice(n,i);return this._allowedGlobalNames.includes(r)}_consumeGlobal(e){const t=this._current;for(this._current+=1;this._current<e.length&&Be(e[this._current]);)this._current+=1;const n=e.slice(t,this._current);return{type:ce,name:n,start:t}}_consumeOperator(e){const t=this._current,n=e[t];return this._current+=1,"!"===n?"="===e[this._current]?(this._current+=1,{type:xe,value:"!=",start:t}):{type:je,value:"!",start:t}:"<"===n?"="===e[this._current]?(this._current+=1,{type:Oe,value:"<=",start:t}):{type:we,value:"<",start:t}:">"===n?"="===e[this._current]?(this._current+=1,{type:Me,value:">=",start:t}):{type:Te,value:">",start:t}:"="===e[this._current]?(this._current+=1,{type:Ee,value:"==",start:t}):{type:Ee,value:"=",start:t}}_consumeLiteral(e){this._current+=1;const t=this._current,n=e.length;let i,r=!1;for(;(r||"`"!==e[this._current])&&this._current<n;){let t=this._current;r&&"\\"===e[t]&&'"'===e[t+1]?t+=2:('"'===e[t]&&(r=!r),t+=r&&"`"===e[t+1]?2:"\\"!==e[t]||"\\"!==e[t+1]&&"`"!==e[t+1]?1:2),this._current=t}let s=e.slice(t,this._current).trimStart();return s=s.replaceAll("\\`","`"),i=function(e){if(""===e)return!1;if('[{"'.includes(e[0]))return!0;if(["true","false","null"].includes(e))return!0;if(!"-0123456789".includes(e[0]))return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(s)?JSON.parse(s):JSON.parse(`"${s}"`),this._current+=1,i}}const{TOK_LITERAL:Ue,TOK_COLON:Ke,TOK_EOF:Ve,TOK_UNQUOTEDIDENTIFIER:He,TOK_QUOTEDIDENTIFIER:Ge,TOK_RBRACKET:ze,TOK_RPAREN:We,TOK_COMMA:Qe,TOK_CONCATENATE:Ze,TOK_RBRACE:Je,TOK_NUMBER:Xe,TOK_CURRENT:et,TOK_GLOBAL:tt,TOK_FIELD:nt,TOK_EXPREF:it,TOK_PIPE:rt,TOK_OR:st,TOK_AND:ot,TOK_ADD:lt,TOK_SUBTRACT:at,TOK_MULTIPLY:ut,TOK_POWER:ct,TOK_DIVIDE:ht,TOK_UNION:dt,TOK_EQ:pt,TOK_GT:gt,TOK_LT:mt,TOK_GTE:_t,TOK_LTE:ft,TOK_NE:vt,TOK_FLATTEN:yt,TOK_STAR:bt,TOK_FILTER:Et,TOK_DOT:Tt,TOK_NOT:wt,TOK_LBRACE:Mt,TOK_LBRACKET:Ot,TOK_LPAREN:xt}=_,Dt={[Ve]:0,[He]:0,[Ge]:0,[ze]:0,[We]:0,[Qe]:0,[Je]:0,[Xe]:0,[et]:0,[tt]:0,[nt]:0,[it]:0,[rt]:1,[st]:2,[ot]:3,[lt]:6,[at]:6,[Ze]:7,[ut]:7,[ht]:7,[ct]:7,[dt]:7,[pt]:5,[gt]:5,[mt]:5,[_t]:5,[ft]:5,[vt]:5,[yt]:9,[bt]:20,[Et]:21,[Tt]:40,[wt]:45,[Mt]:50,[Ot]:55,[xt]:60};class $t{constructor(e=[]){this._allowedGlobalNames=e}parse(e,t){this._loadTokens(e,t),this.index=0;const n=this.expression(0);if(this._lookahead(0)!==Ve){const e=this._lookaheadToken(0),t=new Error(`Unexpected token type: ${e.type}, value: ${e.value}`);throw t.name="ParserError",t}return n}_loadTokens(e,t){const n=new qe(this._allowedGlobalNames,t).tokenize(e);n.push({type:Ve,value:"",start:e.length}),this.tokens=n}expression(e){const t=this._lookaheadToken(0);this._advance();let n=this.nud(t),i=this._lookahead(0);for(;e<Dt[i];)this._advance(),n=this.led(i,n),i=this._lookahead(0);return n}_lookahead(e){return this.tokens[this.index+e].type}_lookaheadToken(e){return this.tokens[this.index+e]}_advance(){this.index+=1}_getIndex(){return this.index}_setIndex(e){this.index=e}nud(e){let t,n,i,r,s;switch(e.type){case Ue:return{type:"Literal",value:e.value};case Xe:return{type:"Number",value:e.value};case He:return{type:"Field",name:e.value};case Ge:if(r={type:"Field",name:e.value},this._lookahead(0)===xt)throw new Error("Quoted identifier not allowed for function names.");return r;case wt:return n=this.expression(Dt.Not),{type:"NotExpression",children:[n]};case bt:return t={type:"Identity"},n=this._lookahead(0)===ze?{type:"Identity"}:this._parseProjectionRHS(Dt.Star),{type:"ValueProjection",children:[t,n]};case Et:return this.led(e.type,{type:"Identity"});case Mt:return this._parseMultiselectHash();case yt:return t={type:yt,children:[{type:"Identity"}]},n=this._parseProjectionRHS(Dt.Flatten),{type:"Projection",children:[t,n]};case Ot:return this._lookahead(0)===bt&&this._lookahead(1)===ze?(this._advance(),this._advance(),n=this._parseProjectionRHS(Dt.Star),{type:"Projection",children:[{type:"Identity"},n]}):this._parseUnchainedIndexExpression();case et:return{type:et};case tt:return{type:tt,name:e.name};case nt:return{type:nt};case it:return i=this.expression(Dt.Expref),{type:"ExpressionReference",children:[i]};case xt:for(s=[];this._lookahead(0)!==We;)i=this.expression(0),s.push(i);return this._match(We),s[0];default:this._errorToken(e)}}led(e,t){let n,i,r,s,o,l,a,u,c;switch(e){case Ze:return i=this.expression(Dt.Concatenate),{type:"ConcatenateExpression",children:[t,i]};case Tt:return a=Dt.Dot,this._lookahead(0)!==bt?(i=this._parseDotRHS(a),{type:"Subexpression",children:[t,i]}):(this._advance(),i=this._parseProjectionRHS(a),{type:"ValueProjection",children:[t,i]});case rt:return i=this.expression(Dt.Pipe),{type:rt,children:[t,i]};case st:return i=this.expression(Dt.Or),{type:"OrExpression",children:[t,i]};case ot:return i=this.expression(Dt.And),{type:"AndExpression",children:[t,i]};case lt:return i=this.expression(Dt.Add),{type:"AddExpression",children:[t,i]};case at:return i=this.expression(Dt.Subtract),{type:"SubtractExpression",children:[t,i]};case ut:return i=this.expression(Dt.Multiply),{type:"MultiplyExpression",children:[t,i]};case ht:return i=this.expression(Dt.Divide),{type:"DivideExpression",children:[t,i]};case ct:return i=this.expression(Dt.Power),{type:"PowerExpression",children:[t,i]};case dt:return i=this.expression(Dt.Power),{type:"UnionExpression",children:[t,i]};case xt:for(r=t.name,s=[];this._lookahead(0)!==We;)o=this.expression(0),this._lookahead(0)===Qe&&this._match(Qe),s.push(o);return this._match(We),l={type:"Function",name:r,children:s},l;case Et:return n=this.expression(0),this._match(ze),i=this._lookahead(0)===yt?{type:"Identity"}:this._parseProjectionRHS(Dt.Filter),{type:"FilterProjection",children:[t,i,n]};case yt:return u={type:yt,children:[t]},c=this._parseProjectionRHS(Dt.Flatten),{type:"Projection",children:[u,c]};case pt:case vt:case gt:case _t:case mt:case ft:return this._parseComparator(t,e);case Ot:return this._lookahead(0)===bt&&this._lookahead(1)===ze?(this._advance(),this._advance(),i=this._parseProjectionRHS(Dt.Star),{type:"Projection",children:[t,i]}):(i=this._parseChainedIndexExpression(),this._projectIfSlice(t,i));default:this._errorToken(this._lookaheadToken(0))}}_match(e){if(this._lookahead(0)!==e){const t=this._lookaheadToken(0),n=new Error(`Expected ${e}, got: ${t.type}`);throw n.name="ParserError",n}this._advance()}_errorToken(e){const t=new Error(`Invalid token (${e.type}): "${e.value}"`);throw t.name="ParserError",t}_parseChainedIndexExpression(){const e=this._getIndex();if(this._lookahead(0)===Ke)return this._parseSliceExpression();const t=this.expression(0);return this._lookahead(0)===Ke?(this._setIndex(e),this._parseSliceExpression()):(this._match(ze),{type:"Index",value:t})}_parseUnchainedIndexExpression(){const e=this._getIndex(),t=this._lookahead(0);if(t===Ke){const e=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},e)}const n=this.expression(0),i=this._lookahead(0);if(i===Qe)return this._setIndex(e),this._parseMultiselectList();if(i===Ke){this._setIndex(e);const t=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},t)}return t===Xe?(this._match(ze),{type:"Index",value:n}):(this._setIndex(e),this._parseMultiselectList())}_projectIfSlice(e,t){const n={type:"IndexExpression",children:[e,t]};return"Slice"===t.type?{type:"Projection",children:[n,this._parseProjectionRHS(Dt.Star)]}:n}_parseSliceExpression(){const e=[null,null,null];let t=0,n=this._lookahead(0);for(;n!==ze&&t<3;){if(n===Ke&&t<2)t+=1,this._advance();else{e[t]=this.expression(0);const n=this._lookahead(0);if(n!==Ke&&n!==ze){const e=new Error(`Syntax error, unexpected token: ${n.value}(${n.type})`);throw e.name="Parsererror",e}}n=this._lookahead(0)}return this._match(ze),{type:"Slice",children:e}}_parseComparator(e,t){return{type:"Comparator",name:t,children:[e,this.expression(Dt[t])]}}_parseDotRHS(e){const t=this._lookahead(0);return[He,Ge,bt].indexOf(t)>=0?this.expression(e):t===Ot?(this._match(Ot),this._parseMultiselectList()):t===Mt?(this._match(Mt),this._parseMultiselectHash()):void 0}_parseProjectionRHS(e){let t;if(Dt[this._lookahead(0)]<10)t={type:"Identity"};else if(this._lookahead(0)===Ot)t=this.expression(e);else if(this._lookahead(0)===Et)t=this.expression(e);else{if(this._lookahead(0)!==Tt){const e=this._lookaheadToken(0),t=new Error(`Sytanx error, unexpected token: ${e.value}(${e.type})`);throw t.name="ParserError",t}this._match(Tt),t=this._parseDotRHS(e)}return t}_parseMultiselectList(){const e=[];for(;this._lookahead(0)!==ze;){const t=this.expression(0);if(e.push(t),this._lookahead(0)===Qe&&(this._match(Qe),this._lookahead(0)===ze))throw new Error("Unexpected token Rbracket")}return this._match(ze),{type:"MultiSelectList",children:e}}_parseMultiselectHash(){const e=[],t=[He,Ge];let n,i,r,s;if(this._lookahead(0)===Je)return this._advance(),{type:"MultiSelectHash",children:[]};for(;;){if(n=this._lookaheadToken(0),t.indexOf(n.type)<0)throw new Error(`Expecting an identifier token, got: ${n.type}`);if(i=n.value,this._advance(),this._match(Ke),r=this.expression(0),s={type:"KeyValuePair",name:i,value:r},e.push(s),this._lookahead(0)===Qe)this._match(Qe);else if(this._lookahead(0)===Je){this._match(Je);break}}return{type:"MultiSelectHash",children:e}}}function Nt(e,t){const n=10**t;return Math.round(e*n)/n}function St(e,t,n,i=[]){return{casefold:{_func:(e,n,i)=>t(e[0]).toLocaleUpperCase(i.language).toLocaleLowerCase(i.language),_signature:[{types:[m.TYPE_STRING]}]},and:{_func:t=>{let n=!!e(t[0]);return t.slice(1).forEach(t=>{n=n&&!!e(t)}),n},_signature:[{types:[m.TYPE_ANY],variadic:!0}]},deepScan:{_func:e=>{const[t,n]=e,i=n.toString(),r=[];return null===t||function e(t){Object.entries(t).forEach(([t,n])=>{t===i&&r.push(n),"object"==typeof n&&e(n)})}(t),r},_signature:[{types:[m.TYPE_OBJECT,m.TYPE_ARRAY,m.TYPE_NULL]},{types:[m.TYPE_STRING,m.TYPE_NUMBER]}]},or:{_func:t=>{let n=!!e(t[0]);return t.slice(1).forEach(t=>{n=n||!!e(t)}),n},_signature:[{types:[m.TYPE_ANY],variadic:!0}]},not:{_func:t=>!e(t[0]),_signature:[{types:[m.TYPE_ANY]}]},null:{_func:()=>null,_signature:[]},true:{_func:()=>!0,_signature:[]},false:{_func:()=>!1,_signature:[]},if:{_func:(t,n,i)=>{const r=t[1],s=t[2],o=i.visit(t[0],n);return e(o)?i.visit(r,n):i.visit(s,n)},_signature:[{types:[m.TYPE_ANY]},{types:[m.TYPE_ANY]},{types:[m.TYPE_ANY]}]},substitute:{_func:e=>{const i=t(e[0]),r=t(e[1]),s=t(e[2]);if(e.length<=3)return i.replaceAll(r,s);const o=n(e[3]);if(o<1)return i;let l=-1;for(let e=0;e<o;e+=1){l+=1;const e=i.slice(l).indexOf(r);if(-1===e)return i;l+=e}return i.slice(0,l)+i.slice(l).replace(r,s)},_signature:[{types:[m.TYPE_STRING]},{types:[m.TYPE_STRING]},{types:[m.TYPE_STRING]},{types:[m.TYPE_NUMBER],optional:!0}]},value:{_func:e=>{const t=e[0]||{},n=e[1],r=t[n];if(void 0===r){i.push(`Failed to find: '${n}'`);const e=Object.keys(t).map(e=>`'${e}'`).toString();return e.length&&i.push(`Available fields: ${e}`),null}return r},_signature:[{types:[m.TYPE_OBJECT,m.TYPE_ARRAY,m.TYPE_NULL]},{types:[m.TYPE_STRING,m.TYPE_NUMBER]}]},lower:{_func:e=>t(e[0]).toLowerCase(),_signature:[{types:[m.TYPE_STRING]}]},upper:{_func:e=>t(e[0]).toUpperCase(),_signature:[{types:[m.TYPE_STRING]}]},exp:{_func:e=>{const t=n(e[0]);return Math.exp(t)},_signature:[{types:[m.TYPE_NUMBER]}]},power:{_func:e=>n(e[0])**n(e[1]),_signature:[{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]}]},find:{_func:e=>{const i=t(e[0]),r=t(e[1]),s=e.length>2?n(e[2]):0,o=r.indexOf(i,s);return-1===o?null:o},_signature:[{types:[m.TYPE_STRING]},{types:[m.TYPE_STRING]},{types:[m.TYPE_NUMBER],optional:!0}]},left:{_func:e=>{const i=e.length>1?n(e[1]):1;return i<0?null:e[0]instanceof Array?e[0].slice(0,i):t(e[0]).substr(0,i)},_signature:[{types:[m.TYPE_STRING,m.TYPE_ARRAY]},{types:[m.TYPE_NUMBER],optional:!0}]},right:{_func:e=>{const i=e.length>1?n(e[1]):1;if(i<0)return null;if(e[0]instanceof Array)return 0===i?[]:e[0].slice(-1*i);const r=t(e[0]);return r.substr(r.length-i,i)},_signature:[{types:[m.TYPE_STRING,m.TYPE_ARRAY]},{types:[m.TYPE_NUMBER],optional:!0}]},mid:{_func:e=>{const i=n(e[1]),r=n(e[2]);return i<0?null:e[0]instanceof Array?e[0].slice(i,i+r):t(e[0]).substr(i,r)},_signature:[{types:[m.TYPE_STRING,m.TYPE_ARRAY]},{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]}]},mod:{_func:e=>n(e[0])%n(e[1]),_signature:[{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]}]},proper:{_func:e=>t(e[0]).split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),_signature:[{types:[m.TYPE_STRING]}]},rept:{_func:e=>{const i=t(e[0]),r=n(e[1]);return r<0?null:i.repeat(r)},_signature:[{types:[m.TYPE_STRING]},{types:[m.TYPE_NUMBER]}]},replace:{_func:e=>{const i=t(e[0]),r=n(e[1]),s=n(e[2]),o=t(e[3]);return r<0?null:i.substr(0,r)+o+i.substr(r+s)},_signature:[{types:[m.TYPE_STRING]},{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]},{types:[m.TYPE_STRING]}]},round:{_func:e=>Nt(n(e[0]),n(e[1])),_signature:[{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]}]},sqrt:{_func:e=>{const t=Math.sqrt(n(e[0]));return Number.isNaN(t)?null:t},_signature:[{types:[m.TYPE_NUMBER]}]},stdevp:{_func:e=>{const t=e[0]||[];if(0===t.length)return null;const i=t.map(e=>n(e)),r=i.reduce((e,t)=>e+t,0)/t.length,s=i.reduce((e,t)=>e+t*t,0)/t.length,o=Math.sqrt(s-r*r);return Number.isNaN(o)?null:o},_signature:[{types:[m.TYPE_ARRAY_NUMBER]}]},stdev:{_func:e=>{const t=e[0]||[];if(t.length<=1)return null;const i=t.map(e=>n(e)),r=i.reduce((e,t)=>e+t,0)/t.length,s=i.reduce((e,t)=>e+t*t,0),o=Math.sqrt((s-t.length*r*r)/(t.length-1));return Number.isNaN(o)?null:o},_signature:[{types:[m.TYPE_ARRAY_NUMBER]}]},trim:{_func:e=>t(e[0]).split(" ").filter(e=>e).join(" "),_signature:[{types:[m.TYPE_STRING]}]},trunc:{_func:e=>{const t=n(e[0]),i=e.length>1?n(e[1]):0;return(t>=0?Math.floor:Math.ceil)(t*10**i)/10**i},_signature:[{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER],optional:!0}]},charCode:{_func:e=>{const t=n(e[0]);return Number.isInteger(t)?String.fromCharCode(t):null},_signature:[{types:[m.TYPE_NUMBER]}]},codePoint:{_func:e=>{const n=t(e[0]);return 0===n.length?null:n.codePointAt(0)},_signature:[{types:[m.TYPE_STRING]}]},datetime:{_func:e=>{const i=n(e[0]),r=n(e[1]),s=n(e[2]),o=e.length>3?n(e[3]):0,l=e.length>4?n(e[4]):0,a=e.length>5?n(e[5]):0,u=e.length>6?n(e[6]):0,c=e.length>7?t(e[7]):null;let h=new Date(i,r-1,s,o,l,a,u);return c&&(h=function(e,t){if(null===e)return null;let n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds());return n+=function(e,t){const n=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format(e),i=/GMT([+\-−])?(\d{1,2}):?(\d{0,2})?/.exec(n);if(!i)return 0;const[r,s,o]=i.slice(1),l=60*(60*(s||0)+1*(o||0))*1e3;return"-"===r?-1*l:l}(e,t),new Date(n)}(h,c)),h.getTime()/864e5},_signature:[{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER],optional:!0},{types:[m.TYPE_NUMBER],optional:!0},{types:[m.TYPE_NUMBER],optional:!0},{types:[m.TYPE_NUMBER],optional:!0},{types:[m.TYPE_STRING],optional:!0}]},datedif:{_func:e=>{const i=n(e[0]),r=n(e[1]),s=t(e[2]).toLowerCase();if(r===i)return 0;if(r<i)return null;if("d"===s)return Math.floor(r-i);const o=new Date(864e5*i),l=new Date(864e5*r),a=l.getFullYear()-o.getFullYear();let u=l.getMonth()-o.getMonth();const c=l.getDate()-o.getDate();if("y"===s){let e=a;return u<0&&(e-=1),0===u&&c<0&&(e-=1),e}if("m"===s)return 12*a+u+(c<0?-1:0);if("ym"===s)return c<0&&(u-=1),u<=0&&a>0?12+u:u;if("yd"===s)return c<0&&(u-=1),l.setFullYear(u<0?o.getFullYear()+1:o.getFullYear()),Math.floor((l.getTime()-o.getTime())/864e5);throw new TypeError(`Unrecognized unit parameter "${s}" for datedif()`)},_signature:[{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]},{types:[m.TYPE_STRING]}]},eomonth:{_func:e=>{const t=n(e[0]),i=n(e[1]),r=new Date(864e5*t);return new Date(r.getFullYear(),r.getMonth()+i+1,0).getTime()/864e5},_signature:[{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]}]},day:{_func:e=>{const t=n(e[0]);return new Date(864e5*t).getDate()},_signature:[{types:[m.TYPE_NUMBER]}]},month:{_func:e=>{const t=n(e[0]);return new Date(864e5*t).getMonth()+1},_signature:[{types:[m.TYPE_NUMBER]}]},year:{_func:e=>{const t=n(e[0]);return new Date(864e5*t).getFullYear()},_signature:[{types:[m.TYPE_NUMBER]}]},time:{_func:e=>{const t=(3600*n(e[0])+60*n(e[1])+n(e[2]))/86400;return t<0?null:t-Math.floor(t)},_signature:[{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER]}]},hour:{_func:e=>{const t=n(e[0])%1;if(t<0)return null;const i=Nt(24*t,14);return Math.floor(i%24)},_signature:[{types:[m.TYPE_NUMBER]}]},minute:{_func:e=>{const t=n(e[0])%1;if(t<0)return null;const i=Math.round(1440*t,10);return Math.floor(i%60)},_signature:[{types:[m.TYPE_NUMBER]}]},second:{_func:e=>{const t=n(e[0])%1;if(t<0)return null;const i=Nt(86400*t,10);return Math.floor(i%60)},_signature:[{types:[m.TYPE_NUMBER]}]},now:{_func:()=>Date.now()/864e5,_signature:[]},today:{_func:()=>Math.floor(Date.now()/864e5),_signature:[]},weekday:{_func:e=>{const t=n(e[0]),i=e.length>1?n(e[1]):1,r=new Date(864e5*t).getDay();switch(i){case 1:return r+1;case 2:return(r+6)%7+1;case 3:return(r+6)%7;default:return null}},_signature:[{types:[m.TYPE_NUMBER]},{types:[m.TYPE_NUMBER],optional:!0}]},entries:{_func:t=>{const n=e(t[0]);return Object.entries(n)},_signature:[{types:[m.TYPE_NUMBER,m.TYPE_STRING,m.TYPE_ARRAY,m.TYPE_OBJECT,m.TYPE_BOOLEAN]}]},fromEntries:{_func:e=>Object.fromEntries(e[0]),_signature:[{types:[m.TYPE_ARRAY_ARRAY]}]},split:{_func:e=>{const n=t(e[0]),i=t(e[1]);return n.split(i)},_signature:[{types:[m.TYPE_STRING]},{types:[m.TYPE_STRING]}]},unique:{_func:t=>{const n=t[0].map(t=>e(t));return t[0].filter((t,i)=>n.indexOf(e(t))===i)},_signature:[{types:[m.TYPE_ARRAY]}]},encodeUrlComponent:{_func:e=>encodeURIComponent(e[0]),_signature:[{types:[m.TYPE_STRING]}]},encodeUrl:{_func:e=>encodeURI(e[0]),_signature:[{types:[m.TYPE_STRING]}]},decodeUrlComponent:{_func:e=>decodeURIComponent(e[0]),_signature:[{types:[m.TYPE_STRING]}]},decodeUrl:{_func:e=>decodeURI(e[0]),_signature:[{types:[m.TYPE_STRING]}]}}}function jt(e,t,n,i,r,s,o){const{TYPE_NUMBER:l,TYPE_ANY:a,TYPE_STRING:u,TYPE_ARRAY:c,TYPE_OBJECT:h,TYPE_BOOLEAN:d,TYPE_EXPREF:p,TYPE_NULL:g,TYPE_ARRAY_NUMBER:_,TYPE_ARRAY_STRING:f}=m;function v(t,n){return i=>{const s=e.visit(t,i);if(n.indexOf(r(s))<0){const e=`TypeError: expected one of ${n}, received ${r(s)}`;throw new Error(e)}return s}}return{abs:{_func:e=>Math.abs(e[0]),_signature:[{types:[l]}]},avg:{_func:e=>{let t=0;const n=e[0];return n.forEach(e=>{t+=e}),t/n.length},_signature:[{types:[_]}]},ceil:{_func:e=>Math.ceil(e[0]),_signature:[{types:[l]}]},contains:{_func:e=>s(e[0]).indexOf(s(e[1]))>=0,_signature:[{types:[u,c]},{types:[a]}]},endsWith:{_func:e=>{const t=s(e[0]),n=s(e[1]);return-1!==t.indexOf(n,t.length-n.length)},_signature:[{types:[u]},{types:[u]}]},floor:{_func:e=>Math.floor(e[0]),_signature:[{types:[l]}]},length:{_func:e=>{const i=s(e[0]);return t(i)?Object.keys(i).length:n(i)?i.length:o(i).length},_signature:[{types:[u,c,h]}]},map:{_func:t=>{const n=t[0];return t[1].map(t=>e.visit(n,t))},_signature:[{types:[p]},{types:[c]}]},reduce:{_func:t=>{const n=t[0];return t[1].reduce((t,i,r,s)=>e.visit(n,{accumulated:t,current:i,index:r,array:s}),3===t.length?t[2]:null)},_signature:[{types:[p]},{types:[c]},{types:[a],optional:!0}]},max:{_func:e=>{if(e[0].length>0){const t=r(e[0][0]);return e[0].reduce(t===l?(e,t)=>i(e)>=i(t)?e:t:(e,t)=>o(t).localeCompare(o(e))<0?e:t,e[0][0])}return null},_signature:[{types:[c,_,f]}]},merge:{_func:e=>{const t={};return e.forEach(e=>{Object.entries(e).forEach(([e,n])=>{t[e]=n})}),t},_signature:[{types:[h],variadic:!0}]},maxBy:{_func:e=>{const t=e[0],n=v(e[1],[l,u]);let i,r,s=-Infinity;return t.forEach(e=>{r=n(e),r>s&&(s=r,i=e)}),i},_signature:[{types:[c]},{types:[p]}]},sum:{_func:e=>{let t=0;return e[0].forEach(e=>{t+=1*e}),t},_signature:[{types:[_]}]},startsWith:{_func:e=>s(e[0]).startsWith(s(e[1])),_signature:[{types:[u]},{types:[u]}]},min:{_func:e=>{if(e[0].length>0){if(r(e[0][0])===l)return e[0].reduce((e,t)=>i(e)<=i(t)?e:t,e[0][0]);const t=e[0];let n=t[0];for(let e=1;e<t.length;e+=1)o(t[e]).localeCompare(o(n))<0&&(n=t[e]);return n}return null},_signature:[{types:[c,_,f]}]},minBy:{_func:e=>{const t=e[0],n=v(e[1],[l,u]);let i,r,s=Infinity;return t.forEach(e=>{r=n(e),r<s&&(s=r,i=e)}),i},_signature:[{types:[c]},{types:[p]}]},type:{_func:e=>({[l]:"number",[u]:"string",[c]:"array",[h]:"object",[d]:"boolean",[p]:"expref",[g]:"null"}[r(e[0])]),_signature:[{types:[a]}]},keys:{_func:e=>null===e[0]?[]:Object.keys(e[0]),_signature:[{types:[a]}]},values:{_func:e=>{const t=s(e[0]);return null===t?[]:Object.values(t)},_signature:[{types:[a]}]},sort:{_func:e=>{const t=e[0].slice(0);if(t.length>0){const n=r(e[0][0])===l?i:o;t.sort((e,t)=>{const i=n(e),r=n(t);return i<r?-1:i>r?1:0})}return t},_signature:[{types:[c,f,_]}]},sortBy:{_func:t=>{const n=t[0].slice(0);if(0===n.length)return n;const i=t[1],s=r(e.visit(i,n[0]));if([l,u].indexOf(s)<0)throw new Error("TypeError");const o=[];for(let e=0;e<n.length;e+=1)o.push([e,n[e]]);o.sort((t,n)=>{const o=e.visit(i,t[1]),l=e.visit(i,n[1]);if(r(o)!==s)throw new Error(`TypeError: expected ${s}, received ${r(o)}`);if(r(l)!==s)throw new Error(`TypeError: expected ${s}, received ${r(l)}`);return o>l?1:o<l?-1:t[0]-n[0]});for(let e=0;e<o.length;e+=1)[,n[e]]=o[e];return n},_signature:[{types:[c]},{types:[p]}]},join:{_func:e=>e[1].join(e[0]),_signature:[{types:[u]},{types:[f]}]},reverse:{_func:e=>{const t=s(e[0]);if(r(t)===u){let e="";for(let n=t.length-1;n>=0;n-=1)e+=t[n];return e}const n=e[0].slice(0);return n.reverse(),n},_signature:[{types:[u,c]}]},toArray:{_func:e=>r(e[0])===c?e[0]:[e[0]],_signature:[{types:[a]}]},toString:{_func:e=>r(e[0])===u?e[0]:JSON.stringify(e[0]),_signature:[{types:[a]}]},toNumber:{_func:e=>{const t=r(e[0]);return t===l?e[0]:t===u?i(e[0]):null},_signature:[{types:[a]}]},notNull:{_func:e=>e.find(e=>r(e)!==g)||null,_signature:[{types:[a],variadic:!0}]},zip:{_func:e=>{const t=e.reduce((e,t)=>Math.min(e,t.length),e[0].length),n=new Array(t);for(let i=0;i<t;i+=1)n[i]=[],e.forEach(e=>{n[i].push(e[i])});return n},_signature:[{types:[c],variadic:!0}]}}}const{TYPE_CLASS:kt,TYPE_ANY:Pt}=m;var Rt=new function(){let t;function n(e){return null==e?"":e.toString()}class i{addFunctions(i,r={}){this.functionTable=e({},jt(this._interpreter,I,R,t,j,A,n),St(A,n,t,i),r)}_validateArgs(e,i,r,s){if(0===r.length)return;let o;const l=r.filter(e=>!e.optional).length;if(r[r.length-1].variadic){if(i.length<r.length)throw o=1===r.length?" argument":" arguments",new Error(`ArgumentError: ${e}() takes at least${r.length}${o} but received ${i.length}`)}else if(i.length<l||i.length>r.length)throw o=1===r.length?" argument":" arguments",new Error(`ArgumentError: ${e}() takes ${r.length}${o} but received ${i.length}`);if(!s)return;let a,u;const c=Math.min(r.length,i.length);for(let s=0;s<c;s+=1)a=r[s].types,h=i[s],d=void 0,a.includes(kt)&&null!==(d=h)&&!Array.isArray(d)&&"Object"!==d.constructor.name||a.includes(Pt)||(u=k(i[s]),i[s]=P(u,a,i[s],e,t,n));var h,d}callFunction(e,t,n,i,r=!0){if(!Object.prototype.hasOwnProperty.call(this.functionTable,e))throw new Error(`Unknown function: ${e}()`);const s=this.functionTable[e];return this._validateArgs(e,t,s._signature,r),s._func.call(this,t,n,i)}}this.compile=function(e,t=[],n=[]){let i;try{i=new $t(t).parse(e,n)}catch(e){throw n.push(e.toString()),e}return i},this.search=function(e,r,s,o,l,a=[],u="en-US"){const c=new i(o);c.debug=a,t=function(e,t=[]){return n=>{const i=A(n);if(null===i)return null;if(i instanceof Array)return t.push("Converted array to zero"),0;const r=typeof i;return"number"===r?i:"string"===r?e(i,t):"boolean"===r?i?1:0:(t.push("Converted object to zero"),0)}}(l||(e=>{const t=+e;return Number.isNaN(t)?0:t}),a);const h=new X(c,s,t,n,a,u);c._interpreter=h,c.addFunctions(a,o);try{return h.search(e,r)}catch(e){throw a.push(e.message||e.toString()),e}},this.strictDeepEqual=L};class It{constructor(e,t={},n=null,i=[],r=[],s="en-US"){this.expression=e,this.customFunctions=t,this.stringToNumber=n,this.node=Rt.compile(e,i,r),this.debug=r,this.language=s}search(t,n){return Rt.search(this.node,t,n,e({},this.customFunctions),this.stringToNumber,this.debug,this.language)}}function At(){return At=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},At.apply(this,arguments)}class Lt{constructor(e="",t=[]){this.errorMessages=t,this.fieldName=e}}const Ct=e=>new Map(Object.entries(e)),Yt=Ct({date:"date-input","data-url":"file-input",binary:"file-input"}),Bt=Ct({number:"number-input",boolean:"checkbox",object:"panel",array:"panel",file:"file-input","file[]":"file-input"}),Ft=["string[]","boolean[]","number[]","array"],qt=e=>{const t=e.type||"string";return"enum"in e?e.enum.length>2||Ft.indexOf(t)>-1?"drop-down":"checkbox":"string"===t||"string[]"===t?Yt.get(e.format)||"text-input":Bt.get(t)||"text-input"},Ut=function(e){return"file"===(null==e?void 0:e.type)||"file[]"===(null==e?void 0:e.type)||("string"===(null==e?void 0:e.type)||"string[]"===(null==e?void 0:e.type))&&("binary"===(null==e?void 0:e.format)||"data-url"===(null==e?void 0:e.format))};function Kt(e,t){let n;return e instanceof Array?(n=[],n=e.map(e=>Kt(e,t))):"object"==typeof e&&null!==e?(n={},Object.entries(e).forEach(([e,i])=>{n[e]=Kt(i,t)})):n=e,t&&n&&n.id&&(n.id=t()),n}const Vt=e=>JSON.stringify(e,null,2);class Ht{constructor(e,t,n){this._metadata=n,this._payload=e,this._type=t}get type(){return this._type}get payload(){return this._payload}get metadata(){return this._metadata}get target(){return this._target}get isCustomEvent(){return!1}payloadToJson(){return this.payload}toJson(){return{payload:this.payloadToJson(),type:this.type,isCustomEvent:this.isCustomEvent}}toString(){return JSON.stringify(this.toJson())}}class Gt extends Ht{constructor(e,t=!1){super(e,"change",{dispatch:t})}withAdditionalChange(e){return new Gt(this.payload.changes.concat(e.payload.changes),this.metadata)}}class zt extends Ht{constructor(e={}){super(e,"invalid",{})}}class Wt extends Ht{constructor(e={}){super(e,"valid",{})}}class Qt extends Ht{constructor(e={},t=!1){super(e,"executeRule",{dispatch:t})}}const Zt=(e,t,n)=>new Gt({changes:[{propertyName:e,currentValue:t,prevValue:n}]});class Jt extends Ht{constructor(e,t=!1){super(e,"initialize",{dispatch:t})}}class Xt extends Ht{constructor(){super({},"load",{dispatch:!1})}}class en extends Ht{constructor(e,t=!1){super(e,"click",{dispatch:t})}}class tn extends Ht{constructor(e,t=!1){super(e,"validationComplete",{dispatch:t})}}class nn extends Ht{constructor(e,t=!1){super(e,"submit",{dispatch:t})}}class rn extends Ht{constructor(e,t){super({field:t,changes:e},"fieldChanged")}}class sn extends Ht{constructor(e,t={},n=!1){super(t,e,{dispatch:n})}get isCustomEvent(){return!0}}class on extends Ht{constructor(e){super(e,"addItem")}}class ln extends Ht{constructor(e){super(e,"removeItem")}}class an{constructor(e,t,n=typeof t){this.$_fields=[],this.$_name=e,this.$_value=t,this.$_type=n}valueOf(){return this.$_value}get $name(){return this.$_name}get $value(){return this.$_value}setValue(e,t,n){this.$_value=e,this.$_fields.forEach(e=>{n!==e&&(e.value=t)})}get $type(){return this.$_type}$bindToField(e){-1===this.$_fields.indexOf(e)&&this.$_fields.push(e)}$convertToDataValue(){return this}get $isDataGroup(){return!1}}const un=Symbol("NullValue"),cn=new class extends an{constructor(){super("",un,"null")}setValue(){}$bindToField(){}$length(){return 0}$convertToDataValue(){return this}$addDataNode(){}$removeDataNode(){}$getDataNode(){return this}$containsDataNode(){return!1}};class hn extends an{createEntry(e,t){const n=t instanceof Array?"array":typeof t;return"object"==typeof t&&null!=t?new hn(e,t,n):new an(e,t,n)}constructor(e,t,n=typeof t){super(e,t,n),this.$_items=t instanceof Array?t.map((e,t)=>this.createEntry(t,e)):Object.fromEntries(Object.entries(t).map(([e,t])=>[e,this.createEntry(e,t)]))}get $value(){return"array"===this.$type?Object.values(this.$_items).filter(e=>void 0!==e).map(e=>e.$value):Object.fromEntries(Object.values(this.$_items).filter(e=>void 0!==e).map(e=>[e.$name,e.$value]))}get $length(){return Object.entries(this.$_items).length}$convertToDataValue(){return new an(this.$name,this.$value,this.$type)}$addDataNode(e,t,n=!1){if(t!==cn)if("array"===this.$type){const i=e;n?this.$_items[e]=t:this.$_items.splice(i,0,t)}else this.$_items[e]=t}$removeDataNode(e){this.$_items[e]=void 0}$getDataNode(e){if(this.$_items.hasOwnProperty(e))return this.$_items[e]}$containsDataNode(e){return this.$_items.hasOwnProperty(e)&&void 0!==this.$_items[e]}get $isDataGroup(){return!0}}const dn=(e,t)=>({type:"Identifier",value:e,start:t}),pn=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e},gn=(e,t,n)=>null===e&&"$"===t[n],mn=(e,t)=>{const n=e[t];return"$"===n?e.length>t&&pn(e[t+1]):n>="a"&&n<="z"||n>="A"&&n<="Z"||"_"===n},_n=e=>e>="0"&&e<="9";class fn{constructor(e){this._tokens=[],this._result_tokens=[],this.stream=e,this._current=0}_consumeGlobal(){return this._current+=1,{type:"Global",start:0,value:"$"}}_consumeUnquotedIdentifier(e){const t=this._current;for(this._current+=1;this._current<e.length&&pn(e[this._current]);)this._current+=1;return dn(e.slice(t,this._current),t)}_consumeQuotedIdentifier(e){const t=this._current;this._current+=1;const n=e.length;for(;'"'!==e[this._current]&&this._current<n;){let t=this._current;t+="\\"!==e[t]||"\\"!==e[t+1]&&'"'!==e[t+1]?1:2,this._current=t}return this._current+=1,dn(JSON.parse(e.slice(t,this._current)),t)}_consumeNumber(e){const t=this._current;this._current+=1;const n=e.length;for(;_n(e[this._current])&&this._current<n;)this._current+=1;const i=e.slice(t,this._current);return{type:"Number",value:parseInt(i,10),start:t}}_consumeBracket(e){const t=this._current;let n;if(this._current+=1,!_n(e[this._current]))throw new Error(`unexpected exception at position ${this._current}. Must be a character`);if(n=this._consumeNumber(e).value,this._current<this.stream.length&&"]"!==e[this._current])throw new Error(`unexpected exception at position ${this._current}. Must be a character`);return this._current++,((e,t)=>({type:"bracket",value:e,start:t}))(n,t)}tokenize(){const e=this.stream;for(;this._current<e.length;){const t=this._tokens.length?this._tokens.slice(-1)[0]:null;if(gn(t,e,this._current)){const e=this._consumeGlobal();this._tokens.push(e),this._result_tokens.push(e)}else if(mn(e,this._current)){const t=this._consumeUnquotedIdentifier(e);this._tokens.push(t),this._result_tokens.push(t)}else if("."===e[this._current]&&null!=t&&"DOT"!==t.type)this._tokens.push({type:"DOT",value:".",start:this._current}),this._current+=1;else if("["===e[this._current]){const t=this._consumeBracket(e);this._tokens.push(t),this._result_tokens.push(t)}else{if('"'!==e[this._current]){const e=Math.max(0,this._current-2),t=Math.min(this.stream.length,this._current+2);throw new Error(`Exception at parsing stream ${this.stream.slice(e,t)}`)}{const t=this._consumeQuotedIdentifier(e);this._tokens.push(t),this._result_tokens.push(t)}}}return this._result_tokens}}const vn=e=>new fn(e).tokenize(),yn=(e,t,n)=>{let i;i="string"==typeof t?vn(t):t;let r=e,s=0;const o=(e,t,n)=>null===t?n:"bracket"===t.type?new hn(e.value,[],"array"):new hn(e.value,{});for(;s<i.length&&null!=r;){const t=i[s];if("Global"===t.type)r=e;else if("Identifier"===t.type){if(!(r instanceof hn&&"object"===r.$type))throw new Error(`Looking for ${t.value} in ${r.$value}`);if(r.$containsDataNode(t.value)&&null!==r.$getDataNode(t.value).$value)r=r.$getDataNode(t.value);else if(n){const e=o(t,s<i.length-1?i[s+1]:null,n);r.$addDataNode(t.value,e),r=e}else r=void 0}else if("bracket"===t.type){if(!(r instanceof hn&&"array"===r.$type))throw new Error(`Looking for index ${t.value} in non array${r.$value}`);{const e=t.value;if(e<r.$length)r=r.$getDataNode(e);else if(n){const l=o(t,s<i.length-1?i[s+1]:null,n);r.$addDataNode(e,l),r=l}else r=void 0}}s+=1}return r};var bn=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const En=["value","label","description","visible","enabled","readOnly","enum","enumNames","required","properties","exclusiveMinimum","exclusiveMaximum","maxLength","maximum","maxItems","minLength","minimum","minItems","step"],Tn=[...En,"valid","index","activeChild"];class wn{constructor(e,t){this._action=e,this._target=t}get type(){return this._action.type}get payload(){return this._action.payload}get metadata(){return this._action.metadata}get target(){return this._target}get isCustomEvent(){return this._action.isCustomEvent}get originalAction(){return this._action.originalAction}toString(){return this._action.toString()}}const Mn=Symbol("target"),On=Symbol("qualifiedName");class xn{get isContainer(){return!1}constructor(e,t){this._callbacks={},this._dependents=[],this._tokens=[],this._options=t,this[On]=null,this._jsonModel=At({},e,{id:"id"in e?e.id:this.form.getUniqueId()})}setupRuleNode(){const e=this;this._ruleNode=new Proxy(this.ruleNodeReference(),{get:(t,n)=>e.getFromRule(t,n)})}ruleNodeReference(){return this}getRuleNode(){return this._ruleNode}getFromRule(e,t){if(t===Symbol.toPrimitive||"valueOf"===t&&!e.hasOwnProperty("valueOf"))return this.valueOf;if(t===Mn)return this;if("string"==typeof t)if(t.startsWith("$")){if("function"!=typeof this[t=t.substr(1)]){const e=this[t];return e instanceof xn?e.getRuleNode():e instanceof Array?e.map(e=>e instanceof xn?e.getRuleNode():e):e}}else{if(e.hasOwnProperty(t))return e[t];if("function"==typeof e[t])return e[t]}}get id(){return this._jsonModel.id}get index(){return this.parent.indexOf(this)}get parent(){return this._options.parent}get type(){return this._jsonModel.type}get fieldType(){return this._jsonModel.fieldType||"text-input"}get":type"(){return this._jsonModel[":type"]||this.fieldType}get name(){return this._jsonModel.name}get description(){return this._jsonModel.description}set description(e){this._setProperty("description",e)}get dataRef(){return this._jsonModel.dataRef}get visible(){return this._jsonModel.visible}set visible(e){if(e!==this._jsonModel.visible){const t=Zt("visible",e,this._jsonModel.visible);this._jsonModel.visible=e,this.notifyDependents(t)}}get form(){return this._options.form}get ruleEngine(){return this.form.ruleEngine}get label(){return this._jsonModel.label}set label(e){if(e!==this._jsonModel.label){const t=Zt("label",e,this._jsonModel.label);this._jsonModel=At({},this._jsonModel,{label:e}),this.notifyDependents(t)}}get uniqueItems(){return this._jsonModel.uniqueItems}isTransparent(){var e;const t="array"===(null==(e=this.parent)?void 0:e._jsonModel.type);return!this._jsonModel.name&&!t}getState(){return At({},this._jsonModel,{":type":this[":type"]})}subscribe(e,t="change"){return this._callbacks[t]=this._callbacks[t]||[],this._callbacks[t].push(e),{unsubscribe:()=>{this._callbacks[t]=this._callbacks[t].filter(t=>t!==e)}}}_addDependent(e){if(void 0===this._dependents.find(({node:t})=>t===e)){const t=this.subscribe(t=>{const n=[...Tn,"items"],i=t.payload.changes.findIndex(e=>n.indexOf(e.propertyName)>-1)>-1;i&&e.dispatch(new Qt)});this._dependents.push({node:e,subscription:t})}}removeDependent(e){const t=this._dependents.findIndex(({node:t})=>t===e);t>-1&&(this._dependents[t].subscription.unsubscribe(),this._dependents.splice(t,1))}queueEvent(e){const t=new wn(e,this);this.form.getEventQueue().queue(this,t,["valid","invalid"].indexOf(t.type)>-1)}dispatch(e){this.queueEvent(e),this.form.getEventQueue().runPendingQueue()}notifyDependents(e){(this._callbacks[e.type]||[]).forEach(t=>{t(new wn(e,this))})}_setProperty(e,t,n=!0){const i=this._jsonModel[e];let r=!1;if(r=null!==t&&null!==i&&"object"==typeof t&&"object"==typeof i?JSON.stringify(t)===JSON.stringify(i):i===t,!r){this._jsonModel[e]=t;const r=Zt(e,t,i);return n&&this.notifyDependents(r),r.payload.changes}return[]}_bindToDataModel(e){if("$form"===this.id)return void(this._data=e);const t=this._jsonModel.dataRef;let n,i=e,r="";if(null===t)n=cn;else if(void 0!==t){0===this._tokens.length&&(this._tokens=vn(t));let s=e;if("Global"===this._tokens[0].type&&(s=this.form.getDataNode()),void 0!==s){const e=this._tokens[this._tokens.length-1].value,t=this.defaultDataModel(e);n=yn(s,this._tokens,t),i=yn(s,this._tokens.slice(0,-1)),r=e}}else if(e!==cn){i=e;const t=this._jsonModel.name||"",s="array"===e.$type?this.index:t;if(r=s,""!==s){const t=this.defaultDataModel(s);void 0!==t&&(n=e.$getDataNode(s),void 0===n&&(n=t,e.$addDataNode(s,n)))}else n=void 0}var s,o;n&&(this.isContainer||i===cn||n===cn||(n=null==(o=n)?void 0:o.$convertToDataValue(),i.$addDataNode(r,n,!0)),null==(s=n)||s.$bindToField(this),this._data=n)}getDataNode(){return this._data}get properties(){return this._jsonModel.properties||{}}set properties(e){this._setProperty("properties",At({},e))}getNonTransparentParent(){let e=this.parent;for(;null!=e&&e.isTransparent();)e=e.parent;return e}_initialize(){if(void 0===this._data){let e,t=this.parent;do{e=t.getDataNode(),t=t.parent}while(void 0===e);this._bindToDataModel(e)}}_applyUpdates(e,t){return e.reduce((e,n)=>{const i=this._setProperty(n,t[n],!1);return i.length>0&&(e[n]=i[0]),e},{})}get qualifiedName(){if(this.isTransparent())return null;if(null!==this[On])return this[On];const e=this.getNonTransparentParent();return this[On]=e&&"array"===e.type?`${e.qualifiedName}[${this.index}]`:`${e.qualifiedName}.${this.name}`,this[On]}focus(){this.parent&&(this.parent.activeChild=this)}}bn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],xn.prototype,"index",null),bn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],xn.prototype,"description",null),bn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],xn.prototype,"visible",null),bn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],xn.prototype,"label",null),bn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],xn.prototype,"properties",null);class Dn extends xn{constructor(...e){super(...e),this._events={},this._rules={}}get rules(){return this._jsonModel.rules||{}}getCompiledRule(e,t){if(!(e in this._rules)){const n=t||this.rules[e];if(!("string"==typeof n&&n.length>0))throw new Error(`only expression strings are supported. ${typeof n} types are not supported`);try{this._rules[e]=this.ruleEngine.compileRule(n)}catch(t){this.form.logger.error(`Unable to compile rule \`"${e}" : "${n}"\` Exception : ${t}`)}}return this._rules[e]}getCompiledEvent(e){if(!(e in this._events)){var t;let n=null==(t=this._jsonModel.events)?void 0:t[e];"string"==typeof n&&n.length>0&&(n=[n]),void 0!==n&&n.length>0&&(this._events[e]=n.map(t=>{try{return this.ruleEngine.compileRule(t)}catch(t){this.form.logger.error(`Unable to compile expression \`"${e}" : "${n}"\` Exception : ${t}`)}return null}).filter(e=>null!==e))}return this._events[e]||[]}applyUpdates(e){Object.entries(e).forEach(([e,t])=>{if(e in En||e in this&&"function"!=typeof this[e])try{this[e]=t}catch(e){console.error(e)}})}executeAllRules(e){const t=Object.entries(this.rules);if(t.length>0){const n=this.getExpressionScope();t.forEach(([t,i])=>{const r=this.getCompiledRule(t,i);if(r){const i=this.ruleEngine.execute(r,n,e,!0);En.indexOf(t)>-1?this[t]=i:this.form.logger.warn(`${t} is not a valid editable property.`)}})}}getExpressionScope(){const e=this.getNonTransparentParent(),t={self:this.getRuleNode(),siblings:(null==e?void 0:e.ruleNodeReference())||{}},n=new Proxy(t,{get:(e,t)=>{if(t===Symbol.toStringTag)return"Object";if(t.startsWith("$")){const n=e.self[t];return n instanceof xn?n.getRuleNode():n instanceof Array?n.map(e=>e instanceof xn?e.getRuleNode():e):n}return t in e.siblings?e.siblings[t]:e.self[t]},has:(e,t)=>void 0!==e.self[t]||void 0!==e.siblings[t]});return n}executeEvent(e,t){let n;t&&(n=this.ruleEngine.execute(t,this.getExpressionScope(),e)),void 0!==n&&null!=n&&this.applyUpdates(n)}executeRule(e,t){void 0===e.payload.ruleName&&this.executeAllRules(t)}executeExpression(e){const t={form:this.form,$form:this.form.getRuleNode(),$field:this.getRuleNode(),field:this},n=this.ruleEngine.compileRule(e);return this.ruleEngine.execute(n,this.getExpressionScope(),t)}executeAction(e){const t={form:this.form,$form:this.form.getRuleNode(),$field:this.getRuleNode(),field:this,$event:{type:e.type,payload:e.payload,target:this.getRuleNode()}},n=e.isCustomEvent?`custom_${e.type}`:e.type;this.getCompiledEvent(e.isCustomEvent?`custom:${e.type}`:e.type).forEach(e=>this.executeEvent(t,e)),n in this&&"function"==typeof this[n]&&this[n](e,t),this.notifyDependents(e)}}var $n=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Nn extends Dn{constructor(...e){super(...e),this._children=[],this._itemTemplate=null,this._activeChild=null}ruleNodeReference(){return this._childrenReference}get items(){return this._children}get maxItems(){return this._jsonModel.maxItems}set maxItems(e){this._jsonModel.maxItems=e;const t=this._children.length,n=Math.min(t-e,t-(this._jsonModel.minItems||1));if(n>0){for(let t=0;t<n;t++)this.getDataNode().$removeDataNode(e+t),this._childrenReference.pop();const t=this._children.splice(e,n);this.notifyDependents(Zt("items",t,null))}}get minItems(){return this._jsonModel.minItems}hasDynamicItems(){return null!=this._itemTemplate}get isContainer(){return!0}getState(){return At({},this._jsonModel,{":type":this[":type"],items:this._children.map(e=>At({},e.getState()))})}_addChildToRuleNode(e,t){const n=this,{parent:i=this}=t,r="array"==i.type?i._children.length+"":e.name||"";r.length>0&&Object.defineProperty(i._childrenReference,r,{get:()=>(e.isContainer&&e.hasDynamicItems()&&n.ruleEngine.trackDependency(e),n.hasDynamicItems()?(n.ruleEngine.trackDependency(n),void 0!==this._children[r]?this._children[r].getRuleNode():void 0):e.getRuleNode()),configurable:!0,enumerable:!0})}_addChild(e,t,n=!1){let i=this;for(;null!=i&&i.isTransparent();)i=i.parent;("number"!=typeof t||t>i._children.length)&&(t=this._children.length);const r=this.form,s=At({index:t},Kt(e,n?()=>r.getUniqueId():void 0)),o=this._createChild(s,{parent:this,index:t});return this._addChildToRuleNode(o,{parent:i}),t===this._children.length?this._children.push(o):this._children.splice(t,0,o),o}indexOf(e){return this._children.indexOf(e)}defaultDataModel(e){const t=this._jsonModel.type||void 0;if(void 0!==t)return new hn(e,"array"===t?[]:{},t)}_initialize(){super._initialize();const e=this._jsonModel.items;if(this._jsonModel.items=[],this._childrenReference="array"==this._jsonModel.type?[]:{},"array"==this._jsonModel.type&&1===e.length&&null!=this.getDataNode()){this._itemTemplate=Kt(e[0]),"number"!=typeof this._jsonModel.minItems&&(this._jsonModel.minItems=0),"number"!=typeof this._jsonModel.maxItems&&(this._jsonModel.maxItems=-1),"number"!=typeof this._jsonModel.initialItems&&(this._jsonModel.initialItems=Math.max(1,this._jsonModel.minItems));for(let e=0;e<this._jsonModel.initialItems;e++)this._addChild(this._itemTemplate)._initialize()}else e.length>0&&(e.forEach(e=>{this._addChild(e)._initialize()}),this._jsonModel.minItems=this._children.length,this._jsonModel.maxItems=this._children.length,this._jsonModel.initialItems=this._children.length);this.setupRuleNode()}addItem(e){if("addItem"===e.type&&null!=this._itemTemplate&&(-1===this._jsonModel.maxItems||this._children.length<this._jsonModel.maxItems)){const t=this.getDataNode();let n=e.payload;("number"!=typeof n||n>this._children.length)&&(n=this._children.length);const i=this._addChild(this._itemTemplate,e.payload,!0),r=i.defaultDataModel(n);r&&t.$addDataNode(n,r),i._initialize(),this.notifyDependents(Zt("items",i.getState,null)),i.dispatch(new Jt),i.dispatch(new Qt);for(let e=n+1;e<this._children.length;e++)this._children[e].dispatch(new Qt)}}removeItem(e){if("removeItem"===e.type&&null!=this._itemTemplate){if(0==this._children.length)return;const t="number"==typeof e.payload?e.payload:this._children.length-1,n=this._children[t].getState();if(this._children.length>this._jsonModel.minItems){this._childrenReference.pop(),this._children.splice(t,1),this.getDataNode().$removeDataNode(t);for(let e=t;e<this._children.length;e++)this._children[e].dispatch(new Qt);this.notifyDependents(Zt("items",null,n))}}}queueEvent(e){var t;super.queueEvent(e),null!=(t=e.metadata)&&t.dispatch&&this.items.forEach(t=>{t.queueEvent(e)})}validate(){return this.items.flatMap(e=>e.validate()).filter(e=>""!==e.fieldName)}dispatch(e){super.dispatch(e)}importData(e){this._bindToDataModel(e);const t=this.getDataNode()||e;this.syncDataAndFormModel(t)}syncDataAndFormModel(e){if("array"===(null==e?void 0:e.$type)&&null!=this._itemTemplate){const t=null==e?void 0:e.$value.length,n=this._children.length,i=this._jsonModel.minItems;let r=Math.min(t-n,(-1===this._jsonModel.maxItems?t:this._jsonModel.maxItems)-n);const s=Math.min(n-t,n-i);for(;r>0;)r--,this._addChild(this._itemTemplate)._initialize();if(s>0){this._children.splice(t,s);for(let e=0;e<s;e++)this._childrenReference.pop()}}this._children.forEach(t=>{t.importData(e)})}get activeChild(){return this._activeChild}set activeChild(e){if(e!==this._activeChild){let t=this._activeChild;for(;t instanceof Nn;){const e=t.activeChild;t.activeChild=null,t=e}const n=Zt("activeChild",e,this._activeChild);this._activeChild=e,this.parent&&null!==e&&(this.parent.activeChild=this),this._jsonModel.activeChild=null==e?void 0:e.id,this.notifyDependents(n)}}}$n([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Nn.prototype,"maxItems",null),$n([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Nn.prototype,"minItems",null),$n([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Nn.prototype,"activeChild",null);class Sn{constructor(e){this._jsonModel=At({},e)}getP(e,t){return((e,t,n)=>{if(t in e)return e[t];if(!t.startsWith(":")){const n=`:${t}`;if(n in e)return e[n]}return n})(this._jsonModel,e,t)}get isContainer(){return!1}}class jn extends Sn{get version(){return this.getP("version","")}get locale(){return this.getP("locale","")}get grammar(){return this.getP("grammar","")}}class kn{constructor(e){this.type="application/octet-stream",this.name="unknown",this.size=0,Object.assign(this,e)}toJSON(){return{name:this.name,size:this.size,type:this.type,data:this.data.toString()}}equals(e){return this.data===e.data&&this.type===e.type&&this.name===e.name&&this.size===e.size}}const Pn="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_".split(""),Rn=/^(\d*\.?\d+)(\\?(?=[KMGT])([KMGT])(?:i?B)?|B?)$/i,In=e=>{const t=[];for(let n=0;n<=e;n++){const e=Math.floor(Math.random()*Pn.length);t.push(Pn[e])}return t.join("")},An=e=>{const t=e.items||[];return null==t?void 0:t.reduce((e,t)=>{let n=null;if(t.isContainer)n=An(t);else if(Ut(t.getState())){n={};const e=t.name||"",i=null!=t.dataRef?t.dataRef:e.length>0?t.name:void 0;t.value instanceof Array?n[t.id]=t.value.map(e=>At({},e,{dataRef:i})):null!=t.value&&(n[t.id]=At({},t.value,{dataRef:i}))}return Object.assign(e,n)},{})},Ln=e=>{let t=0;if("string"==typeof e){const n=Rn.exec(e.trim());null!=n&&(t=Cn(parseFloat(n[1]),(n[2]||"kb").toUpperCase()))}return t},Cn=(e,t)=>{const n=Math.pow(1024,{KB:1,MB:2,GB:3,TB:4}[t]);return Math.round(e*n)},Yn=e=>{const t=/^data:([a-z]+\/[a-z0-9-+.]+)?(?:;name=([^;]+))?(;base64)?,(.+)$/.exec(e);if(null!==t){const e=t[1]||"",n=t[2]||"unknown";if("string"==typeof t[3]){const i=atob(t[4]),r=[];for(let e=0;e<i.length;e++)r.push(i.charCodeAt(e));return{name:n,blob:new window.Blob([new Uint8Array(r)],{type:e})}}return{name:n,blob:new window.Blob([t[4]],{type:e})}}return null},Bn=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,Fn=/^data:([a-z]+\/[a-z0-9-+.]+)?;(?:name=(.*);)?base64,(.*)$/,qn=[31,28,31,30,31,30,31,31,30,31,30,31],Un=e=>null!=Fn.exec(e.trim()),Kn=e=>{let t=parseFloat(e);const n=!isNaN(t);return n||(t=e),{value:t,valid:n}},Vn=e=>{let t=parseFloat(e);const n=!isNaN(t)&&Math.round(t)===t;return n||(t=e),{value:t,valid:n}},Hn=e=>null==e||e instanceof Array?e:[e],Gn=e=>{const t="boolean"==typeof e||"true"===e||"false"===e;return{valid:t,value:"boolean"==typeof e?e:t?"true"===e:e}},zn=e=>{const t=(e=>{if(null!==e){let c=null;if(e instanceof kn)c=e;else if("undefined"!=typeof File&&e instanceof File)c={name:e.name,type:e.type,size:e.size,data:e};else if("string"==typeof e&&Un(e)){const t=Yn(e);if(null!==t){const{blob:e,name:n}=t;c={name:n,type:e.type,size:e.size,data:e}}}else{var t,n;let h=e;try{h=JSON.parse(e),c=h}catch(e){}if("string"==typeof(null==(t=h)?void 0:t.data)&&Un(null==(n=h)?void 0:n.data)){var i;const e=Yn(null==(i=h)?void 0:i.data);if(null!==e){var r,s;const t=e.blob;c={name:null==(r=h)?void 0:r.name,type:null==(s=h)?void 0:s.type,size:t.size,data:t}}}else if("string"==typeof h)c={name:h.split("/").pop(),type:"application/octet-stream",size:0,data:h};else if("object"==typeof h){var o,l,a,u;c={name:null==(o=h)?void 0:o.name,type:null==(l=h)?void 0:l.type,size:null==(a=h)?void 0:a.size,data:null==(u=h)?void 0:u.data}}}return null!==c&&null!=c.data?new kn(c):null}return null})(e),n=null!==t;return{value:n?t:e,valid:n}},Wn=(e,t)=>{const n=Hn(e);return null==n?[[],[n]]:n.reduce((e,n)=>{if(0==e[1].length){const i=t(n);e[i.valid?0:1].push(i.value)}return e},[[],[]])},Qn={date:["minimum","maximum","exclusiveMinimum","exclusiveMaximum","format"],string:["minLength","maxLength","pattern"],number:["minimum","maximum","exclusiveMinimum","exclusiveMaximum"],array:["minItems","maxItems","uniqueItems"],file:["accept","maxFileSize"]},Zn={type:(e,t)=>{let n=t;if(null==t)return{valid:!0,value:t};let i,r=!0;switch(e){case"string":r=!0,n=t.toString();break;case"string[]":n=Hn(t);break;case"number":i=Kn(t),n=i.value,r=i.valid;break;case"boolean":i=Gn(t),r=i.valid,n=i.value;break;case"integer":i=Vn(t),r=i.valid,n=i.value;break;case"integer[]":i=Wn(t,Vn),r=0===i[1].length,n=r?i[0]:t;break;case"file":i=zn(t instanceof Array?t[0]:t),r=i.valid,n=i.value;break;case"file[]":i=Wn(t,zn),r=0===i[1].length,n=r?i[0]:t;break;case"number[]":i=Wn(t,Kn),r=0===i[1].length,n=r?i[0]:t;break;case"boolean[]":i=Wn(t,Gn),r=0===i[1].length,n=r?i[0]:t}return{valid:r,value:n}},format:(e,t)=>{let n=!0;const i=t;if(null===t)return{value:i,valid:n};let r;switch(e){case"date":if(r=Bn.exec((t||"").trim()),null!=r){const[e,t,i,s]=r,[o,l]=[+i,+s],a=(e=>e%400==0||e%4==0&&e%100!=0)(+t);n=o>=1&&o<=12&&l>=1&&l<=((e,t)=>e&&2==t?29:qn[t-1])(a,o)}else n=!1;break;case"data-url":n=!0}return{valid:n,value:i}},minimum:(e,t)=>({valid:t>=e,value:t}),maximum:(e,t)=>({valid:t<=e,value:t}),exclusiveMinimum:(e,t)=>({valid:t>e,value:t}),exclusiveMaximum:(e,t)=>({valid:t<e,value:t}),minItems:(e,t)=>({valid:t instanceof Array&&t.length>=e,value:t}),maxItems:(e,t)=>({valid:t instanceof Array&&t.length<=e,value:t}),uniqueItems:(e,t)=>({valid:!e||t instanceof Array&&t.length===new Set(t).size,value:t}),minLength:(e,t)=>At({},Zn.minimum(e,"string"==typeof t?t.length:0),{value:t}),maxLength:(e,t)=>At({},Zn.maximum(e,"string"==typeof t?t.length:0),{value:t}),pattern:(e,t)=>{let n;return n="string"==typeof e?new RegExp(e):e,{valid:n.test(t),value:t}},required:(e,t)=>({valid:!e||null!=t&&""!==t,value:t}),enum:(e,t)=>({valid:e.indexOf(t)>-1,value:t}),accept:(e,t)=>e&&0!==e.length&&null!=t?{valid:!(t instanceof Array?t:[t]).some(t=>{return!(!(n=t.type)||e.some(e=>{const t=e.trim(),i=t.split("/")[0],r=t.split(".")[1];return t.includes("*")&&n.startsWith(i)||t.includes(".")&&n.endsWith(r)||t===n}));var n}),value:t}:{valid:!0,value:t},maxFileSize:(e,t)=>{const n="string"==typeof e?Ln(e):e;return{valid:!(t instanceof kn)||t.size<=n,value:t}}};var Jn=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Xn extends Dn{constructor(e,t){super(e,t),this._ruleNodeReference=[],this._applyDefaults(),this.queueEvent(new Jt),this.queueEvent(new Qt)}_initialize(){super._initialize(),this.setupRuleNode()}ruleNodeReference(){var e;return this._ruleNodeReference=null!=(e=this.type)&&e.endsWith("[]")?[]:this,this._ruleNodeReference}_getDefaults(){return{readOnly:!1,enabled:!0,visible:!0,type:this._getFallbackType()}}_getFallbackType(){if("string"!=typeof this._jsonModel.type){const e=this.enum;return e&&e.length>0?typeof e[0]:"string"}}_applyDefaults(){if(Object.entries(this._getDefaults()).map(([e,t])=>{void 0===this._jsonModel[e]&&void 0!==t&&(this._jsonModel[e]=t)}),void 0===this._jsonModel.value){const e=Zn.type(this.getInternalType()||"string",this._jsonModel.default);this._jsonModel.value=e.value}void 0===this._jsonModel.fieldType&&(this._jsonModel.viewType?(this._jsonModel.viewType.startsWith("custom:")?this.form.logger.error("viewType property has been removed. For custom types, use :type property"):this.form.logger.error("viewType property has been removed. Use fieldType property"),this._jsonModel.fieldType=this._jsonModel.viewType):this._jsonModel.fieldType=qt(this._jsonModel)),void 0===this._jsonModel.enum&&"boolean"===this._jsonModel.type&&(this._jsonModel.enum=[!0,!1]),"number"==typeof this._jsonModel.step&&"number"===this._jsonModel.type||(this._jsonModel.step=void 0)}get editFormat(){return this._jsonModel.editFormat}get displayFormat(){return this._jsonModel.displayFormat}get placeholder(){return this._jsonModel.placeholder}get readOnly(){return this._jsonModel.readOnly}set readOnly(e){this._setProperty("readOnly",e)}get language(){return Intl.DateTimeFormat().resolvedOptions().locale}get enabled(){return this._jsonModel.enabled}set enabled(e){this._setProperty("enabled",e)}get valid(){return this._jsonModel.valid}get emptyValue(){return"null"===this._jsonModel.emptyValue?null:""===this._jsonModel.emptyValue&&"string"===this.type?"":void 0}get enum(){return this._jsonModel.enum}set enum(e){this._setProperty("enum",e)}get enumNames(){return this._jsonModel.enumNames}set enumNames(e){this._setProperty("enumNames",e)}get required(){return this._jsonModel.required||!1}set required(e){this._setProperty("required",e)}get maximum(){return this._jsonModel.maximum}set maximum(e){this._setProperty("maximum",e)}get minimum(){return this._jsonModel.minimum}set minimum(e){this._setProperty("minimum",e)}isEmpty(){return null==this._jsonModel.value||""===this._jsonModel.value}get editValue(){const e=this.editFormat;return"date"==this.format&&null!=this.value&&!1!==this.valid?g.formatDate(new Date(this.value),this.language,e):this.value}get displayValue(){const e=this.displayFormat;return"date"==this.format&&null!=this.value&&!1!==this.valid?g.formatDate(new Date(this.value),this.language,e):this.value}getDataNodeValue(e){return this.isEmpty()?this.emptyValue:e}get value(){return void 0===this._jsonModel.value?null:this._jsonModel.value}set value(e){const t=this._getConstraintObject(),n=t.type(this.getInternalType()||"string",e),i=this._setProperty("value",n.value,!1);let r={valid:!0};if(i.length>0){this._updateRuleNodeReference(n.value);const e=this.getDataNode();let s;if(void 0!==e&&e.setValue(this.getDataNodeValue(this._jsonModel.value),this._jsonModel.value,this),this.parent.uniqueItems&&"array"===this.parent.type&&(r=t.uniqueItems(this.parent.uniqueItems,this.parent.getDataNode().$value)),n.valid&&r.valid)s=this.evaluateConstraints();else{const e={valid:n.valid&&r.valid,errorMessage:n.valid&&r.valid?"":this.getErrorMessage("type")};s=this._applyUpdates(["valid","errorMessage"],e)}s.valid&&this.triggerValidationEvent(s);const o=new Gt({changes:i.concat(Object.values(s))});this.dispatch(o)}}_updateRuleNodeReference(e){var t;if(null!=(t=this.type)&&t.endsWith("[]"))if(null!=e)for(e.forEach((e,t)=>{this._ruleNodeReference[t]=e});e.length!==this._ruleNodeReference.length;)this._ruleNodeReference.pop();else for(;0!==this._ruleNodeReference.length;)this._ruleNodeReference.pop()}getInternalType(){return this.type}valueOf(){const e=this[Mn],t=void 0===e?this:e;return t.ruleEngine.trackDependency(t),t._jsonModel.value||null}toString(){var e;const t=this[Mn];return(null==(e=(void 0===t?this:t)._jsonModel.value)?void 0:e.toString())||""}getErrorMessage(e){var t;return(null==(t=this._jsonModel.constraintMessages)?void 0:t[e])||""}_getConstraintObject(){return Zn}isArrayType(){return!!this.type&&this.type.indexOf("[]")>-1}checkEnum(e,t){if(!0===this._jsonModel.enforceEnum&&null!=e){const n=t.enum;return e instanceof Array&&this.isArrayType()?e.every(e=>n(this.enum||[],e).valid):n(this.enum||[],e).valid}return!0}checkStep(){return"number"!=typeof this._jsonModel.step||(this._jsonModel.value-(this._jsonModel.minimum||this._jsonModel.default||0))%this._jsonModel.step==0}checkValidationExpression(){return"string"!=typeof this._jsonModel.validationExpression||this.executeExpression(this._jsonModel.validationExpression)}getConstraints(){switch(this.type){case"string":switch(this.format){case"date":return Qn.date;case"binary":case"data-url":return Qn.file;default:return Qn.string}case"file":return Qn.file;case"number":case"integer":return Qn.number}return this.isArrayType()?Qn.array:[]}get format(){return this._jsonModel.format||""}evaluateConstraints(){let e="type";const t=this._jsonModel,n=this._jsonModel.value,i=this._getConstraintObject(),r=this.getConstraints();let s=!0;if(s&&(s=i.required(this.required,n).valid&&(!this.isArrayType()||!this.required||n.length>0),e="required"),s&&n!=this.emptyValue){const o=r.find(e=>{if(e in t){const r=t[e],s=i[e];return n instanceof Array&&this.isArrayType()?-1!==Qn.array.indexOf(e)?!s(r,n).valid:n.some(e=>!s(r,e).valid):"function"==typeof s&&!s(r,n).valid}return!1});null!=o?(s=!1,e=o):(s=this.checkEnum(n,i),e="enum",s&&"number"===this.type&&(s=this.checkStep(),e="step"),s&&(s=this.checkValidationExpression(),e="validationExpression"))}s||this.form.logger.log(`${e} constraint evaluation failed ${this[e]}. Received ${this._jsonModel.value}`);const o={valid:s,errorMessage:s?"":this.getErrorMessage(e)};return this._applyUpdates(["valid","errorMessage"],o)}triggerValidationEvent(e){e.valid&&this.dispatch(this.valid?new Wt:new zt)}validate(){const e=this.evaluateConstraints();return e.valid&&(this.triggerValidationEvent(e),this.notifyDependents(new Gt({changes:Object.values(e)}))),this.valid?[]:[new Lt(this.id,[this._jsonModel.errorMessage])]}importData(e){this._bindToDataModel(e);const t=this.getDataNode();if(void 0!==t&&t!==cn&&t.$value!==this._jsonModel.value){const e=Zt("value",t.$value,this._jsonModel.value);this._jsonModel.value=t.$value,this.queueEvent(e)}}defaultDataModel(e){return new an(e,this.getDataNodeValue(this._jsonModel.value),this.type||"string")}getState(){return At({},super.getState(),{editValue:this.editValue,displayValue:this.displayValue})}}function ei(e,t){return e.replace(";base64",`;name=${encodeURIComponent(t)};base64`)}async function ti(e){const{name:t,size:n,type:i}=e;return await new Promise((r,s)=>{const o=new FileReader;o.onload=e=>{r(new kn({data:ei(e.target.result,t),type:i,name:t,size:n}))},o.readAsDataURL(e.data)})}Jn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Xn.prototype,"readOnly",null),Jn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Xn.prototype,"enabled",null),Jn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Xn.prototype,"valid",null),Jn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Xn.prototype,"enum",null),Jn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Xn.prototype,"enumNames",null),Jn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Xn.prototype,"required",null),Jn([function(e,t,n){const i=n.get;null!=i&&(n.get=function(){return this.ruleEngine.trackDependency(this),i.call(this)})}],Xn.prototype,"value",null);class ni extends Xn{_getDefaults(){return At({},super._getDefaults(),{accept:["audio/*","video/*","image/*","text/*","application/pdf"],maxFileSize:"2MB",type:"file"})}get maxFileSize(){return Ln(this._jsonModel.maxFileSize)}get accept(){return this._jsonModel.accept}_applyUpdates(e,t){return e.reduce((e,n)=>{const i=this._jsonModel[n],r=t[n];return r!==i&&(e[n]={propertyName:n,currentValue:r,prevValue:i},this._jsonModel[n]=i instanceof kn&&"object"==typeof r&&"value"===n?new kn(At({},i,{data:r.data})):r),e},{})}getInternalType(){var e;return null!=(e=this.type)&&e.endsWith("[]")?"file[]":"file"}getDataNodeValue(e){let t=e;var n;return null!=t&&("string"===this.type?t=null==(n=t.data)?void 0:n.toString():"string[]"===this.type&&(t=t instanceof Array?t:[t],t=t.map(e=>{var t;return null==e||null==(t=e.data)?void 0:t.toString()}))),t}async _serialize(){const e=this._jsonModel.value;return void 0===e?null:await(t=e instanceof Array?e:[e],Promise.all([].map.call(t,ti)));var t}importData(e){this._bindToDataModel(e);const t=this.getDataNode();if(void 0!==t){const e=null==t?void 0:t.$value;if(null!=e){const t=Zn.type(this.getInternalType(),e);t.valid||this.form.logger.error(`unable to bind ${this.name} to data`),this.form.getEventQueue().queue(this,Zt("value",t.value,this._jsonModel.value)),this._jsonModel.value=t.value}else this._jsonModel.value=null}}}class ii extends Xn{offValue(){const e=this.enum;return e.length>1?e[1]:null}_getConstraintObject(){const e=At({},super._getConstraintObject());var t;return e.required=(t=this.offValue(),(e,n)=>({valid:Zn.required(e,n).valid&&(!e||n!=t),value:n})),e}_getDefaults(){return At({},super._getDefaults(),{enforceEnum:!0})}get enum(){return this._jsonModel.enum||[]}}class ri extends Xn{constructor(e,t){super(e,t)}_getFallbackType(){const e=super._getFallbackType();if("string"==typeof e)return`${e}[]`}_getDefaults(){return At({},super._getDefaults(),{enforceEnum:!0,enum:[]})}}class si extends Xn{_applyDefaults(){super._applyDefaults();const e=(new Intl.DateTimeFormat).resolvedOptions().locale;this._jsonModel.editFormat||(this._jsonModel.editFormat="short"),this._jsonModel.displayFormat||(this._jsonModel.displayFormat=this._jsonModel.editFormat),this._jsonModel.placeholder||(this._jsonModel.placeholder=g.getSkeleton(this._jsonModel.editFormat,e)),this._jsonModel.description||(this._jsonModel.description=`To enter today's date use ${g.formatDate(new Date,e,this._jsonModel.editFormat)}`)}}const oi=(e,t)=>{let n;var i;return n="items"in e?new ai(e,t):Ut(e)||"file-input"===e.fieldType?new ni(e,t):"checkbox"===((null==(i=e)?void 0:i.fieldType)||qt(i))?new ii(e,t):function(e){return"checkbox-group"===((null==e?void 0:e.fieldType)||qt(e))}(e)?new ri(e,t):function(e){const t=(null==e?void 0:e.fieldType)||qt(e);return"text-input"===t&&"date"===(null==e?void 0:e.format)||"date-input"===t}(e)?new si(e,t):new Xn(e,t),t.form.fieldAdded(n),n},li={visible:!0};class ai extends Nn{constructor(e,t){super(e,t),this._applyDefaults(),this.queueEvent(new Jt),this.queueEvent(new Qt)}_applyDefaults(){Object.entries(li).map(([e,t])=>{void 0===this._jsonModel[e]&&(this._jsonModel[e]=t)}),this._jsonModel.dataRef&&void 0===this._jsonModel.type&&(this._jsonModel.type="object")}get type(){const e=super.type;if("array"===e||"object"===e)return e}_createChild(e,t){const{parent:n=this}=t;return oi(e,{form:this.form,parent:n})}get items(){return super.items}get value(){return null}get fieldType(){return"panel"}get enabled(){return this._jsonModel.enabled}set enabled(e){this._setProperty("enabled",e)}}const ui={off:0,debug:1,info:2,warn:3,error:4};class ci{debug(e){this.log(e,"debug")}info(e){this.log(e,"info")}warn(e){this.log(e,"warn")}error(e){this.log(e,"error")}log(e,t){0!==this.logLevel&&this.logLevel<=ui[t]&&console[t](e)}constructor(e="off"){this.logLevel=ui[e]}}class hi{constructor(e,t){this._node=e,this._event=t}get node(){return this._node}get event(){return this._event}isEqual(e){return null!=e&&this._node==e._node&&this._event.type==e._event.type}toString(){return this._node.id+"__"+this.event.type}valueOf(){return this.toString()}}class di{constructor(e=new ci("off")){this._isProcessing=!1,this._pendingEvents=[],this.logger=e,this._runningEventCount={}}get length(){return this._pendingEvents.length}get isProcessing(){return this._isProcessing}isQueued(e,t){const n=new hi(e,t);return void 0!==this._pendingEvents.find(e=>n.isEqual(e))}queue(e,t,n=!1){e&&t&&(t instanceof Array||(t=[t]),t.forEach(t=>{const i=new hi(e,t),r=this._runningEventCount[i.valueOf()]||0;r<di.MAX_EVENT_CYCLE_COUNT?(this.logger.info(`Queued event : ${t.type} node: ${e.id} - ${e.name}`),n?this._pendingEvents.splice(this._isProcessing?1:0,0,i):this._pendingEvents.push(i),this._runningEventCount[i.valueOf()]=r+1):this.logger.info(`Skipped queueing event : ${t.type} node: ${e.id} - ${e.name} with count=${r}`)}))}runPendingQueue(){if(!this._isProcessing){for(this._isProcessing=!0;this._pendingEvents.length>0;){const e=this._pendingEvents[0];this.logger.info(`Dequeued event : ${e.event.type} node: ${e.node.id} - ${e.node.name}`),e.node.executeAction(e.event),this._pendingEvents.shift()}this._runningEventCount={},this._isProcessing=!1}}}di.MAX_EVENT_CYCLE_COUNT=10;const pi={method:"GET"},gi=e=>{const t=e;return t.length>0&&t.startsWith("custom:")?t.substring("custom:".length):t},mi=async(e,t,n,i,r,s,o)=>{const l=t,a={method:n};let u,c;try{if(i&&i instanceof kn&&i.data instanceof File){const e=new FormData;e.append(i.name,i.data),c=e}else if(i instanceof FormData)c=i;else if(i&&"object"==typeof i&&Object.keys(i).length>0){var h;const e=Object.keys(o);a.headers=e.length>0?At({},o,-1===e.indexOf("Content-Type")?{"Content-Type":"application/json"}:{}):{"Content-Type":"application/json"};const t=(null==a||null==(h=a.headers)?void 0:h["Content-Type"])||"application/json";"application/json"===t?c=JSON.stringify(i):t.indexOf("multipart/form-data")>-1?c=fi(i):t.indexOf("application/x-www-form-urlencoded")>-1&&(c=_i(i))}u=await((e,t=null,n={})=>{const i=At({},pi,n);return fetch(e,At({},i,{body:t})).then(e=>{var t;if(!e.ok)throw new Error(e.statusText);return null!=e&&null!=(t=e.headers.get("Content-Type"))&&t.includes("application/json")?e.json():e.text()})})(l,c,a)}catch(t){e.form.logger.error("Error invoking a rest API");const n=gi(s);return void e.form.dispatch(new sn(n,{},!0))}const d=gi(r);e.form.dispatch(new sn(d,u,!0))},_i=e=>{const t=new URLSearchParams;return Object.entries(e).forEach(([e,n])=>{t.append(e,null!=n&&"object"==typeof n?Vt(n):n)}),t},fi=(e,t)=>{const n=new FormData;Object.entries(e).forEach(([e,t])=>{n.append(e,null!=t&&"object"==typeof t?Vt(t):t)});const i=(e,t)=>{if((null==e?void 0:e.data)instanceof File){let n=`${null==e?void 0:e.dataRef}/${null==e?void 0:e.name}`;n.startsWith("/")||(n=`/${n}`),t.append(n,e.data)}};return t&&Object.keys(t).reduce((e,r)=>{const s=t[r];return s&&s instanceof Array?[...e,...s.map(e=>i(e,n))]:[...e,i(s,n)]},[]),n},vi=new class{constructor(){this.customFunctions={}}registerFunctions(e){Object.entries(e).forEach(([e,t])=>{let n=t;"function"==typeof t&&(n={_func:e=>t(...e),_signature:[]}),n.hasOwnProperty("_func")?this.customFunctions[e]=n:console.warn(`Unable to register function with name ${e}.`)})}unregisterFunctions(...e){e.forEach(e=>{e in this.customFunctions&&delete this.customFunctions[e]})}getFunctions(){function e(t){return null==t?t:null!==(n=t)&&"[object Array]"===Object.prototype.toString.call(n)?t.map(t=>e(t)):t.valueOf();var n}function t(e){return null==e?"":e.toString()}return At({},{validate:{_func:(e,t,n)=>{const i=e[0];let r;return r="string"==typeof i||void 0===i?n.globals.form.validate():n.globals.form.getElement(i.$id).validate(),Array.isArray(r)&&r.length&&n.globals.form.logger.error("Form Validation Error"),r},_signature:[]},setFocus:{_func:(e,t,n)=>{const i=e[0];try{const e=n.globals.form.getElement(i.$id);n.globals.form.setFocus(e)}catch(e){n.globals.form.logger.error("Invalid argument passed in setFocus. An element is expected")}},_signature:[]},getData:{_func:(e,t,n)=>(n.globals.form.logger.warn("The `getData` function is depricated. Use `exportData` instead."),n.globals.form.exportData()),_signature:[]},exportData:{_func:(e,t,n)=>n.globals.form.exportData(),_signature:[]},importData:{_func:(e,t,n)=>{const i=e[0];return"object"==typeof i&&null!==i&&n.globals.form.importData(i),{}},_signature:[]},submitForm:{_func:(n,i,r)=>{const s=t(n[0]),o=t(n[1]),l=n.length>2?t(n[2]):"multipart/form-data",a=n.length>3?e(n[3]):null;return r.globals.form.dispatch(new nn({success:s,error:o,submit_as:l,data:a})),{}},_signature:[]},request:{_func:(n,i,r)=>{const s=t(n[0]),o=t(n[1]),l=e(n[2]);let a,u,c={};return"string"==typeof n[3]?(r.globals.form.logger.warn("This usage of request is deprecated. Please see the documentation and update"),a=e(n[3]),u=e(n[4])):(c=e(n[3]),a=e(n[4]),u=e(n[5])),mi(r.globals,s,o,l,a,u,c),{}},_signature:[]},dispatchEvent:{_func:(t,n,i)=>{const r=t[0];let s,o=e(t[1]),l=t.length>2?e(t[2]):void 0,a=!1;return"string"==typeof r&&(l=o,o=r,a=!0),s=o.startsWith("custom:")?new sn(o.substring("custom:".length),l,a):((e,t={})=>{switch(e){case"change":return new Gt(t);case"submit":return new nn(t);case"click":return new en(t);case"addItem":return new on(t);case"removeItem":return new ln(t);default:console.error("invalid action")}})(o,l),null!=s&&("string"==typeof r?i.globals.form.dispatch(s):i.globals.form.getElement(r.$id).dispatch(s)),{}},_signature:[]}},this.customFunctions)}};class yi extends Nn{constructor(e,t,n=new di,i="off"){super(e,{}),this._fields={},this._invalidFields=[],this.dataRefRegex=/("[^"]+?"|[^.]+?)(?:\.|$)/g,this._ruleEngine=t,this._eventQueue=n,this._logger=new ci(i),this.queueEvent(new Jt),this.queueEvent(new Qt),this._ids=function*(e=50){const t=function(){const t=[];for(let n=0;n<e;n++)t.push(In(10));return t},n={};let i=t();do{let e=i.pop();for(;e in n;)0===i.length&&(i=t()),e=i.pop();n[e]=!0,yield i.pop(),0===i.length&&(i=t())}while(i.length>0)}(),this._bindToDataModel(new hn("$form",{})),this._initialize(),this.queueEvent(new Xt)}get logger(){return this._logger}get metaData(){return new jn(this._jsonModel.metadata||{})}get action(){return this._jsonModel.action}_createChild(e){return oi(e,{form:this,parent:this})}importData(e){this._bindToDataModel(new hn("$form",e)),this.syncDataAndFormModel(this.getDataNode()),this._eventQueue.runPendingQueue()}exportData(){var e;return null==(e=this.getDataNode())?void 0:e.$value}setFocus(e){const t=e.parent,n=e;for(;null!=t&&t.activeChild!=n;)t.activeChild=n}getState(){const e=this,t=super.getState();return t.id="$form",Object.defineProperty(t,"data",{get:function(){return e.exportData()}}),Object.defineProperty(t,"attachments",{get:function(){return An(e)}}),t}get type(){return"object"}isTransparent(){return!1}get form(){return this}get ruleEngine(){return this._ruleEngine}getUniqueId(){return null==this._ids?"":this._ids.next().value}fieldAdded(e){this._fields[e.id]=e,e.subscribe(e=>{-1===this._invalidFields.indexOf(e.target.id)&&this._invalidFields.push(e.target.id)},"invalid"),e.subscribe(e=>{const t=this._invalidFields.indexOf(e.target.id);t>-1&&this._invalidFields.splice(t,1)},"valid"),e.subscribe(e=>{const t=e.target.getState();if(t){const n=new rn(e.payload.changes,t);this.dispatch(n)}})}validate(){const e=super.validate();return this.dispatch(new tn(e)),e}isValid(){return 0===this._invalidFields.length}dispatch(e){"submit"===e.type?(super.queueEvent(e),this._eventQueue.runPendingQueue()):super.dispatch(e)}executeAction(e){"submit"===e.type&&0!==this._invalidFields.length||super.executeAction(e)}submit(e,t){if(0===this.validate().length){const n=(null==e?void 0:e.payload)||{};(async(e,t,n,i="multipart/form-data",r=null)=>{const s=e.form.action;let o=r;"object"==typeof o&&null!=o||(o=e.form.exportData());const l=An(e.form);let a,u=i;Object.keys(l).length>0||"multipart/form-data"===i?(a=fi({data:o},l),u="multipart/form-data"):a={data:o},await mi(e,s,"POST",a,t,n,{"Content-Type":u})})(t,null==n?void 0:n.success,null==n?void 0:n.error,null==n?void 0:n.submit_as,null==n?void 0:n.data)}}getElement(e){return e==this.id?this:this._fields[e]}get qualifiedName(){return"$form"}getEventQueue(){return this._eventQueue}get name(){return"$form"}get value(){return null}get id(){return"$form"}get title(){return this._jsonModel.title||""}}class bi{constructor(){this._globalNames=["$form","$field","$event"]}compileRule(e){const t=vi.getFunctions();return new It(e,t,void 0,this._globalNames)}execute(e,t,n,i=!1){const r=this._context;let s;this._context=n;try{e.debug=[],s=e.search(t,n)}catch(e){var o,l,a;null==(o=this._context)||null==(l=o.form)||null==(a=l.logger)||a.error(e)}for(const t of e.debug){var u,c,h;null==(u=this._context)||null==(c=u.form)||null==(h=c.logger)||h.debug(t)}let d=s;return i&&"object"==typeof s&&null!==s&&(d=Object.getPrototypeOf(s).valueOf.call(s)),this._context=r,d}trackDependency(e){this._context&&void 0!==this._context.field&&this._context.field!==e&&e._addDependent(this._context.field)}}class Ei extends o{getInputHTML(){return`<textarea\n              title="${this.isTooltipVisible()?this.getTooltipValue():""}"\n              aria-label="${this.isLabelVisible()?this.getLabelValue():""}"\n              class="cmp-adaptiveform-textinput__widget"\n              name="${this.getName()}"\n              ${this.getDisabledHTML()}\n              ${this.getReadonlyHTML()}\n              required="${this.isRequired()}"\n              placeholder="${this.getPlaceHolder()}"\n              minlength="${this.getMinLength()}"\n              maxlength="${this.getMaxLength()}"></textarea>`}}var Ti=/*#__PURE__*/n("checkIfEqual");class wi extends s{constructor(e,t){super(e,t),Object.defineProperty(this,Ti,{writable:!0,value:function(e,t,n){if(n){let n=!1;return e.forEach(e=>{String(e)===t&&(n=!0)}),n}return String(e)===t}}),this.qm=this.element.querySelector(wi.selectors.qm)}getWidget(){return this.element.querySelector(wi.selectors.widget)}getDescription(){return this.element.querySelector(wi.selectors.description)}getLabel(){return this.element.querySelector(wi.selectors.label)}getErrorDiv(){return this.element.querySelector(wi.selectors.errorDiv)}getQuestionMarkDiv(){return this.element.querySelector(wi.selectors.qm)}getTooltipDiv(){return this.element.querySelector(wi.selectors.tooltipDiv)}_updateValue(e){let t=this._model.isArrayType();this.widget&&[this.widget].forEach(n=>{i(this,Ti)[Ti](e,n.value,t)?n.setAttribute("selected","selected"):n.removeAttribute("selected")})}addListener(){var e;null==(e=this.getWidget())||e.addEventListener("blur",e=>{if(this._model.isArrayType()){let e=[];[this.widget].forEach(t=>{t.selected&&e.push(t.value)}),this._model.value=e}else this._model.value=e.target.value})}getbemBlock(){return wi.bemBlock}getIS(){return wi.IS}getInputHTML(){var e,t;return`<select class="cmp-adaptiveform-dropdown__widget"\n                    aria-label="${this.isLabelVisible()?this.getLabelValue():""}"\n                    title="${this.isTooltipVisible()?this.getTooltipValue():""}"\n                    name="${this.getName()}"\n                    ${this.getDisabledHTML()}\n                    ${this.getReadonlyHTML()}\n                    ${this.getMultipleHTML()}\n                    required="${this.isRequired()}">\n                ${this.getPlaceHolder()?`<option  value="" disabled selected>${this.getPlaceHolder()}</option>`:""}\n                \n                ${null==(e=this.getState())||null==(t=e.enumNames)?void 0:t.map((e,t)=>{var n;return this.getOptionsHTML(null==(n=this.getState())?void 0:n.enum[t],e,this.getDefault())}).join("")}\n            </select>`}getOptionsHTML(e,t,n){return`\n            <option value="${e}" class="cmp-adaptiveform-dropdown__option"\n                selected="${e==n?"selected":""}">${t}</option>\n            `}getMultipleHTML(){return(this.getState().isMultiSelect?"multiple: multiple":"")+'"'}}wi.NS="cmp",wi.IS="adaptiveFormDropDown",wi.bemBlock="cmp-adaptiveform-dropdown",wi.selectors={self:"[data-"+wi.NS+'-is="'+wi.IS+'"]',widget:`.${wi.bemBlock}__widget`,options:`.${wi.bemBlock}__option`,label:`.${wi.bemBlock}__label`,description:`.${wi.bemBlock}__longdescription`,qm:`.${wi.bemBlock}__questionmark`,errorDiv:`.${wi.bemBlock}__errormessage`,tooltipDiv:`.${wi.bemBlock}__shortdescription`};const Mi={Click:en,Change:Gt,Submit:nn,Blur:class extends Ht{constructor(e,t=!1){super(e,"blur",{dispatch:t})}},AddItem:on,RemoveItem:ln};class Oi extends s{getQuestionMarkDiv(){return null}getLabel(){return null}getWidget(){return this.element.querySelector(".cmp-button")}getDescription(){return null}getErrorDiv(){return null}getTooltipDiv(){return null}addListener(){var e;null==(e=this.getWidget())||e.addEventListener("click",()=>{this._model.dispatch(new Mi.Click)})}getbemBlock(){return Oi.bemBlock}getIS(){return Oi.IS}getHTML(){return`<button \n            type="button"\n            id="${this.getId()}"\n            class="cmp-button"\n            ${this.getDisabledHTML()}\n            ${this.getReadonlyHTML()}\n            title="${this.getTooltipValue}"\n            data-cmp-visible="${this.isVisible()}"\n            data-cmp-enabled="${this.isEnabled()}"\n            data-cmp-is="adaptiveFormButton"\n            aria-label="${this.getLabelValue()}"\n            data-cmp-adaptiveformcontainer-path="${this.getFormContainerPath()}">\n            <span class="cmp-button__text">${this.getLabelValue()}</span>\n        </button>`}}Oi.NS="cmp",Oi.IS="adaptiveFormButton",Oi.bemBlock="cmp-adaptiveform-button",Oi.selectors={self:"[data-"+Oi.NS+'-is="'+Oi.IS+'"]'};var xi=/*#__PURE__*/n("widget"),Di=/*#__PURE__*/n("model"),$i=/*#__PURE__*/n("options"),Ni=/*#__PURE__*/n("defaultOptions"),Si=/*#__PURE__*/n("matchArray"),ji=/*#__PURE__*/n("regex"),ki=/*#__PURE__*/n("processedValue"),Pi=/*#__PURE__*/n("engRegex"),Ri=/*#__PURE__*/n("writtenInLocale"),Ii=/*#__PURE__*/n("previousCompositionVal"),Ai=/*#__PURE__*/n("toLatinForm"),Li=/*#__PURE__*/n("attachEventHandlers"),Ci=/*#__PURE__*/n("attachCompositionEventHandlers"),Yi=/*#__PURE__*/n("getDigits"),Bi=/*#__PURE__*/n("escape"),Fi=/*#__PURE__*/n("compositionUpdateCallback"),qi=/*#__PURE__*/n("handleKeyInput"),Ui=/*#__PURE__*/n("handleKeyDown"),Ki=/*#__PURE__*/n("isValidChar"),Vi=/*#__PURE__*/n("handleKeyPress"),Hi=/*#__PURE__*/n("handlePaste"),Gi=/*#__PURE__*/n("handleCut"),zi=/*#__PURE__*/n("convertValueToLocale"),Wi=/*#__PURE__*/n("convertValueFromLocale"),Qi=/*#__PURE__*/n("isValueSame");class Zi{constructor(e,t){if(Object.defineProperty(this,Qi,{value:dr}),Object.defineProperty(this,Wi,{value:hr}),Object.defineProperty(this,zi,{value:cr}),Object.defineProperty(this,Gi,{value:ur}),Object.defineProperty(this,Hi,{value:ar}),Object.defineProperty(this,Vi,{value:lr}),Object.defineProperty(this,Ki,{value:or}),Object.defineProperty(this,Ui,{value:sr}),Object.defineProperty(this,qi,{value:rr}),Object.defineProperty(this,Fi,{value:ir}),Object.defineProperty(this,Bi,{value:nr}),Object.defineProperty(this,Yi,{value:tr}),Object.defineProperty(this,Ci,{value:er}),Object.defineProperty(this,Li,{value:Xi}),Object.defineProperty(this,Ai,{value:Ji}),Object.defineProperty(this,xi,{writable:!0,value:null}),Object.defineProperty(this,Di,{writable:!0,value:null}),Object.defineProperty(this,$i,{writable:!0,value:null}),Object.defineProperty(this,Ni,{writable:!0,value:{value:null,curValue:null,pos:0,lengthLimitVisible:!0,zero:"0",decimal:".",minus:"-"}}),Object.defineProperty(this,Si,{writable:!0,value:{integer:"^[+-]?{digits}*$",decimal:"^[+-]?{digits}{leading}({decimal}{digits}{fraction})?$",float:"^[+-]?{digits}*({decimal}{digits}*)?$"}}),Object.defineProperty(this,ji,{writable:!0,value:null}),Object.defineProperty(this,ki,{writable:!0,value:null}),Object.defineProperty(this,Pi,{writable:!0,value:null}),Object.defineProperty(this,Ri,{writable:!0,value:!1}),Object.defineProperty(this,Ii,{writable:!0,value:""}),i(this,xi)[xi]=e,i(this,Di)[Di]=t,i(this,$i)[$i]=Object.assign({},i(this,Ni)[Ni],i(this,Di)[Di]._jsonModel),i(this,Si)[Si][i(this,$i)[$i].dataType]){let e=i(this,$i)[$i].leadDigits,t=i(this,$i)[$i].fracDigits,n=t&&-1!==t?"{0,"+t+"}":"*",r=r.replace("{leading}",e&&-1!==e?"{0,"+e+"}":"*").replace("{fraction}",n),s=r.replace(/{digits}/g,i(this,Yi)[Yi]()).replace("{decimal}",i(this,Bi)[Bi](i(this,$i)[$i].decimal)),o=r.replace(/{digits}/g,"[0-9]").replace("{decimal}","\\.");i(this,ki)[ki]=!("[0123456789]"===i(this,Yi)[Yi]()&&"."===i(this,$i)[$i].decimal),i(this,ji)[ji]=new RegExp(s,"g"),i(this,Pi)[Pi]=new RegExp(o,"g")}i(this,xi)[xi].setAttribute("type","text"),i(this,Li)[Li](e)}getValue(e){return(e=i(this,Ai)[Ai](e)).length>0&&i(this,ki)[ki]&&!e.match(i(this,Pi)[Pi])?(i(this,Ri)[Ri]=!0,e=i(this,Wi)[Wi](e)):i(this,Ri)[Ri]=!1,e&&e.length>=i(this,$i)[$i].combCells&&(e=e.slice(0,i(this,$i)[$i].combCells)),i(this,Ii)[Ii]=e,e}trigger(e,t){if(!i(this,xi)[xi])return this;const n=e.split(".")[0];if(void 0!==document.body[`on${n}`])return i(this,xi)[xi].dispatchEvent(new Event(n)),this;const r=new CustomEvent(n,{detail:t||null});return i(this,xi)[xi].dispatchEvent(r),this}getHTMLSupportedAttr(e,t){try{return e[t]}catch(e){return}}isNonPrintableKey(e){return e&&!["MozPrintableKey","Divide","Multiply","Subtract","Add","Enter","Decimal","Spacebar","Del"].includes(e)&&1!==e.length}setValue(e){i(this,Qi)[Qi]()||(e&&i(this,Ri)[Ri]?i(this,xi)[xi].value=i(this,zi)[zi](e):i(this,xi)[xi].value=i(this,Di)[Di].value)}}function Ji(e){return e.replace(/[\uff00-\uffef]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)})}function Xi(e,t){e.addEventListener("keydown",e=>{i(this,Ui)[Ui](e)}),e.addEventListener("keypress",e=>{i(this,Vi)[Vi](e)}),e.addEventListener("paste",e=>{i(this,Hi)[Hi](e)}),e.addEventListener("cut",e=>{i(this,Gi)[Gi](e)}),e.addEventListener("blur",e=>{i(this,Di)[Di].value=this.getValue(e.target.value)}),i(this,Ci)[Ci](e)}function er(e){let t=!1,n=this,r=function(){let t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()};e.addEventListener("keyup",function(e){t&&(i(n,Fi)[Fi](e)&&r(),t=!1)}),e.addEventListener("compositionstart",function(e){}),e.addEventListener("compositionupdate",function(e){i(n,Fi)[Fi](e)&&r()}),e.addEventListener("compositionend",function(e){t=!0}),e.addEventListener("keydown",function(e){229!==e.which&&(t=!1)})}function tr(){let e=i(this,$i)[$i].zero.charCodeAt(0),t="";for(let n=0;n<10;n++)t+=String.fromCharCode(e+n);return"["+t+"]"}function nr(e){return e.replace(".","\\.")}function ir(e){let t=this,n=!1,r=i(t,$i)[$i].leadDigits,s=i(t,$i)[$i].fracDigits;if(-1!==r){let o=i(this,xi)[xi].value;"compositionupdate"===e.type&&e.originalEvent.data&&(o+=e.originalEvent.data.substr(e.originalEvent.data.length-1));let l=r+(-1!==s?s+i(t,$i)[$i].decimal.length:0);-1===o.indexOf(i(t,$i)[$i].decimal)&&(l=r);let a=i(this,Ai)[Ai](o),u=a.match(i(t,ji)[ji])||a.match(i(this,Pi)[Pi]);if(n=!u,null===u)i(t,xi)[xi].value=i(t,Ii)[Ii],n=!0;else if(n){let e=o.substr(0,l);i(t,xi)[xi].value=e,i(t,Ii)[Ii]=e,n=!0}else i(t,Ii)[Ii]=o}return n}function rr(e,t,n){if(e.ctrlKey&&!["paste","cut"].includes(e.type))return!0;i(this,Ui)[Ui](arguments),i(this,$i)[$i].lengthLimitVisible=!0;let r,s=i(this,xi)[xi].value,o=this.getHTMLSupportedAttr(i(this,xi)[xi],"selectionStart")||0,l=!(null==o),a=this.getHTMLSupportedAttr(i(this,xi)[xi],"selectionEnd")||0,u=parseInt(i(this,$i)[$i].combCells)||0,c=t;if(u>0&&(c=t.substr(0,u-s.length+a-o)),!l)return!0;r=s.substr(0,o)+c+s.substr(a);let h=i(this,Ai)[Ai](r);return null==i(this,ji)[ji]||h.match(i(this,ji)[ji])||h.match(i(this,Pi)[Pi])?!["keydown","cut"].includes(e.type)&&u&&(s.length>=u||r.length>u)&&o===a?(e.preventDefault(),!1):(i(this,$i)[$i].curValue=s,i(this,Ii)[Ii]=s,void(i(this,$i)[$i].pos=o)):(e.preventDefault(),!1)}function sr(e){if(e){let t=e.charCode||e.which||e.keyCode||0;if(8===t||46===t)i(this,qi)[qi](e,"",t);else if(32===t)return e.preventDefault(),!1}}function or(e){e=i(this,Ai)[Ai](e);let t=String.fromCharCode(i(this,$i)[$i].zero.charCodeAt(0)+9);return e>="0"&&e<="9"||e>=i(this,$i)[$i].zero&&e<=t||e===i(this,$i)[$i].decimal||e===i(this,$i)[$i].minus}function lr(e){if(e){let t=e.charCode||e.which||e.keyCode||0,n=String.fromCharCode(t);if(this.isNonPrintableKey(e.key))return!0;if(i(this,Ki)[Ki](n))i(this,qi)[qi](e,n,t);else if(!e.ctrlKey)return e.preventDefault(),!1}}function ar(e){if(e){let t;if(window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):(e.originalEvent||e).clipboardData&&(e.originalEvent||e).clipboardData.getData&&(t=(e.originalEvent||e).clipboardData.getData("text/plain")),t)if(t.split("").every(function(e){return i(this,Ki)[Ki](e)},this))t=i(this,Ai)[Ai](t),i(this,qi)[qi](e,t,0);else if(!e.ctrlKey)return e.preventDefault(),!1}}function ur(e){e&&i(this,qi)[qi](e,"",0)}function cr(e){let t=i(this,$i)[$i].zero.charCodeAt(0);return e.map(function(e){return"."===e?i(this,$i)[$i].decimal:"-"===e?i(this,$i)[$i].minus:String.fromCharCode(parseInt(e)+t)},this).join("")}function hr(e){e=i(this,Ai)[Ai](e);let t=i(this,$i)[$i].zero.charCodeAt(0);return e.map(function(e){return e===i(this,$i)[$i].decimal?".":e===i(this,$i)[$i].minus?"-":(e.charCodeAt(0)-t).toString()},this).join("")}function dr(){return null===i(this,Di)[Di].value&&""===i(this,xi)[xi].value||i(this,Di)[Di].value===i(this,xi)[xi].value}class pr extends s{constructor(...e){super(...e),this.widgetObject=void 0}getClass(){return pr.IS}getWidget(){return this.element.querySelector(pr.selectors.widget)}getDescription(){return this.element.querySelector(pr.selectors.description)}getLabel(){return this.element.querySelector(pr.selectors.label)}getErrorDiv(){return this.element.querySelector(pr.selectors.errorDiv)}getTooltipDiv(){return this.element.querySelector(pr.selectors.tooltipDiv)}getQuestionMarkDiv(){return this.element.querySelector(pr.selectors.qm)}_updateValue(e){null==this.widgetObject&&(this._model._jsonModel.editFormat||this._model._jsonModel.displayFormat)&&(this.widgetObject=new Zi(this.getWidget(),this._model)),this.widgetObject?this.widgetObject.setValue(e):super._updateValue(e)}addListener(){var e;this._model._jsonModel.editFormat||this._model._jsonModel.displayFormat?null==this.widgetObject&&(this.widgetObject=new Zi(this.getWidget(),this._model)):null==(e=this.getWidget())||e.addEventListener("blur",e=>{this._model.value=e.target.value})}getbemBlock(){return pr.bemBlock}getIS(){return pr.IS}getInputHTML(){return`<input\n            class="cmp-adaptiveform-numberinput__widget"\n            title="${this.isTooltipVisible()?this.getTooltipValue():""}"\n            aria-label="${this.isLabelVisible()?this.getLabelValue():""}"\n            type="number"\n            name="${this.getName()}"\n            value="${this.getDefault()}"\n            max="${this.getMaximum()}"\n            min="${this.getMinimum()}"\n            ${this.getDisabledHTML()}\n            ${this.getReadonlyHTML()}\n            required="${this.isRequired()}"\n            placeholder="${this.getPlaceHolder()}"/>`}}pr.NS="cmp",pr.IS="adaptiveFormNumberInput",pr.bemBlock="cmp-adaptiveform-numberinput",pr.selectors={self:"[data-"+pr.NS+'-is="'+pr.IS+'"]',widget:`.${pr.bemBlock}__widget`,label:`.${pr.bemBlock}__label`,description:`.${pr.bemBlock}__longdescription`,errorDiv:`.${pr.bemBlock}__errormessage`,qm:`.${pr.bemBlock}__questionmark`,tooltipDiv:`.${pr.bemBlock}__shortdescription`};class gr extends s{constructor(e,t){super(e,t),this.qm=this.element.querySelector(gr.selectors.qm)}getWidget(){return this.element.querySelector(gr.selectors.widget)}getWidgets(){return this.element.querySelectorAll(gr.selectors.widget)}getDescription(){return this.element.querySelector(gr.selectors.description)}getLabel(){return this.element.querySelector(gr.selectors.label)}getQuestionMarkDiv(){return this.element.querySelector(gr.selectors.qm)}getTooltipDiv(){return this.element.querySelector(gr.selectors.tooltipDiv)}getErrorDiv(){return this.element.querySelector(gr.selectors.errorDiv)}_updateValue(e){null!=e&&this.getWidgets().forEach(t=>{null!=t.value&&e.toString()==t.value.toString()?(t.checked=!0,t.setAttribute("checked","checked"),t.setAttribute("aria-checked",!0+"")):(t.checked=!1,t.removeAttribute("checked"),t.setAttribute("aria-checked",!1+""))},this)}_updateEnabled(e){this.toggle(e,"aria-disabled",!0),this.element.setAttribute("data-cmp-enabled",e+"");let t=this.getWidgets();null==t||t.forEach(t=>{!1===e?(t.setAttribute("disabled",!0+""),t.setAttribute("aria-disabled",!0+"")):(t.removeAttribute("disabled"),t.removeAttribute("aria-disabled"))})}addListener(){this.getWidgets().forEach(e=>{e.addEventListener("change",e=>{this._model.value=e.target.value})})}getbemBlock(){return gr.bemBlock}getIS(){return gr.IS}getInputHTML(){var e,t;return`\n            ${null==(e=this.getState())||null==(t=e.enum)?void 0:t.map((e,t)=>{var n;return this.getRadioHTML(this,e,null==(n=this.getState())?void 0:n.enumNames[t],t)}).join("")}`}getRadioHTML(e,t,n,i){return`<div class="cmp-adaptiveform-radiobutton__option ${e.getLayoutProperties().orientation}">\n                    <label class="cmp-adaptiveform-radiobutton__option__label"\n                            title="${e.getTooltipValue()}"\n                            aria-describedby="_desc"\n                            aria-label="${n}">\n                        <input type="radio"\n                                name="${e.getName()}"\n                                class="cmp-adaptiveform-radiobutton__option__widget"\n                                id="${e.getId()}_${i}__widget"\n                                value="${t}"\n                                ${this.getDisabledHTML()}\n                                aria-describedby="_desc"\n                                checked="${t==this.getDefault()}"/>\n                        <span>${n}</span>\n                    </label>\n                </div>\n            </div>`}}gr.NS="cmp",gr.IS="adaptiveFormRadioButton",gr.bemBlock="cmp-adaptiveform-radiobutton",gr.selectors={self:"[data-"+gr.NS+'-is="'+gr.IS+'"]',widget:`.${gr.bemBlock}__option__widget`,label:`.${gr.bemBlock}__label`,description:`.${gr.bemBlock}__longdescription`,qm:`.${gr.bemBlock}__questionmark`,errorDiv:`.${gr.bemBlock}__errormessage`,tooltipDiv:`.${gr.bemBlock}__shortdescription`};class mr extends s{getWidget(){return null}getDescription(){return null}getLabel(){return null}getErrorDiv(){return null}getTooltipDiv(){return null}getQuestionMarkDiv(){return null}getClass(){return mr.IS}setFocus(){this.setActive()}getbemBlock(){return mr.bemBlock}getIS(){return mr.IS}getHTML(){return`\n        <div data-cmp-is="${this.getIS()}"\n            id="${this.id}"\n            data-cmp-adaptiveformcontainer-path="${this.getFormContainerPath()}"\n            data-cmp-visible="${this.getDefault()}"\n            class="cmp-adaptiveform-text">\n            <div class="cmp-adaptiveform-text__widget" tabindex="0">\n                ${this.getState().value}\n            </div>\n        </div>`}}mr.NS="cmp",mr.IS="adaptiveFormText",mr.bemBlock="cmp-adaptiveform-text",mr.selectors={self:"[data-"+mr.NS+'-is="'+mr.IS+'"]'};class _r extends s{getWidget(){return this.element.querySelector(_r.selectors.widget)}getDescription(){return this.element.querySelector(_r.selectors.description)}getLabel(){return this.element.querySelector(_r.selectors.label)}getErrorDiv(){return this.element.querySelector(_r.selectors.errorDiv)}getTooltipDiv(){return this.element.querySelector(_r.selectors.tooltipDiv)}getQuestionMarkDiv(){return this.element.querySelector(_r.selectors.qm)}addListener(){var e,t;null==(e=this.getWidget())||e.addEventListener("blur",e=>{this._model.value=e.target.value,this.setInactive()}),null==(t=this.getWidget())||t.addEventListener("focus",e=>{this.setActive()})}getbemBlock(){return _r.bemBlock}getIS(){return _r.IS}getInputHTML(){return`\n            <br>\n            <p class="range-info">${this.getMinimum()}</p>\n            <input\n                class="cmp-adaptiveform-SliderInput__widget"\n                title="${this.isTooltipVisible()?this.getTooltipValue():""}"\n                aria-label="${this.isLabelVisible()?this.getLabelValue():""}"\n                type="range"\n                name="${this.getName()}"\n                value="${this.getDefault()}"\n                step="${this.getState().step}"\n                ${this.getDisabledHTML()}\n                ${this.getReadonlyHTML()}\n                required="${this.isRequired()}"\n                placeholder="${this.getPlaceHolder()}"\n                min="${this.getMinimum()}"\n                max="${this.getMaximum()}"/>\n            \n            <p class="range-info">${this.getMaximum()}</p>\n            `}}_r.NS="cmp",_r.IS="adaptiveFormSliderInput",_r.bemBlock="cmp-adaptiveform-sliderinput",_r.selectors={self:"[data-"+_r.NS+'-is="'+_r.IS+'"]',widget:`.${_r.bemBlock}__widget`,label:`.${_r.bemBlock}__label`,description:`.${_r.bemBlock}__longdescription`,qm:`.${_r.bemBlock}__questionmark`,errorDiv:`.${_r.bemBlock}__errormessage`,tooltipDiv:`.${_r.bemBlock}__shortdescription`};class fr extends o{getInputHTML(){return`<input\n              class="cmp-adaptiveform-textinput__widget"\n              title="${this.isTooltipVisible()?this.getTooltipValue():""}"\n              aria-label="${this.isLabelVisible()?this.getLabelValue():""}"\n              type="email"\n              name="${this.getName()}"\n              value="${this.getDefault()}"\n              ${this.getDisabledHTML()}\n              ${this.getReadonlyHTML()}\n              required="${this.isRequired()}"\n              placeholder="${this.getPlaceHolder()}"\n              minlength="${this.getMinLength()}"\n              maxlength="${this.getMaxLength()}"/>`}}class vr extends s{constructor(e,t){super(e,t),this.widgetLabel=void 0,this.qm=this.element.querySelector(vr.selectors.qm),this.widgetLabel=this.element.querySelector(vr.selectors.widgetLabel)}getWidget(){return this.element.querySelector(vr.selectors.widget)}getWidgets(){return this.element.querySelectorAll(vr.selectors.widget)}getDescription(){return this.element.querySelector(vr.selectors.description)}getLabel(){return this.element.querySelector(vr.selectors.label)}getErrorDiv(){return this.element.querySelector(vr.selectors.errorDiv)}getQuestionMarkDiv(){return this.element.querySelector(vr.selectors.qm)}getTooltipDiv(){return this.element.querySelector(vr.selectors.tooltipDiv)}_updateModelValue(){let e=[],t=this.getWidgets();null==t||t.forEach(t=>{t.checked&&e.push(t.value)},this),this._model.value=e}_updateEnabled(e){this.toggle(e,"aria-disabled",!0),this.element.setAttribute("data-cmp-enabled",e+"");let t=this.getWidgets();null==t||t.forEach(t=>{!1===e?(t.setAttribute("disabled",!0+""),t.setAttribute("aria-disabled",!0+"")):(t.removeAttribute("disabled"),t.removeAttribute("aria-disabled"))})}getEnum(){var e;return null==(e=this.getState())?void 0:e.enum}getEnumNames(){var e;return null==(e=this.getState())?void 0:e.enumNames}addListener(){this.getWidgets().forEach(e=>{e.addEventListener("change",e=>{this._updateModelValue()})})}getbemBlock(){return vr.bemBlock}getIS(){return vr.IS}getInputHTML(){var e;return`\n            <div class="cmp-adaptiveform-checkboxgroup__widget">\n            ${null==(e=this.getEnum())?void 0:e.map((e,t,n)=>{var i;return this.getCheckboxHTML(this,e,(null==(i=this.getEnumNames())?void 0:i[t])||e,t,null==n?void 0:n.length)}).join("")}\n            </div>\n            `}getCheckboxHTML(e,t,n,i,r){return`<div class="cmp-adaptiveform-checkboxgroup-item ${e.getName()} ${e.getLayoutProperties().orientation} ">\n                <label class="cmp-adaptiveform-checkbox__label" aria-label="${n}"\n                    title="${e.getTooltipValue()}" for="${e.id}_${i}__widget">\n                    <input class="cmp-adaptiveform-checkbox__widget" type="checkbox" id="${e.id}_${i}__widget"\n                        aria-describedby="_desc"\n                        name="${r>1?e.getName():e.getLabelValue()}"\n                        value="${t.toString()}"\n                        checked="${t==e.getDefault()}"\n                        ${this.getDisabledHTML()} />\n                    <span>${this.getEnum().length>1?n:e.getLabelValue()}</span>\n                </label>\n            </div>`}renderLabel(){return this.isLabelVisible()&&this.getEnum().length>1?`<label id="${this.getId()}-label" for="${this.getId()}" class="${this.getbemBlock()}__label" >${this.getLabelValue()}</label>`:""}}vr.NS="cmp",vr.IS="adaptiveFormCheckBoxGroup",vr.bemBlock="cmp-adaptiveform-checkboxgroup",vr.checkboxBemBlock="cmp-adaptiveform-checkbox",vr.selectors={self:"[data-"+vr.NS+'-is="'+vr.IS+'"]',widgets:`.${vr.bemBlock}__widgets`,widget:`.${vr.checkboxBemBlock}__widget`,widgetLabel:`.${vr.checkboxBemBlock}__label`,label:`.${vr.bemBlock}__label`,description:`.${vr.bemBlock}__longdescription`,qm:`.${vr.bemBlock}__questionmark`,errorDiv:`.${vr.bemBlock}__errormessage`,tooltipDiv:`.${vr.bemBlock}__shortdescription`};class yr{constructor(t){this._model=void 0,this._path=void 0,this._fields=void 0,this._deferredParents=void 0,this.renderChildrens=(e,t)=>{console.log("Rendering childrens");let n=null==t?void 0:t.items;n&&n.length>0&&n.forEach(t=>{e.append(this.getRender(t))})},this.getRender=e=>{const t=document.createElement("div");try{let n,i=this.getModel(e.id),r={element:t,id:e.id};switch(null==e?void 0:e.fieldType){case"checkbox":n=new vr(r,i);break;case"email":n=new fr(r,i);break;case"slider":n=new _r(r,i);break;case"plain-text":n=new mr(r,i);break;case"radio":n=new gr(r,i);break;case"number":n=new pr(r,i);break;case"button":n=new Oi(r,i);break;case"select":n=new wi(r,i);break;case"text-area":n=new Ei(r,i);break;default:n=new o(r,i)}n&&n.render()}catch(e){console.error("Unexpected error ",e)}return t},this._model=((e,t,n="error",i)=>{try{let r=i;null==r&&(r=new yi(At({},e),new bi,new di(new ci(n)),n));const s=null==e?void 0:e.data;return s&&r.importData(s),"function"==typeof t&&t(r),r.getEventQueue().runPendingQueue(),r}catch(e){throw console.error(`Unable to create an instance of the Form ${e}`),new Error(e)}})(e({},t._formJson)),this._path=t._path,this._fields={},this._deferredParents={}}getField(e){return this._fields.hasOwnProperty(e)?this._fields[e]:null}getModel(e){return e?this._model.getElement(e):this._model}addField(e){if(e.getFormContainerPath()===this._path){let t=e.getId();this._fields[t]=e;let n=this.getModel(t);e.setModel(n);let i=n.parent.id;if("$form"!=i){let t=this._fields[i];t?e.setParent(t):(this._deferredParents[i]||(this._deferredParents[i]=[]),this._deferredParents[i].push(e))}if(this._deferredParents[t]){let n=this._deferredParents[t];for(let t=0;t<n.length;t++)n[t].setParent(e);delete this._deferredParents[t]}e.subscribe()}}setFocus(e){if(e){let t=this._fields[e];t&&t.setFocus?t.setFocus():console.log("View on which focus is to be set, not initialized.")}}getPath(){return this._path}render(){const e=document.createElement("form");e.className="cmp-adaptiveform-container cmp-container";let t=this._model.getState();return this.renderChildrens(e,t),e}}var br=/*#__PURE__*/n("handlePanel"),Er=/*#__PURE__*/n("handleProperty"),Tr=/*#__PURE__*/n("handleCheckbox"),wr=/*#__PURE__*/n("setProperty"),Mr=/*#__PURE__*/n("handleMultiValues"),Or=/*#__PURE__*/n("handleHierarchy"),xr=/*#__PURE__*/n("isRule"),Dr=/*#__PURE__*/n("isConstraintMsg"),$r=/*#__PURE__*/n("isPanel"),Nr=/*#__PURE__*/n("isEndingPanel"),Sr=/*#__PURE__*/n("cleanUpPanel");class jr{constructor(){Object.defineProperty(this,Sr,{value:qr}),Object.defineProperty(this,Nr,{value:Fr}),Object.defineProperty(this,$r,{value:Br}),Object.defineProperty(this,Dr,{value:Yr}),Object.defineProperty(this,xr,{value:Cr}),Object.defineProperty(this,Or,{value:Lr}),Object.defineProperty(this,Mr,{value:Ar}),Object.defineProperty(this,wr,{value:Ir}),Object.defineProperty(this,Tr,{value:Rr}),Object.defineProperty(this,Er,{value:Pr}),Object.defineProperty(this,br,{value:kr})}async _getForm(e){if(!e)throw new Error("form name is required");const t=await fetch(e),n=await t.json();return console.log("Data",n),n}async getFormModel(e){if(e){let n={adaptiveform:"0.10.0",metadata:{grammar:"json-formula-1.0.0",version:"1.0.0"},items:[]},r=await this._getForm(e);if(!r||!r.data)throw new Error("Unable to retrieve the form details with excel name "+e);var t=[];t.push(n.items);let s=n;return r.data.forEach(e=>{if(i(this,$r)[$r](e)){e.items={};let n=JSON.parse(JSON.stringify(e));i(this,br)[br](n),s.items.push(n),t.push(s),s=n}else i(this,Nr)[Nr](e)?(s=t.pop(),s||(s=n)):s.items.push(i(this,Er)[Er](e))}),{formDef:n,excelData:r}}}}function kr(e){if(i(this,Sr)[Sr](e),i(this,xr)[xr](e)){let t=i(this,Or)[Or](e,"Rules.");t&&0!=Object.keys(t).length&&(e.rules=t)}let t=i(this,Or)[Or](e,"events.");t&&0!=Object.keys(t).length&&(e.events=t)}function Pr(e){let t=Object.fromEntries(Object.entries(e).filter(([e,t])=>null!=t&&""!=t)),n=jr.fieldMapping.has(t.Type)?jr.fieldMapping.get(t.Type):t.Type,r={name:t.Field,placeholder:t.Placeholder,type:"string",fieldType:n,value:t.Value,label:{value:t.Label},required:!!t.Mandatory};if(i(this,wr)[wr](t,"Maximum",r,"maximum"),i(this,wr)[wr](t,"Minimum",r,"minimum"),i(this,wr)[wr](t,"MaxLength",r,"maxLength"),i(this,wr)[wr](t,"MinLength",r,"minLength"),i(this,wr)[wr](t,"Step",r,"step"),i(this,xr)[xr](t)){let e=i(this,Or)[Or](t,"Rules.");e&&0!=Object.keys(e).length&&(r.rules=e)}if(i(this,Dr)[Dr](t)){let e=i(this,Or)[Or](t,"constraintMessages.");e&&0!=Object.keys(e).length&&(r.constraintMessages=e)}let s=i(this,Or)[Or](t,"events.");s&&0!=Object.keys(s).length&&(r.events=s);let o=i(this,Mr)[Mr](t,"Options");return o&&(r.enumNames=r.enum=o),i(this,Tr)[Tr](r),r}function Rr(e){"checkbox"!=(null==e?void 0:e.fieldType)||e.enum&&0!=e.enum.length||(e.enum=["on"])}function Ir(e,t,n,i){e&&e[t]&&(n[i]=e[t])}function Ar(e,t){let n;return e&&e[t]&&(n=e[t].split(",").map(e=>e.trim())),n}function Lr(e,t){let n={};return Object.keys(e).forEach(i=>{if(~i.indexOf(t)){let t=i.split(".")[1];e[i]&&(n[t]=e[i]),delete e[i]}}),n}function Cr(e){return Object.keys(e).some(function(e){return~e.indexOf("Rules.")})}function Yr(e){return Object.keys(e).some(function(e){return~e.indexOf("constraintMessages.")})}function Br(e){return e&&"object"==e.type}function Fr(e){return e&&"page-break"==e.viewType}function qr(e){delete e.type}async function Ur(e){const t=e.querySelector('a[href$=".json"]');t&&null!=t&&t.href&&t.replaceWith(await(async e=>{console.log("Loading & Converting excel form to Crispr Form");const t=new jr,n=await t.getFormModel(e);console.log(n),console.log("Creating Form Container");let i=new yr({_formJson:null==n?void 0:n.formDef});return window.guideContainer=i,i.render()})(t.href))}jr.fieldMapping=new Map([["text-input","text"],["number-input","number"],["date-input","datetime-local"],["file-input","file"],["drop-down","select"],["radio-group",""],["checkbox-group",""],["plain-text","plain-text"],["checkbox","checkbox"],["multiline-input","text-area"],["panel","panel"],["submit","button"]]),Ur(document.getElementsByClassName("form")[0]);export{Ur as default};