function e(){e=function(){return t};var t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=Object.create((t&&t.prototype instanceof f?t:f).prototype),a=new x(r||[]);return i(o,"_invoke",{value:k(e,n,a)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var d={};function f(){}function p(){}function v(){}var g={};l(g,a,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(D([])));y&&y!==n&&r.call(y,a)&&(g=y);var _=v.prototype=f.prototype=Object.create(g);function b(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function w(e,t){function n(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then(function(e){n("next",e,a,s)},function(e){n("throw",e,a,s)}):t.resolve(c).then(function(e){l.value=e,a(l)},function(e){return n("throw",e,a,s)})}s(u.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t(function(t,i){n(e,r,t,i)})}return o=o?o.then(i,i):i()}})}function k(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=j(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=h(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function j(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,j(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=h(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function D(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:void 0,done:!0}}return p.prototype=v,i(_,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,u,"GeneratorFunction")),e.prototype=Object.create(_),e},t.awrap=function(e){return{__await:e}},b(w.prototype),l(w.prototype,s,function(){return this}),t.AsyncIterator=w,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new w(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},b(_),l(_,u,"Generator"),l(_,a,function(){return this}),l(_,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=D,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:D(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=0;function u(e){return"__private_"+s+++"_"+e}function l(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var c=/*#__PURE__*/function(){function e(e,t){this.formContainer=void 0,this.element=void 0,this.active=void 0,this.id=void 0,this.parentView=void 0,this._model=void 0,this.options=void 0,this.formContainer=e.formContainer,this.id=e.id,this.element=e.element,this.active=!1,this.setModel(t)}var t=e.prototype;return t.setId=function(e){this.id=e},t.setParent=function(e){this.parentView=e,this.parentView.addChild&&this.parentView.addChild(this)},t.setActive=function(){this.isActive()||this.element.setAttribute("data-cmp-active","true"),this.parentView&&this.parentView.setActive&&this.parentView.setActive()},t.setInactive=function(){this.isActive()&&this.element.setAttribute("data-cmp-active","false"),this.parentView&&this.parentView.setInactive&&this.parentView.setInactive()},t.isActive=function(){return this.active},t.getFormContainerPath=function(){var e;return null==(e=this.options)?void 0:e.adaptiveformcontainerPath},t.getId=function(){return this.id},t.setModel=function(e){if(null!=this._model)throw"Re-initializing model is not permitted";this._model=e},t.toggle=function(e,t,n){this.toggleAttribute(this.element,e,t,n)},t.toggleAttribute=function(e,t,n,r){e&&(!1===t?e.setAttribute(n,r):e.removeAttribute(n))},t.getLayoutProperties=function(){var e={},t=this.getModel().getState();return t&&t.properties&&t.properties["afs:layout"]&&(e=t.properties["afs:layout"]),e},t.getModel=function(){return this._model},t.subscribe=function(){throw"the field does not subscribe to the model"},t.getState=function(){var e;return null==(e=this._model)?void 0:e.getState()},t.isVisible=function(){return(null==this?void 0:this.getState().visible)||!0},t.isEnabled=function(){return(null==this?void 0:this.getState().enabled)||!0},t.isLabelVisible=function(){var e,t;return(null==this||null==(e=this.getState())||null==(t=e.label)?void 0:t.visible)||!0},t.getLabelValue=function(){var e,t;return(null==this||null==(e=this.getState())||null==(t=e.label)?void 0:t.value)||""},t.getName=function(){var e;return(null==this||null==(e=this.getState())?void 0:e.name)||""},t.isTooltipVisible=function(){return!1},t.getTooltipValue=function(){return""},t.isShortDescVisible=function(){return!1},t.getShortDescValue=function(){return""},t.getDescriptionValue=function(){var e;return(null==this||null==(e=this.getState())?void 0:e.description)||""},t.getDefault=function(){var e;return(null==this||null==(e=this.getState())?void 0:e.default)||""},t.isReadOnly=function(){var e;return(null==this||null==(e=this.getState())?void 0:e.readOnly)||!1},t.isRequired=function(){var e;return(null==this||null==(e=this.getState())?void 0:e.required)||!1},t.getPlaceHolder=function(){var e;return(null==this||null==(e=this.getState())?void 0:e.placeholder)||""},t.getMinLength=function(){var e;return null==this||null==(e=this.getState())?void 0:e.minLength},t.getMaxLength=function(){var e;return null==this||null==(e=this.getState())?void 0:e.maxLength},t.getMinimum=function(){var e;return null==this||null==(e=this.getState())?void 0:e.minimum},t.getMaximum=function(){var e;return null==this||null==(e=this.getState())?void 0:e.maximum},e}();c.IS="FormField";var h=/*#__PURE__*/function(e){function t(t,n){var r;return(r=e.call(this,t,n)||this).qm=void 0,r.widget=void 0,r.label=void 0,r.errorDiv=void 0,r.tooltip=void 0,r.description=void 0,r.element.className=r.getbemBlock(),r.widget=r.getWidget(),r.description=r.getDescription(),r.label=r.getLabel(),r.errorDiv=r.getErrorDiv(),r.qm=r.getQuestionMarkDiv(),r.tooltip=r.getTooltipDiv(),r}i(t,e);var n=t.prototype;return n.getWidget=function(){throw"method not implemented"},n.getDescription=function(){throw"method not implemented"},n.getLabel=function(){throw"method not implemented"},n.getErrorDiv=function(){throw"method not implemented"},n.getTooltipDiv=function(){throw"method not implemented"},n.getQuestionMarkDiv=function(){throw"method not implemented"},n.setModel=function(t){e.prototype.setModel.call(this,t);var n=this._model.getState();this._applyState(n)},n.setFocus=function(){var e;null==(e=this.getWidget())||e.focus()},n._applyState=function(e){e.value&&this._updateValue(e.value),this._updateVisible(e.visible),this._updateEnabled(e.enabled),this._initializeHelpContent(e)},n._initializeHelpContent=function(e){this._showHideLongDescriptionDiv(!1),this.getDescription()&&this._addHelpIconHandler(e)},n._showHideTooltipDiv=function(e){this.tooltip&&this.toggleAttribute(this.getTooltipDiv(),e,"data-cmp-visible",!1)},n._showHideLongDescriptionDiv=function(e){this.description&&this.toggleAttribute(this.description,e,"data-cmp-visible",!1)},n._isTooltipAlwaysVisible=function(){return!!this.getLayoutProperties().tooltipVisible},n._updateVisible=function(e){this.toggle(e,"aria-hidden",!0),this.element.setAttribute("data-cmp-visible",e+"")},n._updateEnabled=function(e){var t,n,r,i;this.getWidget()&&(this.toggle(e,"aria-disabled",!0),this.element.setAttribute("data-cmp-enabled",e+""),!1===e?(null==(t=this.getWidget())||t.setAttribute("disabled","true"),null==(n=this.getWidget())||n.setAttribute("aria-disabled","true")):(null==(r=this.getWidget())||r.removeAttribute("disabled"),null==(i=this.getWidget())||i.removeAttribute("aria-disabled")))},n._updateValid=function(e,t){this.errorDiv&&(this.toggle(e,"aria-invalid",!0),this.element.setAttribute("data-cmp-valid",e+""),("string"!=typeof t.errorMessage||""===t.errorMessage)&&(this.errorDiv.innerHTML=!0===e?"":"There is an error in the field"))},n._updateErrorMessage=function(e,t){this.errorDiv&&(this.errorDiv.innerHTML=t.errorMessage)},n._updateValue=function(e){var t=this.getWidget();t&&(t.value=e)},n._addHelpIconHandler=function(e){var t=this.qm,n=this.description,r=this._isTooltipAlwaysVisible(),i=this;t&&n&&t.addEventListener("click",function(e){e.preventDefault(),"false"===n.getAttribute("data-cmp-visible")?(i._showHideLongDescriptionDiv(!0),r&&i._showHideTooltipDiv(!1)):(i._showHideLongDescriptionDiv(!1),r&&i._showHideTooltipDiv(!0))})},n.getClass=function(){return this.constructor.IS},n.subscribe=function(){var e=this;this._model.subscribe(function(t){var n=t.target.getState();t.payload.changes.forEach(function(t){var r,i="_update"+((r=t.propertyName)[0].toUpperCase()+r.slice(1));"function"==typeof e[i]?"items"===t.propertyName?e[i](t.prevValue,t.currentValue,n):e[i](t.currentValue,n):console.error("changes to "+t.propertyName+" are not supported. Please raise an issue")})})},n.getbemBlock=function(){throw"bemBlock not implemented"},n.getIS=function(){throw"IS is not implemented"},n.getId=function(){return this.getIS()+"-"+this.id},n.addListener=function(){},n.render=function(){this.element.innerHTML=this.getHTML(),this.addListener(),this.subscribe()},n.getHTML=function(){return'\n            <div class="'+this.getbemBlock()+'"\n                data-cmp-is="'+this.getIS()+'"\n                id="'+this.getId()+'"\n                data-cmp-visible="'+this.isVisible()+'"\n                data-cmp-enabled="'+this.isEnabled()+'"\n                data-cmp-adaptiveformcontainer-path="'+this.getFormContainerPath()+'">\n\n                '+this.renderLabel()+"\n                "+this.getInputHTML()+"\n                "+this.getQuestionMarkHTML()+"\n                "+this.getShortDescHTML()+"\n                "+this.getLongDescHTML()+"\n                "+this.getErrorHTML()+"\n            </div>"},n.getInputHTML=function(){throw"getInputHTML is not implemented"},n.renderLabel=function(){return this.isLabelVisible()?'<label id="'+this.getId()+'-label" for="'+this.getId()+'" class="'+this.getbemBlock()+'__label" >'+this.getLabelValue()+"</label>":""},n.getQuestionMarkHTML=function(){return this.getDescriptionValue()?'<button class="'+this.getbemBlock()+'__questionmark" data-sly-test="'+this.getDescriptionValue()+'">\n        </button>':""},n.getShortDescHTML=function(){return this.isShortDescVisible()?'<div id="'+this.getId()+'-shortDescription" class="'+this.getbemBlock()+'__shortdescription">\n                {this.getShortDescValue()}\n            </div>':""},n.getLongDescHTML=function(){return'<div aria-live="polite">\n                '+(this.getDescriptionValue()?'<div id="'+this.getId()+'-longDescription" class="'+this.getbemBlock()+'__longdescription"></div>':"")+"\n            </div>"},n.getErrorHTML=function(){return'<div id="'+this.getId()+'-errorMessage" class="'+this.getbemBlock()+'__errormessage"></div>'},n.getDisabledHTML=function(){return this.isEnabled()?"":' disabled="true" '},n.getReadonlyHTML=function(){return this.isReadOnly()?' readonly="true" ':""},t}(c),d=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.getWidget=function(){return this.element.querySelector(t.selectors.widget)},n.getDescription=function(){return this.element.querySelector(t.selectors.description)},n.getLabel=function(){return this.element.querySelector(t.selectors.label)},n.getErrorDiv=function(){return this.element.querySelector(t.selectors.errorDiv)},n.getTooltipDiv=function(){return this.element.querySelector(t.selectors.tooltipDiv)},n.getQuestionMarkDiv=function(){return this.element.querySelector(t.selectors.qm)},n.addListener=function(){var e,t,n=this;null==(e=this.getWidget())||e.addEventListener("blur",function(e){n._model.value=e.target.value,n.setInactive()}),null==(t=this.getWidget())||t.addEventListener("focus",function(e){n.setActive()})},n.getbemBlock=function(){return t.bemBlock},n.getIS=function(){return t.IS},n.getInputHTML=function(){return'<input\n            class="cmp-adaptiveform-textinput__widget"\n            title="'+(this.isTooltipVisible()?this.getTooltipValue():"")+'"\n            aria-label="'+(this.isLabelVisible()?this.getLabelValue():"")+'"\n            type="text"\n            name="'+this.getName()+'"\n            value="'+this.getDefault()+'"\n            '+this.getDisabledHTML()+"\n            "+this.getReadonlyHTML()+'\n            required="'+this.isRequired()+'"\n            placeholder="'+this.getPlaceHolder()+'"\n            minlength="'+this.getMinLength()+'"\n            maxlength="'+this.getMaxLength()+'"/>'},t}(h);function f(e){var t={exports:{}};return e(t,t.exports),t.exports}d.NS="cmp",d.IS="adaptiveFormTextInput",d.bemBlock="cmp-adaptiveform-textinput",d.selectors={self:"[data-"+d.NS+'-is="'+d.IS+'"]',widget:"."+d.bemBlock+"__widget",label:"."+d.bemBlock+"__label",description:"."+d.bemBlock+"__longdescription",qm:"."+d.bemBlock+"__questionmark",errorDiv:"."+d.bemBlock+"__errormessage",tooltipDiv:"."+d.bemBlock+"__shortdescription"};var p=b;const v=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvV]{1,5}|[zZOvVxX]{1,3}|S{1,3}|'(?:[^']|'')*')|[^a-zA-Z']+/g;function g(e,t){const n={},r=e.split(/\s/).filter(e=>e.length);n.dateStyle=r[0],r.length>1&&(n.timeStyle=r[1]);const i=new Date(2e3,2,1,2,3,4),o=new Intl.DateTimeFormat(t,n).formatToParts(i),a=o.find(e=>"month"===e.type).value,s=new Intl.DateTimeFormat(t,{month:"long"}).formatToParts(i)[0].value,u=new Intl.DateTimeFormat(t,{month:"short"}).formatToParts(i)[0].value,l=[];return o.forEach(t=>{let n,{type:r,value:i}=t;"month"===r&&(n={[a]:"medium"===e?"short":"long",[s]:"long",[u]:"short","03":"2-digit",3:"numeric"}[i]),"year"===r&&(n={2e3:"numeric","00":"2-digit"}[i]),["day","hour","minute","second"].includes(r)&&(n=2===i.length?"2-digit":"numeric"),"literal"===r&&(n=i),"dayPeriod"===r&&(n="short"),l.push([r,n,i.length])}),l}var m,y,_=/*#__PURE__*/Object.defineProperty({getSkeleton:function(e,t){if(p.ShorthandStyles.find(t=>e.includes(t))){const n=g(e,t),r=[],i={month:"M",year:"Y",day:"d"};return n.forEach(e=>{let[t,n,o]=e;t in i?r.push(Array(o).fill(i[t]).join("")):"literal"===t&&r.push(n)}),r.join("")}return e},parseDateTimeSkeleton:function(e,t){if(p.ShorthandStyles.find(t=>e.includes(t)))return g(e,t);const n=[];return e.replace(v,e=>{const t=e.length;switch(e[0]){case"G":n.push(["era",4===t?"long":5===t?"narrow":"short",t]);break;case"y":n.push(["year",2===t?"2-digit":"numeric",t]);break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":n.push(["month",["numeric","2-digit","short","long","narrow"][t-1],t]);break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":n.push(["day",["numeric","2-digit"][t-1],t]);break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":n.push(["weekday",["short","short","short","long","narrow","narrow"][t-1],t]);break;case"e":if(t<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");n.push(["weekday",["short","long","narrow","short"][t-4],t]);break;case"c":if(t<3||t>5)throw new RangeError("`c, cc, cccccc` (weekday) patterns are not supported");n.push(["weekday",["short","long","narrow","short"][t-3],t]);break;case"a":n.push(["hour12",!0,1]);break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":n.push(["hourCycle","h12"]),n.push(["hour",["numeric","2-digit"][t-1],t]);break;case"H":n.push(["hourCycle","h23",1]),n.push(["hour",["numeric","2-digit"][t-1],t]);break;case"K":n.push(["hourCycle","h11",1]),n.push(["hour",["numeric","2-digit"][t-1],t]);break;case"k":n.push(["hourCycle","h24",1]),n.push(["hour",["numeric","2-digit"][t-1],t]);break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":n.push(["minute",["numeric","2-digit"][t-1],t]);break;case"s":n.push(["second",["numeric","2-digit"][t-1],t]);break;case"S":n.push(["fractionalSecondDigits",t,t]);break;case"A":throw new RangeError("`S/A` (millisecond) patterns are not supported, use `s` instead");case"O":n.push(["timeZoneName",t<4?"shortOffset":"longOffset",t]),n.push(["x-timeZoneName",t<4?"O":"OOOO",t]);break;case"X":case"x":case"Z":n.push(["timeZoneName","longOffset",1]),n.push(["x-timeZoneName",e,1]);break;case"z":case"v":case"V":throw new RangeError("z/v/V` (timeZone) patterns are not supported, use `X/x/Z/O` instead");case"'":n.push(["literal",e.slice(1,-1).replace(/''/g,"'"),-1]);break;default:n.push(["literal",e,-1])}return""}),n}},"__esModule",{value:!0}),b=f(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ShorthandStyles=void 0,t.adjustTimeZone=l,t.datetimeToNumber=function(e){return null===e?0:e.getTime()/864e5},t.formatDate=function(e,t,n,r){if(c.find(e=>n.includes(e))){const i={timeZone:r},o=n.split(/\s/).filter(e=>e.length);return c.indexOf(o[0])>-1&&(i.dateStyle=o[0]),o.length>1&&c.indexOf(o[1])>-1&&(i.timeStyle=o[1]),new Intl.DateTimeFormat(t,i).format(e)}return function(e,t,n,r){const i=(0,_.parseDateTimeSkeleton)(n,t);i.push(["timeZone",r]);const o=i.filter(e=>!e[0].startsWith("x-")),a=i.filter(e=>e[0].startsWith("x-")),s=Object.fromEntries(o);delete s.literal;const u=new Intl.DateTimeFormat(t,s).formatToParts(e);return function(e,t){["hour","minute","second"].forEach(n=>{const r=e.find(e=>e.type===n);if(!r)return;const i=t.find(e=>e[0]===n)[1];"2-digit"===i&&1===r.value.length&&(r.value=`0${r.value}`),"numeric"===i&&2===r.value.length&&"0"===r.value.charAt(0)&&(r.value=r.value.slice(1))})}(u,i),function(e,t){const n=e.find(e=>"year"===e.type);if(!n)return;const r=t.find(e=>"year"===e[0])[2];for(;n.value.length<r;)n.value=`0${n.value}`}(u,o),o.reduce((e,t)=>{if("literal"===t[0])e.push(t);else{const n=u.find(e=>{return e.type===({hour12:"dayPeriod",fractionalSecondDigits:"fractionalSecond"}[n=t[0]]||n);var n});if(n&&"timeZoneName"===n.type){const e=a.find(e=>"x-timeZoneName"===e[0])[1],t=e[0];"Z"===t&&(e.length<4?(n.value=n.value.replace(/(GMT|:)/g,""),""===n.value&&(n.value="+0000")):5===e.length&&(n.value="GMT"===n.value?"Z":n.value.replace(/GMT/,""))),"X"===t||"x"===t?(1===e.length&&(n.value=n.value.replace(/(GMT|:(00)?)/g,"")),2===e.length&&(n.value=n.value.replace(/(GMT|:)/g,"")),3===e.length&&(n.value=n.value.replace(/GMT/g,"")),"X"===t&&""===n.value&&(n.value="Z")):"O"===e&&(n.value=n.value.replace(/GMT/g,"").replace(/0(\d+):/,"$1:").replace(/:00/,""),""===n.value&&(n.value="+0"))}n&&e.push([n.type,n.value])}return e},[])}(e,t,n,r).map(e=>e[1]).join("")},t.numberToDatetime=function(e){return new Date(Math.round(1e3*e*60*60*24))},t.offsetMS=s,t.offsetMSFallback=u,t.parseDate=h,t.parseDefaultDate=function(e,t,n){return h(e,t,"short",null,!1)};const n=[0,1,2,3,4,5,6,7,8,9,10,11].map(e=>new Date(2e3,e,1));function r(e,t){return n.map(n=>{const r=new Intl.DateTimeFormat(e,t).formatToParts(n).find(e=>"month"===e.type);return r&&r.value})}function i(e){return new Intl.NumberFormat(e,{style:"decimal",useGrouping:!1}).format(9876543210).split("").reverse()}function o(e){var t;return"هـ"===(null===(t=new Intl.DateTimeFormat(e,{era:"short"}).formatToParts(new Date).find(e=>"era"===e.type))||void 0===t?void 0:t.value)?"islamic":"gregory"}function a(e){const t=new Date(2e3,1,1,1,1,1),n=new Date(2e3,1,1,16,1,1),r=new Intl.DateTimeFormat(e,{dateStyle:"full",timeStyle:"full"}),i=r.formatToParts(t).find(e=>"dayPeriod"===e.type),o=r.formatToParts(n).find(e=>"dayPeriod"===e.type);return i&&o?{regex:`(${i.value}|${o.value})`,fn:(e,t)=>t.hour+=e===o.value?12:0}:null}function s(e,t){let n;try{n=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format(e)}catch(e){return u(0,t)}const r=/GMT([+\-−])?(\d{1,2}):?(\d{0,2})?/.exec(n);if(!r)return 0;const[i,o,a]=r.slice(1),s=60*(60*(isNaN(parseInt(o))?0:parseInt(o))+(isNaN(parseInt(a))?0:parseInt(a)))*1e3;return"-"===i?-s:s}function u(e,t){const n=function(e){var t=new Date;function n(e){var t=e.replace(":"," ").split(" ");return{day:parseInt(t[0]),hour:parseInt(t[1]),minute:parseInt(t[2])}}var r=t.toLocaleString("en-US",{timeZone:e,day:"numeric",hour:"numeric",minute:"numeric",hour12:!1}),i=n(r),o=n(r=t.toLocaleString("en-US",{day:"numeric",hour:"numeric",minute:"numeric",hour12:!1}));return 24*i.day*60+60*i.hour+i.minute-(24*o.day*60+60*o.hour+o.minute)-t.getTimezoneOffset()}(t);return 60*n*1e3}function l(e,t){if(null===e)return null;let n=e.getTime()-60*e.getTimezoneOffset()*1e3;const r=s(e,t);return u(0,t),n+=-r,new Date(n)}const c=["full","long","medium","short"];function h(e,t,n,s){let u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const c=[],h=[],d=o(t),f=i(t),p=`([${f[0]}-${f[9]}]{1,2})`,v=`([${f[0]}-${f[9]}]{1,3})`,g=`([${f[0]}-${f[9]}]{1,4})`;let m="h12",y=u,b=!1;const w=e=>1===e.length&&":-/.".includes(e),k=e=>j(e)-1,j=e=>e.split("").reduce((e,t)=>10*e+f.indexOf(t),0),E=e=>t=>{let n=j(t);return n=n<100&&2===e?n+2e3:n,"islamic"===d&&(n=Math.ceil(.97*n+622)),e>2&&n<100&&(b=!0),n},M=e=>t=>e.indexOf(t),x=(0,_.parseDateTimeSkeleton)(n,t),D=r(t,Object.fromEntries(x));x.forEach(e=>{let[n,r,i]=e;if("literal"===n)w(r)?h.push(`[^${f[0]}-${f[9]}]`):h.push(r);else if("month"===n&&["numeric","2-digit"].includes(r))h.push(p),c.push(["month",k]);else if("month"===n&&["formatted","long","short","narrow"].includes(r))h.push(`(${D.join("|")})`),c.push(["month",M(D)]);else if(["day","minute","second"].includes(n))"minute"!==n&&"second"!==n||(y=!1),h.push(p),c.push([n,j]);else if("fractionalSecondDigits"===n)y=!1,h.push(v),c.push([n,(e,t)=>t.fractionalSecondDigits+j(e)]);else if("hour"===n)y=!1,h.push(p),c.push([n,(e,t)=>t.hour+j(e)]);else if("year"===n)h.push("numeric"===r?g:p),c.push(["year",E(i)]);else if("dayPeriod"===n){y=!1;const e=a(t);e&&(h.push(e.regex),c.push(["hour",e.fn]))}else"hourCycle"===n?(y=!1,m=r):"x-timeZoneName"===n?(y=!1,h.push("(?:GMT|UTC|Z)?([+\\-−0-9]{0,3}:?[0-9]{0,2})"),c.push([n,(e,t)=>{if(y=!0,!e)return;const n=e.replace(/−/,"-").match(/([+\-\d]{2,3}):?(\d{0,2})/),r=1*n[1];t.hour-=r;const i=n.length>2?1*n[2]:0;t.minute-=r<0?-i:i}])):"timeZoneName"!==n&&(y=!1,h.push(".+?"));return h},[]);const S=new RegExp(h.join("")),O=e.match(S);if(null===O)return e;const T={year:1972,month:0,day:1,hour:0,minute:0,second:0,fractionalSecondDigits:0};if(O.slice(1).forEach((e,t)=>{const[n,r]=c[t];T[n]=r(e,T)}),"h24"===m&&24===T.hour&&(T.hour=0),"h12"===m&&12===T.hour&&(T.hour=0),y){const e=new Date(Date.UTC(T.year,T.month,T.day,T.hour,T.minute,T.second,T.fractionalSecondDigits));return b&&e.setUTCFullYear(T.year),e}const N=new Date(T.year,T.month,T.day,T.hour,T.minute,T.second,T.fractionalSecondDigits);return b&&N.setFullYear(T.year),null==s?N:l(N,s)}t.ShorthandStyles=c}),w=f(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"formatDate",{enumerable:!0,get:function(){return p.formatDate}}),Object.defineProperty(t,"getSkeleton",{enumerable:!0,get:function(){return _.getSkeleton}}),Object.defineProperty(t,"parseDate",{enumerable:!0,get:function(){return p.parseDate}})}),k=f(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"formatDate",{enumerable:!0,get:function(){return w.formatDate}}),Object.defineProperty(t,"getSkeleton",{enumerable:!0,get:function(){return w.getSkeleton}}),Object.defineProperty(t,"parseDate",{enumerable:!0,get:function(){return w.parseDate}})});console.time("script json-formula");var j=0,E=2,M=3,x=5,D=7,S=8,O=9,T=((m={})[j]="number",m[1]="any",m[E]="string",m[M]="array",m[4]="object",m[x]="boolean",m[6]="expression",m[D]="null",m[S]="Array<number>",m[O]="Array<string>",m[10]="class",m[11]="Array<array>",m);function N(e,t){if(void 0===t&&(t=!0),null===e)return D;var n=e;if(t){if("function"!=typeof e.valueOf)return 4;n=e.valueOf.call(e)}switch(Object.prototype.toString.call(n)){case"[object String]":return E;case"[object Number]":return j;case"[object Array]":return M;case"[object Boolean]":return x;case"[object Null]":return D;case"[object Object]":return"Expref"===n.jmespathType?6:4;default:return 4}}function L(e){return[N(e),N(e,!1)]}function P(e,t,n,r,i,o){var a=e[0];if(-1!==t.findIndex(function(e){return 1===e||a===e}))return n;var s=!1;if((4===a||1===t.length&&10===t[0])&&(s=!0),a===M&&1===t.length&&4===t[0]&&(s=!0),t.includes(11)){if(a===M&&(n.forEach(function(e){e instanceof Array||(s=!0)}),!s))return n;s=!0}if(s)throw new Error("TypeError: "+r+" expected argument to be type "+T[t[0]]+" but received type "+T[a]+" instead.");var u=-1;if(a===M&&t.includes(O)&&t.includes(S)&&(u=n.length>0&&"string"==typeof n[0]?O:S),-1===u&&[O,S,M].includes(a)&&(u=t.find(function(e){return[O,S,M].includes(e)})),-1===u&&(u=t[0]),1===u)return n;if(u===O||u===S||u===M){if(u===M)return a===S||a===O?n:null===n?[]:[n];var l=u===S?j:E;if(a===M){for(var c=n.slice(),h=0;h<c.length;h+=1){var d=L(c[h]);c[h]=P(d,[l],c[h],r,i,o)}return c}if([j,E,D,x].includes(l))return[P(e,[l],n,r,i,o)]}else{if(u===j)return[E,x,D].includes(a)?i(n):0;if(u===E)return a===D||4===a?"":o(n);if(u===x)return!!n;if(4===u&&4===e[1])return n}throw new Error("unhandled argument")}function I(e){return null!==e&&"[object Array]"===Object.prototype.toString.call(e)}function C(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function F(e){return null==e?e:I(e)?e.map(function(e){return F(e)}):"function"!=typeof e.valueOf?e:e.valueOf()}function A(e,t){var n=F(e),r=F(t);if(n===r)return!0;if(Object.prototype.toString.call(n)!==Object.prototype.toString.call(r))return!1;if(!0===I(n)){if(n.length!==r.length)return!1;for(var i=0;i<n.length;i+=1)if(!1===A(n[i],r[i]))return!1;return!0}if(!0===C(n)){var o={};for(var a in n)if(hasOwnProperty.call(n,a)){if(!1===A(n[a],r[a]))return!1;o[a]=!0}for(var s in r)if(hasOwnProperty.call(r,s)&&!0!==o[s])return!1;return!0}return!1}function q(e){if(null===e)return!0;var t=F(e);if(""===t||!1===t||null===t)return!0;if(I(t)&&0===t.length)return!0;if(C(t)){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))return!1;return!0}return!t}var R=/*#__PURE__*/function(){function e(e,t,n,r,i,o){this.runtime=e,this.globals=t,this.toNumber=n,this.toString=r,this.debug=i,this.language=o}var t=e.prototype;return t.search=function(e,t){return this.visit(e,t)},t.visit=function(e,t){var n,r=this,i=e&&(n={Field:function(e,t){if(null!==t&&(C(t)||I(t))){var n=t[e.name];if("function"==typeof n&&(n=void 0),void 0===n){try{r.debug.push("Failed to find: '"+e.name+"'");var i=Object.keys(t).map(function(e){return"'"+e+"'"}).toString();i.length&&r.debug.push("Available fields: "+i)}catch(e){}return null}return n}return null},Subexpression:function(e,t){for(var n=r.visit(e.children[0],t),i=1;i<e.children.length;i+=1)if(null===(n=r.visit(e.children[1],n)))return null;return n},IndexExpression:function(e,t){var n=r.visit(e.children[0],t);return r.visit(e.children[1],n)},Index:function(e,t){if(I(t)){var n=r.toNumber(r.visit(e.value,t));n<0&&(n=t.length+n);var i=t[n];return void 0===i?(r.debug.push("Index "+n+" out of range"),null):i}if(C(t)){var o=r.toString(r.visit(e.value,t)),a=t[o];return void 0===a?(r.debug.push("Key "+o+" does not exist"),null):a}return r.debug.push("left side of index expression "+t+" is not an array or object."),null},Slice:function(e,t){if(!I(t))return null;var n=e.children.slice(0).map(function(e){return null!=e?r.toNumber(r.visit(e,t)):null}),i=r.computeSliceParams(t.length,n),o=i[0],a=i[1],s=i[2],u=[];if(s>0)for(var l=o;l<a;l+=s)u.push(t[l]);else for(var c=o;c>a;c+=s)u.push(t[c]);return u},Projection:function(e,t){var n=r.visit(e.children[0],t);if(!I(n))return null;var i=[];return n.forEach(function(t){var n=r.visit(e.children[1],t);null!==n&&i.push(n)}),i},ValueProjection:function(e,t){var n=r.visit(e.children[0],t);if(!C(F(n)))return null;var i=[];return Object.values(n).forEach(function(t){var n=r.visit(e.children[1],t);null!==n&&i.push(n)}),i},FilterProjection:function(e,t){var n=r.visit(e.children[0],t);if(!I(n))return null;var i=n.filter(function(t){return!q(r.visit(e.children[2],t))}),o=[];return i.forEach(function(t){var n=r.visit(e.children[1],t);null!==n&&o.push(n)}),o},Comparator:function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);if("EQ"===e.name)return A(n,i);if("NE"===e.name)return!A(n,i);if("GT"===e.name)return n>i;if("GTE"===e.name)return n>=i;if("LT"===e.name)return n<i;if("LTE"===e.name)return n<=i;throw new Error("Unknown comparator: "+e.name)}},n.Flatten=function(e,t){var n=r.visit(e.children[0],t);if(!I(n))return null;var i=[];return n.forEach(function(e){I(e)?i.push.apply(i,e):i.push(e)}),i},n.Identity=function(e,t){return t},n.MultiSelectList=function(e,t){return null===t?null:e.children.map(function(e){return r.visit(e,t)})},n.MultiSelectHash=function(e,t){if(null===t)return null;var n={};return e.children.forEach(function(e){n[e.name]=r.visit(e.value,t)}),n},n.OrExpression=function(e,t){var n=r.visit(e.children[0],t);return q(n)&&(n=r.visit(e.children[1],t)),n},n.AndExpression=function(e,t){var n=r.visit(e.children[0],t);return!0===q(n)?n:r.visit(e.children[1],t)},n.AddExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"+")},n.ConcatenateExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return n=P(L(n),[2,9],n,"concatenate",r.toNumber,r.toString),i=P(L(i),[2,9],i,"concatenate",r.toNumber,r.toString),r.applyOperator(n,i,"&")},n.UnionExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return n=P(L(n),[3],n,"union",r.toNumber,r.toString),i=P(L(i),[3],i,"union",r.toNumber,r.toString),n.concat(i)},n.SubtractExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"-")},n.MultiplyExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"*")},n.DivideExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"/")},n.PowerExpression=function(e,t){var n=r.visit(e.children[0],t),i=r.visit(e.children[1],t);return r.applyOperator(n,i,"^")},n.NotExpression=function(e,t){return q(r.visit(e.children[0],t))},n.Literal=function(e){return e.value},n.Number=function(e){return e.value},n.Pipe=function(e,t){var n=r.visit(e.children[0],t);return r.visit(e.children[1],n)},n.Current=function(e,t){return t},n.Global=function(e){var t=r.globals[e.name];return void 0===t?null:t},n.Function=function(e,t){if("if"===e.name)return r.runtime.callFunction(e.name,e.children,t,r,!1);var n=e.children.map(function(e){return r.visit(e,t)});return r.runtime.callFunction(e.name,n,t,r)},n.ExpressionReference=function(e){var t=e.children[0];return t.jmespathType="Expref",t},n)[e.type];if(!i)throw new Error("Unknown/missing node type "+(e&&e.type||""));return i(e,t)},t.computeSliceParams=function(e,t){function n(e,t,n){var r=t;return r<0?(r+=e)<0&&(r=n<0?-1:0):r>=e&&(r=n<0?e-1:e),r}var r=t[0],i=t[1],o=t[2];if(null===o)o=1;else if(0===o){var a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}var s=o<0;return[r=null===r?s?e-1:0:n(e,r,o),i=null===i?s?-1:e:n(e,i,o),o]},t.applyOperator=function(e,t,n){var r=this;if(I(e)&&I(t)){var i=e.length<t.length?e:t,o=Math.abs(e.length-t.length);i.length+=o,i.fill(null,i.length-o);for(var a=[],s=0;s<e.length;s+=1)a.push(this.applyOperator(e[s],t[s],n));return a}if(I(e))return e.map(function(e){return r.applyOperator(e,t,n)});if(I(t))return t.map(function(t){return r.applyOperator(e,t,n)});if("*"===n)return this.toNumber(e)*this.toNumber(t);if("&"===n)return e+t;if("+"===n)return this.toNumber(e)+this.toNumber(t);if("-"===n)return this.toNumber(e)-this.toNumber(t);if("/"===n){var u=e/t;return Number.isFinite(u)?u:null}if("^"===n)return Math.pow(e,t);throw new Error("Unknown operator: "+n)},e}(),V="UnquotedIdentifier",$="QuotedIdentifier",B="Rbracket",H="Rparen",U="Comma",z="Colon",G="Number",W="Current",Q="Pipe",Z="Or",J="And",Y="Dot",K="Lbracket",X="Literal",ee={".":Y,",":U,":":z,"{":"Lbrace","}":"Rbrace","]":B,"(":"Lparen",")":H,"@":W},te={"<":!0,">":!0,"=":!0,"!":!0},ne={" ":!0,"\t":!0,"\n":!0};function re(e,t){return e>="0"&&e<="9"||t&&"-"===e||"."===e}function ie(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e}function oe(e,t){var n=e[t];return"$"===n?e.length>t&&ie(e[t+1]):n>="a"&&n<="z"||n>="A"&&n<="Z"||"_"===n}var ae=/*#__PURE__*/function(){function e(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this._allowedGlobalNames=e,this.debug=t}var t=e.prototype;return t.tokenize=function(e){var t,n,r,i=[];for(this._current=0;this._current<e.length;){var o=i.length?i.slice(-1)[0].type:null;if(this._isGlobal(o,e,this._current))i.push(this._consumeGlobal(e));else if(oe(e,this._current))t=this._current,n=this._consumeUnquotedIdentifier(e),i.push({type:V,value:n,start:t});else if(void 0!==ee[e[this._current]])i.push({type:ee[e[this._current]],value:e[this._current],start:this._current}),this._current+=1;else if("-"===e[this._current]&&![W,G,H,V,$,B].includes(o)||re(e[this._current],!1))r=this._consumeNumber(e),i.push(r);else if("["===e[this._current])r=this._consumeLBracket(e),i.push(r);else if('"'===e[this._current])t=this._current,n=this._consumeQuotedIdentifier(e),i.push({type:$,value:n,start:t});else if("'"===e[this._current])t=this._current,n=this._consumeRawStringLiteral(e),i.push({type:X,value:n,start:t});else if("`"===e[this._current]){t=this._current;var a=this._consumeLiteral(e);i.push({type:X,value:a,start:t})}else if(void 0!==te[e[this._current]])i.push(this._consumeOperator(e));else if(void 0!==ne[e[this._current]])this._current+=1;else if("&"===e[this._current])t=this._current,this._current+=1,"&"===e[this._current]?(this._current+=1,i.push({type:J,value:"&&",start:t})):i.push(o===U||"Lparen"===o?{type:"Expref",value:"&",start:t}:{type:"Concatenate",value:"&",start:t});else if("~"===e[this._current])t=this._current,this._current+=1,i.push({type:"Union",value:"~",start:t});else if("+"===e[this._current])t=this._current,this._current+=1,i.push({type:"Add",value:"+",start:t});else if("-"===e[this._current])t=this._current,this._current+=1,i.push({type:"Subtract",value:"-",start:t});else if("*"===e[this._current]){t=this._current,this._current+=1;var s=i.length&&i.slice(-1)[0].type;0===i.length||[K,Y,Q,J,Z,U,z].includes(s)?i.push({type:"Star",value:"*",start:t}):i.push({type:"Multiply",value:"*",start:t})}else if("/"===e[this._current])t=this._current,this._current+=1,i.push({type:"Divide",value:"/",start:t});else if("^"===e[this._current])t=this._current,this._current+=1,i.push({type:"Power",value:"^",start:t});else{if("|"!==e[this._current]){var u=new Error("Unknown character:"+e[this._current]);throw u.name="LexerError",u}t=this._current,this._current+=1,"|"===e[this._current]?(this._current+=1,i.push({type:Z,value:"||",start:t})):i.push({type:Q,value:"|",start:t})}}return i},t._consumeUnquotedIdentifier=function(e){var t=this._current;for(this._current+=1;this._current<e.length&&ie(e[this._current]);)this._current+=1;return e.slice(t,this._current)},t._consumeQuotedIdentifier=function(e){var t=this._current;this._current+=1;for(var n=e.length,r=!oe(e,t+1);'"'!==e[this._current]&&this._current<n;){var i=this._current;ie(e[i])||(r=!0),this._current=i+="\\"!==e[i]||"\\"!==e[i+1]&&'"'!==e[i+1]?1:2}this._current+=1;var o=e.slice(t,this._current);try{r&&!o.includes(" ")||(this.debug.push("Suspicious quotes: "+o),this.debug.push("Did you intend a literal? '"+o.replace(/"/g,"")+"'?"))}catch(e){}return JSON.parse(o)},t._consumeRawStringLiteral=function(e){var t=this._current;this._current+=1;for(var n=e.length;"'"!==e[this._current]&&this._current<n;){var r=this._current;this._current=r+="\\"!==e[r]||"\\"!==e[r+1]&&"'"!==e[r+1]?1:2}return this._current+=1,e.slice(t+1,this._current-1).replaceAll("\\'","'")},t._consumeNumber=function(e){var t=this._current;this._current+=1;for(var n=e.length;re(e[this._current],!1)&&this._current<n;)this._current+=1;var r,i=e.slice(t,this._current);return r=i.includes(".")?parseFloat(i):parseInt(i,10),{type:G,value:r,start:t}},t._consumeLBracket=function(e){var t=this._current;return this._current+=1,"?"===e[this._current]?(this._current+=1,{type:"Filter",value:"[?",start:t}):"]"===e[this._current]?(this._current+=1,{type:"Flatten",value:"[]",start:t}):{type:K,value:"[",start:t}},t._isGlobal=function(e,t,n){if(null!==e&&e===Y)return!1;if("$"!==t[n])return!1;for(var r=n+1;r<t.length&&ie(t[r]);)r+=1;var i=t.slice(n,r);return this._allowedGlobalNames.includes(i)},t._consumeGlobal=function(e){var t=this._current;for(this._current+=1;this._current<e.length&&ie(e[this._current]);)this._current+=1;return{type:"Global",name:e.slice(t,this._current),start:t}},t._consumeOperator=function(e){var t=this._current,n=e[t];return this._current+=1,"!"===n?"="===e[this._current]?(this._current+=1,{type:"NE",value:"!=",start:t}):{type:"Not",value:"!",start:t}:"<"===n?"="===e[this._current]?(this._current+=1,{type:"LTE",value:"<=",start:t}):{type:"LT",value:"<",start:t}:">"===n?"="===e[this._current]?(this._current+=1,{type:"GTE",value:">=",start:t}):{type:"GT",value:">",start:t}:"="===e[this._current]?(this._current+=1,{type:"EQ",value:"==",start:t}):{type:"EQ",value:"=",start:t}},t._consumeLiteral=function(e){this._current+=1;for(var t,n=this._current,r=e.length,i=!1;(i||"`"!==e[this._current])&&this._current<r;){var o=this._current;i&&"\\"===e[o]&&'"'===e[o+1]?o+=2:('"'===e[o]&&(i=!i),o+=i&&"`"===e[o+1]?2:"\\"!==e[o]||"\\"!==e[o+1]&&"`"!==e[o+1]?1:2),this._current=o}var a=e.slice(n,this._current).trimStart();return t=function(e){if(""===e)return!1;if('[{"'.includes(e[0]))return!0;if(["true","false","null"].includes(e))return!0;if(!"-0123456789".includes(e[0]))return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(a=a.replaceAll("\\`","`"))?JSON.parse(a):JSON.parse('"'+a+'"'),this._current+=1,t},e}(),se="Colon",ue="UnquotedIdentifier",le="QuotedIdentifier",ce="Rbracket",he="Rparen",de="Comma",fe="Concatenate",pe="Rbrace",ve="Number",ge="Current",me="Global",ye="Field",_e="Pipe",be="Subtract",we="Multiply",ke="Flatten",je="Star",Ee="Filter",Me="Lbrace",xe="Lbracket",De="Lparen",Se=((y={}).EOF=0,y[ue]=0,y[le]=0,y[ce]=0,y[he]=0,y[de]=0,y[pe]=0,y[ve]=0,y[ge]=0,y[me]=0,y[ye]=0,y.Expref=0,y[_e]=1,y.Or=2,y.And=3,y.Add=6,y[be]=6,y[fe]=7,y[we]=7,y.Divide=7,y.Power=7,y.Union=7,y.EQ=5,y.GT=5,y.LT=5,y.GTE=5,y.LTE=5,y.NE=5,y[ke]=9,y[je]=20,y[Ee]=21,y.Dot=40,y.Not=45,y[Me]=50,y[xe]=55,y[De]=60,y),Oe=/*#__PURE__*/function(){function e(e){void 0===e&&(e=[]),this._allowedGlobalNames=e}var t=e.prototype;return t.parse=function(e,t){this._loadTokens(e,t),this.index=0;var n=this.expression(0);if("EOF"!==this._lookahead(0)){var r=this._lookaheadToken(0),i=new Error("Unexpected token type: "+r.type+", value: "+r.value);throw i.name="ParserError",i}return n},t._loadTokens=function(e,t){var n=new ae(this._allowedGlobalNames,t).tokenize(e);n.push({type:"EOF",value:"",start:e.length}),this.tokens=n},t.expression=function(e){var t=this._lookaheadToken(0);this._advance();for(var n=this.nud(t),r=this._lookahead(0);e<Se[r];)this._advance(),n=this.led(r,n),r=this._lookahead(0);return n},t._lookahead=function(e){return this.tokens[this.index+e].type},t._lookaheadToken=function(e){return this.tokens[this.index+e]},t._advance=function(){this.index+=1},t._getIndex=function(){return this.index},t._setIndex=function(e){this.index=e},t.nud=function(e){var t,n,r;switch(e.type){case"Literal":return{type:"Literal",value:e.value};case ve:return{type:"Number",value:e.value};case ue:return{type:"Field",name:e.value};case le:if(n={type:"Field",name:e.value},this._lookahead(0)===De)throw new Error("Quoted identifier not allowed for function names.");return n;case"Not":return{type:"NotExpression",children:[this.expression(Se.Not)]};case je:return{type:"ValueProjection",children:[{type:"Identity"},this._lookahead(0)===ce?{type:"Identity"}:this._parseProjectionRHS(Se.Star)]};case Ee:return this.led(e.type,{type:"Identity"});case Me:return this._parseMultiselectHash();case ke:return{type:"Projection",children:[{type:ke,children:[{type:"Identity"}]},this._parseProjectionRHS(Se.Flatten)]};case xe:return this._lookahead(0)===je&&this._lookahead(1)===ce?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},this._parseProjectionRHS(Se.Star)]}):this._parseUnchainedIndexExpression();case ge:return{type:ge};case me:return{type:me,name:e.name};case ye:return{type:ye};case"Expref":return{type:"ExpressionReference",children:[t=this.expression(Se.Expref)]};case De:for(r=[];this._lookahead(0)!==he;)t=this.expression(0),r.push(t);return this._match(he),r[0];default:this._errorToken(e)}},t.led=function(e,t){var n,r,i,o,a,s;switch(e){case fe:return{type:"ConcatenateExpression",children:[t,r=this.expression(Se.Concatenate)]};case"Dot":return s=Se.Dot,this._lookahead(0)!==je?{type:"Subexpression",children:[t,r=this._parseDotRHS(s)]}:(this._advance(),{type:"ValueProjection",children:[t,r=this._parseProjectionRHS(s)]});case _e:return r=this.expression(Se.Pipe),{type:_e,children:[t,r]};case"Or":return{type:"OrExpression",children:[t,r=this.expression(Se.Or)]};case"And":return{type:"AndExpression",children:[t,r=this.expression(Se.And)]};case"Add":return{type:"AddExpression",children:[t,r=this.expression(Se.Add)]};case be:return{type:"SubtractExpression",children:[t,r=this.expression(Se.Subtract)]};case we:return{type:"MultiplyExpression",children:[t,r=this.expression(Se.Multiply)]};case"Divide":return{type:"DivideExpression",children:[t,r=this.expression(Se.Divide)]};case"Power":return{type:"PowerExpression",children:[t,r=this.expression(Se.Power)]};case"Union":return{type:"UnionExpression",children:[t,r=this.expression(Se.Power)]};case De:for(i=t.name,o=[];this._lookahead(0)!==he;)a=this.expression(0),this._lookahead(0)===de&&this._match(de),o.push(a);return this._match(he),{type:"Function",name:i,children:o};case Ee:return n=this.expression(0),this._match(ce),{type:"FilterProjection",children:[t,r=this._lookahead(0)===ke?{type:"Identity"}:this._parseProjectionRHS(Se.Filter),n]};case ke:return{type:"Projection",children:[{type:ke,children:[t]},this._parseProjectionRHS(Se.Flatten)]};case"EQ":case"NE":case"GT":case"GTE":case"LT":case"LTE":return this._parseComparator(t,e);case xe:return this._lookahead(0)===je&&this._lookahead(1)===ce?(this._advance(),this._advance(),{type:"Projection",children:[t,r=this._parseProjectionRHS(Se.Star)]}):(r=this._parseChainedIndexExpression(),this._projectIfSlice(t,r));default:this._errorToken(this._lookaheadToken(0))}},t._match=function(e){if(this._lookahead(0)!==e){var t=this._lookaheadToken(0),n=new Error("Expected "+e+", got: "+t.type);throw n.name="ParserError",n}this._advance()},t._errorToken=function(e){var t=new Error("Invalid token ("+e.type+'): "'+e.value+'"');throw t.name="ParserError",t},t._parseChainedIndexExpression=function(){var e=this._getIndex();if(this._lookahead(0)===se)return this._parseSliceExpression();var t=this.expression(0);return this._lookahead(0)===se?(this._setIndex(e),this._parseSliceExpression()):(this._match(ce),{type:"Index",value:t})},t._parseUnchainedIndexExpression=function(){var e=this._getIndex(),t=this._lookahead(0);if(t===se){var n=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},n)}var r=this.expression(0),i=this._lookahead(0);if(i===de)return this._setIndex(e),this._parseMultiselectList();if(i===se){this._setIndex(e);var o=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},o)}return t===ve?(this._match(ce),{type:"Index",value:r}):(this._setIndex(e),this._parseMultiselectList())},t._projectIfSlice=function(e,t){var n={type:"IndexExpression",children:[e,t]};return"Slice"===t.type?{type:"Projection",children:[n,this._parseProjectionRHS(Se.Star)]}:n},t._parseSliceExpression=function(){for(var e=[null,null,null],t=0,n=this._lookahead(0);n!==ce&&t<3;){if(n===se&&t<2)t+=1,this._advance();else{e[t]=this.expression(0);var r=this._lookahead(0);if(r!==se&&r!==ce){var i=new Error("Syntax error, unexpected token: "+r.value+"("+r.type+")");throw i.name="Parsererror",i}}n=this._lookahead(0)}return this._match(ce),{type:"Slice",children:e}},t._parseComparator=function(e,t){return{type:"Comparator",name:t,children:[e,this.expression(Se[t])]}},t._parseDotRHS=function(e){var t=this._lookahead(0);return[ue,le,je].indexOf(t)>=0?this.expression(e):t===xe?(this._match(xe),this._parseMultiselectList()):t===Me?(this._match(Me),this._parseMultiselectHash()):void 0},t._parseProjectionRHS=function(e){var t;if(Se[this._lookahead(0)]<10)t={type:"Identity"};else if(this._lookahead(0)===xe)t=this.expression(e);else if(this._lookahead(0)===Ee)t=this.expression(e);else{if("Dot"!==this._lookahead(0)){var n=this._lookaheadToken(0),r=new Error("Sytanx error, unexpected token: "+n.value+"("+n.type+")");throw r.name="ParserError",r}this._match("Dot"),t=this._parseDotRHS(e)}return t},t._parseMultiselectList=function(){for(var e=[];this._lookahead(0)!==ce;){var t=this.expression(0);if(e.push(t),this._lookahead(0)===de&&(this._match(de),this._lookahead(0)===ce))throw new Error("Unexpected token Rbracket")}return this._match(ce),{type:"MultiSelectList",children:e}},t._parseMultiselectHash=function(){var e,t,n,r=[],i=[ue,le];if(this._lookahead(0)===pe)return this._advance(),{type:"MultiSelectHash",children:[]};for(;;){if(e=this._lookaheadToken(0),i.indexOf(e.type)<0)throw new Error("Expecting an identifier token, got: "+e.type);if(t=e.value,this._advance(),this._match(se),n=this.expression(0),r.push({type:"KeyValuePair",name:t,value:n}),this._lookahead(0)===de)this._match(de);else if(this._lookahead(0)===pe){this._match(pe);break}}return{type:"MultiSelectHash",children:r}},e}();function Te(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var Ne=new function(){var e;function t(e){return null==e?"":e.toString()}var n=/*#__PURE__*/function(){function n(){}var i=n.prototype;return i.addFunctions=function(n,i){void 0===i&&(i={}),this.functionTable=r({},function(e,t,n,r,i,o,a){var s=0,u=2;function l(t,n){return function(r){var o=e.visit(t,r);if(n.indexOf(i(o))<0){var a="TypeError: expected one of "+n+", received "+i(o);throw new Error(a)}return o}}return{abs:{_func:function(e){return Math.abs(e[0])},_signature:[{types:[s]}]},avg:{_func:function(e){var t=0,n=e[0];return n.forEach(function(e){t+=e}),t/n.length},_signature:[{types:[8]}]},ceil:{_func:function(e){return Math.ceil(e[0])},_signature:[{types:[s]}]},contains:{_func:function(e){return o(e[0]).indexOf(o(e[1]))>=0},_signature:[{types:[u,3]},{types:[1]}]},endsWith:{_func:function(e){var t=o(e[0]),n=o(e[1]);return-1!==t.indexOf(n,t.length-n.length)},_signature:[{types:[u]},{types:[u]}]},floor:{_func:function(e){return Math.floor(e[0])},_signature:[{types:[s]}]},length:{_func:function(e){var r=o(e[0]);return t(r)?Object.keys(r).length:n(r)?r.length:a(r).length},_signature:[{types:[u,3,4]}]},map:{_func:function(t){var n=t[0];return t[1].map(function(t){return e.visit(n,t)})},_signature:[{types:[6]},{types:[3]}]},reduce:{_func:function(t){var n=t[0];return t[1].reduce(function(t,r,i,o){return e.visit(n,{accumulated:t,current:r,index:i,array:o})},3===t.length?t[2]:null)},_signature:[{types:[6]},{types:[3]},{types:[1],optional:!0}]},max:{_func:function(e){if(e[0].length>0){var t=i(e[0][0]);return e[0].reduce(t===s?function(e,t){return r(e)>=r(t)?e:t}:function(e,t){return a(t).localeCompare(a(e))<0?e:t},e[0][0])}return null},_signature:[{types:[3,8,9]}]},merge:{_func:function(e){var t={};return e.forEach(function(e){Object.entries(e).forEach(function(e){t[e[0]]=e[1]})}),t},_signature:[{types:[4],variadic:!0}]},maxBy:{_func:function(e){var t,n,r=e[0],i=l(e[1],[s,u]),o=-Infinity;return r.forEach(function(e){(n=i(e))>o&&(o=n,t=e)}),t},_signature:[{types:[3]},{types:[6]}]},sum:{_func:function(e){var t=0;return e[0].forEach(function(e){t+=1*e}),t},_signature:[{types:[8]}]},startsWith:{_func:function(e){return o(e[0]).startsWith(o(e[1]))},_signature:[{types:[u]},{types:[u]}]},min:{_func:function(e){if(e[0].length>0){if(i(e[0][0])===s)return e[0].reduce(function(e,t){return r(e)<=r(t)?e:t},e[0][0]);for(var t=e[0],n=t[0],o=1;o<t.length;o+=1)a(t[o]).localeCompare(a(n))<0&&(n=t[o]);return n}return null},_signature:[{types:[3,8,9]}]},minBy:{_func:function(e){var t,n,r=e[0],i=l(e[1],[s,u]),o=Infinity;return r.forEach(function(e){(n=i(e))<o&&(o=n,t=e)}),t},_signature:[{types:[3]},{types:[6]}]},type:{_func:function(e){var t;return(t={},t[s]="number",t[u]="string",t[3]="array",t[4]="object",t[5]="boolean",t[6]="expref",t[7]="null",t)[i(e[0])]},_signature:[{types:[1]}]},keys:{_func:function(e){return null===e[0]?[]:Object.keys(e[0])},_signature:[{types:[1]}]},values:{_func:function(e){var t=o(e[0]);return null===t?[]:Object.values(t)},_signature:[{types:[1]}]},sort:{_func:function(e){var t=e[0].slice(0);if(t.length>0){var n=i(e[0][0])===s?r:a;t.sort(function(e,t){var r=n(e),i=n(t);return r<i?-1:r>i?1:0})}return t},_signature:[{types:[3,9,8]}]},sortBy:{_func:function(t){var n=t[0].slice(0);if(0===n.length)return n;var r=t[1],o=i(e.visit(r,n[0]));if([s,u].indexOf(o)<0)throw new Error("TypeError");for(var a=[],l=0;l<n.length;l+=1)a.push([l,n[l]]);a.sort(function(t,n){var a=e.visit(r,t[1]),s=e.visit(r,n[1]);if(i(a)!==o)throw new Error("TypeError: expected "+o+", received "+i(a));if(i(s)!==o)throw new Error("TypeError: expected "+o+", received "+i(s));return a>s?1:a<s?-1:t[0]-n[0]});for(var c=0;c<a.length;c+=1)n[c]=a[c][1];return n},_signature:[{types:[3]},{types:[6]}]},join:{_func:function(e){return e[1].join(e[0])},_signature:[{types:[u]},{types:[9]}]},reverse:{_func:function(e){var t=o(e[0]);if(i(t)===u){for(var n="",r=t.length-1;r>=0;r-=1)n+=t[r];return n}var a=e[0].slice(0);return a.reverse(),a},_signature:[{types:[u,3]}]},toArray:{_func:function(e){return 3===i(e[0])?e[0]:[e[0]]},_signature:[{types:[1]}]},toString:{_func:function(e){return i(e[0])===u?e[0]:JSON.stringify(e[0])},_signature:[{types:[1]}]},toNumber:{_func:function(e){var t=i(e[0]);return t===s?e[0]:t===u?r(e[0]):null},_signature:[{types:[1]}]},notNull:{_func:function(e){return e.find(function(e){return 7!==i(e)})||null},_signature:[{types:[1],variadic:!0}]},zip:{_func:function(e){for(var t=e.reduce(function(e,t){return Math.min(e,t.length)},e[0].length),n=new Array(t),r=function(t){n[t]=[],e.forEach(function(e){n[t].push(e[t])})},i=0;i<t;i+=1)r(i);return n},_signature:[{types:[3],variadic:!0}]}}}(this._interpreter,C,I,e,N,F,t),function(e,t,n,r){return void 0===r&&(r=[]),{casefold:{_func:function(e,n,r){return t(e[0]).toLocaleUpperCase(r.language).toLocaleLowerCase(r.language)},_signature:[{types:[2]}]},and:{_func:function(t){var n=!!e(t[0]);return t.slice(1).forEach(function(t){n=n&&!!e(t)}),n},_signature:[{types:[1],variadic:!0}]},deepScan:{_func:function(e){var t=e[0],n=e[1].toString(),r=[];return null===t||function e(t){Object.entries(t).forEach(function(t){var i=t[1];t[0]===n&&r.push(i),"object"==typeof i&&e(i)})}(t),r},_signature:[{types:[4,3,7]},{types:[2,0]}]},or:{_func:function(t){var n=!!e(t[0]);return t.slice(1).forEach(function(t){n=n||!!e(t)}),n},_signature:[{types:[1],variadic:!0}]},not:{_func:function(t){return!e(t[0])},_signature:[{types:[1]}]},null:{_func:function(){return null},_signature:[]},true:{_func:function(){return!0},_signature:[]},false:{_func:function(){return!1},_signature:[]},if:{_func:function(t,n,r){var i=t[1],o=t[2],a=r.visit(t[0],n);return e(a)?r.visit(i,n):r.visit(o,n)},_signature:[{types:[1]},{types:[1]},{types:[1]}]},substitute:{_func:function(e){var r=t(e[0]),i=t(e[1]),o=t(e[2]);if(e.length<=3)return r.replaceAll(i,o);var a=n(e[3]);if(a<1)return r;for(var s=-1,u=0;u<a;u+=1){var l=r.slice(s+=1).indexOf(i);if(-1===l)return r;s+=l}return r.slice(0,s)+r.slice(s).replace(i,o)},_signature:[{types:[2]},{types:[2]},{types:[2]},{types:[0],optional:!0}]},value:{_func:function(e){var t=e[0]||{},n=e[1],i=t[n];if(void 0===i){r.push("Failed to find: '"+n+"'");var o=Object.keys(t).map(function(e){return"'"+e+"'"}).toString();return o.length&&r.push("Available fields: "+o),null}return i},_signature:[{types:[4,3,7]},{types:[2,0]}]},lower:{_func:function(e){return t(e[0]).toLowerCase()},_signature:[{types:[2]}]},upper:{_func:function(e){return t(e[0]).toUpperCase()},_signature:[{types:[2]}]},exp:{_func:function(e){var t=n(e[0]);return Math.exp(t)},_signature:[{types:[0]}]},power:{_func:function(e){return Math.pow(n(e[0]),n(e[1]))},_signature:[{types:[0]},{types:[0]}]},find:{_func:function(e){var r=t(e[0]),i=t(e[1]),o=e.length>2?n(e[2]):0,a=i.indexOf(r,o);return-1===a?null:a},_signature:[{types:[2]},{types:[2]},{types:[0],optional:!0}]},left:{_func:function(e){var r=e.length>1?n(e[1]):1;return r<0?null:e[0]instanceof Array?e[0].slice(0,r):t(e[0]).substr(0,r)},_signature:[{types:[2,3]},{types:[0],optional:!0}]},right:{_func:function(e){var r=e.length>1?n(e[1]):1;if(r<0)return null;if(e[0]instanceof Array)return 0===r?[]:e[0].slice(-1*r);var i=t(e[0]);return i.substr(i.length-r,r)},_signature:[{types:[2,3]},{types:[0],optional:!0}]},mid:{_func:function(e){var r=n(e[1]),i=n(e[2]);return r<0?null:e[0]instanceof Array?e[0].slice(r,r+i):t(e[0]).substr(r,i)},_signature:[{types:[2,3]},{types:[0]},{types:[0]}]},mod:{_func:function(e){return n(e[0])%n(e[1])},_signature:[{types:[0]},{types:[0]}]},proper:{_func:function(e){return t(e[0]).split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}).join(" ")},_signature:[{types:[2]}]},rept:{_func:function(e){var r=t(e[0]),i=n(e[1]);return i<0?null:r.repeat(i)},_signature:[{types:[2]},{types:[0]}]},replace:{_func:function(e){var r=t(e[0]),i=n(e[1]),o=n(e[2]),a=t(e[3]);return i<0?null:r.substr(0,i)+a+r.substr(i+o)},_signature:[{types:[2]},{types:[0]},{types:[0]},{types:[2]}]},round:{_func:function(e){return Te(n(e[0]),n(e[1]))},_signature:[{types:[0]},{types:[0]}]},sqrt:{_func:function(e){var t=Math.sqrt(n(e[0]));return Number.isNaN(t)?null:t},_signature:[{types:[0]}]},stdevp:{_func:function(e){var t=e[0]||[];if(0===t.length)return null;var r=t.map(function(e){return n(e)}),i=r.reduce(function(e,t){return e+t},0)/t.length,o=r.reduce(function(e,t){return e+t*t},0)/t.length,a=Math.sqrt(o-i*i);return Number.isNaN(a)?null:a},_signature:[{types:[8]}]},stdev:{_func:function(e){var t=e[0]||[];if(t.length<=1)return null;var r=t.map(function(e){return n(e)}),i=r.reduce(function(e,t){return e+t},0)/t.length,o=r.reduce(function(e,t){return e+t*t},0),a=Math.sqrt((o-t.length*i*i)/(t.length-1));return Number.isNaN(a)?null:a},_signature:[{types:[8]}]},trim:{_func:function(e){return t(e[0]).split(" ").filter(function(e){return e}).join(" ")},_signature:[{types:[2]}]},trunc:{_func:function(e){var t=n(e[0]),r=e.length>1?n(e[1]):0;return(t>=0?Math.floor:Math.ceil)(t*Math.pow(10,r))/Math.pow(10,r)},_signature:[{types:[0]},{types:[0],optional:!0}]},charCode:{_func:function(e){var t=n(e[0]);return Number.isInteger(t)?String.fromCharCode(t):null},_signature:[{types:[0]}]},codePoint:{_func:function(e){var n=t(e[0]);return 0===n.length?null:n.codePointAt(0)},_signature:[{types:[2]}]},datetime:{_func:function(e){var r=n(e[0]),i=n(e[1]),o=n(e[2]),a=e.length>3?n(e[3]):0,s=e.length>4?n(e[4]):0,u=e.length>5?n(e[5]):0,l=e.length>6?n(e[6]):0,c=e.length>7?t(e[7]):null,h=new Date(r,i-1,o,a,s,u,l);return c&&(h=function(e,t){if(null===e)return null;var n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds());return n+=function(e,t){var n=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format(e),r=/GMT([+\-−])?(\d{1,2}):?(\d{0,2})?/.exec(n);if(!r)return 0;var i=r.slice(1),o=60*(60*(i[1]||0)+1*(i[2]||0))*1e3;return"-"===i[0]?-1*o:o}(e,t),new Date(n)}(h,c)),h.getTime()/864e5},_signature:[{types:[0]},{types:[0]},{types:[0]},{types:[0],optional:!0},{types:[0],optional:!0},{types:[0],optional:!0},{types:[0],optional:!0},{types:[2],optional:!0}]},datedif:{_func:function(e){var r=n(e[0]),i=n(e[1]),o=t(e[2]).toLowerCase();if(i===r)return 0;if(i<r)return null;if("d"===o)return Math.floor(i-r);var a=new Date(864e5*r),s=new Date(864e5*i),u=s.getFullYear()-a.getFullYear(),l=s.getMonth()-a.getMonth(),c=s.getDate()-a.getDate();if("y"===o){var h=u;return l<0&&(h-=1),0===l&&c<0&&(h-=1),h}if("m"===o)return 12*u+l+(c<0?-1:0);if("ym"===o)return c<0&&(l-=1),l<=0&&u>0?12+l:l;if("yd"===o)return c<0&&(l-=1),s.setFullYear(l<0?a.getFullYear()+1:a.getFullYear()),Math.floor((s.getTime()-a.getTime())/864e5);throw new TypeError('Unrecognized unit parameter "'+o+'" for datedif()')},_signature:[{types:[0]},{types:[0]},{types:[2]}]},eomonth:{_func:function(e){var t=n(e[0]),r=n(e[1]),i=new Date(864e5*t);return new Date(i.getFullYear(),i.getMonth()+r+1,0).getTime()/864e5},_signature:[{types:[0]},{types:[0]}]},day:{_func:function(e){var t=n(e[0]);return new Date(864e5*t).getDate()},_signature:[{types:[0]}]},month:{_func:function(e){var t=n(e[0]);return new Date(864e5*t).getMonth()+1},_signature:[{types:[0]}]},year:{_func:function(e){var t=n(e[0]);return new Date(864e5*t).getFullYear()},_signature:[{types:[0]}]},time:{_func:function(e){var t=(3600*n(e[0])+60*n(e[1])+n(e[2]))/86400;return t<0?null:t-Math.floor(t)},_signature:[{types:[0]},{types:[0]},{types:[0]}]},hour:{_func:function(e){var t=n(e[0])%1;if(t<0)return null;var r=Te(24*t,14);return Math.floor(r%24)},_signature:[{types:[0]}]},minute:{_func:function(e){var t=n(e[0])%1;if(t<0)return null;var r=Math.round(1440*t,10);return Math.floor(r%60)},_signature:[{types:[0]}]},second:{_func:function(e){var t=n(e[0])%1;if(t<0)return null;var r=Te(86400*t,10);return Math.floor(r%60)},_signature:[{types:[0]}]},now:{_func:function(){return Date.now()/864e5},_signature:[]},today:{_func:function(){return Math.floor(Date.now()/864e5)},_signature:[]},weekday:{_func:function(e){var t=n(e[0]),r=e.length>1?n(e[1]):1,i=new Date(864e5*t).getDay();switch(r){case 1:return i+1;case 2:return(i+6)%7+1;case 3:return(i+6)%7;default:return null}},_signature:[{types:[0]},{types:[0],optional:!0}]},entries:{_func:function(t){var n=e(t[0]);return Object.entries(n)},_signature:[{types:[0,2,3,4,5]}]},fromEntries:{_func:function(e){return Object.fromEntries(e[0])},_signature:[{types:[11]}]},split:{_func:function(e){var n=t(e[0]),r=t(e[1]);return n.split(r)},_signature:[{types:[2]},{types:[2]}]},unique:{_func:function(t){var n=t[0].map(function(t){return e(t)});return t[0].filter(function(t,r){return n.indexOf(e(t))===r})},_signature:[{types:[3]}]},encodeUrlComponent:{_func:function(e){return encodeURIComponent(e[0])},_signature:[{types:[2]}]},encodeUrl:{_func:function(e){return encodeURI(e[0])},_signature:[{types:[2]}]},decodeUrlComponent:{_func:function(e){return decodeURIComponent(e[0])},_signature:[{types:[2]}]},decodeUrl:{_func:function(e){return decodeURI(e[0])},_signature:[{types:[2]}]}}}(F,t,e,n),i)},i._validateArgs=function(n,r,i,o){if(0!==i.length){var a,s=i.filter(function(e){return!e.optional}).length;if(i[i.length-1].variadic){if(r.length<i.length)throw a=1===i.length?" argument":" arguments",new Error("ArgumentError: "+n+"() takes at least"+i.length+a+" but received "+r.length)}else if(r.length<s||r.length>i.length)throw a=1===i.length?" argument":" arguments",new Error("ArgumentError: "+n+"() takes "+i.length+a+" but received "+r.length);if(o)for(var u,l,c,h,d=Math.min(i.length,r.length),f=0;f<d;f+=1)c=r[f],h=void 0,(u=i[f].types).includes(10)&&null!==(h=c)&&!Array.isArray(h)&&"Object"!==h.constructor.name||u.includes(1)||(l=L(r[f]),r[f]=P(l,u,r[f],n,e,t))}},i.callFunction=function(e,t,n,r,i){if(void 0===i&&(i=!0),!Object.prototype.hasOwnProperty.call(this.functionTable,e))throw new Error("Unknown function: "+e+"()");var o=this.functionTable[e];return this._validateArgs(e,t,o._signature,i),o._func.call(this,t,n,r)},n}();this.compile=function(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=[]);try{r=new Oe(t).parse(e,n)}catch(e){throw n.push(e.toString()),e}return r},this.search=function(r,i,o,a,s,u,l){void 0===u&&(u=[]),void 0===l&&(l="en-US");var c=new n(a);c.debug=u,e=function(e,t){return void 0===t&&(t=[]),function(n){var r=F(n);if(null===r)return null;if(r instanceof Array)return t.push("Converted array to zero"),0;var i=typeof r;return"number"===i?r:"string"===i?e(r,t):"boolean"===i?r?1:0:(t.push("Converted object to zero"),0)}}(s||function(e){var t=+e;return Number.isNaN(t)?0:t},u);var h=new R(c,o,e,t,u,l);c._interpreter=h,c.addFunctions(u,a);try{return h.search(r,i)}catch(e){throw u.push(e.message||e.toString()),e}},this.strictDeepEqual=A},Le=/*#__PURE__*/function(){function e(e,t,n,r,i,o){void 0===t&&(t={}),void 0===n&&(n=null),void 0===r&&(r=[]),void 0===i&&(i=[]),void 0===o&&(o="en-US"),this.expression=e,this.customFunctions=t,this.stringToNumber=n,this.node=Ne.compile(e,r,i),this.debug=i,this.language=o}return e.prototype.search=function(e,t){return Ne.search(this.node,e,t,r({},this.customFunctions),this.stringToNumber,this.debug,this.language)},e}();console.timeEnd("script json-formula");var Pe=function(e){try{var t=e.name,n=e.size,r=e.type;return Promise.resolve(new Promise(function(i,o){var a=new FileReader;a.onload=function(e){i(new Ot({data:Yt(e.target.result,t),type:r,name:t,size:n}))},a.readAsDataURL(e.data)}))}catch(e){return Promise.reject(e)}};function Ie(){return Ie=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ie.apply(this,arguments)}console.time("script af-core");var Ce=function(e,t){void 0===e&&(e=""),void 0===t&&(t=[]),this.errorMessages=t,this.fieldName=e},Fe=function(e){return new Map(Object.entries(e))},Ae=Fe({date:"date-input","data-url":"file-input",binary:"file-input"}),qe=Fe({number:"number-input",boolean:"checkbox",object:"panel",array:"panel",file:"file-input","file[]":"file-input"}),Re=["string[]","boolean[]","number[]","array"],Ve=function(e){var t=e.type||"string";return"enum"in e?e.enum.length>2||Re.indexOf(t)>-1?"drop-down":"checkbox":"string"===t||"string[]"===t?Ae.get(e.format)||"text-input":qe.get(t)||"text-input"},$e=function(e){return"file"===(null==e?void 0:e.type)||"file[]"===(null==e?void 0:e.type)||("string"===(null==e?void 0:e.type)||"string[]"===(null==e?void 0:e.type))&&("binary"===(null==e?void 0:e.format)||"data-url"===(null==e?void 0:e.format))};function Be(e,t){var n;return e instanceof Array?(n=[],n=e.map(function(e){return Be(e,t)})):"object"==typeof e&&null!==e?(n={},Object.entries(e).forEach(function(e){n[e[0]]=Be(e[1],t)})):n=e,t&&n&&n.id&&(n.id=t()),n}var He=function(e){return JSON.stringify(e,null,2)},Ue=/*#__PURE__*/function(){function e(e,t,n){this._metadata=n,this._payload=e,this._type=t}var t=e.prototype;return t.payloadToJson=function(){return this.payload},t.toJson=function(){return{payload:this.payloadToJson(),type:this.type,isCustomEvent:this.isCustomEvent}},t.toString=function(){return JSON.stringify(this.toJson())},n(e,[{key:"type",get:function(){return this._type}},{key:"payload",get:function(){return this._payload}},{key:"metadata",get:function(){return this._metadata}},{key:"target",get:function(){return this._target}},{key:"isCustomEvent",get:function(){return!1}}]),e}(),ze=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"change",{dispatch:n})||this}return i(t,e),t.prototype.withAdditionalChange=function(e){return new t(this.payload.changes.concat(e.payload.changes),this.metadata)},t}(Ue),Ge=/*#__PURE__*/function(e){function t(t){return void 0===t&&(t={}),e.call(this,t,"invalid",{})||this}return i(t,e),t}(Ue),We=/*#__PURE__*/function(e){function t(t){return void 0===t&&(t={}),e.call(this,t,"valid",{})||this}return i(t,e),t}(Ue),Qe=/*#__PURE__*/function(e){function t(t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),e.call(this,t,"executeRule",{dispatch:n})||this}return i(t,e),t}(Ue),Ze=function(e,t,n){return new ze({changes:[{propertyName:e,currentValue:t,prevValue:n}]})},Je=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"initialize",{dispatch:n})||this}return i(t,e),t}(Ue),Ye=/*#__PURE__*/function(e){function t(){return e.call(this,{},"load",{dispatch:!1})||this}return i(t,e),t}(Ue),Ke=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"click",{dispatch:n})||this}return i(t,e),t}(Ue),Xe=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"blur",{dispatch:n})||this}return i(t,e),t}(Ue),et=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"validationComplete",{dispatch:n})||this}return i(t,e),t}(Ue),tt=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,"submit",{dispatch:n})||this}return i(t,e),t}(Ue),nt=/*#__PURE__*/function(e){function t(t,n){return e.call(this,{field:n,changes:t},"fieldChanged")||this}return i(t,e),t}(Ue),rt=/*#__PURE__*/function(e){function t(t,n,r){return void 0===n&&(n={}),void 0===r&&(r=!1),e.call(this,n,t,{dispatch:r})||this}return i(t,e),n(t,[{key:"isCustomEvent",get:function(){return!0}}]),t}(Ue),it=/*#__PURE__*/function(e){function t(t){return e.call(this,t,"addItem")||this}return i(t,e),t}(Ue),ot=/*#__PURE__*/function(e){function t(t){return e.call(this,t,"removeItem")||this}return i(t,e),t}(Ue),at=/*#__PURE__*/function(){function e(e,t,n){void 0===n&&(n=typeof t),this.$_fields=[],this.$_name=e,this.$_value=t,this.$_type=n}var t=e.prototype;return t.valueOf=function(){return this.$_value},t.setValue=function(e,t,n){this.$_value=e,this.$_fields.forEach(function(e){n!==e&&(e.value=t)})},t.$bindToField=function(e){-1===this.$_fields.indexOf(e)&&this.$_fields.push(e)},t.$convertToDataValue=function(){return this},n(e,[{key:"$name",get:function(){return this.$_name}},{key:"$value",get:function(){return this.$_value}},{key:"$type",get:function(){return this.$_type}},{key:"$isDataGroup",get:function(){return!1}}]),e}(),st=Symbol("NullValue"),ut=new(/*#__PURE__*/function(e){function t(){return e.call(this,"",st,"null")||this}i(t,e);var n=t.prototype;return n.setValue=function(){},n.$bindToField=function(){},n.$length=function(){return 0},n.$convertToDataValue=function(){return this},n.$addDataNode=function(){},n.$removeDataNode=function(){},n.$getDataNode=function(){return this},n.$containsDataNode=function(){return!1},t}(at)),lt=/*#__PURE__*/function(e){i(r,e);var t=r.prototype;function r(t,n,r){var i;return void 0===r&&(r=typeof n),(i=e.call(this,t,n,r)||this).$_items=n instanceof Array?n.map(function(e,t){return i.createEntry(t,e)}):Object.fromEntries(Object.entries(n).map(function(e){var t=e[0];return[t,i.createEntry(t,e[1])]})),i}return t.createEntry=function(e,t){var n=t instanceof Array?"array":typeof t;return"object"==typeof t&&null!=t?new r(e,t,n):new at(e,t,n)},t.$convertToDataValue=function(){return new at(this.$name,this.$value,this.$type)},t.$addDataNode=function(e,t,n){if(void 0===n&&(n=!1),t!==ut)if("array"===this.$type){var r=e;n?this.$_items[e]=t:this.$_items.splice(r,0,t)}else this.$_items[e]=t},t.$removeDataNode=function(e){this.$_items[e]=void 0},t.$getDataNode=function(e){if(this.$_items.hasOwnProperty(e))return this.$_items[e]},t.$containsDataNode=function(e){return this.$_items.hasOwnProperty(e)&&void 0!==this.$_items[e]},n(r,[{key:"$value",get:function(){return"array"===this.$type?Object.values(this.$_items).filter(function(e){return void 0!==e}).map(function(e){return e.$value}):Object.fromEntries(Object.values(this.$_items).filter(function(e){return void 0!==e}).map(function(e){return[e.$name,e.$value]}))}},{key:"$length",get:function(){return Object.entries(this.$_items).length}},{key:"$isDataGroup",get:function(){return!0}}]),r}(at),ct=function(e,t){return{type:"Identifier",value:e,start:t}},ht=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e},dt=function(e,t,n){return null===e&&"$"===t[n]},ft=function(e,t){var n=e[t];return"$"===n?e.length>t&&ht(e[t+1]):n>="a"&&n<="z"||n>="A"&&n<="Z"||"_"===n},pt=function(e){return e>="0"&&e<="9"},vt=/*#__PURE__*/function(){function e(e){this._tokens=[],this._result_tokens=[],this.stream=e,this._current=0}var t=e.prototype;return t._consumeGlobal=function(){return this._current+=1,{type:"Global",start:0,value:"$"}},t._consumeUnquotedIdentifier=function(e){var t=this._current;for(this._current+=1;this._current<e.length&&ht(e[this._current]);)this._current+=1;return ct(e.slice(t,this._current),t)},t._consumeQuotedIdentifier=function(e){var t=this._current;this._current+=1;for(var n=e.length;'"'!==e[this._current]&&this._current<n;){var r=this._current;this._current=r+="\\"!==e[r]||"\\"!==e[r+1]&&'"'!==e[r+1]?1:2}return this._current+=1,ct(JSON.parse(e.slice(t,this._current)),t)},t._consumeNumber=function(e){var t=this._current;this._current+=1;for(var n=e.length;pt(e[this._current])&&this._current<n;)this._current+=1;var r=e.slice(t,this._current);return{type:"Number",value:parseInt(r,10),start:t}},t._consumeBracket=function(e){var t,n=this._current;if(this._current+=1,!pt(e[this._current]))throw new Error("unexpected exception at position "+this._current+". Must be a character");if(t=this._consumeNumber(e).value,this._current<this.stream.length&&"]"!==e[this._current])throw new Error("unexpected exception at position "+this._current+". Must be a character");return this._current++,function(e,t){return{type:"bracket",value:e,start:t}}(t,n)},t.tokenize=function(){for(var e=this.stream;this._current<e.length;){var t=this._tokens.length?this._tokens.slice(-1)[0]:null;if(dt(t,e,this._current)){var n=this._consumeGlobal();this._tokens.push(n),this._result_tokens.push(n)}else if(ft(e,this._current)){var r=this._consumeUnquotedIdentifier(e);this._tokens.push(r),this._result_tokens.push(r)}else if("."===e[this._current]&&null!=t&&"DOT"!==t.type)this._tokens.push({type:"DOT",value:".",start:this._current}),this._current+=1;else if("["===e[this._current]){var i=this._consumeBracket(e);this._tokens.push(i),this._result_tokens.push(i)}else{if('"'!==e[this._current]){var o=Math.max(0,this._current-2),a=Math.min(this.stream.length,this._current+2);throw new Error("Exception at parsing stream "+this.stream.slice(o,a))}var s=this._consumeQuotedIdentifier(e);this._tokens.push(s),this._result_tokens.push(s)}}return this._result_tokens},e}(),gt=function(e){return new vt(e).tokenize()},mt=function(e,t,n){var r;r="string"==typeof t?gt(t):t;for(var i=e,o=0,a=function(e,t,n){return null===t?n:"bracket"===t.type?new lt(e.value,[],"array"):new lt(e.value,{})};o<r.length&&null!=i;){var s=r[o];if("Global"===s.type)i=e;else if("Identifier"===s.type){if(!(i instanceof lt&&"object"===i.$type))throw new Error("Looking for "+s.value+" in "+i.$value);if(i.$containsDataNode(s.value)&&null!==i.$getDataNode(s.value).$value)i=i.$getDataNode(s.value);else if(n){var u=a(s,o<r.length-1?r[o+1]:null,n);i.$addDataNode(s.value,u),i=u}else i=void 0}else if("bracket"===s.type){if(!(i instanceof lt&&"array"===i.$type))throw new Error("Looking for index "+s.value+" in non array"+i.$value);var l=s.value;if(l<i.$length)i=i.$getDataNode(l);else if(n){var c=a(s,o<r.length-1?r[o+1]:null,n);i.$addDataNode(l,c),i=c}else i=void 0}o+=1}return i},yt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},_t=["value","label","description","visible","enabled","readOnly","enum","enumNames","required","properties","exclusiveMinimum","exclusiveMaximum","maxLength","maximum","maxItems","minLength","minimum","minItems","step"],bt=[].concat(_t,["valid","index","activeChild"]),wt=/*#__PURE__*/function(){function e(e,t){this._action=e,this._target=t}return e.prototype.toString=function(){return this._action.toString()},n(e,[{key:"type",get:function(){return this._action.type}},{key:"payload",get:function(){return this._action.payload}},{key:"metadata",get:function(){return this._action.metadata}},{key:"target",get:function(){return this._target}},{key:"isCustomEvent",get:function(){return this._action.isCustomEvent}},{key:"originalAction",get:function(){return this._action.originalAction}}]),e}(),kt=Symbol("target"),jt=Symbol("qualifiedName"),Et=/*#__PURE__*/function(){function e(e,t){this._callbacks={},this._dependents=[],this._tokens=[],this._options=t,this[jt]=null,this._jsonModel=Ie({},e,{id:"id"in e?e.id:this.form.getUniqueId()})}var t=e.prototype;return t.setupRuleNode=function(){var e=this;this._ruleNode=new Proxy(this.ruleNodeReference(),{get:function(t,n){return e.getFromRule(t,n)}})},t.ruleNodeReference=function(){return this},t.getRuleNode=function(){return this._ruleNode},t.getFromRule=function(t,n){if(n===Symbol.toPrimitive||"valueOf"===n&&!t.hasOwnProperty("valueOf"))return this.valueOf;if(n===kt)return this;if("string"==typeof n)if(n.startsWith("$")){if("function"!=typeof this[n=n.substr(1)]){var r=this[n];return r instanceof e?r.getRuleNode():r instanceof Array?r.map(function(t){return t instanceof e?t.getRuleNode():t}):r}}else{if(t.hasOwnProperty(n))return t[n];if("function"==typeof t[n])return t[n]}},t.isTransparent=function(){var e,t="array"===(null==(e=this.parent)?void 0:e._jsonModel.type);return!this._jsonModel.name&&!t},t.getState=function(){return Ie({},this._jsonModel,{":type":this[":type"]})},t.subscribe=function(e,t){var n=this;return void 0===t&&(t="change"),this._callbacks[t]=this._callbacks[t]||[],this._callbacks[t].push(e),{unsubscribe:function(){n._callbacks[t]=n._callbacks[t].filter(function(t){return t!==e})}}},t._addDependent=function(e){if(void 0===this._dependents.find(function(t){return t.node===e})){var t=this.subscribe(function(t){var n=t.payload.changes,r=[].concat(bt,["items"]);n.findIndex(function(e){return r.indexOf(e.propertyName)>-1})>-1&&e.dispatch(new Qe)});this._dependents.push({node:e,subscription:t})}},t.removeDependent=function(e){var t=this._dependents.findIndex(function(t){return t.node===e});t>-1&&(this._dependents[t].subscription.unsubscribe(),this._dependents.splice(t,1))},t.queueEvent=function(e){var t=new wt(e,this);this.form.getEventQueue().queue(this,t,["valid","invalid"].indexOf(t.type)>-1)},t.dispatch=function(e){this.queueEvent(e),this.form.getEventQueue().runPendingQueue()},t.notifyDependents=function(e){var t=this;(this._callbacks[e.type]||[]).forEach(function(n){n(new wt(e,t))})},t._setProperty=function(e,t,n){void 0===n&&(n=!0);var r=this._jsonModel[e];if(!(null!==t&&null!==r&&"object"==typeof t&&"object"==typeof r?JSON.stringify(t)===JSON.stringify(r):r===t)){this._jsonModel[e]=t;var i=Ze(e,t,r);return n&&this.notifyDependents(i),i.payload.changes}return[]},t._bindToDataModel=function(e){if("$form"!==this.id){var t,n,r,i=this._jsonModel.dataRef,o=e,a="";if(null===i)t=ut;else if(void 0!==i){0===this._tokens.length&&(this._tokens=gt(i));var s=e;if("Global"===this._tokens[0].type&&(s=this.form.getDataNode()),void 0!==s){var u=this._tokens[this._tokens.length-1].value,l=this.defaultDataModel(u);t=mt(s,this._tokens,l),o=mt(s,this._tokens.slice(0,-1)),a=u}}else if(e!==ut){o=e;var c="array"===e.$type?this.index:this._jsonModel.name||"";if(a=c,""!==c){var h=this.defaultDataModel(c);void 0!==h&&void 0===(t=e.$getDataNode(c))&&e.$addDataNode(c,t=h)}else t=void 0}t&&(this.isContainer||o===ut||t===ut||(t=null==(r=t)?void 0:r.$convertToDataValue(),o.$addDataNode(a,t,!0)),null==(n=t)||n.$bindToField(this),this._data=t)}else this._data=e},t.getDataNode=function(){return this._data},t.getNonTransparentParent=function(){for(var e=this.parent;null!=e&&e.isTransparent();)e=e.parent;return e},t._initialize=function(){if(void 0===this._data){var e,t=this.parent;do{e=t.getDataNode(),t=t.parent}while(void 0===e);this._bindToDataModel(e)}},t._applyUpdates=function(e,t){var n=this;return e.reduce(function(e,r){var i=n._setProperty(r,t[r],!1);return i.length>0&&(e[r]=i[0]),e},{})},t.focus=function(){this.parent&&(this.parent.activeChild=this)},n(e,[{key:"isContainer",get:function(){return!1}},{key:"id",get:function(){return this._jsonModel.id}},{key:"index",get:function(){return this.parent.indexOf(this)}},{key:"parent",get:function(){return this._options.parent}},{key:"type",get:function(){return this._jsonModel.type}},{key:"fieldType",get:function(){return this._jsonModel.fieldType||"text-input"}},{key:":type",get:function(){return this._jsonModel[":type"]||this.fieldType}},{key:"name",get:function(){return this._jsonModel.name}},{key:"description",get:function(){return this._jsonModel.description},set:function(e){this._setProperty("description",e)}},{key:"dataRef",get:function(){return this._jsonModel.dataRef}},{key:"visible",get:function(){return this._jsonModel.visible},set:function(e){if(e!==this._jsonModel.visible){var t=Ze("visible",e,this._jsonModel.visible);this._jsonModel.visible=e,this.notifyDependents(t)}}},{key:"form",get:function(){return this._options.form}},{key:"ruleEngine",get:function(){return this.form.ruleEngine}},{key:"label",get:function(){return this._jsonModel.label},set:function(e){if(e!==this._jsonModel.label){var t=Ze("label",e,this._jsonModel.label);this._jsonModel=Ie({},this._jsonModel,{label:e}),this.notifyDependents(t)}}},{key:"uniqueItems",get:function(){return this._jsonModel.uniqueItems}},{key:"properties",get:function(){return this._jsonModel.properties||{}},set:function(e){this._setProperty("properties",Ie({},e))}},{key:"qualifiedName",get:function(){if(this.isTransparent())return null;if(null!==this[jt])return this[jt];var e=this.getNonTransparentParent();return this[jt]=e&&"array"===e.type?e.qualifiedName+"["+this.index+"]":e.qualifiedName+"."+this.name,this[jt]}}]),e}();yt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Et.prototype,"index",null),yt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Et.prototype,"description",null),yt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Et.prototype,"visible",null),yt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Et.prototype,"label",null),yt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Et.prototype,"properties",null);var Mt=/*#__PURE__*/function(e){function t(){var t;return(t=e.call.apply(e,[this].concat([].slice.call(arguments)))||this)._events={},t._rules={},t}i(t,e);var r=t.prototype;return r.getCompiledRule=function(e,t){if(!(e in this._rules)){var n=t||this.rules[e];if(!("string"==typeof n&&n.length>0))throw new Error("only expression strings are supported. "+typeof n+" types are not supported");try{this._rules[e]=this.ruleEngine.compileRule(n)}catch(t){this.form.logger.error('Unable to compile rule `"'+e+'" : "'+n+'"` Exception : '+t)}}return this._rules[e]},r.getCompiledEvent=function(e){var t=this;if(!(e in this._events)){var n,r=null==(n=this._jsonModel.events)?void 0:n[e];"string"==typeof r&&r.length>0&&(r=[r]),void 0!==r&&r.length>0&&(this._events[e]=r.map(function(n){try{return t.ruleEngine.compileRule(n)}catch(n){t.form.logger.error('Unable to compile expression `"'+e+'" : "'+r+'"` Exception : '+n)}return null}).filter(function(e){return null!==e}))}return this._events[e]||[]},r.applyUpdates=function(e){var t=this;Object.entries(e).forEach(function(e){var n=e[0],r=e[1];if(n in _t||n in t&&"function"!=typeof t[n])try{t[n]=r}catch(e){console.error(e)}})},r.executeAllRules=function(e){var t=this,n=Object.entries(this.rules);if(n.length>0){var r=this.getExpressionScope();n.forEach(function(n){var i=n[0],o=t.getCompiledRule(i,n[1]);if(o){var a=t.ruleEngine.execute(o,r,e,!0);_t.indexOf(i)>-1?t[i]=a:t.form.logger.warn(i+" is not a valid editable property.")}})}},r.getExpressionScope=function(){var e=this.getNonTransparentParent(),t={self:this.getRuleNode(),siblings:(null==e?void 0:e.ruleNodeReference())||{}},n=new Proxy(t,{get:function(e,t){if(t===Symbol.toStringTag)return"Object";if(t.startsWith("$")){var n=e.self[t];return n instanceof Et?n.getRuleNode():n instanceof Array?n.map(function(e){return e instanceof Et?e.getRuleNode():e}):n}return t in e.siblings?e.siblings[t]:e.self[t]},has:function(e,t){return void 0!==e.self[t]||void 0!==e.siblings[t]}});return n},r.executeEvent=function(e,t){var n;t&&(n=this.ruleEngine.execute(t,this.getExpressionScope(),e)),void 0!==n&&null!=n&&this.applyUpdates(n)},r.executeRule=function(e,t){void 0===e.payload.ruleName&&this.executeAllRules(t)},r.executeExpression=function(e){var t={form:this.form,$form:this.form.getRuleNode(),$field:this.getRuleNode(),field:this},n=this.ruleEngine.compileRule(e);return this.ruleEngine.execute(n,this.getExpressionScope(),t)},r.executeAction=function(e){var t=this,n={form:this.form,$form:this.form.getRuleNode(),$field:this.getRuleNode(),field:this,$event:{type:e.type,payload:e.payload,target:this.getRuleNode()}},r=e.isCustomEvent?"custom_"+e.type:e.type;this.getCompiledEvent(e.isCustomEvent?"custom:"+e.type:e.type).forEach(function(e){return t.executeEvent(n,e)}),r in this&&"function"==typeof this[r]&&this[r](e,n),this.notifyDependents(e)},n(t,[{key:"rules",get:function(){return this._jsonModel.rules||{}}}]),t}(Et),xt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Dt=/*#__PURE__*/function(e){function t(){var t;return(t=e.call.apply(e,[this].concat([].slice.call(arguments)))||this)._children=[],t._itemTemplate=null,t._activeChild=null,t}i(t,e);var r=t.prototype;return r.ruleNodeReference=function(){return this._childrenReference},r.hasDynamicItems=function(){return null!=this._itemTemplate},r.getState=function(){return Ie({},this._jsonModel,{":type":this[":type"],items:this._children.map(function(e){return Ie({},e.getState())})})},r._addChildToRuleNode=function(e,t){var n=this,r=this,i=t.parent,o=void 0===i?this:i,a="array"==o.type?o._children.length+"":e.name||"";a.length>0&&Object.defineProperty(o._childrenReference,a,{get:function(){return e.isContainer&&e.hasDynamicItems()&&r.ruleEngine.trackDependency(e),r.hasDynamicItems()?(r.ruleEngine.trackDependency(r),void 0!==n._children[a]?n._children[a].getRuleNode():void 0):e.getRuleNode()},configurable:!0,enumerable:!0})},r._addChild=function(e,t,n){void 0===n&&(n=!1);for(var r=this;null!=r&&r.isTransparent();)r=r.parent;("number"!=typeof t||t>r._children.length)&&(t=this._children.length);var i=this.form,o=Ie({index:t},Be(e,n?function(){return i.getUniqueId()}:void 0)),a=this._createChild(o,{parent:this,index:t});return this._addChildToRuleNode(a,{parent:r}),t===this._children.length?this._children.push(a):this._children.splice(t,0,a),a},r.indexOf=function(e){return this._children.indexOf(e)},r.defaultDataModel=function(e){var t=this._jsonModel.type||void 0;if(void 0!==t)return new lt(e,"array"===t?[]:{},t)},r._initialize=function(){var t=this;e.prototype._initialize.call(this);var n=this._jsonModel.items;if(this._jsonModel.items=[],this._childrenReference="array"==this._jsonModel.type?[]:{},"array"==this._jsonModel.type&&1===n.length&&null!=this.getDataNode()){this._itemTemplate=Be(n[0]),"number"!=typeof this._jsonModel.minItems&&(this._jsonModel.minItems=0),"number"!=typeof this._jsonModel.maxItems&&(this._jsonModel.maxItems=-1),"number"!=typeof this._jsonModel.initialItems&&(this._jsonModel.initialItems=Math.max(1,this._jsonModel.minItems));for(var r=0;r<this._jsonModel.initialItems;r++)this._addChild(this._itemTemplate)._initialize()}else n.length>0&&(n.forEach(function(e){t._addChild(e)._initialize()}),this._jsonModel.minItems=this._children.length,this._jsonModel.maxItems=this._children.length,this._jsonModel.initialItems=this._children.length);this.setupRuleNode()},r.addItem=function(e){if("addItem"===e.type&&null!=this._itemTemplate&&(-1===this._jsonModel.maxItems||this._children.length<this._jsonModel.maxItems)){var t=this.getDataNode(),n=e.payload;("number"!=typeof n||n>this._children.length)&&(n=this._children.length);var r=this._addChild(this._itemTemplate,e.payload,!0),i=r.defaultDataModel(n);i&&t.$addDataNode(n,i),r._initialize(),this.notifyDependents(Ze("items",r.getState,null)),r.dispatch(new Je),r.dispatch(new Qe);for(var o=n+1;o<this._children.length;o++)this._children[o].dispatch(new Qe)}},r.removeItem=function(e){if("removeItem"===e.type&&null!=this._itemTemplate){if(0==this._children.length)return;var t="number"==typeof e.payload?e.payload:this._children.length-1,n=this._children[t].getState();if(this._children.length>this._jsonModel.minItems){this._childrenReference.pop(),this._children.splice(t,1),this.getDataNode().$removeDataNode(t);for(var r=t;r<this._children.length;r++)this._children[r].dispatch(new Qe);this.notifyDependents(Ze("items",null,n))}}},r.queueEvent=function(t){var n;e.prototype.queueEvent.call(this,t),null!=(n=t.metadata)&&n.dispatch&&this.items.forEach(function(e){e.queueEvent(t)})},r.validate=function(){return this.items.flatMap(function(e){return e.validate()}).filter(function(e){return""!==e.fieldName})},r.dispatch=function(t){e.prototype.dispatch.call(this,t)},r.importData=function(e){this._bindToDataModel(e);var t=this.getDataNode()||e;this.syncDataAndFormModel(t)},r.syncDataAndFormModel=function(e){if("array"===(null==e?void 0:e.$type)&&null!=this._itemTemplate){for(var t=null==e?void 0:e.$value.length,n=this._children.length,r=this._jsonModel.minItems,i=Math.min(t-n,(-1===this._jsonModel.maxItems?t:this._jsonModel.maxItems)-n),o=Math.min(n-t,n-r);i>0;)i--,this._addChild(this._itemTemplate)._initialize();if(o>0){this._children.splice(t,o);for(var a=0;a<o;a++)this._childrenReference.pop()}}this._children.forEach(function(t){t.importData(e)})},n(t,[{key:"items",get:function(){return this._children}},{key:"maxItems",get:function(){return this._jsonModel.maxItems},set:function(e){this._jsonModel.maxItems=e;var t=this._children.length,n=Math.min(t-e,t-(this._jsonModel.minItems||1));if(n>0){for(var r=0;r<n;r++)this.getDataNode().$removeDataNode(e+r),this._childrenReference.pop();var i=this._children.splice(e,n);this.notifyDependents(Ze("items",i,null))}}},{key:"minItems",get:function(){return this._jsonModel.minItems}},{key:"isContainer",get:function(){return!0}},{key:"activeChild",get:function(){return this._activeChild},set:function(e){if(e!==this._activeChild){for(var n=this._activeChild;n instanceof t;){var r=n.activeChild;n.activeChild=null,n=r}var i=Ze("activeChild",e,this._activeChild);this._activeChild=e,this.parent&&null!==e&&(this.parent.activeChild=this),this._jsonModel.activeChild=null==e?void 0:e.id,this.notifyDependents(i)}}}]),t}(Mt);xt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Dt.prototype,"maxItems",null),xt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Dt.prototype,"minItems",null),xt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Dt.prototype,"activeChild",null);var St=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),n(t,[{key:"version",get:function(){return this.getP("version","")}},{key:"locale",get:function(){return this.getP("locale","")}},{key:"grammar",get:function(){return this.getP("grammar","")}}]),t}(/*#__PURE__*/function(){function e(e){this._jsonModel=Ie({},e)}return e.prototype.getP=function(e,t){return function(e,t,n){if(t in e)return e[t];if(!t.startsWith(":")){var r=":"+t;if(r in e)return e[r]}return n}(this._jsonModel,e,t)},n(e,[{key:"isContainer",get:function(){return!1}}]),e}()),Ot=/*#__PURE__*/function(){function e(e){this.type="application/octet-stream",this.name="unknown",this.size=0,Object.assign(this,e)}var t=e.prototype;return t.toJSON=function(){return{name:this.name,size:this.size,type:this.type,data:this.data.toString()}},t.equals=function(e){return this.data===e.data&&this.type===e.type&&this.name===e.name&&this.size===e.size},e}(),Tt="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_".split(""),Nt=/^(\d*\.?\d+)(\\?(?=[KMGT])([KMGT])(?:i?B)?|B?)$/i,Lt=function(e){for(var t=[],n=0;n<=e;n++){var r=Math.floor(Math.random()*Tt.length);t.push(Tt[r])}return t.join("")},Pt=function e(t){var n=t.items||[];return null==n?void 0:n.reduce(function(t,n){var r=null;if(n.isContainer)r=e(n);else if($e(n.getState())){r={};var i=null!=n.dataRef?n.dataRef:(n.name||"").length>0?n.name:void 0;n.value instanceof Array?r[n.id]=n.value.map(function(e){return Ie({},e,{dataRef:i})}):null!=n.value&&(r[n.id]=Ie({},n.value,{dataRef:i}))}return Object.assign(t,r)},{})},It=function(e){var t=0;if("string"==typeof e){var n=Nt.exec(e.trim());null!=n&&(t=Ct(parseFloat(n[1]),(n[2]||"kb").toUpperCase()))}return t},Ct=function(e,t){var n=Math.pow(1024,{KB:1,MB:2,GB:3,TB:4}[t]);return Math.round(e*n)},Ft=function(e){var t=/^data:([a-z]+\/[a-z0-9-+.]+)?(?:;name=([^;]+))?(;base64)?,(.+)$/.exec(e);if(null!==t){var n=t[1]||"",r=t[2]||"unknown";if("string"==typeof t[3]){for(var i=atob(t[4]),o=[],a=0;a<i.length;a++)o.push(i.charCodeAt(a));return{name:r,blob:new window.Blob([new Uint8Array(o)],{type:n})}}return{name:r,blob:new window.Blob([t[4]],{type:n})}}return null},At=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,qt=/^data:([a-z]+\/[a-z0-9-+.]+)?;(?:name=(.*);)?base64,(.*)$/,Rt=[31,28,31,30,31,30,31,31,30,31,30,31],Vt=function(e){return null!=qt.exec(e.trim())},$t=function(e){var t=parseFloat(e),n=!isNaN(t);return n||(t=e),{value:t,valid:n}},Bt=function(e){var t=parseFloat(e),n=!isNaN(t)&&Math.round(t)===t;return n||(t=e),{value:t,valid:n}},Ht=function(e){return null==e||e instanceof Array?e:[e]},Ut=function(e){var t="boolean"==typeof e||"true"===e||"false"===e;return{valid:t,value:"boolean"==typeof e?e:t?"true"===e:e}},zt=function(e){var t=function(e){if(null!==e){var t=null;if(e instanceof Ot)t=e;else if("undefined"!=typeof File&&e instanceof File)t={name:e.name,type:e.type,size:e.size,data:e};else if("string"==typeof e&&Vt(e)){var n=Ft(e);if(null!==n){var r=n.blob;t={name:n.name,type:r.type,size:r.size,data:r}}}else{var i,o,a=e;try{t=a=JSON.parse(e)}catch(e){}if("string"==typeof(null==(i=a)?void 0:i.data)&&Vt(null==(o=a)?void 0:o.data)){var s,u=Ft(null==(s=a)?void 0:s.data);if(null!==u){var l,c,h=u.blob;t={name:null==(l=a)?void 0:l.name,type:null==(c=a)?void 0:c.type,size:h.size,data:h}}}else if("string"==typeof a)t={name:a.split("/").pop(),type:"application/octet-stream",size:0,data:a};else if("object"==typeof a){var d,f,p,v;t={name:null==(d=a)?void 0:d.name,type:null==(f=a)?void 0:f.type,size:null==(p=a)?void 0:p.size,data:null==(v=a)?void 0:v.data}}}return null!==t&&null!=t.data?new Ot(t):null}return null}(e),n=null!==t;return{value:n?t:e,valid:n}},Gt=function(e,t){var n=Ht(e);return null==n?[[],[n]]:n.reduce(function(e,n){if(0==e[1].length){var r=t(n);e[r.valid?0:1].push(r.value)}return e},[[],[]])},Wt={date:["minimum","maximum","exclusiveMinimum","exclusiveMaximum","format"],string:["minLength","maxLength","pattern"],number:["minimum","maximum","exclusiveMinimum","exclusiveMaximum"],array:["minItems","maxItems","uniqueItems"],file:["accept","maxFileSize"]},Qt={type:function(e,t){var n=t;if(null==t)return{valid:!0,value:t};var r,i=!0;switch(e){case"string":i=!0,n=t.toString();break;case"string[]":n=Ht(t);break;case"number":n=(r=$t(t)).value,i=r.valid;break;case"boolean":i=(r=Ut(t)).valid,n=r.value;break;case"integer":i=(r=Bt(t)).valid,n=r.value;break;case"integer[]":n=(i=0===(r=Gt(t,Bt))[1].length)?r[0]:t;break;case"file":i=(r=zt(t instanceof Array?t[0]:t)).valid,n=r.value;break;case"file[]":n=(i=0===(r=Gt(t,zt))[1].length)?r[0]:t;break;case"number[]":n=(i=0===(r=Gt(t,$t))[1].length)?r[0]:t;break;case"boolean[]":n=(i=0===(r=Gt(t,Ut))[1].length)?r[0]:t}return{valid:i,value:n}},format:function(e,t){var n,r,i=!0,o=t;if(null===t)return{value:o,valid:i};switch(e){case"date":if(null!=(n=At.exec((t||"").trim()))){var a=+n[2],s=+n[3],u=(r=+n[1])%400==0||r%4==0&&r%100!=0;i=a>=1&&a<=12&&s>=1&&s<=function(e,t){return e&&2==t?29:Rt[t-1]}(u,a)}else i=!1;break;case"data-url":i=!0}return{valid:i,value:o}},minimum:function(e,t){return{valid:t>=e,value:t}},maximum:function(e,t){return{valid:t<=e,value:t}},exclusiveMinimum:function(e,t){return{valid:t>e,value:t}},exclusiveMaximum:function(e,t){return{valid:t<e,value:t}},minItems:function(e,t){return{valid:t instanceof Array&&t.length>=e,value:t}},maxItems:function(e,t){return{valid:t instanceof Array&&t.length<=e,value:t}},uniqueItems:function(e,t){return{valid:!e||t instanceof Array&&t.length===new Set(t).size,value:t}},minLength:function(e,t){return Ie({},Qt.minimum(e,"string"==typeof t?t.length:0),{value:t})},maxLength:function(e,t){return Ie({},Qt.maximum(e,"string"==typeof t?t.length:0),{value:t})},pattern:function(e,t){return{valid:("string"==typeof e?new RegExp(e):e).test(t),value:t}},required:function(e,t){return{valid:!e||null!=t&&""!==t,value:t}},enum:function(e,t){return{valid:e.indexOf(t)>-1,value:t}},accept:function(e,t){return e&&0!==e.length&&null!=t?{valid:!(t instanceof Array?t:[t]).some(function(t){return!(!(n=t.type)||e.some(function(e){var t=e.trim(),r=t.split("/")[0],i=t.split(".")[1];return t.includes("*")&&n.startsWith(r)||t.includes(".")&&n.endsWith(i)||t===n}));var n}),value:t}:{valid:!0,value:t}},maxFileSize:function(e,t){var n="string"==typeof e?It(e):e;return{valid:!(t instanceof Ot)||t.size<=n,value:t}}},Zt=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Jt=/*#__PURE__*/function(e){function t(t,n){var r;return(r=e.call(this,t,n)||this)._ruleNodeReference=[],r._applyDefaults(),r.queueEvent(new Je),r.queueEvent(new Qe),r}i(t,e);var r=t.prototype;return r._initialize=function(){e.prototype._initialize.call(this),this.setupRuleNode()},r.ruleNodeReference=function(){var e;return this._ruleNodeReference=null!=(e=this.type)&&e.endsWith("[]")?[]:this,this._ruleNodeReference},r._getDefaults=function(){return{readOnly:!1,enabled:!0,visible:!0,type:this._getFallbackType()}},r._getFallbackType=function(){if("string"!=typeof this._jsonModel.type){var e=this.enum;return e&&e.length>0?typeof e[0]:"string"}},r._applyDefaults=function(){var e=this;if(Object.entries(this._getDefaults()).map(function(t){var n=t[0],r=t[1];void 0===e._jsonModel[n]&&void 0!==r&&(e._jsonModel[n]=r)}),void 0===this._jsonModel.value){var t=Qt.type(this.getInternalType()||"string",this._jsonModel.default);this._jsonModel.value=t.value}void 0===this._jsonModel.fieldType&&(this._jsonModel.viewType?(this._jsonModel.viewType.startsWith("custom:")?this.form.logger.error("viewType property has been removed. For custom types, use :type property"):this.form.logger.error("viewType property has been removed. Use fieldType property"),this._jsonModel.fieldType=this._jsonModel.viewType):this._jsonModel.fieldType=Ve(this._jsonModel)),void 0===this._jsonModel.enum&&"boolean"===this._jsonModel.type&&(this._jsonModel.enum=[!0,!1]),"number"==typeof this._jsonModel.step&&"number"===this._jsonModel.type||(this._jsonModel.step=void 0)},r.isEmpty=function(){return null==this._jsonModel.value||""===this._jsonModel.value},r.getDataNodeValue=function(e){return this.isEmpty()?this.emptyValue:e},r._updateRuleNodeReference=function(e){var t,n=this;if(null!=(t=this.type)&&t.endsWith("[]"))if(null!=e)for(e.forEach(function(e,t){n._ruleNodeReference[t]=e});e.length!==this._ruleNodeReference.length;)this._ruleNodeReference.pop();else for(;0!==this._ruleNodeReference.length;)this._ruleNodeReference.pop()},r.getInternalType=function(){return this.type},r.valueOf=function(){var e=this[kt],t=void 0===e?this:e;return t.ruleEngine.trackDependency(t),t._jsonModel.value||null},r.toString=function(){var e,t=this[kt];return(null==(e=(void 0===t?this:t)._jsonModel.value)?void 0:e.toString())||""},r.getErrorMessage=function(e){var t;return(null==(t=this._jsonModel.constraintMessages)?void 0:t[e])||""},r._getConstraintObject=function(){return Qt},r.isArrayType=function(){return!!this.type&&this.type.indexOf("[]")>-1},r.checkEnum=function(e,t){var n=this;if(!0===this._jsonModel.enforceEnum&&null!=e){var r=t.enum;return e instanceof Array&&this.isArrayType()?e.every(function(e){return r(n.enum||[],e).valid}):r(this.enum||[],e).valid}return!0},r.checkStep=function(){return"number"!=typeof this._jsonModel.step||(this._jsonModel.value-(this._jsonModel.minimum||this._jsonModel.default||0))%this._jsonModel.step==0},r.checkValidationExpression=function(){return"string"!=typeof this._jsonModel.validationExpression||this.executeExpression(this._jsonModel.validationExpression)},r.getConstraints=function(){switch(this.type){case"string":switch(this.format){case"date":return Wt.date;case"binary":case"data-url":return Wt.file;default:return Wt.string}case"file":return Wt.file;case"number":case"integer":return Wt.number}return this.isArrayType()?Wt.array:[]},r.evaluateConstraints=function(){var e=this,t="type",n=this._jsonModel,r=this._jsonModel.value,i=this._getConstraintObject(),o=this.getConstraints(),a=!0;if(a&&(a=i.required(this.required,r).valid&&(!this.isArrayType()||!this.required||r.length>0),t="required"),a&&r!=this.emptyValue){var s=o.find(function(t){if(t in n){var o=n[t],a=i[t];return r instanceof Array&&e.isArrayType()?-1!==Wt.array.indexOf(t)?!a(o,r).valid:r.some(function(e){return!a(o,e).valid}):"function"==typeof a&&!a(o,r).valid}return!1});null!=s?(a=!1,t=s):(t="enum",(a=this.checkEnum(r,i))&&"number"===this.type&&(a=this.checkStep(),t="step"),a&&(a=this.checkValidationExpression(),t="validationExpression"))}a||this.form.logger.log(t+" constraint evaluation failed "+this[t]+". Received "+this._jsonModel.value);var u={valid:a,errorMessage:a?"":this.getErrorMessage(t)};return this._applyUpdates(["valid","errorMessage"],u)},r.triggerValidationEvent=function(e){e.valid&&this.dispatch(this.valid?new We:new Ge)},r.validate=function(){var e=this.evaluateConstraints();return e.valid&&(this.triggerValidationEvent(e),this.notifyDependents(new ze({changes:Object.values(e)}))),this.valid?[]:[new Ce(this.id,[this._jsonModel.errorMessage])]},r.importData=function(e){this._bindToDataModel(e);var t=this.getDataNode();if(void 0!==t&&t!==ut&&t.$value!==this._jsonModel.value){var n=Ze("value",t.$value,this._jsonModel.value);this._jsonModel.value=t.$value,this.queueEvent(n)}},r.defaultDataModel=function(e){return new at(e,this.getDataNodeValue(this._jsonModel.value),this.type||"string")},r.getState=function(){return Ie({},e.prototype.getState.call(this),{editValue:this.editValue,displayValue:this.displayValue})},n(t,[{key:"editFormat",get:function(){return this._jsonModel.editFormat}},{key:"displayFormat",get:function(){return this._jsonModel.displayFormat}},{key:"placeholder",get:function(){return this._jsonModel.placeholder}},{key:"readOnly",get:function(){return this._jsonModel.readOnly},set:function(e){this._setProperty("readOnly",e)}},{key:"language",get:function(){return Intl.DateTimeFormat().resolvedOptions().locale}},{key:"enabled",get:function(){return this._jsonModel.enabled},set:function(e){this._setProperty("enabled",e)}},{key:"valid",get:function(){return this._jsonModel.valid}},{key:"emptyValue",get:function(){return"null"===this._jsonModel.emptyValue?null:""===this._jsonModel.emptyValue&&"string"===this.type?"":void 0}},{key:"enum",get:function(){return this._jsonModel.enum},set:function(e){this._setProperty("enum",e)}},{key:"enumNames",get:function(){return this._jsonModel.enumNames},set:function(e){this._setProperty("enumNames",e)}},{key:"required",get:function(){return this._jsonModel.required||!1},set:function(e){this._setProperty("required",e)}},{key:"maximum",get:function(){return this._jsonModel.maximum},set:function(e){this._setProperty("maximum",e)}},{key:"minimum",get:function(){return this._jsonModel.minimum},set:function(e){this._setProperty("minimum",e)}},{key:"editValue",get:function(){var e=this.editFormat;return"date"==this.format&&null!=this.value&&!1!==this.valid?k.formatDate(new Date(this.value),this.language,e):this.value}},{key:"displayValue",get:function(){var e=this.displayFormat;return"date"==this.format&&null!=this.value&&!1!==this.valid?k.formatDate(new Date(this.value),this.language,e):this.value}},{key:"value",get:function(){return void 0===this._jsonModel.value?null:this._jsonModel.value},set:function(e){var t=this._getConstraintObject(),n=t.type(this.getInternalType()||"string",e),r=this._setProperty("value",n.value,!1),i={valid:!0};if(r.length>0){this._updateRuleNodeReference(n.value);var o,a=this.getDataNode();if(void 0!==a&&a.setValue(this.getDataNodeValue(this._jsonModel.value),this._jsonModel.value,this),this.parent.uniqueItems&&"array"===this.parent.type&&(i=t.uniqueItems(this.parent.uniqueItems,this.parent.getDataNode().$value)),n.valid&&i.valid)o=this.evaluateConstraints();else{var s={valid:n.valid&&i.valid,errorMessage:n.valid&&i.valid?"":this.getErrorMessage("type")};o=this._applyUpdates(["valid","errorMessage"],s)}o.valid&&this.triggerValidationEvent(o);var u=new ze({changes:r.concat(Object.values(o))});this.dispatch(u)}}},{key:"format",get:function(){return this._jsonModel.format||""}}]),t}(Mt);function Yt(e,t){return e.replace(";base64",";name="+encodeURIComponent(t)+";base64")}Zt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Jt.prototype,"readOnly",null),Zt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Jt.prototype,"enabled",null),Zt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Jt.prototype,"valid",null),Zt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Jt.prototype,"enum",null),Zt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Jt.prototype,"enumNames",null),Zt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Jt.prototype,"required",null),Zt([function(e,t,n){var r=n.get;null!=r&&(n.get=function(){return this.ruleEngine.trackDependency(this),r.call(this)})}],Jt.prototype,"value",null);var Kt=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var r=t.prototype;return r._getDefaults=function(){return Ie({},e.prototype._getDefaults.call(this),{accept:["audio/*","video/*","image/*","text/*","application/pdf"],maxFileSize:"2MB",type:"file"})},r._applyUpdates=function(e,t){var n=this;return e.reduce(function(e,r){var i=n._jsonModel[r],o=t[r];return o!==i&&(e[r]={propertyName:r,currentValue:o,prevValue:i},n._jsonModel[r]=i instanceof Ot&&"object"==typeof o&&"value"===r?new Ot(Ie({},i,{data:o.data})):o),e},{})},r.getInternalType=function(){var e;return null!=(e=this.type)&&e.endsWith("[]")?"file[]":"file"},r.getDataNodeValue=function(e){var t,n=e;return null!=n&&("string"===this.type?n=null==(t=n.data)?void 0:t.toString():"string[]"===this.type&&(n=(n=n instanceof Array?n:[n]).map(function(e){var t;return null==e||null==(t=e.data)?void 0:t.toString()}))),n},r._serialize=function(){try{var e=this._jsonModel.value;return Promise.resolve(void 0===e?null:Promise.all([].map.call(e instanceof Array?e:[e],Pe)))}catch(e){return Promise.reject(e)}},r.importData=function(e){this._bindToDataModel(e);var t=this.getDataNode();if(void 0!==t){var n=null==t?void 0:t.$value;if(null!=n){var r=Qt.type(this.getInternalType(),n);r.valid||this.form.logger.error("unable to bind "+this.name+" to data"),this.form.getEventQueue().queue(this,Ze("value",r.value,this._jsonModel.value)),this._jsonModel.value=r.value}else this._jsonModel.value=null}},n(t,[{key:"maxFileSize",get:function(){return It(this._jsonModel.maxFileSize)}},{key:"accept",get:function(){return this._jsonModel.accept}}]),t}(Jt),Xt=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var r=t.prototype;return r.offValue=function(){var e=this.enum;return e.length>1?e[1]:null},r._getConstraintObject=function(){var t,n=Ie({},e.prototype._getConstraintObject.call(this));return n.required=(t=this.offValue(),function(e,n){return{valid:Qt.required(e,n).valid&&(!e||n!=t),value:n}}),n},r._getDefaults=function(){return Ie({},e.prototype._getDefaults.call(this),{enforceEnum:!0})},n(t,[{key:"enum",get:function(){return this._jsonModel.enum||[]}}]),t}(Jt),en=/*#__PURE__*/function(e){function t(t,n){return e.call(this,t,n)||this}i(t,e);var n=t.prototype;return n._getFallbackType=function(){var t=e.prototype._getFallbackType.call(this);if("string"==typeof t)return t+"[]"},n._getDefaults=function(){return Ie({},e.prototype._getDefaults.call(this),{enforceEnum:!0,enum:[]})},t}(Jt),tn=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t.prototype._applyDefaults=function(){e.prototype._applyDefaults.call(this);var t=(new Intl.DateTimeFormat).resolvedOptions().locale;this._jsonModel.editFormat||(this._jsonModel.editFormat="short"),this._jsonModel.displayFormat||(this._jsonModel.displayFormat=this._jsonModel.editFormat),this._jsonModel.placeholder||(this._jsonModel.placeholder=k.getSkeleton(this._jsonModel.editFormat,t)),this._jsonModel.description||(this._jsonModel.description="To enter today's date use "+k.formatDate(new Date,t,this._jsonModel.editFormat))},t}(Jt),nn=function(e,t){var n,r;return n="items"in e?new on(e,t):$e(e)||"file-input"===e.fieldType?new Kt(e,t):"checkbox"===((null==(r=e)?void 0:r.fieldType)||Ve(r))?new Xt(e,t):function(e){return"checkbox-group"===((null==e?void 0:e.fieldType)||Ve(e))}(e)?new en(e,t):function(e){var t=(null==e?void 0:e.fieldType)||Ve(e);return"text-input"===t&&"date"===(null==e?void 0:e.format)||"date-input"===t}(e)?new tn(e,t):new Jt(e,t),t.form.fieldAdded(n),n},rn={visible:!0},on=/*#__PURE__*/function(e){function t(t,n){var r;return(r=e.call(this,t,n)||this)._applyDefaults(),r.queueEvent(new Je),r.queueEvent(new Qe),r}i(t,e);var r=t.prototype;return r._applyDefaults=function(){var e=this;Object.entries(rn).map(function(t){var n=t[0];void 0===e._jsonModel[n]&&(e._jsonModel[n]=t[1])}),this._jsonModel.dataRef&&void 0===this._jsonModel.type&&(this._jsonModel.type="object")},r._createChild=function(e,t){var n=t.parent;return nn(e,{form:this.form,parent:void 0===n?this:n})},n(t,[{key:"type",get:function(){var t=e.prototype.type;if("array"===t||"object"===t)return t}},{key:"items",get:function(){return e.prototype.items}},{key:"value",get:function(){return null}},{key:"fieldType",get:function(){return"panel"}},{key:"enabled",get:function(){return this._jsonModel.enabled},set:function(e){this._setProperty("enabled",e)}}]),t}(Dt),an={off:0,debug:1,info:2,warn:3,error:4},sn=/*#__PURE__*/function(){var e=t.prototype;function t(e){void 0===e&&(e="off"),this.logLevel=an[e]}return e.debug=function(e){this.log(e,"debug")},e.info=function(e){this.log(e,"info")},e.warn=function(e){this.log(e,"warn")},e.error=function(e){this.log(e,"error")},e.log=function(e,t){0!==this.logLevel&&this.logLevel<=an[t]&&console[t](e)},t}(),un=/*#__PURE__*/function(){function e(e,t){this._node=e,this._event=t}var t=e.prototype;return t.isEqual=function(e){return null!=e&&this._node==e._node&&this._event.type==e._event.type},t.toString=function(){return this._node.id+"__"+this.event.type},t.valueOf=function(){return this.toString()},n(e,[{key:"node",get:function(){return this._node}},{key:"event",get:function(){return this._event}}]),e}(),ln=/*#__PURE__*/function(){function e(e){void 0===e&&(e=new sn("off")),this._isProcessing=!1,this._pendingEvents=[],this.logger=e,this._runningEventCount={}}var t=e.prototype;return t.isQueued=function(e,t){var n=new un(e,t);return void 0!==this._pendingEvents.find(function(e){return n.isEqual(e)})},t.queue=function(t,n,r){var i=this;void 0===r&&(r=!1),t&&n&&(n instanceof Array||(n=[n]),n.forEach(function(n){var o=new un(t,n),a=i._runningEventCount[o.valueOf()]||0;a<e.MAX_EVENT_CYCLE_COUNT?(i.logger.info("Queued event : "+n.type+" node: "+t.id+" - "+t.name),r?i._pendingEvents.splice(i._isProcessing?1:0,0,o):i._pendingEvents.push(o),i._runningEventCount[o.valueOf()]=a+1):i.logger.info("Skipped queueing event : "+n.type+" node: "+t.id+" - "+t.name+" with count="+a)}))},t.runPendingQueue=function(){if(!this._isProcessing){for(this._isProcessing=!0;this._pendingEvents.length>0;){var e=this._pendingEvents[0];this.logger.info("Dequeued event : "+e.event.type+" node: "+e.node.id+" - "+e.node.name),e.node.executeAction(e.event),this._pendingEvents.shift()}this._runningEventCount={},this._isProcessing=!1}},n(e,[{key:"length",get:function(){return this._pendingEvents.length}},{key:"isProcessing",get:function(){return this._isProcessing}}]),e}();ln.MAX_EVENT_CYCLE_COUNT=10;var cn={method:"GET"},hn=function(e){var t=e;return t.length>0&&t.startsWith("custom:")?t.substring("custom:".length):t},dn=function(e,t,n,r,i,o,a){try{var s,u,l,c=function(t){if(s)return t;var n=hn(i);e.form.dispatch(new rt(n,u,!0))},h=t,d={method:n},f=function(e,t){try{var n=e()}catch(e){return t()}return n&&n.then?n.then(void 0,t):n}(function(){if(r&&r instanceof Ot&&r.data instanceof File){var e=new FormData;e.append(r.name,r.data),l=e}else if(r instanceof FormData)l=r;else if(r&&"object"==typeof r&&Object.keys(r).length>0){var t,n=Object.keys(a);d.headers=n.length>0?Ie({},a,-1===n.indexOf("Content-Type")?{"Content-Type":"application/json"}:{}):{"Content-Type":"application/json"};var i=(null==d||null==(t=d.headers)?void 0:t["Content-Type"])||"application/json";"application/json"===i?l=JSON.stringify(r):i.indexOf("multipart/form-data")>-1?l=pn(r):i.indexOf("application/x-www-form-urlencoded")>-1&&(l=fn(r))}return Promise.resolve(function(e,t,n){void 0===t&&(t=null),void 0===n&&(n={});var r=Ie({},cn,n);return fetch(e,Ie({},r,{body:t})).then(function(e){var t;if(!e.ok)throw new Error(e.statusText);return null!=e&&null!=(t=e.headers.get("Content-Type"))&&t.includes("application/json")?e.json():e.text()})}(h,l,d)).then(function(e){u=e})},function(){e.form.logger.error("Error invoking a rest API");var t=hn(o);e.form.dispatch(new rt(t,{},!0)),s=1});return Promise.resolve(f&&f.then?f.then(c):c(f))}catch(e){return Promise.reject(e)}},fn=function(e){var t=new URLSearchParams;return Object.entries(e).forEach(function(e){var n=e[1];t.append(e[0],null!=n&&"object"==typeof n?He(n):n)}),t},pn=function(e,t){var n=new FormData;Object.entries(e).forEach(function(e){var t=e[1];n.append(e[0],null!=t&&"object"==typeof t?He(t):t)});var r=function(e,t){if((null==e?void 0:e.data)instanceof File){var n=(null==e?void 0:e.dataRef)+"/"+(null==e?void 0:e.name);n.startsWith("/")||(n="/"+n),t.append(n,e.data)}};return t&&Object.keys(t).reduce(function(e,i){var o=t[i];return[].concat(e,o&&o instanceof Array?o.map(function(e){return r(e,n)}):[r(o,n)])},[]),n},vn=/*#__PURE__*/function(){function e(){this.customFunctions={}}var t=e.prototype;return t.registerFunctions=function(e){var t=this;Object.entries(e).forEach(function(e){var n=e[0],r=e[1],i=r;"function"==typeof r&&(i={_func:function(e){return r.apply(void 0,e)},_signature:[]}),i.hasOwnProperty("_func")?t.customFunctions[n]=i:console.warn("Unable to register function with name "+n+".")})},t.unregisterFunctions=function(){var e=this;[].slice.call(arguments).forEach(function(t){t in e.customFunctions&&delete e.customFunctions[t]})},t.getFunctions=function(){function e(t){return null==t?t:null!==(n=t)&&"[object Array]"===Object.prototype.toString.call(n)?t.map(function(t){return e(t)}):t.valueOf();var n}function t(e){return null==e?"":e.toString()}return Ie({},{validate:{_func:function(e,t,n){var r,i=e[0];return r="string"==typeof i||void 0===i?n.globals.form.validate():n.globals.form.getElement(i.$id).validate(),Array.isArray(r)&&r.length&&n.globals.form.logger.error("Form Validation Error"),r},_signature:[]},setFocus:{_func:function(e,t,n){var r=e[0];try{var i=n.globals.form.getElement(r.$id);n.globals.form.setFocus(i)}catch(e){n.globals.form.logger.error("Invalid argument passed in setFocus. An element is expected")}},_signature:[]},getData:{_func:function(e,t,n){return n.globals.form.logger.warn("The `getData` function is depricated. Use `exportData` instead."),n.globals.form.exportData()},_signature:[]},exportData:{_func:function(e,t,n){return n.globals.form.exportData()},_signature:[]},importData:{_func:function(e,t,n){var r=e[0];return"object"==typeof r&&null!==r&&n.globals.form.importData(r),{}},_signature:[]},submitForm:{_func:function(n,r,i){var o=t(n[0]),a=t(n[1]),s=n.length>2?t(n[2]):"multipart/form-data",u=n.length>3?e(n[3]):null;return i.globals.form.dispatch(new tt({success:o,error:a,submit_as:s,data:u})),{}},_signature:[]},request:{_func:function(n,r,i){var o,a,s=t(n[0]),u=t(n[1]),l=e(n[2]),c={};return"string"==typeof n[3]?(i.globals.form.logger.warn("This usage of request is deprecated. Please see the documentation and update"),o=e(n[3]),a=e(n[4])):(c=e(n[3]),o=e(n[4]),a=e(n[5])),dn(i.globals,s,u,l,o,a,c),{}},_signature:[]},dispatchEvent:{_func:function(t,n,r){var i,o=t[0],a=e(t[1]),s=t.length>2?e(t[2]):void 0,u=!1;return"string"==typeof o&&(s=a,a=o,u=!0),i=a.startsWith("custom:")?new rt(a.substring("custom:".length),s,u):function(e,t){switch(void 0===t&&(t={}),e){case"change":return new ze(t);case"submit":return new tt(t);case"click":return new Ke(t);case"addItem":return new it(t);case"removeItem":return new ot(t);default:console.error("invalid action")}}(a,s),null!=i&&("string"==typeof o?r.globals.form.dispatch(i):r.globals.form.getElement(o.$id).dispatch(i)),{}},_signature:[]}},this.customFunctions)},e}(),gn=new vn,mn=/*#__PURE__*/function(t){function r(n,r,i,o){var a,s;return void 0===i&&(i=new ln),void 0===o&&(o="off"),(a=t.call(this,n,{})||this)._fields={},a._invalidFields=[],a.dataRefRegex=/("[^"]+?"|[^.]+?)(?:\.|$)/g,a._ruleEngine=r,a._eventQueue=i,a._logger=new sn(o),a.queueEvent(new Je),a.queueEvent(new Qe),a._ids=(void 0===s&&(s=50),/*#__PURE__*/e().mark(function t(){var n,r,i,o;return e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=function(){for(var e=[],t=0;t<s;t++)e.push(Lt(10));return e},r={},i=n();case 3:for(o=i.pop();o in r;)0===i.length&&(i=n()),o=i.pop();return r[o]=!0,e.next=8,i.pop();case 8:0===i.length&&(i=n());case 9:if(i.length>0){e.next=3;break}case 10:case"end":return e.stop()}},t)})()),a._bindToDataModel(new lt("$form",{})),a._initialize(),a.queueEvent(new Ye),a}i(r,t);var o=r.prototype;return o._createChild=function(e){return nn(e,{form:this,parent:this})},o.importData=function(e){this._bindToDataModel(new lt("$form",e)),this.syncDataAndFormModel(this.getDataNode()),this._eventQueue.runPendingQueue()},o.exportData=function(){var e;return null==(e=this.getDataNode())?void 0:e.$value},o.setFocus=function(e){for(var t=e.parent,n=e;null!=t&&t.activeChild!=n;)t.activeChild=n},o.getState=function(){var e=this,n=t.prototype.getState.call(this);return n.id="$form",Object.defineProperty(n,"data",{get:function(){return e.exportData()}}),Object.defineProperty(n,"attachments",{get:function(){return Pt(e)}}),n},o.isTransparent=function(){return!1},o.getUniqueId=function(){return null==this._ids?"":this._ids.next().value},o.fieldAdded=function(e){var t=this;this._fields[e.id]=e,e.subscribe(function(e){-1===t._invalidFields.indexOf(e.target.id)&&t._invalidFields.push(e.target.id)},"invalid"),e.subscribe(function(e){var n=t._invalidFields.indexOf(e.target.id);n>-1&&t._invalidFields.splice(n,1)},"valid"),e.subscribe(function(e){var n=e.target.getState();if(n){var r=new nt(e.payload.changes,n);t.dispatch(r)}})},o.validate=function(){var e=t.prototype.validate.call(this);return this.dispatch(new et(e)),e},o.isValid=function(){return 0===this._invalidFields.length},o.dispatch=function(e){"submit"===e.type?(t.prototype.queueEvent.call(this,e),this._eventQueue.runPendingQueue()):t.prototype.dispatch.call(this,e)},o.executeAction=function(e){"submit"===e.type&&0!==this._invalidFields.length||t.prototype.executeAction.call(this,e)},o.submit=function(e,t){if(0===this.validate().length){var n=(null==e?void 0:e.payload)||{};!function(e,t,n,r,i){void 0===r&&(r="multipart/form-data"),void 0===i&&(i=null);try{var o=e.form.action,a=i;"object"==typeof a&&null!=a||(a=e.form.exportData());var s,u=Pt(e.form),l=r;Object.keys(u).length>0||"multipart/form-data"===r?(s=pn({data:a},u),l="multipart/form-data"):s={data:a},Promise.resolve(dn(e,o,"POST",s,t,n,{"Content-Type":l})).then(function(){})}catch(e){return Promise.reject(e)}}(t,null==n?void 0:n.success,null==n?void 0:n.error,null==n?void 0:n.submit_as,null==n?void 0:n.data)}},o.getElement=function(e){return e==this.id?this:this._fields[e]},o.getEventQueue=function(){return this._eventQueue},n(r,[{key:"logger",get:function(){return this._logger}},{key:"metaData",get:function(){return new St(this._jsonModel.metadata||{})}},{key:"action",get:function(){return this._jsonModel.action}},{key:"type",get:function(){return"object"}},{key:"form",get:function(){return this}},{key:"ruleEngine",get:function(){return this._ruleEngine}},{key:"qualifiedName",get:function(){return"$form"}},{key:"name",get:function(){return"$form"}},{key:"value",get:function(){return null}},{key:"id",get:function(){return"$form"}},{key:"title",get:function(){return this._jsonModel.title||""}}]),r}(Dt),yn=/*#__PURE__*/function(){function e(){this._globalNames=["$form","$field","$event"]}var t=e.prototype;return t.compileRule=function(e){var t=gn.getFunctions();return new Le(e,t,void 0,this._globalNames)},t.execute=function(e,t,n,r){void 0===r&&(r=!1);var i=this._context;this._context=n;var o=void 0;try{e.debug=[],o=e.search(t,n)}catch(e){var s,u,l;null==(s=this._context)||null==(u=s.form)||null==(l=u.logger)||l.error(e)}for(var c,h=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e.debug);!(c=h()).done;){var d,f,p;null==(d=this._context)||null==(f=d.form)||null==(p=f.logger)||p.debug(c.value)}var v=o;return r&&"object"==typeof o&&null!==o&&(v=Object.getPrototypeOf(o).valueOf.call(o)),this._context=i,v},t.trackDependency=function(e){this._context&&void 0!==this._context.field&&this._context.field!==e&&e._addDependent(this._context.field)},e}();console.timeEnd("script af-core");var _n=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t.prototype.getInputHTML=function(){return'<textarea\n              title="'+(this.isTooltipVisible()?this.getTooltipValue():"")+'"\n              aria-label="'+(this.isLabelVisible()?this.getLabelValue():"")+'"\n              class="cmp-adaptiveform-textinput__widget"\n              name="'+this.getName()+'"\n              '+this.getDisabledHTML()+"\n              "+this.getReadonlyHTML()+'\n              required="'+this.isRequired()+'"\n              placeholder="'+this.getPlaceHolder()+'"\n              minlength="'+this.getMinLength()+'"\n              maxlength="'+this.getMaxLength()+'"></textarea>'},t}(d),bn=/*#__PURE__*/u("checkIfEqual"),wn=/*#__PURE__*/function(e){function t(n,r){var i;return i=e.call(this,n,r)||this,Object.defineProperty(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),bn,{writable:!0,value:function(e,t,n){if(n){var r=!1;return e.forEach(function(e){String(e)===t&&(r=!0)}),r}return String(e)===t}}),i.qm=i.element.querySelector(t.selectors.qm),i}i(t,e);var n=t.prototype;return n.getWidget=function(){return this.element.querySelector(t.selectors.widget)},n.getDescription=function(){return this.element.querySelector(t.selectors.description)},n.getLabel=function(){return this.element.querySelector(t.selectors.label)},n.getErrorDiv=function(){return this.element.querySelector(t.selectors.errorDiv)},n.getQuestionMarkDiv=function(){return this.element.querySelector(t.selectors.qm)},n.getTooltipDiv=function(){return this.element.querySelector(t.selectors.tooltipDiv)},n._updateValue=function(e){var t=this,n=this._model.isArrayType();this.widget&&[this.widget].forEach(function(r){l(t,bn)[bn](e,r.value,n)?r.setAttribute("selected","selected"):r.removeAttribute("selected")})},n.addListener=function(){var e,t=this;null==(e=this.getWidget())||e.addEventListener("blur",function(e){if(t._model.isArrayType()){var n=[];[t.widget].forEach(function(e){e.selected&&n.push(e.value)}),t._model.value=n}else t._model.value=e.target.value})},n.getbemBlock=function(){return t.bemBlock},n.getIS=function(){return t.IS},n.getInputHTML=function(){var e,t,n=this;return'<select class="cmp-adaptiveform-dropdown__widget"\n                    aria-label="'+(this.isLabelVisible()?this.getLabelValue():"")+'"\n                    title="'+(this.isTooltipVisible()?this.getTooltipValue():"")+'"\n                    name="'+this.getName()+'"\n                    '+this.getDisabledHTML()+"\n                    "+this.getReadonlyHTML()+"\n                    "+this.getMultipleHTML()+'\n                    required="'+this.isRequired()+'">\n                '+(this.getPlaceHolder()?'<option  value="" disabled selected>'+this.getPlaceHolder()+"</option>":"")+"\n                \n                "+(null==(e=this.getState())||null==(t=e.enumNames)?void 0:t.map(function(e,t){var r;return n.getOptionsHTML(null==(r=n.getState())?void 0:r.enum[t],e,n.getDefault())}).join(""))+"\n            </select>"},n.getOptionsHTML=function(e,t,n){return'\n            <option value="'+e+'" class="cmp-adaptiveform-dropdown__option"\n                selected="'+(e==n?"selected":"")+'">'+t+"</option>\n            "},n.getMultipleHTML=function(){return(this.getState().isMultiSelect?"multiple: multiple":"")+'"'},t}(h);wn.NS="cmp",wn.IS="adaptiveFormDropDown",wn.bemBlock="cmp-adaptiveform-dropdown",wn.selectors={self:"[data-"+wn.NS+'-is="'+wn.IS+'"]',widget:"."+wn.bemBlock+"__widget",options:"."+wn.bemBlock+"__option",label:"."+wn.bemBlock+"__label",description:"."+wn.bemBlock+"__longdescription",qm:"."+wn.bemBlock+"__questionmark",errorDiv:"."+wn.bemBlock+"__errormessage",tooltipDiv:"."+wn.bemBlock+"__shortdescription"};var kn={Click:Ke,Change:ze,Submit:tt,Blur:Xe,AddItem:it,RemoveItem:ot},jn=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.getQuestionMarkDiv=function(){return null},n.getLabel=function(){return null},n.getWidget=function(){return this.element.querySelector(".cmp-button")},n.getDescription=function(){return null},n.getErrorDiv=function(){return null},n.getTooltipDiv=function(){return null},n.addListener=function(){var e,t=this;null==(e=this.getWidget())||e.addEventListener("click",function(){t._model.dispatch(new kn.Click)})},n.getbemBlock=function(){return t.bemBlock},n.getIS=function(){return t.IS},n.getHTML=function(){return'<button \n            type="button"\n            id="'+this.getId()+'"\n            class="cmp-button"\n            '+this.getDisabledHTML()+"\n            "+this.getReadonlyHTML()+'\n            title="'+this.getTooltipValue+'"\n            data-cmp-visible="'+this.isVisible()+'"\n            data-cmp-enabled="'+this.isEnabled()+'"\n            data-cmp-is="adaptiveFormButton"\n            aria-label="'+this.getLabelValue()+'"\n            data-cmp-adaptiveformcontainer-path="'+this.getFormContainerPath()+'">\n            <span class="cmp-button__text">'+this.getLabelValue()+"</span>\n        </button>"},t}(h);jn.NS="cmp",jn.IS="adaptiveFormButton",jn.bemBlock="cmp-adaptiveform-button",jn.selectors={self:"[data-"+jn.NS+'-is="'+jn.IS+'"]'};var En=/*#__PURE__*/u("widget"),Mn=/*#__PURE__*/u("model"),xn=/*#__PURE__*/u("options"),Dn=/*#__PURE__*/u("defaultOptions"),Sn=/*#__PURE__*/u("matchArray"),On=/*#__PURE__*/u("regex"),Tn=/*#__PURE__*/u("processedValue"),Nn=/*#__PURE__*/u("engRegex"),Ln=/*#__PURE__*/u("writtenInLocale"),Pn=/*#__PURE__*/u("previousCompositionVal"),In=/*#__PURE__*/u("toLatinForm"),Cn=/*#__PURE__*/u("attachEventHandlers"),Fn=/*#__PURE__*/u("attachCompositionEventHandlers"),An=/*#__PURE__*/u("getDigits"),qn=/*#__PURE__*/u("escape"),Rn=/*#__PURE__*/u("compositionUpdateCallback"),Vn=/*#__PURE__*/u("handleKeyInput"),$n=/*#__PURE__*/u("handleKeyDown"),Bn=/*#__PURE__*/u("isValidChar"),Hn=/*#__PURE__*/u("handleKeyPress"),Un=/*#__PURE__*/u("handlePaste"),zn=/*#__PURE__*/u("handleCut"),Gn=/*#__PURE__*/u("convertValueToLocale"),Wn=/*#__PURE__*/u("convertValueFromLocale"),Qn=/*#__PURE__*/u("isValueSame"),Zn=/*#__PURE__*/function(){function e(e,t){if(Object.defineProperty(this,Qn,{value:cr}),Object.defineProperty(this,Wn,{value:lr}),Object.defineProperty(this,Gn,{value:ur}),Object.defineProperty(this,zn,{value:sr}),Object.defineProperty(this,Un,{value:ar}),Object.defineProperty(this,Hn,{value:or}),Object.defineProperty(this,Bn,{value:ir}),Object.defineProperty(this,$n,{value:rr}),Object.defineProperty(this,Vn,{value:nr}),Object.defineProperty(this,Rn,{value:tr}),Object.defineProperty(this,qn,{value:er}),Object.defineProperty(this,An,{value:Xn}),Object.defineProperty(this,Fn,{value:Kn}),Object.defineProperty(this,Cn,{value:Yn}),Object.defineProperty(this,In,{value:Jn}),Object.defineProperty(this,En,{writable:!0,value:null}),Object.defineProperty(this,Mn,{writable:!0,value:null}),Object.defineProperty(this,xn,{writable:!0,value:null}),Object.defineProperty(this,Dn,{writable:!0,value:{value:null,curValue:null,pos:0,lengthLimitVisible:!0,zero:"0",decimal:".",minus:"-"}}),Object.defineProperty(this,Sn,{writable:!0,value:{integer:"^[+-]?{digits}*$",decimal:"^[+-]?{digits}{leading}({decimal}{digits}{fraction})?$",float:"^[+-]?{digits}*({decimal}{digits}*)?$"}}),Object.defineProperty(this,On,{writable:!0,value:null}),Object.defineProperty(this,Tn,{writable:!0,value:null}),Object.defineProperty(this,Nn,{writable:!0,value:null}),Object.defineProperty(this,Ln,{writable:!0,value:!1}),Object.defineProperty(this,Pn,{writable:!0,value:""}),l(this,En)[En]=e,l(this,Mn)[Mn]=t,l(this,xn)[xn]=Object.assign({},l(this,Dn)[Dn],l(this,Mn)[Mn]._jsonModel),l(this,Sn)[Sn][l(this,xn)[xn].dataType]){var n=l(this,xn)[xn].leadDigits,r=l(this,xn)[xn].fracDigits,i=r&&-1!==r?"{0,"+r+"}":"*",o=o.replace("{leading}",n&&-1!==n?"{0,"+n+"}":"*").replace("{fraction}",i),a=o.replace(/{digits}/g,l(this,An)[An]()).replace("{decimal}",l(this,qn)[qn](l(this,xn)[xn].decimal)),s=o.replace(/{digits}/g,"[0-9]").replace("{decimal}","\\.");l(this,Tn)[Tn]=!("[0123456789]"===l(this,An)[An]()&&"."===l(this,xn)[xn].decimal),l(this,On)[On]=new RegExp(a,"g"),l(this,Nn)[Nn]=new RegExp(s,"g")}l(this,En)[En].setAttribute("type","text"),l(this,Cn)[Cn](e)}var t=e.prototype;return t.getValue=function(e){return(e=l(this,In)[In](e)).length>0&&l(this,Tn)[Tn]&&!e.match(l(this,Nn)[Nn])?(l(this,Ln)[Ln]=!0,e=l(this,Wn)[Wn](e)):l(this,Ln)[Ln]=!1,e&&e.length>=l(this,xn)[xn].combCells&&(e=e.slice(0,l(this,xn)[xn].combCells)),l(this,Pn)[Pn]=e,e},t.trigger=function(e,t){if(!l(this,En)[En])return this;var n=e.split(".")[0];if(void 0!==document.body["on"+n])return l(this,En)[En].dispatchEvent(new Event(n)),this;var r=new CustomEvent(n,{detail:t||null});return l(this,En)[En].dispatchEvent(r),this},t.getHTMLSupportedAttr=function(e,t){try{return e[t]}catch(e){return}},t.isNonPrintableKey=function(e){return e&&!["MozPrintableKey","Divide","Multiply","Subtract","Add","Enter","Decimal","Spacebar","Del"].includes(e)&&1!==e.length},t.setValue=function(e){l(this,Qn)[Qn]()||(e&&l(this,Ln)[Ln]?l(this,En)[En].value=l(this,Gn)[Gn](e):l(this,En)[En].value=l(this,Mn)[Mn].value)},e}();function Jn(e){return e.replace(/[\uff00-\uffef]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)})}function Yn(e,t){var n=this;e.addEventListener("keydown",function(e){l(n,$n)[$n](e)}),e.addEventListener("keypress",function(e){l(n,Hn)[Hn](e)}),e.addEventListener("paste",function(e){l(n,Un)[Un](e)}),e.addEventListener("cut",function(e){l(n,zn)[zn](e)}),e.addEventListener("blur",function(e){l(n,Mn)[Mn].value=n.getValue(e.target.value)}),l(this,Fn)[Fn](e)}function Kn(e){var t=!1,n=this,r=function(){var t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()};e.addEventListener("keyup",function(e){t&&(l(n,Rn)[Rn](e)&&r(),t=!1)}),e.addEventListener("compositionstart",function(e){}),e.addEventListener("compositionupdate",function(e){l(n,Rn)[Rn](e)&&r()}),e.addEventListener("compositionend",function(e){t=!0}),e.addEventListener("keydown",function(e){229!==e.which&&(t=!1)})}function Xn(){for(var e=l(this,xn)[xn].zero.charCodeAt(0),t="",n=0;n<10;n++)t+=String.fromCharCode(e+n);return"["+t+"]"}function er(e){return e.replace(".","\\.")}function tr(e){var t=this,n=!1,r=l(t,xn)[xn].leadDigits,i=l(t,xn)[xn].fracDigits;if(-1!==r){var o=l(this,En)[En].value;"compositionupdate"===e.type&&e.originalEvent.data&&(o+=e.originalEvent.data.substr(e.originalEvent.data.length-1));var a=r+(-1!==i?i+l(t,xn)[xn].decimal.length:0);-1===o.indexOf(l(t,xn)[xn].decimal)&&(a=r);var s=l(this,In)[In](o),u=s.match(l(t,On)[On])||s.match(l(this,Nn)[Nn]);if(n=!u,null===u)l(t,En)[En].value=l(t,Pn)[Pn],n=!0;else if(n){var c=o.substr(0,a);l(t,En)[En].value=c,l(t,Pn)[Pn]=c,n=!0}else l(t,Pn)[Pn]=o}return n}function nr(e,t,n){if(e.ctrlKey&&!["paste","cut"].includes(e.type))return!0;l(this,$n)[$n](arguments),l(this,xn)[xn].lengthLimitVisible=!0;var r,i=l(this,En)[En].value,o=this.getHTMLSupportedAttr(l(this,En)[En],"selectionStart")||0,a=!(null==o),s=this.getHTMLSupportedAttr(l(this,En)[En],"selectionEnd")||0,u=parseInt(l(this,xn)[xn].combCells)||0,c=t;if(u>0&&(c=t.substr(0,u-i.length+s-o)),!a)return!0;r=i.substr(0,o)+c+i.substr(s);var h=l(this,In)[In](r);return null==l(this,On)[On]||h.match(l(this,On)[On])||h.match(l(this,Nn)[Nn])?!["keydown","cut"].includes(e.type)&&u&&(i.length>=u||r.length>u)&&o===s?(e.preventDefault(),!1):(l(this,xn)[xn].curValue=i,l(this,Pn)[Pn]=i,void(l(this,xn)[xn].pos=o)):(e.preventDefault(),!1)}function rr(e){if(e){var t=e.charCode||e.which||e.keyCode||0;if(8===t||46===t)l(this,Vn)[Vn](e,"",t);else if(32===t)return e.preventDefault(),!1}}function ir(e){e=l(this,In)[In](e);var t=String.fromCharCode(l(this,xn)[xn].zero.charCodeAt(0)+9);return e>="0"&&e<="9"||e>=l(this,xn)[xn].zero&&e<=t||e===l(this,xn)[xn].decimal||e===l(this,xn)[xn].minus}function or(e){if(e){var t=e.charCode||e.which||e.keyCode||0,n=String.fromCharCode(t);if(this.isNonPrintableKey(e.key))return!0;if(l(this,Bn)[Bn](n))l(this,Vn)[Vn](e,n,t);else if(!e.ctrlKey)return e.preventDefault(),!1}}function ar(e){if(e){var t=void 0;if(window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):(e.originalEvent||e).clipboardData&&(e.originalEvent||e).clipboardData.getData&&(t=(e.originalEvent||e).clipboardData.getData("text/plain")),t)if(t.split("").every(function(e){return l(this,Bn)[Bn](e)},this))t=l(this,In)[In](t),l(this,Vn)[Vn](e,t,0);else if(!e.ctrlKey)return e.preventDefault(),!1}}function sr(e){e&&l(this,Vn)[Vn](e,"",0)}function ur(e){var t=l(this,xn)[xn].zero.charCodeAt(0);return e.map(function(e){return"."===e?l(this,xn)[xn].decimal:"-"===e?l(this,xn)[xn].minus:String.fromCharCode(parseInt(e)+t)},this).join("")}function lr(e){e=l(this,In)[In](e);var t=l(this,xn)[xn].zero.charCodeAt(0);return e.map(function(e){return e===l(this,xn)[xn].decimal?".":e===l(this,xn)[xn].minus?"-":(e.charCodeAt(0)-t).toString()},this).join("")}function cr(){return null===l(this,Mn)[Mn].value&&""===l(this,En)[En].value||l(this,Mn)[Mn].value===l(this,En)[En].value}var hr=/*#__PURE__*/function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).widgetObject=void 0,t}i(t,e);var n=t.prototype;return n.getClass=function(){return t.IS},n.getWidget=function(){return this.element.querySelector(t.selectors.widget)},n.getDescription=function(){return this.element.querySelector(t.selectors.description)},n.getLabel=function(){return this.element.querySelector(t.selectors.label)},n.getErrorDiv=function(){return this.element.querySelector(t.selectors.errorDiv)},n.getTooltipDiv=function(){return this.element.querySelector(t.selectors.tooltipDiv)},n.getQuestionMarkDiv=function(){return this.element.querySelector(t.selectors.qm)},n._updateValue=function(t){null==this.widgetObject&&(this._model._jsonModel.editFormat||this._model._jsonModel.displayFormat)&&(this.widgetObject=new Zn(this.getWidget(),this._model)),this.widgetObject?this.widgetObject.setValue(t):e.prototype._updateValue.call(this,t)},n.addListener=function(){var e,t=this;this._model._jsonModel.editFormat||this._model._jsonModel.displayFormat?null==this.widgetObject&&(this.widgetObject=new Zn(this.getWidget(),this._model)):null==(e=this.getWidget())||e.addEventListener("blur",function(e){t._model.value=e.target.value})},n.getbemBlock=function(){return t.bemBlock},n.getIS=function(){return t.IS},n.getInputHTML=function(){return'<input\n            class="cmp-adaptiveform-numberinput__widget"\n            title="'+(this.isTooltipVisible()?this.getTooltipValue():"")+'"\n            aria-label="'+(this.isLabelVisible()?this.getLabelValue():"")+'"\n            type="number"\n            name="'+this.getName()+'"\n            value="'+this.getDefault()+'"\n            max="'+this.getMaximum()+'"\n            min="'+this.getMinimum()+'"\n            '+this.getDisabledHTML()+"\n            "+this.getReadonlyHTML()+'\n            required="'+this.isRequired()+'"\n            placeholder="'+this.getPlaceHolder()+'"/>'},t}(h);hr.NS="cmp",hr.IS="adaptiveFormNumberInput",hr.bemBlock="cmp-adaptiveform-numberinput",hr.selectors={self:"[data-"+hr.NS+'-is="'+hr.IS+'"]',widget:"."+hr.bemBlock+"__widget",label:"."+hr.bemBlock+"__label",description:"."+hr.bemBlock+"__longdescription",errorDiv:"."+hr.bemBlock+"__errormessage",qm:"."+hr.bemBlock+"__questionmark",tooltipDiv:"."+hr.bemBlock+"__shortdescription"};var dr=/*#__PURE__*/function(e){function t(n,r){var i;return(i=e.call(this,n,r)||this).qm=i.element.querySelector(t.selectors.qm),i}i(t,e);var n=t.prototype;return n.getWidget=function(){return this.element.querySelector(t.selectors.widget)},n.getWidgets=function(){return this.element.querySelectorAll(t.selectors.widget)},n.getDescription=function(){return this.element.querySelector(t.selectors.description)},n.getLabel=function(){return this.element.querySelector(t.selectors.label)},n.getQuestionMarkDiv=function(){return this.element.querySelector(t.selectors.qm)},n.getTooltipDiv=function(){return this.element.querySelector(t.selectors.tooltipDiv)},n.getErrorDiv=function(){return this.element.querySelector(t.selectors.errorDiv)},n._updateValue=function(e){null!=e&&this.getWidgets().forEach(function(t){null!=t.value&&e.toString()==t.value.toString()?(t.checked=!0,t.setAttribute("checked","checked"),t.setAttribute("aria-checked",!0+"")):(t.checked=!1,t.removeAttribute("checked"),t.setAttribute("aria-checked",!1+""))},this)},n._updateEnabled=function(e){this.toggle(e,"aria-disabled",!0),this.element.setAttribute("data-cmp-enabled",e+"");var t=this.getWidgets();null==t||t.forEach(function(t){!1===e?(t.setAttribute("disabled",!0+""),t.setAttribute("aria-disabled",!0+"")):(t.removeAttribute("disabled"),t.removeAttribute("aria-disabled"))})},n.addListener=function(){var e=this;this.getWidgets().forEach(function(t){t.addEventListener("change",function(t){e._model.value=t.target.value})})},n.getbemBlock=function(){return t.bemBlock},n.getIS=function(){return t.IS},n.getInputHTML=function(){var e,t,n=this;return"\n            "+(null==(e=this.getState())||null==(t=e.enum)?void 0:t.map(function(e,t){var r;return n.getRadioHTML(n,e,null==(r=n.getState())?void 0:r.enumNames[t],t)}).join(""))},n.getRadioHTML=function(e,t,n,r){return'<div class="cmp-adaptiveform-radiobutton__option '+e.getLayoutProperties().orientation+'">\n                    <label class="cmp-adaptiveform-radiobutton__option__label"\n                            title="'+e.getTooltipValue()+'"\n                            aria-describedby="_desc"\n                            aria-label="'+n+'">\n                        <input type="radio"\n                                name="'+e.getName()+'"\n                                class="cmp-adaptiveform-radiobutton__option__widget"\n                                id="'+e.getId()+"_"+r+'__widget"\n                                value="'+t+'"\n                                '+this.getDisabledHTML()+'\n                                aria-describedby="_desc"\n                                checked="'+(t==this.getDefault())+'"/>\n                        <span>'+n+"</span>\n                    </label>\n                </div>\n            </div>"},t}(h);dr.NS="cmp",dr.IS="adaptiveFormRadioButton",dr.bemBlock="cmp-adaptiveform-radiobutton",dr.selectors={self:"[data-"+dr.NS+'-is="'+dr.IS+'"]',widget:"."+dr.bemBlock+"__option__widget",label:"."+dr.bemBlock+"__label",description:"."+dr.bemBlock+"__longdescription",qm:"."+dr.bemBlock+"__questionmark",errorDiv:"."+dr.bemBlock+"__errormessage",tooltipDiv:"."+dr.bemBlock+"__shortdescription"};var fr=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.getWidget=function(){return null},n.getDescription=function(){return null},n.getLabel=function(){return null},n.getErrorDiv=function(){return null},n.getTooltipDiv=function(){return null},n.getQuestionMarkDiv=function(){return null},n.getClass=function(){return t.IS},n.setFocus=function(){this.setActive()},n.getbemBlock=function(){return t.bemBlock},n.getIS=function(){return t.IS},n.getHTML=function(){return'\n        <div data-cmp-is="'+this.getIS()+'"\n            id="'+this.id+'"\n            data-cmp-adaptiveformcontainer-path="'+this.getFormContainerPath()+'"\n            data-cmp-visible="'+this.getDefault()+'"\n            class="cmp-adaptiveform-text">\n            <div class="cmp-adaptiveform-text__widget" tabindex="0">\n                '+this.getState().value+"\n            </div>\n        </div>"},t}(h);fr.NS="cmp",fr.IS="adaptiveFormText",fr.bemBlock="cmp-adaptiveform-text",fr.selectors={self:"[data-"+fr.NS+'-is="'+fr.IS+'"]'};var pr=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.getWidget=function(){return this.element.querySelector(t.selectors.widget)},n.getDescription=function(){return this.element.querySelector(t.selectors.description)},n.getLabel=function(){return this.element.querySelector(t.selectors.label)},n.getErrorDiv=function(){return this.element.querySelector(t.selectors.errorDiv)},n.getTooltipDiv=function(){return this.element.querySelector(t.selectors.tooltipDiv)},n.getQuestionMarkDiv=function(){return this.element.querySelector(t.selectors.qm)},n.addListener=function(){var e,t,n=this;null==(e=this.getWidget())||e.addEventListener("blur",function(e){n._model.value=e.target.value,n.setInactive()}),null==(t=this.getWidget())||t.addEventListener("focus",function(e){n.setActive()})},n.getbemBlock=function(){return t.bemBlock},n.getIS=function(){return t.IS},n.getInputHTML=function(){return'\n            <br>\n            <p class="range-info">'+this.getMinimum()+'</p>\n            <input\n                class="cmp-adaptiveform-SliderInput__widget"\n                title="'+(this.isTooltipVisible()?this.getTooltipValue():"")+'"\n                aria-label="'+(this.isLabelVisible()?this.getLabelValue():"")+'"\n                type="range"\n                name="'+this.getName()+'"\n                value="'+this.getDefault()+'"\n                step="'+this.getState().step+'"\n                '+this.getDisabledHTML()+"\n                "+this.getReadonlyHTML()+'\n                required="'+this.isRequired()+'"\n                placeholder="'+this.getPlaceHolder()+'"\n                min="'+this.getMinimum()+'"\n                max="'+this.getMaximum()+'"/>\n            \n            <p class="range-info">'+this.getMaximum()+"</p>\n            "},t}(h);pr.NS="cmp",pr.IS="adaptiveFormSliderInput",pr.bemBlock="cmp-adaptiveform-sliderinput",pr.selectors={self:"[data-"+pr.NS+'-is="'+pr.IS+'"]',widget:"."+pr.bemBlock+"__widget",label:"."+pr.bemBlock+"__label",description:"."+pr.bemBlock+"__longdescription",qm:"."+pr.bemBlock+"__questionmark",errorDiv:"."+pr.bemBlock+"__errormessage",tooltipDiv:"."+pr.bemBlock+"__shortdescription"};var vr=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t.prototype.getInputHTML=function(){return'<input\n              class="cmp-adaptiveform-textinput__widget"\n              title="'+(this.isTooltipVisible()?this.getTooltipValue():"")+'"\n              aria-label="'+(this.isLabelVisible()?this.getLabelValue():"")+'"\n              type="email"\n              name="'+this.getName()+'"\n              value="'+this.getDefault()+'"\n              '+this.getDisabledHTML()+"\n              "+this.getReadonlyHTML()+'\n              required="'+this.isRequired()+'"\n              placeholder="'+this.getPlaceHolder()+'"\n              minlength="'+this.getMinLength()+'"\n              maxlength="'+this.getMaxLength()+'"/>'},t}(d),gr=/*#__PURE__*/function(e){function t(n,r){var i;return(i=e.call(this,n,r)||this).widgetLabel=void 0,i.qm=i.element.querySelector(t.selectors.qm),i.widgetLabel=i.element.querySelector(t.selectors.widgetLabel),i}i(t,e);var n=t.prototype;return n.getWidget=function(){return this.element.querySelector(t.selectors.widget)},n.getWidgets=function(){return this.element.querySelectorAll(t.selectors.widget)},n.getDescription=function(){return this.element.querySelector(t.selectors.description)},n.getLabel=function(){return this.element.querySelector(t.selectors.label)},n.getErrorDiv=function(){return this.element.querySelector(t.selectors.errorDiv)},n.getQuestionMarkDiv=function(){return this.element.querySelector(t.selectors.qm)},n.getTooltipDiv=function(){return this.element.querySelector(t.selectors.tooltipDiv)},n._updateModelValue=function(){var e=[],t=this.getWidgets();null==t||t.forEach(function(t){t.checked&&e.push(t.value)},this),this._model.value=e},n._updateEnabled=function(e){this.toggle(e,"aria-disabled",!0),this.element.setAttribute("data-cmp-enabled",e+"");var t=this.getWidgets();null==t||t.forEach(function(t){!1===e?(t.setAttribute("disabled",!0+""),t.setAttribute("aria-disabled",!0+"")):(t.removeAttribute("disabled"),t.removeAttribute("aria-disabled"))})},n.getEnum=function(){var e;return null==(e=this.getState())?void 0:e.enum},n.getEnumNames=function(){var e;return null==(e=this.getState())?void 0:e.enumNames},n.addListener=function(){var e=this;this.getWidgets().forEach(function(t){t.addEventListener("change",function(t){e._updateModelValue()})})},n.getbemBlock=function(){return t.bemBlock},n.getIS=function(){return t.IS},n.getInputHTML=function(){var e,t=this;return'\n            <div class="cmp-adaptiveform-checkboxgroup__widget">\n            '+(null==(e=this.getEnum())?void 0:e.map(function(e,n,r){var i;return t.getCheckboxHTML(t,e,(null==(i=t.getEnumNames())?void 0:i[n])||e,n,null==r?void 0:r.length)}).join(""))+"\n            </div>\n            "},n.getCheckboxHTML=function(e,t,n,r,i){return'<div class="cmp-adaptiveform-checkboxgroup-item '+e.getName()+" "+e.getLayoutProperties().orientation+' ">\n                <label class="cmp-adaptiveform-checkbox__label" aria-label="'+n+'"\n                    title="'+e.getTooltipValue()+'" for="'+e.id+"_"+r+'__widget">\n                    <input class="cmp-adaptiveform-checkbox__widget" type="checkbox" id="'+e.id+"_"+r+'__widget"\n                        aria-describedby="_desc"\n                        name="'+(i>1?e.getName():e.getLabelValue())+'"\n                        value="'+t.toString()+'"\n                        checked="'+(t==e.getDefault())+'"\n                        '+this.getDisabledHTML()+" />\n                    <span>"+(this.getEnum().length>1?n:e.getLabelValue())+"</span>\n                </label>\n            </div>"},n.renderLabel=function(){return this.isLabelVisible()&&this.getEnum().length>1?'<label id="'+this.getId()+'-label" for="'+this.getId()+'" class="'+this.getbemBlock()+'__label" >'+this.getLabelValue()+"</label>":""},t}(h);gr.NS="cmp",gr.IS="adaptiveFormCheckBoxGroup",gr.bemBlock="cmp-adaptiveform-checkboxgroup",gr.checkboxBemBlock="cmp-adaptiveform-checkbox",gr.selectors={self:"[data-"+gr.NS+'-is="'+gr.IS+'"]',widgets:"."+gr.bemBlock+"__widgets",widget:"."+gr.checkboxBemBlock+"__widget",widgetLabel:"."+gr.checkboxBemBlock+"__label",label:"."+gr.bemBlock+"__label",description:"."+gr.bemBlock+"__longdescription",qm:"."+gr.bemBlock+"__questionmark",errorDiv:"."+gr.bemBlock+"__errormessage",tooltipDiv:"."+gr.bemBlock+"__shortdescription"};var mr=/*#__PURE__*/function(){function e(e){var t=this;this._model=void 0,this._path=void 0,this._fields=void 0,this._deferredParents=void 0,this.renderChildrens=function(e,n){console.log("Rendering childrens");var r=null==n?void 0:n.items;r&&r.length>0&&r.forEach(function(n){e.append(t.getRender(n))})},this.getRender=function(e){var n=document.createElement("div");try{var r,i=t.getModel(e.id),o={element:n,id:e.id};switch(null==e?void 0:e.fieldType){case"checkbox":r=new gr(o,i);break;case"email":r=new vr(o,i);break;case"slider":r=new pr(o,i);break;case"plain-text":r=new fr(o,i);break;case"radio":r=new dr(o,i);break;case"number":r=new hr(o,i);break;case"button":r=new jn(o,i);break;case"select":r=new wn(o,i);break;case"text-area":r=new _n(o,i);break;default:r=new d(o,i)}r&&r.render()}catch(e){console.error("Unexpected error ",e)}return n},this._model=function(e,t,n,r){void 0===n&&(n="error"),void 0===r&&(r=void 0);try{var i=r;null==i&&(i=new mn(Ie({},e),new yn,new ln(new sn(n)),n));var o=null==e?void 0:e.data;return o&&i.importData(o),i.getEventQueue().runPendingQueue(),i}catch(e){throw console.error("Unable to create an instance of the Form "+e),new Error(e)}}(r({},e._formJson)),this._path=e._path,this._fields={},this._deferredParents={}}var t=e.prototype;return t.getField=function(e){return this._fields.hasOwnProperty(e)?this._fields[e]:null},t.getModel=function(e){return e?this._model.getElement(e):this._model},t.addField=function(e){if(e.getFormContainerPath()===this._path){var t=e.getId();this._fields[t]=e;var n=this.getModel(t);e.setModel(n);var r=n.parent.id;if("$form"!=r){var i=this._fields[r];i?e.setParent(i):(this._deferredParents[r]||(this._deferredParents[r]=[]),this._deferredParents[r].push(e))}if(this._deferredParents[t]){for(var o=this._deferredParents[t],a=0;a<o.length;a++)o[a].setParent(e);delete this._deferredParents[t]}e.subscribe()}},t.setFocus=function(e){if(e){var t=this._fields[e];t&&t.setFocus?t.setFocus():console.log("View on which focus is to be set, not initialized.")}},t.getPath=function(){return this._path},t.render=function(){var e=document.createElement("form");e.className="cmp-adaptiveform-container cmp-container";var t=this._model.getState();return this.renderChildrens(e,t),e},e}(),yr=/*#__PURE__*/u("handlePanel"),_r=/*#__PURE__*/u("handleProperty"),br=/*#__PURE__*/u("handleCheckbox"),wr=/*#__PURE__*/u("setProperty"),kr=/*#__PURE__*/u("handleMultiValues"),jr=/*#__PURE__*/u("handleHierarchy"),Er=/*#__PURE__*/u("isRule"),Mr=/*#__PURE__*/u("isConstraintMsg"),xr=/*#__PURE__*/u("isPanel"),Dr=/*#__PURE__*/u("isEndingPanel"),Sr=/*#__PURE__*/u("cleanUpPanel"),Or=/*#__PURE__*/function(){function e(){Object.defineProperty(this,Sr,{value:Vr}),Object.defineProperty(this,Dr,{value:Rr}),Object.defineProperty(this,xr,{value:qr}),Object.defineProperty(this,Mr,{value:Ar}),Object.defineProperty(this,Er,{value:Fr}),Object.defineProperty(this,jr,{value:Cr}),Object.defineProperty(this,kr,{value:Ir}),Object.defineProperty(this,wr,{value:Pr}),Object.defineProperty(this,br,{value:Lr}),Object.defineProperty(this,_r,{value:Nr}),Object.defineProperty(this,yr,{value:Tr})}var t=e.prototype;return t._getForm=function(e){try{if(!e)throw new Error("form name is required");return Promise.resolve(fetch(e)).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}},t.getFormModel=function(e){try{var t=this;return Promise.resolve(function(){if(e){var n={adaptiveform:"0.10.0",metadata:{grammar:"json-formula-1.0.0",version:"1.0.0"},items:[]};return console.time("Get Excel JSON"),Promise.resolve(t._getForm(e)).then(function(r){if(console.timeEnd("Get Excel JSON"),!r||!r.data)throw new Error("Unable to retrieve the form details with excel name "+e);var i=[];i.push(n.items);var o=n;return r.data.forEach(function(e){if(l(t,xr)[xr](e)){e.items={};var r=JSON.parse(JSON.stringify(e));l(t,yr)[yr](r),o.items.push(r),i.push(o),o=r}else l(t,Dr)[Dr](e)?(o=i.pop())||(o=n):o.items.push(l(t,_r)[_r](e))}),{formDef:n,excelData:r}})}}())}catch(e){return Promise.reject(e)}},e}();function Tr(e){if(l(this,Sr)[Sr](e),l(this,Er)[Er](e)){var t=l(this,jr)[jr](e,"Rules.");t&&0!=Object.keys(t).length&&(e.rules=t)}var n=l(this,jr)[jr](e,"events.");n&&0!=Object.keys(n).length&&(e.events=n)}function Nr(e){var t=Object.fromEntries(Object.entries(e).filter(function(e){var t=e[1];return null!=t&&""!=t})),n=Or.fieldMapping.has(t.Type)?Or.fieldMapping.get(t.Type):t.Type,r={name:t.Field,placeholder:t.Placeholder,type:"string",fieldType:n,value:t.Value,label:{value:t.Label},required:!!t.Mandatory};if(l(this,wr)[wr](t,"Maximum",r,"maximum"),l(this,wr)[wr](t,"Minimum",r,"minimum"),l(this,wr)[wr](t,"MaxLength",r,"maxLength"),l(this,wr)[wr](t,"MinLength",r,"minLength"),l(this,wr)[wr](t,"Step",r,"step"),l(this,Er)[Er](t)){var i=l(this,jr)[jr](t,"Rules.");i&&0!=Object.keys(i).length&&(r.rules=i)}if(l(this,Mr)[Mr](t)){var o=l(this,jr)[jr](t,"constraintMessages.");o&&0!=Object.keys(o).length&&(r.constraintMessages=o)}var a=l(this,jr)[jr](t,"events.");a&&0!=Object.keys(a).length&&(r.events=a);var s=l(this,kr)[kr](t,"Options");return s&&(r.enumNames=r.enum=s),l(this,br)[br](r),r}function Lr(e){"checkbox"!=(null==e?void 0:e.fieldType)||e.enum&&0!=e.enum.length||(e.enum=["on"])}function Pr(e,t,n,r){e&&e[t]&&(n[r]=e[t])}function Ir(e,t){var n;return e&&e[t]&&(n=e[t].split(",").map(function(e){return e.trim()})),n}function Cr(e,t){var n={};return Object.keys(e).forEach(function(r){if(~r.indexOf(t)){var i=r.split(".")[1];e[r]&&(n[i]=e[r]),delete e[r]}}),n}function Fr(e){return Object.keys(e).some(function(e){return~e.indexOf("Rules.")})}function Ar(e){return Object.keys(e).some(function(e){return~e.indexOf("constraintMessages.")})}function qr(e){return e&&"object"==e.type}function Rr(e){return e&&"page-break"==e.viewType}function Vr(e){delete e.type}Or.fieldMapping=new Map([["text-input","text"],["number-input","number"],["date-input","datetime-local"],["file-input","file"],["drop-down","select"],["radio-group",""],["checkbox-group",""],["plain-text","plain-text"],["checkbox","checkbox"],["multiline-input","text-area"],["panel","panel"],["submit","button"]]);var $r=function(e){try{var t=null==e?void 0:e.querySelector('a[href$=".json"]'),n=function(){if(t&&null!=t&&t.href){var e=t.replaceWith;return Promise.resolve(Br(t.href)).then(function(n){e.call(t,n)})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},Br=function(e){try{console.log("Loading & Converting excel form to Crispr Form"),console.time("Json Transformation (including Get)");var t=new Or;return Promise.resolve(t.getFormModel(e)).then(function(e){console.timeEnd("Json Transformation (including Get)"),console.log(e),console.log("Creating Form Container"),console.time("Form Model Instance Creation");var t=new mr({_formJson:null==e?void 0:e.formDef});console.timeEnd("Form Model Instance Creation"),window.guideContainer=t,console.time("Form Rendition");var n=t.render();return console.timeEnd("Form Rendition"),n})}catch(e){return Promise.reject(e)}};$r(document.getElementsByClassName("form")[0]);export{$r as default};
